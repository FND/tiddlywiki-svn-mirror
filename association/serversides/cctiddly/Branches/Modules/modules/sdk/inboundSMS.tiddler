<div tiddler="inboundSMS" modifier="ccTiddly" modified="200805082300" created="200805082300" tags="systemConfig excludeLists excludeSearch ccTiddly" changecount="1" server.type="file" server.host="10.0.200.170/sdk" server.page.revision="200805082300">//{{{\n	\n	\n	\n//config.macros.notifyUsers={};\n//config.macros.notifyUsers.handler=function(place,macroName,params,wikifier,paramString,tiddler,errorMsg){\n//var tagged = store.getTaggedTiddlers('notifyUser');	\n//	if(tagged.length &gt; 0) {\n//		for(var i = 0; i &lt; tagged.length; i++) {\n//			var textHolder1 = createTiddlyElement(place, &quot;span&quot;,&quot;users&quot;, &quot;leftAlign smsList&quot;);\n//			var item1 = createTiddlyText(textHolder1,tagged[i].text);\n//		}\n//	}\n//};\n\n\nconfig.macros.inboundSMS={};\nconfig.macros.inboundSMS.handler=function(place,macroName,params,wikifier,paramString,tiddler,errorMsg){\n	var inboundSMSDiv=createTiddlyElement(place,&quot;div&quot;,null,&quot;inboundSMSDiv&quot;,null);\n	this.refresh(inboundSMSDiv);	\n};	\n\nconfig.macros.inboundSMS.refresh=function(place,errorMsg){		\n	var inboundSMSDiv=document.getElementById(&quot;inboundSMSDiv&quot;);\n	removeChildren(inboundSMSDiv);\n	\n	var tagged = store.getTaggedTiddlers('sms');\n	if(tagged.length &gt; 0) {\n		for(var i = 0; i &lt; tagged.length; i++) {\n			var textHolder = createTiddlyElement(place, &quot;span&quot;,&quot;messages&quot;, &quot;leftAlign smsList&quot;);\n			var item = createTiddlyText(textHolder,tagged[i].text);\n			var btnHolder = createTiddlyElement(place, &quot;div&quot;,&quot;&quot;,&quot;rightAlign smsList&quot;);\n			var btnAdd = createTiddlyButton(btnHolder,&quot;add&quot;,&quot;add this message&quot;);\n			btnAdd.id=tagged[i].title;\n			btnAdd.textvalue=tagged[i].text;\n			btnAdd.onclick = function() {\n				displayMessage(this.id+this.text);\n				config.macros.inboundSMS.addTiddler(this.id, this.id, this.textvalue);\n			};\n			var btnDel = createTiddlyButton(btnHolder,&quot;remove&quot;,&quot;remove this message&quot;);\n			btnDel.id=tagged[i].title;\n			btnDel.onclick = function() {\n				config.macros.inboundSMS.delTiddler(this.id);\n			};				\n		}\n	}\n};\n\n\n\nconfig.macros.inboundSMS.delTiddler=function(id){\n	config.macros.inboundSMS.markAsRead(id);\n};\nconfig.macros.inboundSMS.addTiddler=function(id,title,body){\n	var tiddler=store.getTiddler(title); if (!tiddler) tiddler=new Tiddler();	\n	tiddler.set (title,body,&quot;&quot;,(new Date()),&quot;sms&quot;);\n	store.addTiddler(tiddler);\n	story.closeTiddler(title);	\n	story.displayTiddler(null,title,0);\n	store.notify(title,true);\n	store.saveTiddler(tiddler.title,tiddler.title,tiddler.text,tiddler.modifier,tiddler.modified,tiddler.tags,tiddler.fields,true,tiddler.created)\n//	config.macros.inboundSMS.markAsRead(id);\n}\n\nconfig.macros.inboundSMS.markAsRead=function(id){\n	var loginResp=doHttp('GET','http://127.0.0.1/sdk/sdk/examples/cmds/markMessageAsRead.php?id='+id,&quot;&quot;,null,null,null,config.macros.inboundSMS.readCallback,params);\n}\n\nconfig.macros.inboundSMS.readCallback=function(status,params,responseText,uri,xhr){\n	displayMessage(responseText);\n	displayMessage(&quot;Message cleared from inbox.&quot;);\n	window.location=window.location;\n}	\n//}}}</div>

<