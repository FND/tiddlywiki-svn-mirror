{% include 'search.html' %}
{% from 'labels.html' import labels %}
<div id="recordsTableContainer">
	<div id="results">
		{% set count = tiddlers|count %}
		<p class="small">
		{% if count == 0 %}
			There are no results - <span class="filter"><a href="javascript:;">try adding a filter to include other fields in the search</a></span>
		{% else %}
			{% if count == 1 %}
				There is {{count}} result
			{% elif count == 51 %}
				There are more than 50 results, only showing the first 50  
			{% else %}
				There are {{count}} results
			{% endif %}
		 - <span class="filter"><a href="javascript:;">add a filter</a>?</span>
		{% endif %}
		</p>
		<div class="right small" id="columnPicker">
			<div class="label">hide/show columns</div>
			{% for field, label in labels %}
			<div class="columns">
				<span class="label">{{label}}</span>
				<span class="controls">
					<span class="hideControl">hide</span>|<span class="showControl">show</span>
				</span>
			</div>
			{% endfor %}
		</div>
	</div>
	<table class="draggable forget-ordering" id="recordsTable">
		<thead>
			<tr>
			{% for field, label in labels %}
				<th>{{label}}</th>
			{% endfor %}
				<th>Challenge</th>
				<th>Request More Info</th>
			</tr>
		</thead>
		<tfoot class="dark">
			<tr>
			{% for field, label in labels %}
				<th><a href="javascript:;">hide</a></th>
			{% endfor %}
				<th><a href="javascript:;">hide</a></th>
				<th><a href="javascript:;">hide</a></th>
			</tr>
		</tfoot>
		<tbody>	
		{% for tiddler in tiddlers %}
		{# this if clause is a temporary hack until we don't supply a 'stub' tiddler #}
		{% if not (tiddler.title == 'stub') %}
			<tr>
				<td><a href="/bags/avox/tiddlers/{{tiddler.title}}.html">{{tiddler.title}}</a></td>
			{% for field, label in labels %}
				{% if field == 'avid' %}
				<td><a href="/bags/avox/tiddlers/{{tiddler.title}}.html">{{tiddler.title}}</a></td>
				{% else %}
				<td>{{tiddler.fields[field]}}</td>
				{% endif %}
			{% endfor %}
				<td><a href="/bags/avox/tiddlers/{{ tiddler.title }}.challenge">go</a></td>
				<td><a href="/bags/avox/tiddlers/{{ tiddler.title }}.request">go</a></td>
			</tr>
		{% endif %}
		{% endfor %}
		</tbody>
	</table>
</div>