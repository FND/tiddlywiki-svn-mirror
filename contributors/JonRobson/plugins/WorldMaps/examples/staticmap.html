<html>
<head>


<script src="../jquery.js" type="text/javascript"></script>
<script src="proj4js.js" type="text/javascript"></script>
<script src="merc.js" id="lib/projCode/merc.js" type="text/javascript"></script>


<script src="ieHack.js" type="text/javascript"></script>
<script src="../canvasMaps3D.js" type="text/javascript"></script>
<script src="whereLegal.js" type="text/javascript"></script>


<script>
var eMap = null;
function init(){
	eMap = new EasyMap('wrapper');
	eMap.wrapper.onmouseup = function(e){
	

		var s = eMap.utils.getShapeAtClick(e);
		console.log("clicked", s);
		if(s){
			alert(s.properties.name);
			}
	};
	eMap.settings.background = "#000000";
	eMap.utils = EasyMapUtils;
	//eMap.utils._testCanvas(eMap.canvas.getContext('2d'));


	eMap.addControl("pan");
	eMap.addControl("zoom");
	eMap.addControl("mousepanning");
	eMap.addControl("mousewheelzooming");
	


var that = eMap;
eMap.clear();
eMap._fittocanvas = false;

var ctx = eMap.canvas.getContext('2d');



var img = new Image();
img.src="http://maps.google.com/staticmap?center=0,0&zoom=-1&size=600x400&key=YOUR_KEY_HERE";
img.width = 300;



var p = {};


var projHash = {};

  for (var def in Proj4js.defs){
     projHash[def] = new Proj4js.Proj(def);    //create a Proj for each definition
 }

	p.source = projHash['WGS84'];
	p.dest = projHash['GOOGLE'];

	p.xy = function(x,y){
		var pointSource = new Proj4js.Point(x,y);
		var pointDest = Proj4js.transform(p.source,p.dest, pointSource);
		
		var newx =pointDest.x;
		var newy = pointDest.y;
		newx *= 0.00000655555;
		newy *= 0.00000655555;
		var res = {x:newx , y:newy};
		
		
		return res;
	}


eMap.settings.projection = p;



eMap.controller.oldtransform = eMap.controller.transform;
eMap.controller.transform = function(){


var zoomL = 0;

var x =0;
var y =0;

var  t= this.transformation.translate;
var  scale= this.transformation.scale;
zoomL = Math.round(Math.sqrt(scale.x));


lo = (t.y * scale.y);
la = (- t.x * scale.x);

var res = p.xy(lo,la);
x =res.x;
y = res.y;
eMap.settings.backgroundimg = "http://maps.google.com/staticmap?center="+x+","+y+"&zoom="+zoomL+"&size=600x400&key=YOUR_KEY_HERE";
this.oldtransform();


};

eMap.controller.setTransformation({translate:{x:1,y:1},scale: {x:1, y:1},rotate: {x:1,y:1}});
eMap.settings.backgroundimg = "http://maps.google.com/staticmap?center=0,0&zoom=0&size=600x400&key=YOUR_KEY_HERE";
eMap.drawFromGeojson(geojson);




}

</script>
</head>
<body onload="window.setTimeout(init,0)">

<div id='wrapper' style="width:600; height:400;position:relative;">
	<div id ='caption'></div>
	<div id='wrapper_statustext'>please wait while we load... </div>
</div>
<div id='time'></div>
<br>
<br>
<br>
<a href="javascript:eMap.zoom(0.5,0.5)">zoom in</a> <a href="javascript:eMap.zoom(-0.5,-0.5)">zoom out</a>


<a href="javascript:eMap.pan(0,20)">up</a> <a href="javascript:eMap.pan(0,-20)">down</a>

<a href="javascript:eMap.pan(20,0)">left</a> <a href="javascript:eMap.pan(-20,0)">right</a>


<div id='consolelogger'></div>


</body>
</html>