<html>
<head>


<script src="jquery.js" type="text/javascript"></script>

<script src="ieHack.js" type="text/javascript"></script>
<script src="canvasMaps3D.js" type="text/javascript"></script>

<script>
var eMap = null;
function init(){
	eMap = new EasyMap('wrapper');

	
	var that = eMap;
	var myElement = document.getElementById('caption');
	

	
	function highlight(shape){
		that.oldcolor = shape.fillStyle;
		that.oldstrokecolor = shape.strokeStyle;
		shape.fillStyle = "#FFFFFF";
		shape.strokeStyle = "#FFFFFF";
		var el = myElement;
		if(el.style.display == 'none'){
			el.style.position = "absolute";
			el.style.display = "";
			var legal = "";
			if(shape.properties.legality == 1) legal = " (legal)";
			else if(shape.properties.legality == 0) legal = "(illegal)";
			else legal = "(no data)";
			el.innerHTML = shape.tooltip + legal;
			el.style.left =0;
			el.style.top = 300;

		}	
		that.redrawShape(shape);
	}
	
	function dehighlight(shape){
		if(!shape) return;
		if(that.oldcolor)shape.fillStyle = that.oldcolor;
		if(that.oldstrokecolor)shape.strokeStyle = that.oldstrokecolor;
		that.redrawShape(shape);
		myElement.style.display = "none";
	}
	
	var shapeHighlighted;
	eMap.mousemoveHandler = function(e){
		try{
		var t1 = new Date();
		var shape = eMap.getShapeAt(e);
		var t2 = new Date();
		var time = t2-t1;
	
		if(!shape) {
			dehighlight(shapeHighlighted);
			shapeHighlighted = null;
			return;
		}
		
		if(shapeHighlighted) dehighlight(shapeHighlighted);
			highlight(shape);
			shapeHighlighted = shape;
		}
		catch(e){
			document.getElementById('time').innerHTML += e + ",";
		}

	};
	eMap.mousemoveHandler = function(e){
			//var shape =eMap.getShapeAtClick(e);
			
	//		if(shape)
	//		document.getElementById('time').innerHTML ="long: " + shape.longitudes + " lat:" + shape.latitudes;			
	};

	eMap.wrapper.onclick = function(e){

		var s = eMap.utils.getShapeAtClick(e);
		console.log(s);
		
		if(s)
			alert(s.properties.name);
	};
	eMap.spherical = true;
	eMap.drawFromGeojsonFile('whereLegal.json');
	eMap.addControl("pan");
	eMap.addControl("zoom");	
	var spin = function() {
		var t = eMap.controller.transformation;
		if(!t.rotate){
			t.rotate = {};
			t.rotate.x = 0;
			t.rotate.y = 0;
			t.rotate.z = 0;
		}
		t.rotate.z += 0.25;
		eMap.controller.setTransformation(t);
		window.setTimeout(spin,1000);
	}
	spin();
}

</script>
</head>

<body onload="window.setTimeout(init,0)">

<div id='wrapper' style="width:800; height:400;position:relative;">
	<div id ='caption'></div>
	<div id='wrapper_statustext'>please wait while we load... </div>
</div>
<div id='time'></div>







</body>
</html>