<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<script type="text/javascript">
//<![CDATA[
var version = {major: 2, minor: 1, revision: 3, date: new Date("Nov 3, 2006"), extensions: {}};
//]]>
</script>
<!--
TiddlyWiki 2.1.3 by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)

Copyright (c) Osmosoft Limited 2004-2006

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.

Redistributions in binary form must reproduce the above copyright notice, this
list of conditions and the following disclaimer in the documentation and/or other
materials provided with the distribution.

Neither the name of the Osmosoft Limited nor the names of its contributors may be
used to endorse or promote products derived from this software without specific
prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE.
-->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<!--PRE-HEAD-START-->
<!--{{{-->
<link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml'/>
<!--}}}-->
<!--PRE-HEAD-END-->
<title> Socialtext Unplugged - Socialtext Open Source Wiki </title>
<script type="text/javascript">
//<![CDATA[
//
// 
// This code is designed to be readable but for compactness it only includes brief comments. You can see fuller comments
// in the project Subversion repository:
//
// http://svn.tiddlywiki.org/Trunk/core/
//
//
// ---------------------------------------------------------------------------------
// Configuration repository
// ---------------------------------------------------------------------------------

// Miscellaneous options
var config = {
	numRssItems: 20, // Number of items in the RSS feed
	animFast: 0.12, // Speed for animations (lower == slower)
	animSlow: 0.01, // Speed for EasterEgg animations
	cascadeFast: 20, // Speed for cascade animations (higher == slower)
	cascadeSlow: 60, // Speed for EasterEgg cascade animations
	cascadeDepth: 5, // Depth of cascade animation
	displayStartupTime: false // Whether to display startup time
	};

// Messages
config.messages = {
	messageClose: {},
	dates: {}
};

// Options that can be set in the options panel and/or cookies
config.options = {
	chkRegExpSearch: false,
	chkCaseSensitiveSearch: false,
	chkAnimate: true,
	chkSaveBackups: true,
	chkAutoSave: false,
	chkGenerateAnRssFeed: false,
	chkSaveEmptyTemplate: false,
	chkOpenInNewWindow: true,
	chkToggleLinks: false,
	chkHttpReadOnly: true,
	chkForceMinorUpdate: false,
	chkConfirmDelete: true,
	chkInsertTabs: false,
	txtBackupFolder: "",
	txtMainTab: "tabTimeline",
	txtMoreTab: "moreTabAll",
	txtMaxEditRows: "30"
	};
	
// List of notification functions to be called when certain tiddlers are changed or deleted
config.notifyTiddlers = [
	{name: "StyleSheetLayout", notify: refreshStyles},
	{name: "StyleSheetColors", notify: refreshStyles},
	{name: "StyleSheet", notify: refreshStyles},
	{name: "StyleSheetPrint", notify: refreshStyles},
	{name: "PageTemplate", notify: refreshPageTemplate},
	{name: "SiteTitle", notify: refreshPageTitle},
	{name: "SiteSubtitle", notify: refreshPageTitle},
	{name: "ColorPalette", notify: refreshColorPalette},
	{name: null, notify: refreshDisplay}
	];

// Default tiddler templates
var DEFAULT_VIEW_TEMPLATE = 1;
var DEFAULT_EDIT_TEMPLATE = 2;
config.tiddlerTemplates = {
	1: "ViewTemplate",
	2: "EditTemplate"
	};

// More messages (rather a legacy layout that shouldn't really be like this)
config.views = {
	wikified: {
		tag: {}
		},
	editor: {
		tagChooser: {}
		}
	};

// Backstage tasks
config.backstageTasks = ["tidy","sync","importTask","copy","plugins"];

// Macros; each has a 'handler' member that is inserted later
config.macros = {
	today: {},
	version: {},
	search: {sizeTextbox: 15},
	tiddler: {},
	tag: {},
	tags: {},
	tagging: {},
	timeline: {},
	allTags: {},
	list: {
		all: {},
		missing: {},
		orphans: {},
		shadowed: {}
		},
	closeAll: {},
	permaview: {},
	saveChanges: {},
	slider: {},
	option: {},
	newTiddler: {},
	newJournal: {},
	sparkline: {},
	tabs: {},
	gradient: {},
	message: {},
	view: {},
	edit: {},
	tagChooser: {},
	toolbar: {},
	br: {},
	plugins: {},
	refreshDisplay: {},
	importTiddlers: {}
	};

// Commands supported by the toolbar macro
config.commands = {
	closeTiddler: {},
	closeOthers: {},
	editTiddler: {},
	saveTiddler: {hideReadOnly: true},
	cancelTiddler: {},
	deleteTiddler: {hideReadOnly: true},
	permalink: {},
	references: {},
	jump: {}
	};

// Browser detection... In a very few places, there's nothing else for it but to
// know what browser we're using.
config.userAgent = navigator.userAgent.toLowerCase();
config.browser = {
	isIE: config.userAgent.indexOf("msie") != -1 && config.userAgent.indexOf("opera") == -1,
	ieVersion: /MSIE (\d.\d)/i.exec(config.userAgent), // config.browser.ieVersion[1], if it exists, will be the IE version string, eg "6.0"
	isSafari: config.userAgent.indexOf("applewebkit") != -1,
	isBadSafari: !((new RegExp("[\u0150\u0170]","g")).test("\u0150")),
	firefoxDate: /Gecko\/(\d{8})/i.exec(config.userAgent), // config.browser.firefoxDate[1], if it exists, will be Firefox release date as "YYYYMMDD"
	isOpera: config.userAgent.indexOf("opera") != -1,
	isLinux: config.userAgent.indexOf("linux") != -1,
	isUnix: config.userAgent.indexOf("x11") != -1,
	isMac: config.userAgent.indexOf("mac") != -1,
	isWindows: config.userAgent.indexOf("win") != -1
	};

// Basic regular expressions
config.textPrimitives = {
	upperLetter: "[A-Z\u00c0-\u00de\u0150\u0170]",
	lowerLetter: "[a-z0-9_\\-\u00df-\u00ff\u0151\u0171]",
	anyLetter:   "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]",
	anyLetterStrict: "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]"
	};
if(config.browser.isBadSafari)
	config.textPrimitives = {
		upperLetter: "[A-Z\u00c0-\u00de]",
		lowerLetter: "[a-z0-9_\\-\u00df-\u00ff]",
		anyLetter:   "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff]",
		anyLetterStrict: "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff]"
		}
config.textPrimitives.sliceSeparator = "::";
config.textPrimitives.urlPattern = "[a-z]{3,8}:[^\\s:'\"][^\\s'\"]*(?:/|\\b)";
config.textPrimitives.unWikiLink = "~";
config.textPrimitives.wikiLink = "(?:(?:" + config.textPrimitives.upperLetter + "+" +
												config.textPrimitives.lowerLetter + "+" +
												config.textPrimitives.upperLetter +
												config.textPrimitives.anyLetter + "*)|(?:" +
												config.textPrimitives.upperLetter + "{2,}" +
												config.textPrimitives.lowerLetter + "+))";

config.textPrimitives.cssLookahead = "(?:(" + config.textPrimitives.anyLetter + "+)\\(([^\\)\\|\\n]+)(?:\\):))|(?:(" + config.textPrimitives.anyLetter + "+):([^;\\|\\n]+);)";
config.textPrimitives.cssLookaheadRegExp = new RegExp(config.textPrimitives.cssLookahead,"mg");

config.textPrimitives.brackettedLink = "\\[\\[([^\\]]+)\\]\\]";
config.textPrimitives.titledBrackettedLink = "\\[\\[([^\\[\\]\\|]+)\\|([^\\[\\]\\|]+)\\]\\]";
config.textPrimitives.tiddlerForcedLinkRegExp = new RegExp("(?:" + config.textPrimitives.titledBrackettedLink + ")|(?:" +
	config.textPrimitives.brackettedLink + ")|(?:" + 
	config.textPrimitives.urlPattern + ")","mg");
config.textPrimitives.tiddlerAnyLinkRegExp = new RegExp("("+ config.textPrimitives.wikiLink + ")|(?:" +
	config.textPrimitives.titledBrackettedLink + ")|(?:" +
	config.textPrimitives.brackettedLink + ")|(?:" +
	config.textPrimitives.urlPattern + ")","mg");

// ---------------------------------------------------------------------------------
// Shadow tiddlers
// ---------------------------------------------------------------------------------

config.shadowTiddlers = {
	StyleSheet: "",
	MarkupPreHead: "<!--{{{-->\n<link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml'/>\n<!--}}}-->",
	MarkupPostHead: "",
	MarkupPreBody: "",
	MarkupPostBody: ""
	};

// ---------------------------------------------------------------------------------
// Translateable strings
// ---------------------------------------------------------------------------------

// Strings in "double quotes" should be translated; strings in 'single quotes' should be left alone

merge(config.options,{
	txtUserName: "YourName"});

config.tasks = {
		tidy: {text: "tidy up", tooltip: "Make bulk changes across groups of tiddlers", content: 'Coming soon...\n\nThis tab will allow bulk operations on tiddlers, and tags. It will be a generalised, extensible version of the plugins tab'},
		sync: {text: "sync", tooltip: "Synchronise changes with other TiddlyWiki files and servers", content: '<<sync>>'},
		importTask: {text: "import", tooltip: "Import tiddlers and plugins from other TiddlyWiki files and servers", content: '<<importTiddlers>>'},
		copy: {text: "copy", tooltip: "Copy tiddlers to other TiddlyWiki files and servers", content: 'Coming soon...\n\nThis tab will allow tiddlers to be copied to remote servers'},
		plugins: {text: "plugins", tooltip: "Manage installed plugins", content: '<<plugins>>'}
};

merge(config.messages,{
	customConfigError: "Problems were encountered loading plugins. See PluginManager for details",
	pluginError: "Error: %0",
	pluginDisabled: "Not executed because disabled via 'systemConfigDisable' tag",
	pluginForced: "Executed because forced via 'systemConfigForce' tag",
	pluginVersionError: "Not executed because this plugin needs a newer version of TiddlyWiki",
	nothingSelected: "Nothing is selected. You must select one or more items first",
	savedSnapshotError: "It appears that this TiddlyWiki has been incorrectly saved. Please see http://www.tiddlywiki.com/#DownloadSoftware for details",
	subtitleUnknown: "(unknown)",
	undefinedTiddlerToolTip: "The tiddler '%0' doesn't yet exist",
	shadowedTiddlerToolTip: "The tiddler '%0' doesn't yet exist, but has a pre-defined shadow value",
	tiddlerLinkTooltip: "%0 - %1, %2",
	externalLinkTooltip: "External link to %0",
	noTags: "There are no tagged tiddlers",
	notFileUrlError: "You need to save this TiddlyWiki to a file before you can save changes",
	cantSaveError: "It's not possible to save changes. Possible reasons include:\n- your browser doesn't support saving (Firefox, Internet Explorer, Safari and Opera all work if properly configured)\n- the pathname to your TiddlyWiki file contains illegal characters\n- the TiddlyWiki HTML file has been moved or renamed",
	invalidFileError: "The original file '%0' does not appear to be a valid TiddlyWiki",
	backupSaved: "Backup saved",
	backupFailed: "Failed to save backup file",
	rssSaved: "RSS feed saved",
	rssFailed: "Failed to save RSS feed file",
	emptySaved: "Empty template saved",
	emptyFailed: "Failed to save empty template file",
	mainSaved: "Main TiddlyWiki file saved",
	mainFailed: "Failed to save main TiddlyWiki file. Your changes have not been saved",
	macroError: "Error in macro <<%0>>",
	macroErrorDetails: "Error while executing macro <<%0>>:\n%1",
	missingMacro: "No such macro",
	overwriteWarning: "A tiddler named '%0' already exists. Choose OK to overwrite it",
	unsavedChangesWarning: "WARNING! There are unsaved changes in TiddlyWiki\n\nChoose OK to save\nChoose CANCEL to discard",
	confirmExit: "--------------------------------\n\nThere are unsaved changes in TiddlyWiki. If you continue you will lose those changes\n\n--------------------------------",
	saveInstructions: "SaveChanges",
	unsupportedTWFormat: "Unsupported TiddlyWiki format '%0'",
	tiddlerSaveError: "Error when saving tiddler '%0'",
	tiddlerLoadError: "Error when loading tiddler '%0'",
	wrongSaveFormat: "Cannot save with storage format '%0'. Using standard format for save.",
	invalidFieldName: "Invalid field name %0",
	fieldCannotBeChanged: "Field '%0' cannot be changed",
	backstagePrompt: "backstage: "});

merge(config.messages.messageClose,{
	text: "close",
	tooltip: "close this message area"});

config.messages.dates.months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November","December"];
config.messages.dates.days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
config.messages.dates.shortMonths = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
config.messages.dates.shortDays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
config.messages.dates.am = "am";
config.messages.dates.pm = "pm";

merge(config.views.wikified.tag,{
	labelNoTags: "no tags",
	labelTags: "tags: ",
	openTag: "Open tag '%0'",
	tooltip: "Show tiddlers tagged with '%0'",
	openAllText: "Open all",
	openAllTooltip: "Open all of these tiddlers",
	popupNone: "No other tiddlers tagged with '%0'"});

merge(config.views.wikified,{
	defaultText: "The tiddler '%0' doesn't yet exist. Double-click to create it",
	defaultModifier: "(missing)",
	shadowModifier: "(built-in shadow tiddler)",
	createdPrompt: "created"});

merge(config.views.editor,{
	tagPrompt: "Type tags separated with spaces, [[use double square brackets]] if necessary, or add existing",
	defaultText: "Type the text for '%0'"});

merge(config.views.editor.tagChooser,{
	text: "tags",
	tooltip: "Choose existing tags to add to this tiddler",
	popupNone: "There are no tags defined",
	tagTooltip: "Add the tag '%0'"});

merge(config.macros.search,{
	label: "search",
	prompt: "Search this TiddlyWiki",
	accessKey: "F",
	successMsg: "%0 tiddlers found matching %1",
	failureMsg: "No tiddlers found matching %0"});

merge(config.macros.tagging,{
	label: "tagging: ",
	labelNotTag: "not tagging",
	tooltip: "List of tiddlers tagged with '%0'"});

merge(config.macros.timeline,{
	dateFormat: "DD MMM YYYY"});

merge(config.macros.allTags,{
	tooltip: "Show tiddlers tagged with '%0'",
	noTags: "There are no tagged tiddlers"});

config.macros.list.all.prompt = "All tiddlers in alphabetical order";
config.macros.list.missing.prompt = "Tiddlers that have links to them but are not defined";
config.macros.list.orphans.prompt = "Tiddlers that are not linked to from any other tiddlers";
config.macros.list.shadowed.prompt = "Tiddlers shadowed with default contents";

merge(config.macros.closeAll,{
	label: "close all",
	prompt: "Close all displayed tiddlers (except any that are being edited)"});

merge(config.macros.permaview,{
	label: "permaview",
	prompt: "Link to an URL that retrieves all the currently displayed tiddlers"});

merge(config.macros.saveChanges,{
	label: "save changes",
	prompt: "Save all tiddlers to create a new TiddlyWiki",
	accessKey: "S"});

merge(config.macros.newTiddler,{
	label: "new tiddler",
	prompt: "Create a new tiddler",
	title: "New Tiddler",
	accessKey: "N"});

merge(config.macros.newJournal,{
	label: "new journal",
	prompt: "Create a new tiddler from the current date and time",
	accessKey: "J"});

merge(config.macros.plugins,{
	wizardTitle: "Plugins",
	step1: "These are the plugins that are currently loaded",
	skippedText: "(This plugin has not been executed because it was added since startup)",
	noPluginText: "There are no plugins installed",
	confirmDeleteText: "Are you sure you want to delete these tiddlers:\n\n%0",
	listViewTemplate : {
		columns: [
			{name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},
			{name: 'Title', field: 'title', tiddlerLink: 'title', title: "Title", type: 'TiddlerLink'},
			{name: 'Forced', field: 'forced', title: "Forced", tag: 'systemConfigForce', type: 'TagCheckbox'},
			{name: 'Disabled', field: 'disabled', title: "Disabled", tag: 'systemConfigDisable', type: 'TagCheckbox'},
			{name: 'Executed', field: 'executed', title: "Loaded", type: 'Boolean', trueText: "Yes", falseText: "No"},
			{name: 'Error', field: 'error', title: "Status", type: 'Boolean', trueText: "Error", falseText: "OK"},
			{name: 'Log', field: 'log', title: "Log", type: 'StringList'}
			],
		rowClasses: [
			{className: 'error', field: 'error'},
			{className: 'warning', field: 'warning'}
			],
		actions: [
			{caption: "More actions...", name: ''},
			{caption: "Remove systemConfig tag", name: 'remove'},
			{caption: "Delete these tiddlers forever", name: 'delete'}
			]}
	});

merge(config.macros.refreshDisplay,{
	label: "refresh",
	prompt: "Redraw the entire TiddlyWiki display"
	});

merge(config.macros.importTiddlers,{
	readOnlyWarning: "You cannot import tiddlers into a read-only TiddlyWiki. Try opening the TiddlyWiki file from a file:// URL",
	defaultPath: "http://www.tiddlywiki.com/index.html",
	fetchLabel: "fetch",
	fetchPrompt: "Fetch the tiddlywiki file",
	fetchError: "There were problems fetching the tiddlywiki file",
	confirmOverwriteText: "Are you sure you want to overwrite these tiddlers:\n\n%0",
	wizardTitle: "Import tiddlers from another TiddlyWiki file",
	step1: "Step 1: Locate the TiddlyWiki file",
	step1prompt: "Enter the URL or pathname here: ",
	step1promptFile: "...or browse for a file: ",
	step1promptFeeds: "...or select a pre-defined feed: ",
	step1feedPrompt: "Choose...",
	step2: "Step 2: Loading TiddlyWiki file",
	step2Text: "Please wait while the file is loaded from: %0",
	step3: "Step 3: Choose the tiddlers to import",
	step4: "%0 tiddler(s) imported",
	step5: "Done",
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},
			{name: 'Title', field: 'title', title: "Title", type: 'String'},
			{name: 'Snippet', field: 'text', title: "Snippet", type: 'String'},
			{name: 'Tags', field: 'tags', title: "Tags", type: 'Tags'}
			],
		rowClasses: [
			],
		actions: [
			{caption: "More actions...", name: ''},
			{caption: "Import these tiddlers", name: 'import'}
			]}
	});

merge(config.commands.closeTiddler,{
	text: "close",
	tooltip: "Close this tiddler"});

merge(config.commands.closeOthers,{
	text: "close others",
	tooltip: "Close all other tiddlers"});

merge(config.commands.editTiddler,{
	text: "edit",
	tooltip: "Edit this tiddler",
	readOnlyText: "view",
	readOnlyTooltip: "View the source of this tiddler"});

merge(config.commands.saveTiddler,{
	text: "done",
	tooltip: "Save changes to this tiddler"});

merge(config.commands.cancelTiddler,{
	text: "cancel",
	tooltip: "Undo changes to this tiddler",
	warning: "Are you sure you want to abandon your changes to '%0'?",
	readOnlyText: "done",
	readOnlyTooltip: "View this tiddler normally"});

merge(config.commands.deleteTiddler,{
	text: "delete",
	tooltip: "Delete this tiddler",
	warning: "Are you sure you want to delete '%0'?"});

merge(config.commands.permalink,{
	text: "permalink",
	tooltip: "Permalink for this tiddler"});

merge(config.commands.references,{
	text: "references",
	tooltip: "Show tiddlers that link to this one",
	popupNone: "No references"});

merge(config.commands.jump,{
	text: "jump",
	tooltip: "Jump to another open tiddler"});

merge(config.shadowTiddlers,{
	DefaultTiddlers: "GettingStarted",
	MainMenu: "GettingStarted",
	SiteTitle: "My TiddlyWiki",
	SiteSubtitle: "a reusable non-linear personal web notebook",
	SiteUrl: "http://www.tiddlywiki.com/",
	SideBarOptions: '<<search>><<closeAll>><<permaview>><<newTiddler>><<newJournal "DD MMM YYYY">><<saveChanges>><<slider chkSliderOptionsPanel OptionsPanel "options Â»" "Change TiddlyWiki advanced options">>',
	SideBarTabs: '<<tabs txtMainTab "Timeline" "Timeline" TabTimeline "All" "All tiddlers" TabAll "Tags" "All tags" TabTags "More" "More lists" TabMore>>',
	TabTimeline: '<<timeline>>',
	TabAll: '<<list all>>',
	TabTags: '<<allTags excludeLists>>',
	TabMore: '<<tabs txtMoreTab "Missing" "Missing tiddlers" TabMoreMissing "Orphans" "Orphaned tiddlers" TabMoreOrphans "Shadowed" "Shadowed tiddlers" TabMoreShadowed>>',
	TabMoreMissing: '<<list missing>>',
	TabMoreOrphans: '<<list orphans>>',
	TabMoreShadowed: '<<list shadowed>>',
	PluginManager: '<<plugins>>',
	ImportTiddlers: '<<importTiddlers>>'});
// ---------------------------------------------------------------------------------
// Main
// ---------------------------------------------------------------------------------

var params = null; // Command line parameters
var store = null; // TiddlyWiki storage
var story = null; // Main story
var formatter = null; // Default formatters for the wikifier
config.parsers = {}; // Hashmap of alternative parsers for the wikifier
var anim = new Animator(); // Animation engine
var readOnly = false; // Whether we're in readonly mode
var highlightHack = null; // Embarrassing hack department...
var hadConfirmExit = false; // Don't warn more than once
var safeMode = false; // Disable all plugins and cookies
var installedPlugins = []; // Information filled in when plugins are executed
var startingUp = false; // Whether we're in the process of starting up
var pluginInfo,tiddler; // Used to pass information to plugins in loadPlugins()

// Whether to use the JavaSaver applet
var useJavaSaver = config.browser.isSafari || config.browser.isOpera;

// Starting up
function main()
{
	var t9,t8,t7,t6,t5,t4,t3,t2,t1,t0 = new Date();
	startingUp = true;
	window.onbeforeunload = function(e) {if(window.confirmExit) return confirmExit();};
	params = getParameters();
	if(params)
		params = params.parseParams("open",null,false);
	store = new TiddlyWiki();
	invokeParamifier(params,"oninit");
	story = new Story("tiddlerDisplay","tiddler");
	addEvent(document,"click",Popup.onDocumentClick);
	saveTest();
	loadOptionsCookie();
	for(var s=0; s<config.notifyTiddlers.length; s++)
		store.addNotification(config.notifyTiddlers[s].name,config.notifyTiddlers[s].notify);
	t1 = new Date();
	store.loadFromDiv("storeArea","store",true);
	t2 = new Date();
	loadShadowTiddlers();
	t3 = new Date();
	invokeParamifier(params,"onload");
	t4 = new Date();
	var pluginProblem = loadPlugins();
	t5 = new Date();
	formatter = new Formatter(config.formatters);
	readOnly = (window.location.protocol == "file:") ? false : config.options.chkHttpReadOnly;
	invokeParamifier(params,"onconfig");
	t6 = new Date();
	store.notifyAll();
	t7 = new Date();
	restart();
	t8 = new Date();
	if(pluginProblem)
		{
		story.displayTiddler(null,"PluginManager");
		displayMessage(config.messages.customConfigError);
		}
	for(var m in config.macros)
		if(config.macros[m].init)
			config.macros[m].init();
	if(!readOnly)
		backstage.init();
	t9 = new Date();
	if(config.displayStartupTime)
		{
		displayMessage("Load in " + (t2-t1) + " ms");
		displayMessage("Loadshadows in " + (t3-t2) + " ms");
		displayMessage("Loadplugins in " + (t5-t4) + " ms");
		displayMessage("Notify in " + (t7-t6) + " ms");
		displayMessage("Restart in " + (t8-t7) + " ms");
		displayMessage("Total startup in " + (t9-t0) + " ms");
		}
	startingUp = false;
}

// Restarting
function restart()
{
	invokeParamifier(params,"onstart");
	if(story.isEmpty())
		{
		var defaultParams = store.getTiddlerText("DefaultTiddlers").parseParams("open",null,false);
		invokeParamifierAsync(defaultParams,"onstart");
		}
	window.scrollTo(0,0);
}

function saveTest()
{
	var saveTest = document.getElementById("saveTest");
	if(saveTest.hasChildNodes())
		alert(config.messages.savedSnapshotError);
	saveTest.appendChild(document.createTextNode("savetest"));
}

function loadShadowTiddlers()
{
	var shadows = new TiddlyWiki();
	shadows.loadFromDiv("shadowArea","shadows",true);
	shadows.forEachTiddler(function(title,tiddler){config.shadowTiddlers[title] = tiddler.text;});
	delete shadows;
}

function loadPlugins()
{
	if(safeMode)
		return false;
	var configTiddlers = store.getTaggedTiddlers("systemConfig");
	installedPlugins = [];
	var hadProblem = false;
	for(var t=0; t<configTiddlers.length; t++)
		{
		tiddler = configTiddlers[t];
		pluginInfo = getPluginInfo(tiddler);
		if(isPluginExecutable(pluginInfo))
			{
			pluginInfo.executed = true;
			pluginInfo.error = false;
			try
				{
				if(tiddler.text && tiddler.text != "")
					window.eval(tiddler.text);
				}
			catch(e)
				{
				pluginInfo.log.push(config.messages.pluginError.format([exceptionText(e)]));
				pluginInfo.error = true;
				hadProblem = true;
				}
			}
		else
			pluginInfo.warning = true;
		installedPlugins.push(pluginInfo);
		}
	return hadProblem;
}

function getPluginInfo(tiddler)
{
	var p = store.getTiddlerSlices(tiddler.title,["Name","Description","Version","CoreVersion","Date","Source","Author","License","Browsers"]);
	p.tiddler = tiddler;
	p.title = tiddler.title;
	p.log = [];
	return p;
}

// Check that a particular plugin is valid for execution
function isPluginExecutable(plugin)
{
	if(plugin.tiddler.isTagged("systemConfigDisable"))
		return verifyTail(plugin,false,config.messages.pluginDisabled);
	if(plugin.tiddler.isTagged("systemConfigForce"))
		return verifyTail(plugin,true,config.messages.pluginForced);
	if(plugin["CoreVersion"])
		{
		var coreVersion = plugin["CoreVersion"].split(".");
		var w = parseInt(coreVersion[0]) - version.major;
		if(w == 0 && coreVersion[1])
			w = parseInt(coreVersion[1]) - version.minor;
		if(w == 0 && coreVersion[2])
		 	w = parseInt(coreVersion[2]) - version.revision;
		if(w > 0)
			return verifyTail(plugin,false,config.messages.pluginVersionError);
		}
	return true;
}

function verifyTail(plugin,result,message)
{
	plugin.log.push(message);
	return result;
}

function invokeMacro(place,macro,params,wikifier,tiddler)
{
	try
		{
		var m = config.macros[macro];
		if(m && m.handler)
			m.handler(place,macro,params.readMacroParams(),wikifier,params,tiddler);
		else
			createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,config.messages.missingMacro]));
		}
	catch(ex)
		{
		createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,ex.toString()]));
		}
}

// ---------------------------------------------------------------------------------
// Paramifiers
// ---------------------------------------------------------------------------------

function getParameters()
{
	var p = null;
	if(window.location.hash)
		{
		p = decodeURI(window.location.hash.substr(1));
		if(config.browser.firefoxDate != null && config.browser.firefoxDate[1] < "20051111")
			p = convertUTF8ToUnicode(p);
		}
	return p;
}

function invokeParamifier(params,handler)
{
	if(!params || params.length == undefined || params.length <= 1)
		return;
	for(var t=1; t<params.length; t++)
		{
		var p = config.paramifiers[params[t].name];
		if(p && p[handler] instanceof Function)
			p[handler](params[t].value);
		}
}

function AsyncParamifier(p,h)
{
	this.params = p;
	this.handler = h;
	this.index = 1; // p[0] is not used
	if(!p || p.length == undefined || p.length <= 1)
		this.params.length = 0;
	return this;
}

AsyncParamifier.prototype.tick = function()
{
	if(this.index<this.params.length)
		{
		var p = config.paramifiers[this.params[this.index].name];
		if(p && p[this.handler] instanceof Function)
			p[this.handler](this.params[this.index].value,this.index);
		this.index++;
		return true;
		}
	return false;
};

function invokeParamifierAsync(params,handler)
{
	anim.startAnimating(new AsyncParamifier(params,handler));
}

config.paramifiers = {};

config.paramifiers.start = {
	oninit: function(v) {
		safeMode = v.toLowerCase() == "safe";
		}
};

config.paramifiers.open = {
	onstart: function(v,i) {
		story.displayTiddler(i == 1 ? null : "bottom",v,null,false,false);
		}
};

config.paramifiers.story = {
	onstart: function(v) {
		var list = store.getTiddlerText(v,"").parseParams("open",null,false);
		invokeParamifier(list,"onstart");
		}
};

config.paramifiers.search = {
	onstart: function(v) {
		story.search(v,false,false);
		}
};

config.paramifiers.searchRegExp = {
	onstart: function(v) {
		story.prototype.search(v,false,true);
		}
};

config.paramifiers.tag = {
	onstart: function(v) {
		var tagged = store.getTaggedTiddlers(v,"title");
		for(var t=0; t<tagged.length; t++)
			story.displayTiddler("bottom",tagged[t].title,null,false,false);
		}
};

config.paramifiers.newTiddler = {
	onstart: function(v) {
		if(!readOnly)
			{
			story.displayTiddler(null,v,DEFAULT_EDIT_TEMPLATE);
			story.focusTiddler(v,"text");
			}
		}
};

config.paramifiers.newJournal = {
	onstart: function(v) {
		if(!readOnly)
			{
			var now = new Date();
			var title = now.formatString(v.trim());
			story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE);
			story.focusTiddler(title,"text");
			}
		}
};

config.paramifiers.readOnly = {
	onconfig: function(v) {
		var p = v.toLowerCase();
		readOnly = p == "yes" ? true : (p == "no" ? false : readOnly);
		}
};
// ---------------------------------------------------------------------------------
// Formatter helpers
// ---------------------------------------------------------------------------------

function Formatter(formatters)
{
	this.formatters = [];
	var pattern = [];
	for(var n=0; n<formatters.length; n++)
		{
		pattern.push("(" + formatters[n].match + ")");
		this.formatters.push(formatters[n]);
		}
	this.formatterRegExp = new RegExp(pattern.join("|"),"mg");
}

config.formatterHelpers = {

	createElementAndWikify: function(w)
	{
		w.subWikifyTerm(createTiddlyElement(w.output,this.element),this.termRegExp);
	},
	
	inlineCssHelper: function(w)
	{
		var styles = [];
		config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch)
			{
			var s,v;
			if(lookaheadMatch[1])
				{
				s = lookaheadMatch[1].unDash();
				v = lookaheadMatch[2];
				}
			else
				{
				s = lookaheadMatch[3].unDash();
				v = lookaheadMatch[4];
				}
			if (s=="bgcolor")
				s = "backgroundColor";
			styles.push({style: s, value: v});
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
			config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
			}
		return styles;
	},

	applyCssHelper: function(e,styles)
	{
		for(var t=0; t< styles.length; t++)
			{
			try
				{
				e.style[styles[t].style] = styles[t].value;
				}
			catch (ex)
				{
				}
			}
	},

	enclosedTextHelper: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
			{
			var text = lookaheadMatch[1];
			if(config.browser.isIE)
				text = text.replace(/\n/g,"\r");
			createTiddlyElement(w.output,this.element,null,null,text);
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
			}
	},

	isExternalLink: function(link)
	{
		if(store.tiddlerExists(link) || store.isShadowTiddler(link))
			{
			return false;
			}
		var urlRegExp = new RegExp(config.textPrimitives.urlPattern,"mg");
		if(urlRegExp.exec(link))
			{
			// Definitely an external link
			return true;
			}
		if (link.indexOf(".")!=-1 || link.indexOf("\\")!=-1 || link.indexOf("/")!=-1)
			{
			return true;
			}
		return false;
	}

};

// ---------------------------------------------------------------------------------
// Standard formatters
// ---------------------------------------------------------------------------------

config.formatters = [
{
	name: "table",
	match: "^\\|(?:[^\\n]*)\\|(?:[fhck]?)$",
	lookaheadRegExp: /^\|([^\n]*)\|([fhck]?)$/mg,
	rowTermRegExp: /(\|(?:[fhck]?)$\n?)/mg,
	cellRegExp: /(?:\|([^\n\|]*)\|)|(\|[fhck]?$\n?)/mg,
	cellTermRegExp: /((?:\x20*)\|)/mg,
	rowTypes: {"c":"caption", "h":"thead", "":"tbody", "f":"tfoot"},

	handler: function(w)
	{
		var table = createTiddlyElement(w.output,"table");
		var prevColumns = [];
		var currRowType = null;
		var rowContainer;
		var rowCount = 0;
		w.nextMatch = w.matchStart;
		this.lookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch)
			{
			var nextRowType = lookaheadMatch[2];
			if(nextRowType == "k")
				{
				table.className = lookaheadMatch[1];
				w.nextMatch += lookaheadMatch[0].length+1;
				}
			else
				{
				if(nextRowType != currRowType)
					{
					rowContainer = createTiddlyElement(table,this.rowTypes[nextRowType]);
					currRowType = nextRowType;
					}
				if(currRowType == "c")
					{
					// Caption
					w.nextMatch++;
					if(rowContainer != table.firstChild)
						table.insertBefore(rowContainer,table.firstChild);
					rowContainer.setAttribute("align",rowCount == 0?"top":"bottom");
					w.subWikifyTerm(rowContainer,this.rowTermRegExp);
					}
				else
					{
					this.rowHandler(w,createTiddlyElement(rowContainer,"tr",null,(rowCount&1)?"oddRow":"evenRow"),prevColumns);
					rowCount++;
					}
				}
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = this.lookaheadRegExp.exec(w.source);
			}
	},
	rowHandler: function(w,e,prevColumns)
	{
		var col = 0;
		var colSpanCount = 1;
		var prevCell = null;
		this.cellRegExp.lastIndex = w.nextMatch;
		var cellMatch = this.cellRegExp.exec(w.source);
		while(cellMatch && cellMatch.index == w.nextMatch)
			{
			if(cellMatch[1] == "~")
				{
				// Rowspan
				var last = prevColumns[col];
				if(last)
					{
					last.rowSpanCount++;
					last.element.setAttribute("rowspan",last.rowSpanCount);
					last.element.setAttribute("rowSpan",last.rowSpanCount); // Needed for IE
					last.element.valign = "center";
					}
				w.nextMatch = this.cellRegExp.lastIndex-1;
				}
			else if(cellMatch[1] == ">")
				{
				// Colspan
				colSpanCount++;
				w.nextMatch = this.cellRegExp.lastIndex-1;
				}
			else if(cellMatch[2])
				{
				// End of row
				if(prevCell && colSpanCount > 1)
					{
					prevCell.setAttribute("colspan",colSpanCount);
					prevCell.setAttribute("colSpan",colSpanCount); // Needed for IE
					}
				w.nextMatch = this.cellRegExp.lastIndex;
				break;
				}
			else
				{
				// Cell
				w.nextMatch++;
				var styles = config.formatterHelpers.inlineCssHelper(w);
				var spaceLeft = false;
				var chr = w.source.substr(w.nextMatch,1);
				while(chr == " ")
					{
					spaceLeft = true;
					w.nextMatch++;
					chr = w.source.substr(w.nextMatch,1);
					}
				var cell;
				if(chr == "!")
					{
					cell = createTiddlyElement(e,"th");
					w.nextMatch++;
					}
				else
					cell = createTiddlyElement(e,"td");
				prevCell = cell;
				prevColumns[col] = {rowSpanCount:1,element:cell};
				if(colSpanCount > 1)
					{
					cell.setAttribute("colspan",colSpanCount);
					cell.setAttribute("colSpan",colSpanCount); // Needed for IE
					colSpanCount = 1;
					}
				config.formatterHelpers.applyCssHelper(cell,styles);
				w.subWikifyTerm(cell,this.cellTermRegExp);
				if(w.matchText.substr(w.matchText.length-2,1) == " ") // spaceRight
					cell.align = spaceLeft ? "center" : "left";
				else if(spaceLeft)
					cell.align = "right";
				w.nextMatch--;
				}
			col++;
			this.cellRegExp.lastIndex = w.nextMatch;
			cellMatch = this.cellRegExp.exec(w.source);
			}
	}
},

{
	name: "heading",
	match: "^!{1,5}",
	termRegExp: /(\n)/mg,
	handler: function(w)
	{
		w.subWikifyTerm(createTiddlyElement(w.output,"h" + w.matchLength),this.termRegExp);
	}
},

{
	name: "list",
	match: "^(?:[\\*#;:]+)",
	lookaheadRegExp: /^(?:(?:(\*)|(#)|(;)|(:))+)/mg,
	termRegExp: /(\n)/mg,
	handler: function(w)
	{
		var stack = [w.output];
		var currLevel = 0, currType = null;
		var listLevel, listType, itemType;
		w.nextMatch = w.matchStart;
		this.lookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch)
			{
			if(lookaheadMatch[1])
				{
				listType = "ul";
				itemType = "li";
				}
			else if(lookaheadMatch[2])
				{
				listType = "ol";
				itemType = "li";
				}
			else if(lookaheadMatch[3])
				{
				listType = "dl";
				itemType = "dt";
				}
			else if(lookaheadMatch[4])
				{
				listType = "dl";
				itemType = "dd";
				}
			listLevel = lookaheadMatch[0].length;
			w.nextMatch += lookaheadMatch[0].length;
			if(listLevel > currLevel)
				{
				for(var t=currLevel; t<listLevel; t++)
					stack.push(createTiddlyElement(stack[stack.length-1],listType));
				}
			else if(listLevel < currLevel)
				{
				for(var t=currLevel; t>listLevel; t--)
					stack.pop();
				}
			else if(listLevel == currLevel && listType != currType)
				{
				stack.pop();
				stack.push(createTiddlyElement(stack[stack.length-1],listType));
				}
			currLevel = listLevel;
			currType = listType;
			var e = createTiddlyElement(stack[stack.length-1],itemType);
			w.subWikifyTerm(e,this.termRegExp);
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		}
	}
},

{
	name: "quoteByBlock",
	match: "^<<<\\n",
	termRegExp: /(^<<<(\n|$))/mg,
	element: "blockquote",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "quoteByLine",
	match: "^>+",
	lookaheadRegExp: /^>+/mg,
	termRegExp: /(\n)/mg,
	element: "blockquote",
	handler: function(w)
	{
		var stack = [w.output];
		var currLevel = 0;
		var newLevel = w.matchLength;
		var t;
		do {
			if(newLevel > currLevel)
				{
				for(t=currLevel; t<newLevel; t++)
					stack.push(createTiddlyElement(stack[stack.length-1],this.element));
				}
			else if(newLevel < currLevel)
				{
				for(t=currLevel; t>newLevel; t--)
					stack.pop();
				}
			currLevel = newLevel;
			w.subWikifyTerm(stack[stack.length-1],this.termRegExp);
			createTiddlyElement(stack[stack.length-1],"br");
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
			var matched = lookaheadMatch && lookaheadMatch.index == w.nextMatch;
			if(matched)
				{
				newLevel = lookaheadMatch[0].length;
				w.nextMatch += lookaheadMatch[0].length;
				}
		} while(matched);
	}
},

{
	name: "rule",
	match: "^----+$\\n?",
	handler: function(w)
	{
		createTiddlyElement(w.output,"hr");
	}
},

{
	name: "monospacedByLine",
	match: "^\\{\\{\\{\\n",
	lookaheadRegExp: /^\{\{\{\n((?:^[^\n]*\n)+?)(^\}\}\}$\n?)/mg,
	element: "pre",
	handler: config.formatterHelpers.enclosedTextHelper
},

{
	name: "monospacedByLineForCSS",
	match: "^/\\*\\{\\{\\{\\*/\\n",
	lookaheadRegExp: /\/\*\{\{\{\*\/\n*((?:^[^\n]*\n)+?)(\n*^\/\*\}\}\}\*\/$\n?)/mg,
	element: "pre",
	handler: config.formatterHelpers.enclosedTextHelper
},

{
	name: "monospacedByLineForPlugin",
	match: "^//\\{\\{\\{\\n",
	lookaheadRegExp: /^\/\/\{\{\{\n\n*((?:^[^\n]*\n)+?)(\n*^\/\/\}\}\}$\n?)/mg,
	element: "pre",
	handler: config.formatterHelpers.enclosedTextHelper
},

{
	name: "monospacedByLineForTemplate",
	match: "^<!--\\{\\{\\{-->\\n",
	lookaheadRegExp: /<!--\{\{\{-->\n*((?:^[^\n]*\n)+?)(\n*^<!--\}\}\}-->$\n?)/mg,
	element: "pre",
	handler: config.formatterHelpers.enclosedTextHelper
},

{
	name: "wikifyCommentForPlugin",
	match: "^/\\*\\*\\*\\n",
	termRegExp: /(^\*\*\*\/\n)/mg,
	handler: function(w)
	{
		w.subWikifyTerm(w.output,this.termRegExp);
	}
},

{
	name: "wikifyCommentForTemplate",
	match: "^<!---\\n",
	termRegExp: /(^--->\n)/mg,
	handler: function(w) 
	{
		w.subWikifyTerm(w.output,this.termRegExp);
	}
},

{
	name: "macro",
	match: "<<",
	lookaheadRegExp: /<<([^>\s]+)(?:\s*)((?:[^>]|(?:>(?!>)))*)>>/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart && lookaheadMatch[1])
			{
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			invokeMacro(w.output,lookaheadMatch[1],lookaheadMatch[2],w,w.tiddler);
			}
	}
},

{
	name: "prettyLink",
	match: "\\[\\[",
	lookaheadRegExp: /\[\[(.*?)(?:\|(~)?(.*?))?\]\]/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
			{
			var e;
			var text = lookaheadMatch[1];
			if(lookaheadMatch[3])
				{
				// Pretty bracketted link
				var link = lookaheadMatch[3];
				e = (!lookaheadMatch[2] && config.formatterHelpers.isExternalLink(link))
						? createExternalLink(w.output,link)
						: createTiddlyLink(w.output,link,false,null,w.isStatic);
				}
			else
				{
				// Simple bracketted link
				e = createTiddlyLink(w.output,text,false,null,w.isStatic);
				}
			createTiddlyText(e,text);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			}
	}
},

{
	name: "unWikiLink",
	match: config.textPrimitives.unWikiLink+config.textPrimitives.wikiLink,
	handler: function(w)
	{
		w.outputText(w.output,w.matchStart+1,w.nextMatch);
	}
},

{
	name: "wikiLink",
	match: config.textPrimitives.wikiLink,
	handler: function(w)
	{
		if(w.matchStart > 0)
			{
			var preRegExp = new RegExp(config.textPrimitives.anyLetterStrict,"mg");
			preRegExp.lastIndex = w.matchStart-1;
			var preMatch = preRegExp.exec(w.source);
			if(preMatch.index == w.matchStart-1)
				{
				w.outputText(w.output,w.matchStart,w.nextMatch);
				return;
				}
			}
		if(w.autoLinkWikiWords == true || store.isShadowTiddler(w.matchText))
			{
			var link = createTiddlyLink(w.output,w.matchText,false,null,w.isStatic);
			w.outputText(link,w.matchStart,w.nextMatch);
			}
		else
			{
			w.outputText(w.output,w.matchStart,w.nextMatch);
			}
	}
},

{
	name: "urlLink",
	match: config.textPrimitives.urlPattern,
	handler: function(w)
	{
		w.outputText(createExternalLink(w.output,w.matchText),w.matchStart,w.nextMatch);
	}
},

{
	name: "image",
	match: "\\[[<>]?[Ii][Mm][Gg]\\[",
	lookaheadRegExp: /\[(<?)(>?)[Ii][Mm][Gg]\[(?:([^\|\]]+)\|)?([^\[\]\|]+)\](?:\[([^\]]*)\])?\]/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
			{
			var e = w.output;
			if(lookaheadMatch[5])
				{
				var link = lookaheadMatch[5];
				e = config.formatterHelpers.isExternalLink(link) ? createExternalLink(w.output,link) : createTiddlyLink(w.output,link,false,null,w.isStatic);
				addClass(e,"imageLink");
				}
			var img = createTiddlyElement(e,"img");
			if(lookaheadMatch[1])
				img.align = "left";
			else if(lookaheadMatch[2])
				img.align = "right";
			if(lookaheadMatch[3])
				img.title = lookaheadMatch[3];
			img.src = lookaheadMatch[4];
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			}
	}
},

{
	name: "html",
	match: "<[Hh][Tt][Mm][Ll]>",
	lookaheadRegExp: /<[Hh][Tt][Mm][Ll]>((?:.|\n)*?)<\/[Hh][Tt][Mm][Ll]>/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source)
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
			{
			createTiddlyElement(w.output,"span").innerHTML = lookaheadMatch[1];
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			}
	}
},

{
	name: "commentByBlock",
	match: "/%",
	lookaheadRegExp: /\/%((?:.|\n)*?)%\//mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source)
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
			w.nextMatch = this.lookaheadRegExp.lastIndex;
	}
},

{
	name: "boldByChar",
	match: "''",
	termRegExp: /('')/mg,
	element: "strong",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "italicByChar",
	match: "//",
	termRegExp: /(\/\/)/mg,
	element: "em",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "underlineByChar",
	match: "__",
	termRegExp: /(__)/mg,
	element: "u",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "strikeByChar",
	match: "--(?!\\s|$)",
	termRegExp: /((?!\s)--|(?=\n\n))/mg,
	element: "strike",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "superscriptByChar",
	match: "\\^\\^",
	termRegExp: /(\^\^)/mg,
	element: "sup",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "subscriptByChar",
	match: "~~",
	termRegExp: /(~~)/mg,
	element: "sub",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "monospacedByChar",
	match: "\\{\\{\\{",
	lookaheadRegExp: /\{\{\{((?:.|\n)*?)\}\}\}/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source)
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
			{
			createTiddlyElement(w.output,"code",null,null,lookaheadMatch[1]);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			}
	}
},

{
	name: "styleByChar",
	match: "@@",
	termRegExp: /(@@)/mg,
	handler: function(w)
	{
		var e = createTiddlyElement(w.output,"span");
		var styles = config.formatterHelpers.inlineCssHelper(w);
		if(styles.length == 0)
			e.className = "marked";
		else
			config.formatterHelpers.applyCssHelper(e,styles);
		w.subWikifyTerm(e,this.termRegExp);
	}
},

{
	name: "lineBreak",
	match: "\\n|<br ?/?>",
	handler: function(w)
	{
		createTiddlyElement(w.output,"br");
	}
},

{
	name: "rawText",
	match: "\\\"{3}|<nowiki>",
	lookaheadRegExp: /(?:\"{3}|<nowiki>)((?:.|\n)*?)(?:\"{3}|<\/nowiki>)/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source)
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
			{
			createTiddlyElement(w.output,"span",null,null,lookaheadMatch[1]);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			}
	}
},

{
	name: "mdash",
	match: "--",
	handler: function(w)
		{
		createTiddlyElement(w.output,"span").innerHTML = "&mdash;";
		}
},

{
	name: "htmlEntitiesEncoding",
	match: "(?:(?:&#?[a-zA-Z0-9]{2,8};|.)(?:&#?(?:x0*(?:3[0-6][0-9a-fA-F]|1D[c-fC-F][0-9a-fA-F]|20[d-fD-F][0-9a-fA-F]|FE2[0-9a-fA-F])|0*(?:76[89]|7[7-9][0-9]|8[0-7][0-9]|761[6-9]|76[2-7][0-9]|84[0-3][0-9]|844[0-7]|6505[6-9]|6506[0-9]|6507[0-1]));)+|&#?[a-zA-Z0-9]{2,8};)",
	handler: function(w)
		{
		createTiddlyElement(w.output,"span").innerHTML = w.matchText;
		}
},

{
	name: "customClasses",
	match: "\\{\\{",
	termRegExp: /(\}\}\})/mg,
	lookaheadRegExp: /\{\{[\s]*([\w]+[\s\w]*)[\s]*\{(\n?)/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch)
			{
			var e = createTiddlyElement(w.output,lookaheadMatch[2] == "\n" ? "div" : "span",null,lookaheadMatch[1]);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			w.subWikifyTerm(e,this.termRegExp);
			}
	}
}

];

// ---------------------------------------------------------------------------------
// Wikifier
// ---------------------------------------------------------------------------------

function getParser(tiddler)
{
	var f = formatter;
	if(tiddler!=null)
		{
		for(var i in config.parsers)
			{
			if(tiddler.isTagged(config.parsers[i].formatTag))
				{
				f = config.parsers[i];
				break;
				}
			}
		}
	return f;
}

function wikify(source,output,highlightRegExp,tiddler)
{
	if(source && source != "")
		{
		var wikifier = new Wikifier(source,getParser(tiddler),highlightRegExp,tiddler);
		wikifier.subWikifyUnterm(output);
		}
}

function wikifyStatic(source,highlightRegExp,tiddler)
{
	var e = createTiddlyElement(document.body,"div");
	e.style.display = "none";
	var html = "";
	if(source && source != "")
		{
		var wikifier = new Wikifier(source,getParser(tiddler),highlightRegExp,tiddler);
		wikifier.isStatic = true;
		wikifier.subWikifyUnterm(e);
		html = e.innerHTML;
		e.parentNode.removeChild(e);
		}
	return html;
}

// Wikify a named tiddler to plain text
function wikifyPlain(title)
{
	if(store.tiddlerExists(title) || store.isShadowTiddler(title))
		{
		var wikifier = new Wikifier(store.getTiddlerText(title),formatter,null,store.getTiddler(title));
		return wikifier.wikifyPlain();
		}
	else
		return "";
}

// Highlight plain text into an element
function highlightify(source,output,highlightRegExp,tiddler)
{
	if(source && source != "")
		{
		var wikifier = new Wikifier(source,formatter,highlightRegExp,tiddler);
		wikifier.outputText(output,0,source.length);
		}
}

// Construct a wikifier object
// source - source string that's going to be wikified
// formatter - Formatter() object containing the list of formatters to be used
// highlightRegExp - regular expression of the text string to highlight
// tiddler - reference to the tiddler that's taken to be the container for this wikification
function Wikifier(source,formatter,highlightRegExp,tiddler)
{
	this.source = source;
	this.output = null;
	this.formatter = formatter;
	this.nextMatch = 0;
	this.autoLinkWikiWords = tiddler && tiddler.autoLinkWikiWords() == false ? false : true;
	this.highlightRegExp = highlightRegExp;
	this.highlightMatch = null;
	this.isStatic = false;
	if(highlightRegExp)
		{
		highlightRegExp.lastIndex = 0;
		this.highlightMatch = highlightRegExp.exec(source);
		}
	this.tiddler = tiddler;
}

Wikifier.prototype.wikifyPlain = function()
{
	var e = createTiddlyElement(document.body,"div");
	e.style.display = "none";
	this.subWikify(e);
	var text = getPlainText(e);
	e.parentNode.removeChild(e);
	return text;
}

Wikifier.prototype.subWikify = function(output,terminator)
{
	// Handle the terminated and unterminated cases separately
	if (terminator)
		this.subWikifyTerm(output,new RegExp("(" + terminator + ")","mg"));
	else
		this.subWikifyUnterm(output);
}

Wikifier.prototype.subWikifyUnterm = function(output)
{
	// subWikify() can be indirectly recursive, so we need to save the old output pointer
	var oldOutput = this.output;
	this.output = output;
	// Get the first match
	this.formatter.formatterRegExp.lastIndex = this.nextMatch;
	var formatterMatch = this.formatter.formatterRegExp.exec(this.source);
	while(formatterMatch)
		{
		// Output any text before the match
		if(formatterMatch.index > this.nextMatch)
			this.outputText(this.output,this.nextMatch,formatterMatch.index);
		// Set the match parameters for the handler
		this.matchStart = formatterMatch.index;
		this.matchLength = formatterMatch[0].length;
		this.matchText = formatterMatch[0];
		this.nextMatch = this.formatter.formatterRegExp.lastIndex;
		// Figure out which formatter matched and call its handler
		for(var t=1; t<formatterMatch.length; t++)
			{
			if(formatterMatch[t])
				{
				this.formatter.formatters[t-1].handler(this);
				this.formatter.formatterRegExp.lastIndex = this.nextMatch;
				break;
				}
			}
		// Get the next match
		formatterMatch = this.formatter.formatterRegExp.exec(this.source);
		}
	// Output any text after the last match
	if(this.nextMatch < this.source.length)
		{
		this.outputText(this.output,this.nextMatch,this.source.length);
		this.nextMatch = this.source.length;
		}
	// Restore the output pointer
	this.output = oldOutput;
}

Wikifier.prototype.subWikifyTerm = function(output,terminatorRegExp)
{
	// subWikify() can be indirectly recursive, so we need to save the old output pointer
	var oldOutput = this.output;
	this.output = output;
	// Get the first matches for the formatter and terminator RegExps
	terminatorRegExp.lastIndex = this.nextMatch;
	var terminatorMatch = terminatorRegExp.exec(this.source);
	this.formatter.formatterRegExp.lastIndex = this.nextMatch;
	var formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);
	while(terminatorMatch || formatterMatch)
		{
		// Check for a terminator match  before the next formatter match
		if(terminatorMatch && (!formatterMatch || terminatorMatch.index <= formatterMatch.index))
			{
			// Output any text before the match
			if(terminatorMatch.index > this.nextMatch)
				this.outputText(this.output,this.nextMatch,terminatorMatch.index);
			// Set the match parameters
			this.matchText = terminatorMatch[1];
			this.matchLength = terminatorMatch[1].length;
			this.matchStart = terminatorMatch.index;
			this.nextMatch = this.matchStart + this.matchLength;
			// Restore the output pointer
			this.output = oldOutput;
			return;
			}
		// It must be a formatter match; output any text before the match
		if(formatterMatch.index > this.nextMatch)
			this.outputText(this.output,this.nextMatch,formatterMatch.index);
		// Set the match parameters
		this.matchStart = formatterMatch.index;
		this.matchLength = formatterMatch[0].length;
		this.matchText = formatterMatch[0];
		this.nextMatch = this.formatter.formatterRegExp.lastIndex;
		// Figure out which formatter matched and call its handler
		for(var t=1; t<formatterMatch.length; t++)
			{
			if(formatterMatch[t])
				{
				this.formatter.formatters[t-1].handler(this);
				this.formatter.formatterRegExp.lastIndex = this.nextMatch;
				break;
				}
			}
		// Get the next match
		terminatorRegExp.lastIndex = this.nextMatch;
		terminatorMatch = terminatorRegExp.exec(this.source);
		formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);
		}
	// Output any text after the last match
	if(this.nextMatch < this.source.length)
		{
		this.outputText(this.output,this.nextMatch,this.source.length);
		this.nextMatch = this.source.length;
		}
	// Restore the output pointer
	this.output = oldOutput;
}

Wikifier.prototype.outputText = function(place,startPos,endPos)
{
	// Check for highlights
	while(this.highlightMatch && (this.highlightRegExp.lastIndex > startPos) && (this.highlightMatch.index < endPos) && (startPos < endPos))
		{
		// Deal with any plain text before the highlight
		if(this.highlightMatch.index > startPos)
			{
			createTiddlyText(place,this.source.substring(startPos,this.highlightMatch.index));
			startPos = this.highlightMatch.index;
			}
		// Deal with the highlight
		var highlightEnd = Math.min(this.highlightRegExp.lastIndex,endPos);
		var theHighlight = createTiddlyElement(place,"span",null,"highlight",this.source.substring(startPos,highlightEnd));
		startPos = highlightEnd;
		// Nudge along to the next highlight if we're done with this one
		if(startPos >= this.highlightRegExp.lastIndex)
			this.highlightMatch = this.highlightRegExp.exec(this.source);
		}
	// Do the unhighlighted text left over
	if(startPos < endPos)
		{
		createTiddlyText(place,this.source.substring(startPos,endPos));
		}
}

// ---------------------------------------------------------------------------------
// Macro definitions
// ---------------------------------------------------------------------------------

config.macros.today.handler = function(place,macroName,params)
{
	var now = new Date();
	var text;
	if(params[0])
		text = now.formatString(params[0].trim());
	else
		text = now.toLocaleString();
	createTiddlyElement(place,"span",null,null,text);
}

config.macros.version.handler = function(place)
{
	createTiddlyElement(place,"span",null,null,version.major + "." + version.minor + "." + version.revision + (version.beta ? " (beta " + version.beta + ")" : ""));
}

config.macros.list.handler = function(place,macroName,params)
{
	var type = params[0] ? params[0] : "all";
	var theList = document.createElement("ul");
	place.appendChild(theList);
	if(this[type].prompt)
		createTiddlyElement(theList,"li",null,"listTitle",this[type].prompt);
	var results;
	if(this[type].handler)
		results = this[type].handler(params);
	for(var t = 0; t < results.length; t++)
		{
		var theListItem = document.createElement("li")
		theList.appendChild(theListItem);
		if(typeof results[t] == "string")
			createTiddlyLink(theListItem,results[t],true);
		else
			createTiddlyLink(theListItem,results[t].title,true);
		}
}

config.macros.list.all.handler = function(params)
{
	return store.reverseLookup("tags","excludeLists",false,"title");
}

config.macros.list.missing.handler = function(params)
{
	return store.getMissingLinks();
}

config.macros.list.orphans.handler = function(params)
{
	return store.getOrphans();
}

config.macros.list.shadowed.handler = function(params)
{
	return store.getShadowed();
}

config.macros.allTags.handler = function(place,macroName,params)
{
	var tags = store.getTags(params[0]);
	var ul = createTiddlyElement(place,"ul");
	if(tags.length == 0)
		createTiddlyElement(ul,"li",null,"listTitle",this.noTags);
	for(var t=0; t<tags.length; t++)
		{
		var title = tags[t][0];
		var info = getTiddlyLinkInfo(title)
		var li =createTiddlyElement(ul,"li");
		var btn = createTiddlyButton(li,title + " (" + tags[t][1] + ")",this.tooltip.format([title]),onClickTag,info.classes);
		btn.setAttribute("tag",title);
		btn.setAttribute("refresh","link");
		btn.setAttribute("tiddlyLink",title);
		}
}

config.macros.timeline.handler = function(place,macroName,params)
{
	var field = params[0] ? params[0] : "modified";
	var tiddlers = store.reverseLookup("tags","excludeLists",false,field);
	var lastDay = "";
	var last = params[1] ? tiddlers.length-Math.min(tiddlers.length,parseInt(params[1])) : 0;
	for(var t=tiddlers.length-1; t>=last; t--)
		{
		var tiddler = tiddlers[t];
		var theDay = tiddler[field].convertToLocalYYYYMMDDHHMM().substr(0,8);
		if(theDay != lastDay)
			{
			var theDateList = document.createElement("ul");
			place.appendChild(theDateList);
			createTiddlyElement(theDateList,"li",null,"listTitle",tiddler[field].formatString(this.dateFormat));
			lastDay = theDay;
			}
		var theDateListItem = createTiddlyElement(theDateList,"li",null,"listLink");
		theDateListItem.appendChild(createTiddlyLink(place,tiddler.title,true));
		}
}

config.macros.search.handler = function(place,macroName,params)
{
	var searchTimeout = null;
	var btn = createTiddlyButton(place,this.label,this.prompt,this.onClick);
	var txt = createTiddlyElement(place,"input",null,"txtOptionInput");
	if(params[0])
		txt.value = params[0];
	txt.onkeyup = this.onKeyPress;
	txt.onfocus = this.onFocus;
	txt.setAttribute("size",this.sizeTextbox);
	txt.setAttribute("accessKey",this.accessKey);
	txt.setAttribute("autocomplete","off");
	txt.setAttribute("lastSearchText","");
	if(config.browser.isSafari)
		{
		txt.setAttribute("type","search");
		txt.setAttribute("results","5");
		}
	else
		txt.setAttribute("type","text");
}

// Global because there's only ever one outstanding incremental search timer
config.macros.search.timeout = null;

config.macros.search.doSearch = function(txt)
{
	if(txt.value.length > 0)
		{
		story.search(txt.value,config.options.chkCaseSensitiveSearch,config.options.chkRegExpSearch);
		txt.setAttribute("lastSearchText",txt.value);
		}
}

config.macros.search.onClick = function(e)
{
	config.macros.search.doSearch(this.nextSibling);
	return false;
}

config.macros.search.onKeyPress = function(e)
{
	if(!e) var e = window.event;
	switch(e.keyCode)
		{
		case 13: // Ctrl-Enter
		case 10: // Ctrl-Enter on IE PC
			config.macros.search.doSearch(this);
			break;
		case 27: // Escape
			this.value = "";
			clearMessage();
			break;
		}
	if(this.value.length > 2)
		{
		if(this.value != this.getAttribute("lastSearchText"))
			{
			if(config.macros.search.timeout)
				clearTimeout(config.macros.search.timeout);
			var txt = this;
			config.macros.search.timeout = setTimeout(function() {config.macros.search.doSearch(txt);},500);
			}
		}
	else
		{
		if(config.macros.search.timeout)
			clearTimeout(config.macros.search.timeout);
		}
}

config.macros.search.onFocus = function(e)
{
	this.select();
}

config.macros.tiddler.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("name",null,true,false,true);
	var names = params[0]["name"];
	var tiddlerName = names[0];
	var className = names[1] ? names[1] : null;
	var args = params[0]["with"];
	var wrapper = createTiddlyElement(place,"span",null,className);
	if(!args)
		{
		wrapper.setAttribute("refresh","content");
		wrapper.setAttribute("tiddler",tiddlerName);
		}
	var text = store.getTiddlerText(tiddlerName);
	if(text)
		{
		var stack = config.macros.tiddler.tiddlerStack;
		if(stack.indexOf(tiddlerName) !== -1)
			return;
		stack.push(tiddlerName);
		try
			{
			var n = args ? Math.min(args.length,9) : 0;
			for(var i=0; i<n; i++) 
				{
				var placeholderRE = new RegExp("\\$" + (i + 1),"mg");
				text = text.replace(placeholderRE,args[i]);
				}
			config.macros.tiddler.renderText(wrapper,text,tiddlerName,params);
			}
		finally
			{
			stack.pop();
			}
		}
}

config.macros.tiddler.renderText = function(place,text,tiddlerName,params) 
{
	wikify(text,place,null,store.getTiddler(tiddlerName));
}

config.macros.tiddler.tiddlerStack = [];

config.macros.tag.handler = function(place,macroName,params)
{
	createTagButton(place,params[0]);
}

config.macros.tags.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var theList = createTiddlyElement(place,"ul");
	var title = getParam(params,"anon","");
	if(title && store.tiddlerExists(title))
		tiddler = store.getTiddler(title);
	var sep = getParam(params,"sep"," ");
	var lingo = config.views.wikified.tag;
	var prompt = tiddler.tags.length == 0 ? lingo.labelNoTags : lingo.labelTags;
	createTiddlyElement(theList,"li",null,"listTitle",prompt.format([tiddler.title]));
	for(var t=0; t<tiddler.tags.length; t++)
		{
		createTagButton(createTiddlyElement(theList,"li"),tiddler.tags[t],tiddler.title);
		if(t<tiddler.tags.length-1)
			createTiddlyText(theList,sep);
		}
}

config.macros.tagging.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var theList = createTiddlyElement(place,"ul");
	var title = getParam(params,"anon","");
	if(title == "" && tiddler instanceof Tiddler)
		title = tiddler.title;
	var sep = getParam(params,"sep"," ");
	theList.setAttribute("title",this.tooltip.format([title]));
	var tagged = store.getTaggedTiddlers(title);
	var prompt = tagged.length == 0 ? this.labelNotTag : this.label;
	createTiddlyElement(theList,"li",null,"listTitle",prompt.format([title,tagged.length]));
	for(var t=0; t<tagged.length; t++)
		{
		createTiddlyLink(createTiddlyElement(theList,"li"),tagged[t].title,true);
		if(t<tagged.length-1)
			createTiddlyText(theList,sep);
		}
}

config.macros.closeAll.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
}

config.macros.closeAll.onClick = function(e)
{
	story.closeAllTiddlers();
	return false;
}

config.macros.permaview.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
}

config.macros.permaview.onClick = function(e)
{
	story.permaView();
	return false;
}

config.macros.saveChanges.handler = function(place)
{
	if(!readOnly)
		createTiddlyButton(place,this.label,this.prompt,this.onClick,null,null,this.accessKey);
}

config.macros.saveChanges.onClick = function(e)
{
	saveChanges();
	return false;
}

config.macros.slider.onClickSlider = function(e)
{
	if(!e) var e = window.event;
	var n = this.nextSibling;
	var cookie = n.getAttribute("cookie");
	var isOpen = n.style.display != "none";
	if(config.options.chkAnimate && anim && typeof Slider == "function")
		anim.startAnimating(new Slider(n,!isOpen,e.shiftKey || e.altKey,"none"));
	else
		n.style.display = isOpen ? "none" : "block";
	config.options[cookie] = !isOpen;
	saveOptionCookie(cookie);
	return false;
}

config.macros.slider.createSlider = function(place,cookie,title,tooltip)
{
	var cookie = cookie ? cookie : "";
	var btn = createTiddlyButton(place,title,tooltip,this.onClickSlider);
	var panel = createTiddlyElement(null,"div",null,"sliderPanel");
	panel.setAttribute("cookie",cookie);
	panel.style.display = config.options[cookie] ? "block" : "none";
	place.appendChild(panel);
	return panel;
}

config.macros.slider.handler = function(place,macroName,params)
{
	var panel = this.createSlider(place,params[0],params[2],params[3]);
	var text = store.getTiddlerText(params[1]);
	panel.setAttribute("refresh", "content");
	panel.setAttribute("tiddler", params[1]);
	if(text)
		wikify(text,panel,null,store.getTiddler(params[1]));
}

config.macros.option.onChangeOption = function(e)
{
	var opt = this.getAttribute("option");
	var elementType,valueField;
	if(opt)
		{
		switch(opt.substr(0,3))
			{
			case "txt":
				elementType = "input";
				valueField = "value";
				break;
			case "chk":
				elementType = "input";
				valueField = "checked";
				break;
			}
		config.options[opt] = this[valueField];
		saveOptionCookie(opt);
		var nodes = document.getElementsByTagName(elementType);
		for(var t=0; t<nodes.length; t++)
			{
			var optNode = nodes[t].getAttribute("option");
			if(opt == optNode)
				nodes[t][valueField] = this[valueField];
			}
		}
	return(true);
}

config.macros.option.handler = function(place,macroName,params)
{
	var opt = params[0];
	if(config.options[opt] == undefined)
		return;
	var c;
	switch(opt.substr(0,3))
		{
		case "txt":
			c = document.createElement("input");
			c.onkeyup = this.onChangeOption;
			c.setAttribute("option",opt);
			c.className = "txtOptionInput";
			place.appendChild(c);
			c.value = config.options[opt];
			break;
		case "chk":
			c = document.createElement("input");
			c.setAttribute("type","checkbox");
			c.onclick = this.onChangeOption;
			c.setAttribute("option",opt);
			c.className = "chkOptionInput";
			place.appendChild(c);
			c.checked = config.options[opt];
			break;
		}
}

config.macros.newTiddler.createNewTiddlerButton = function(place,title,params,label,prompt,accessKey,newFocus,isJournal)
{
	var tags = [];
	for(var t=1; t<params.length; t++)
		if((params[t].name == "anon" && t != 1) || (params[t].name == "tag"))
			tags.push(params[t].value);
	label = getParam(params,"label",label);
	prompt = getParam(params,"prompt",prompt);
	accessKey = getParam(params,"accessKey",accessKey);
	newFocus = getParam(params,"focus",newFocus);
	var customFields = getParam(params,"fields",newFocus);
	var btn = createTiddlyButton(place,label,prompt,this.onClickNewTiddler,null,null,accessKey);
	btn.setAttribute("newTitle",title);
	btn.setAttribute("isJournal",isJournal);
	btn.setAttribute("params",tags.join("|"));
	btn.setAttribute("newFocus",newFocus);
	btn.setAttribute("newTemplate",getParam(params,"template",DEFAULT_EDIT_TEMPLATE));
	btn.setAttribute("customFields",customFields);
	var text = getParam(params,"text");
	if(text !== undefined) 
		btn.setAttribute("newText",text);
	return btn;
}

config.macros.newTiddler.onClickNewTiddler = function()
{
	var title = this.getAttribute("newTitle");
	if(this.getAttribute("isJournal"))
		{
		var now = new Date();
		title = now.formatString(title.trim());
		}
	var params = this.getAttribute("params").split("|");
	var focus = this.getAttribute("newFocus");
	var template = this.getAttribute("newTemplate");
	var customFields = this.getAttribute("customFields");
	story.displayTiddler(null,title,template,false,false,customFields);
	var text = this.getAttribute("newText");
	if(typeof text == "string")
		story.getTiddlerField(title,"text").value = text.format([title]);
	for(var t=0;t<params.length;t++)
		story.setTiddlerTag(title,params[t],+1);
	story.focusTiddler(title,focus);
	return false;
}

config.macros.newTiddler.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(!readOnly)
		{
		params = paramString.parseParams("anon",null,true,false,false);
		var title = params[1] && params[1].name == "anon" ? params[1].value : this.title;
		title = getParam(params,"title",title);
		this.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,"title",false);
		}
}

config.macros.newJournal.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(!readOnly)
		{
		params = paramString.parseParams("anon",null,true,false,false);
		var title = params[1] && params[1].name == "anon" ? params[1].value : "";
		title = getParam(params,"title",title);
		config.macros.newTiddler.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,"text",true);
		}
}

config.macros.sparkline.handler = function(place,macroName,params)
{
	var data = [];
	var min = 0;
	var max = 0;
	for(var t=0; t<params.length; t++)
		{
		var v = parseInt(params[t]);
		if(v < min)
			min = v;
		if(v > max)
			max = v;
		data.push(v);
		}
	if(data.length < 1)
		return;
	var box = createTiddlyElement(place,"span",null,"sparkline",String.fromCharCode(160));
	box.title = data.join(",");
	var w = box.offsetWidth;
	var h = box.offsetHeight;
	box.style.paddingRight = (data.length * 2 - w) + "px";
	box.style.position = "relative";
	for(var d=0; d<data.length; d++)
		{
		var tick = document.createElement("img");
		tick.border = 0;
		tick.className = "sparktick";
		tick.style.position = "absolute";
		tick.src = "data:image/gif,GIF89a%01%00%01%00%91%FF%00%FF%FF%FF%00%00%00%C0%C0%C0%00%00%00!%F9%04%01%00%00%02%00%2C%00%00%00%00%01%00%01%00%40%02%02T%01%00%3B";
		tick.style.left = d*2 + "px";
		tick.style.width = "2px";
		var v = Math.floor(((data[d] - min)/(max-min)) * h);
		tick.style.top = (h-v) + "px";
		tick.style.height = v + "px";
		box.appendChild(tick);
		}
}

config.macros.tabs.handler = function(place,macroName,params)
{
	var cookie = params[0];
	var numTabs = (params.length-1)/3;
	var wrapper = createTiddlyElement(null,"div",null,cookie);
	var tabset = createTiddlyElement(wrapper,"div",null,"tabset");
	tabset.setAttribute("cookie",cookie);
	var validTab = false;
	for(var t=0; t<numTabs; t++)
		{
		var label = params[t*3+1];
		var prompt = params[t*3+2];
		var content = params[t*3+3];
		var tab = createTiddlyButton(tabset,label,prompt,this.onClickTab,"tab tabUnselected");
		tab.setAttribute("tab",label);
		tab.setAttribute("content",content);
		tab.title = prompt;
		if(config.options[cookie] == label)
			validTab = true;
		}
	if(!validTab)
		config.options[cookie] = params[1];
	place.appendChild(wrapper);
	this.switchTab(tabset,config.options[cookie]);
}

config.macros.tabs.onClickTab = function(e)
{
	config.macros.tabs.switchTab(this.parentNode,this.getAttribute("tab"));
	return false;
}

config.macros.tabs.switchTab = function(tabset,tab)
{
	var cookie = tabset.getAttribute("cookie");
	var theTab = null
	var nodes = tabset.childNodes;
	for(var t=0; t<nodes.length; t++)
		if(nodes[t].getAttribute && nodes[t].getAttribute("tab") == tab)
			{
			theTab = nodes[t];
			theTab.className = "tab tabSelected";
			}
		else
			nodes[t].className = "tab tabUnselected"
	if(theTab)
		{
		if(tabset.nextSibling && tabset.nextSibling.className == "tabContents")
			tabset.parentNode.removeChild(tabset.nextSibling);
		var tabContent = createTiddlyElement(null,"div",null,"tabContents");
		tabset.parentNode.insertBefore(tabContent,tabset.nextSibling);
		var contentTitle = theTab.getAttribute("content");
		wikify(store.getTiddlerText(contentTitle),tabContent,null,store.getTiddler(contentTitle));
		if(cookie)
			{
			config.options[cookie] = tab;
			saveOptionCookie(cookie);
			}
		}
}

// <<gradient [[tiddler name]] vert|horiz rgb rgb rgb rgb... >>
config.macros.gradient.handler = function(place,macroName,params,wikifier)
{
	var terminator = ">>";
	var panel;
	if(wikifier)
		panel = createTiddlyElement(place,"div",null,"gradient");
	else
		panel = place;
	panel.style.position = "relative";
	panel.style.overflow = "hidden";
	panel.style.zIndex = "0";
	var t;
	if(wikifier)
		{
		var styles = config.formatterHelpers.inlineCssHelper(wikifier);
		config.formatterHelpers.applyCssHelper(panel,styles);
		}
	var colours = [];
	for(t=1; t<params.length; t++)
		{
		var c = new RGB(params[t]);
		if(c)
			colours.push(c);
		}
	drawGradient(panel,params[0] != "vert",colours);
	if(wikifier)
		wikifier.subWikify(panel,terminator);
	if(document.all)
		{
		panel.style.height = "100%";
		panel.style.width = "100%";
		}
}

config.macros.message.handler = function(place,macroName,params)
{
	if(params[0])
		{
		var m = config;
		var p = params[0].split(".");
		for(var t=0; t<p.length; t++)
			{
			if(p[t] in m)
				m = m[p[t]];
			else
				break;
			}
		createTiddlyText(place,m.toString().format(params.splice(1)));
		}
}

config.macros.view.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if((tiddler instanceof Tiddler) && params[0])
		{
		var value = store.getValue(tiddler,params[0]);
		if(value != undefined)
			switch(params[1])
				{
				case undefined:
					highlightify(value,place,highlightHack,tiddler);
					break;
				case "link":
					createTiddlyLink(place,value,true);
					break;
				case "wikified":
					wikify(value,place,highlightHack,tiddler);
					break;
				case "date":
					value = Date.convertFromYYYYMMDDHHMM(value);
					if(params[2])
						createTiddlyText(place,value.formatString(params[2]));
					else
						createTiddlyText(place,value);
					break;
				}
		}
}

config.macros.edit.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var field = params[0];
	if((tiddler instanceof Tiddler) && field)
		{
		story.setDirty(tiddler.title,true);
		if(field != "text")
			{
				var e = createTiddlyElement(null,"input");
				if(tiddler.isReadOnly())
					e.setAttribute("readOnly","readOnly");
				e.setAttribute("edit",field);
				e.setAttribute("type","text");
				var v = store.getValue(tiddler,field);
				if(!v) 
					v = "";
				e.value = v;
				e.setAttribute("size","40");
				e.setAttribute("autocomplete","off");
				place.appendChild(e);
			}
		else
			{
				var wrapper1 = createTiddlyElement(null,"fieldset",null,"fieldsetFix");
				var wrapper2 = createTiddlyElement(wrapper1,"div");
				var e = createTiddlyElement(wrapper2,"textarea");
				if(tiddler.isReadOnly())
					e.setAttribute("readOnly","readOnly");
				var v = store.getValue(tiddler,field);
				if(!v) 
					v = "";
				e.value = v;
				var rows = 10;
				var lines = v.match(/\n/mg);
				var maxLines = Math.max(parseInt(config.options.txtMaxEditRows),5);
				if(lines != null && lines.length > rows)
					rows = lines.length + 5;
				rows = Math.min(rows,maxLines);
				e.setAttribute("rows",rows);
				e.setAttribute("edit",field);
				place.appendChild(wrapper1);
			}
		}
}

config.macros.tagChooser.onClick = function(e)
{
	if(!e) var e = window.event;
	var lingo = config.views.editor.tagChooser;
	var popup = Popup.create(this);
	var tags = store.getTags();
	if(tags.length == 0)
		createTiddlyText(createTiddlyElement(popup,"li"),lingo.popupNone);
	for(var t=0; t<tags.length; t++)
		{
		var theTag = createTiddlyButton(createTiddlyElement(popup,"li"),tags[t][0],lingo.tagTooltip.format([tags[t][0]]),config.macros.tagChooser.onTagClick);
		theTag.setAttribute("tag",tags[t][0]);
		theTag.setAttribute("tiddler", this.getAttribute("tiddler"));
		}
	Popup.show(popup,false);
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return(false);
}

config.macros.tagChooser.onTagClick = function(e)
{
	if(!e) var e = window.event;
	var tag = this.getAttribute("tag");
	var title = this.getAttribute("tiddler");
	if(!readOnly)
		story.setTiddlerTag(title,tag,0);
	return(false);
}

config.macros.tagChooser.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(tiddler instanceof Tiddler)
		{
		var title = tiddler.title;
		var lingo = config.views.editor.tagChooser;
		var btn = createTiddlyButton(place,lingo.text,lingo.tooltip,this.onClick);
		btn.setAttribute("tiddler", title);
		}
}

// Create a toolbar command button
// place - parent DOM element
// command - reference to config.commands[] member -or- name of member
// tiddler - reference to tiddler that toolbar applies to
// theClass - the class to give the button
config.macros.toolbar.createCommand = function(place,commandName,tiddler,theClass)
{
	if(typeof commandName != "string")
		{
		var c = null;
		for(var t in config.commands)
			if(config.commands[t] == commandName)
				c = t;
		commandName = c;
		}
	if((tiddler instanceof Tiddler) && (typeof commandName == "string"))
		{
		var command = config.commands[commandName];
		if(command.isEnabled ? command.isEnabled(tiddler) : this.isCommandEnabled(command,tiddler))
			{
			var text = command.getText ? command.getText(tiddler) : this.getCommandText(command,tiddler);
			var tooltip = command.getTooltip ? command.getTooltip(tiddler) : this.getCommandTooltip(command,tiddler);
			var btn = createTiddlyButton(null,text,tooltip,this.onClickCommand);
			btn.setAttribute("commandName", commandName);
			btn.setAttribute("tiddler", tiddler.title);
			if(theClass)
				addClass(btn,theClass);
			place.appendChild(btn);
			}
		}
}

config.macros.toolbar.isCommandEnabled = function(command, tiddler) {
	var title = tiddler.title;
	var ro = tiddler.isReadOnly();
	var shadow = store.isShadowTiddler(title) && !store.tiddlerExists(title);
	return (!ro || (ro && !command.hideReadOnly)) && !(shadow && command.hideShadow);
}

config.macros.toolbar.getCommandText = function(command, tiddler) {
	return tiddler.isReadOnly() && command.readOnlyText ? command.readOnlyText : command.text;
}

config.macros.toolbar.getCommandTooltip = function(command, tiddler) {
	return tiddler.isReadOnly() && command.readOnlyTooltip ? command.readOnlyTooltip : command.tooltip;
}

config.macros.toolbar.onClickCommand = function(e)
{
	if(!e) var e = window.event;
	var command = config.commands[this.getAttribute("commandName")];
	return command.handler(e,this,this.getAttribute("tiddler"));
}

// Invoke the first command encountered from a given place that is tagged with a specified class
config.macros.toolbar.invokeCommand = function(place,theClass,event)
{
	var children = place.getElementsByTagName("a")
	for(var t=0; t<children.length; t++)
		{
		var c = children[t];
		if(hasClass(c,theClass) && c.getAttribute && c.getAttribute("commandName"))
			{
			if(c.onclick instanceof Function)
				c.onclick.call(c,event);
			break;
			}
		}
}

config.macros.toolbar.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	for(var t=0; t<params.length; t++)
		{
		var c = params[t];
		var theClass = "";
		switch(c.substr(0,1))
			{
			case "+":
				theClass = "defaultCommand";
				c = c.substr(1);
				break;
			case "-":
				theClass = "cancelCommand";
				c = c.substr(1);
				break;
			}
		if(c in config.commands)
			this.createCommand(place,c,tiddler,theClass);
		}
}

config.macros.refreshDisplay.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
}

config.macros.refreshDisplay.onClick = function(e)
{
	refreshAll();
	return false;
}
// ---------------------------------------------------------------------------------
// Menu and toolbar commands
// ---------------------------------------------------------------------------------

config.commands.closeTiddler.handler = function(event,src,title)
{
	story.closeTiddler(title,true,event.shiftKey || event.altKey);
	return false;
}

config.commands.closeOthers.handler = function(event,src,title)
{
	story.closeAllTiddlers(title);
	return false;
}

config.commands.editTiddler.handler = function(event,src,title)
{
	clearMessage();
	story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE);
	story.focusTiddler(title,"text");
	return false;
}

config.commands.saveTiddler.handler = function(event,src,title)
{
	var newTitle = story.saveTiddler(title,event.shiftKey);
	if(newTitle)
	   story.displayTiddler(null,newTitle);
	return false;
}

config.commands.cancelTiddler.handler = function(event,src,title)
{
	if(story.hasChanges(title) && !readOnly)
		if(!confirm(this.warning.format([title])))
			return false;
	story.setDirty(title,false);
	story.displayTiddler(null,title);
	return false;
}

config.commands.deleteTiddler.handler = function(event,src,title)
{
	var deleteIt = true;
	if (config.options.chkConfirmDelete)
		deleteIt = confirm(this.warning.format([title]));
	if (deleteIt)
		{
		store.removeTiddler(title);
		story.closeTiddler(title,true,event.shiftKey || event.altKey);
		if(config.options.chkAutoSave)
			saveChanges();
		}
	return false;
}

config.commands.permalink.handler = function(event,src,title)
{
	var t = encodeURIComponent(String.encodeTiddlyLink(title));
	if(window.location.hash != t)
		window.location.hash = t;
	return false;
}

config.commands.references.handler = function(event,src,title)
{
	var popup = Popup.create(src);
	if(popup)
		{
		var references = store.getReferringTiddlers(title);
		var c = false;
		for(var r=0; r<references.length; r++)
			if(references[r].title != title && !references[r].isTagged("excludeLists"))
				{
				createTiddlyLink(createTiddlyElement(popup,"li"),references[r].title,true);
				c = true;
				}
		if(!c)
			createTiddlyText(createTiddlyElement(popup,"li",null,"disabled"),this.popupNone);
		}
	Popup.show(popup,false);
	event.cancelBubble = true;
	if (event.stopPropagation) event.stopPropagation();
	return false;
}

config.commands.jump.handler = function(event,src,title)
{
	var popup = Popup.create(src);
	if(popup)
		{
		story.forEachTiddler(function(title,element) {
			createTiddlyLink(createTiddlyElement(popup,"li"),title,true);
			});
		}
	Popup.show(popup,false);
	event.cancelBubble = true;
	if (event.stopPropagation) event.stopPropagation();
	return false;
}

// ---------------------------------------------------------------------------------
// Tiddler() object
// ---------------------------------------------------------------------------------

function Tiddler()
{
	this.title = null;
	this.text = null;
	this.modifier = null;
	this.modified = new Date();
	this.created = new Date();
	this.links = [];
	this.linksUpdated = false;
	this.tags = [];
	return this;
}

Tiddler.prototype.getLinks = function()
{
	if(this.linksUpdated==false)
		this.changed();
	return this.links;
}

// Format the text for storage in an RSS item
Tiddler.prototype.saveToRss = function(url)
{
	var s = [];
	s.push("<item>");
	s.push("<title" + ">" + this.title.htmlEncode() + "</title" + ">");
	s.push("<description>" + wikifyStatic(this.text,null,this).htmlEncode() + "</description>");
	for(var t=0; t<this.tags.length; t++)
		s.push("<category>" + this.tags[t] + "</category>");
	s.push("<link>" + url + "#" + encodeURIComponent(String.encodeTiddlyLink(this.title)) + "</link>");
	s.push("<pubDate>" + this.modified.toGMTString() + "</pubDate>");
	s.push("</item>");
	return(s.join("\n"));
}

// Change the text and other attributes of a tiddler
Tiddler.prototype.set = function(title,text,modifier,modified,tags,created,fields)
{
	this.assign(title,text,modifier,modified,tags,created,fields);
	this.changed();
	return this;
}

// Change the text and other attributes of a tiddler without triggered a tiddler.changed() call
Tiddler.prototype.assign = function(title,text,modifier,modified,tags,created,fields)
{
	if(title != undefined)
		this.title = title;
	if(text != undefined)
		this.text = text;
	if(modifier != undefined)
		this.modifier = modifier;
	if(modified != undefined)
		this.modified = modified;
	if(created != undefined)
		this.created = created;
	if(fields != undefined)
		this.fields = fields;
	if(tags != undefined)
		this.tags = (typeof tags == "string") ? tags.readBracketedList() : tags;
	else if(this.tags == undefined)
		this.tags = [];
	return this;
}

// Get the tags for a tiddler as a string (space delimited, using [[brackets]] for tags containing spaces)
Tiddler.prototype.getTags = function()
{
	return String.encodeTiddlyLinkList(this.tags);
}

// Test if a tiddler carries a tag
Tiddler.prototype.isTagged = function(tag)
{
	return this.tags.indexOf(tag) != -1;
}

// Static method to convert "\n" to newlines, "\s" to "\"
Tiddler.unescapeLineBreaks = function(text)
{
	return text ? text.unescapeLineBreaks() : "";
}

// Convert newlines to "\n", "\" to "\s"
Tiddler.prototype.escapeLineBreaks = function()
{
	return this.text.escapeLineBreaks();
}

// Updates the secondary information (like links[] array) after a change to a tiddler
Tiddler.prototype.changed = function()
{
	this.links = [];
	var t = this.autoLinkWikiWords() ? 0 : 1;
	var tiddlerLinkRegExp = t==0 ? config.textPrimitives.tiddlerAnyLinkRegExp : config.textPrimitives.tiddlerForcedLinkRegExp;
	tiddlerLinkRegExp.lastIndex = 0;
	var formatMatch = tiddlerLinkRegExp.exec(this.text);
	while(formatMatch)
		{
		var lastIndex = tiddlerLinkRegExp.lastIndex;
		if(t==0 && formatMatch[1] && formatMatch[1] != this.title) // wikiWordLink
			{
			if(formatMatch.index > 0)
				{
				var preRegExp = new RegExp(config.textPrimitives.unWikiLink+"|"+config.textPrimitives.anyLetter,"mg");
				preRegExp.lastIndex = formatMatch.index-1;
				var preMatch = preRegExp.exec(this.text);
				if(preMatch.index != formatMatch.index-1)
					this.links.pushUnique(formatMatch[1]);
				}
			else
				this.links.pushUnique(formatMatch[1]);
			}
		else if(formatMatch[2-t] && (store.tiddlerExists(formatMatch[3-t]) || store.isShadowTiddler(formatMatch[3-t]))) // titledBrackettedLink
			this.links.pushUnique(formatMatch[3-t]);
		else if(formatMatch[4-t] && formatMatch[4-t] != this.title) // brackettedLink
			this.links.pushUnique(formatMatch[4-t]);
		// Do not add link if match urlPattern (formatMatch[5-t])
		tiddlerLinkRegExp.lastIndex = lastIndex;
		formatMatch = tiddlerLinkRegExp.exec(this.text);
		}
	this.linksUpdated = true;
	return;
}

Tiddler.prototype.getSubtitle = function()
{
	var theModifier = this.modifier;
	if(!theModifier)
		theModifier = config.messages.subtitleUnknown;
	var theModified = this.modified;
	if(theModified)
		theModified = theModified.toLocaleString();
	else
		theModified = config.messages.subtitleUnknown;
	return(config.messages.tiddlerLinkTooltip.format([this.title,theModifier,theModified]));
}

Tiddler.prototype.isReadOnly = function()
{
	return readOnly;
}

Tiddler.prototype.autoLinkWikiWords = function()
{
	return !(this.isTagged("systemConfig") || this.isTagged("excludeMissing"));
}

Tiddler.prototype.generateFingerprint = function()
{
	return "0x" + Crypto.hexSha1Str(this.text);
}

// ---------------------------------------------------------------------------------
// TiddlyWiki() object contains Tiddler()s
// ---------------------------------------------------------------------------------

function TiddlyWiki()
{
	var tiddlers = {}; // Hashmap by name of tiddlers
	this.tiddlersUpdated = false;
	this.namedNotifications = []; // Array of {name:,notify:} of notification functions
	this.notificationLevel = 0;
	this.slices = {}; // map tiddlerName->(map sliceName->sliceValue). Lazy.
	this.clear = function() {
		tiddlers = {};
		this.setDirty(false);
		};
	this.fetchTiddler = function(title) {
		return tiddlers[title];
		};
	this.deleteTiddler = function(title) {
		delete this.slices[title];
		delete tiddlers[title];
		};
	this.addTiddler = function(tiddler) {
		delete this.slices[tiddler.title];
		tiddlers[tiddler.title] = tiddler;
		};
	this.forEachTiddler = function(callback) {
		for(var t in tiddlers)
			{
			var tiddler = tiddlers[t];
			if(tiddler instanceof Tiddler)
				callback.call(this,t,tiddler);
			}
		};
}

// Set the dirty flag
TiddlyWiki.prototype.setDirty = function(dirty)
{
	this.dirty = dirty;
}

TiddlyWiki.prototype.isDirty = function()
{
	return this.dirty;
}

TiddlyWiki.prototype.suspendNotifications = function()
{
	this.notificationLevel--;
}

TiddlyWiki.prototype.resumeNotifications = function()
{
	this.notificationLevel++;
}

// Invoke the notification handlers for a particular tiddler
TiddlyWiki.prototype.notify = function(title,doBlanket)
{
	if(!this.notificationLevel)
		for(var t=0; t<this.namedNotifications.length; t++)
			{
			var n = this.namedNotifications[t];
			if((n.name == null && doBlanket) || (n.name == title))
				n.notify(title);
			}
}

// Invoke the notification handlers for all tiddlers
TiddlyWiki.prototype.notifyAll = function()
{
	if(!this.notificationLevel)
		for(var t=0; t<this.namedNotifications.length; t++)
			{
			var n = this.namedNotifications[t];
			if(n.name)
				n.notify(n.name);
			}
}

// Add a notification handler to a tiddler
TiddlyWiki.prototype.addNotification = function(title,fn)
{
	for (var i=0; i<this.namedNotifications.length; i++)
		if((this.namedNotifications[i].name == title) && (this.namedNotifications[i].notify == fn))
			return this;
	this.namedNotifications.push({name: title, notify: fn});
	return this;
}

TiddlyWiki.prototype.removeTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler)
		{
		this.deleteTiddler(title);
		this.notify(title,true);
		this.setDirty(true);
		}
}

TiddlyWiki.prototype.tiddlerExists = function(title)
{
	var t = this.fetchTiddler(title);
	return (t != undefined);
}

TiddlyWiki.prototype.isShadowTiddler = function(title)
{
	return typeof config.shadowTiddlers[title] == "string";
}

TiddlyWiki.prototype.getTiddler = function(title)
{
	var t = this.fetchTiddler(title);
	if(t != undefined)
		return t;
	else
		return null;
}

TiddlyWiki.prototype.getTiddlerText = function(title,defaultText)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler)
		return tiddler.text;
	if(!title)
		return defaultText;
	var pos = title.indexOf(config.textPrimitives.sliceSeparator);
	if(pos != -1)
		{
		var slice = this.getTiddlerSlice(title.substr(0,pos),title.substr(pos + config.textPrimitives.sliceSeparator.length));
		if(slice)
			return slice;
		}
	if(this.isShadowTiddler(title))
		return config.shadowTiddlers[title];
	if(defaultText != undefined)
		return defaultText;
	return null;
}

TiddlyWiki.prototype.slicesRE = /(?:[\'\/]*~?(\w+)[\'\/]*\:[\'\/]*\s*(.*?)\s*$)|(?:\|[\'\/]*~?(\w+)\:?[\'\/]*\|\s*(.*?)\s*\|)/gm

// @internal
TiddlyWiki.prototype.calcAllSlices = function(title) 
{
	var slices = {};
	var text = this.getTiddlerText(title,"");
	this.slicesRE.lastIndex = 0;
	do 
		{
			var m = this.slicesRE.exec(text);
			if (m) 
				{
					if (m[1])
						slices[m[1]] = m[2];
					else
						slices[m[3]] = m[4];
				}
		}
	while(m);
	return slices;
}

// Returns the slice of text of the given name
TiddlyWiki.prototype.getTiddlerSlice = function(title,sliceName)
{
	var slices = this.slices[title];
	if (!slices) {
		slices = this.calcAllSlices(title);
		this.slices[title] = slices;
	}
	return slices[sliceName];
}

// Build an hashmap of the specified named slices of a tiddler
TiddlyWiki.prototype.getTiddlerSlices = function(title,sliceNames)
{
	var r = {};
	for(var t=0; t<sliceNames.length; t++)
		{
		var slice = this.getTiddlerSlice(title,sliceNames[t]);
		if(slice)
			r[sliceNames[t]] = slice;
		}
	return r;
}

TiddlyWiki.prototype.getRecursiveTiddlerText = function(title,defaultText,depth)
{
	var bracketRegExp = new RegExp("(?:\\[\\[([^\\]]+)\\]\\])","mg");
	var text = this.getTiddlerText(title,null);
	if(text == null)
		return defaultText;
	var textOut = [];
	var lastPos = 0;
	do {
		var match = bracketRegExp.exec(text);
		if(match)
			{
			textOut.push(text.substr(lastPos,match.index-lastPos));
			if(match[1])
				{
				if(depth <= 0)
					textOut.push(match[1]);
				else
					textOut.push(this.getRecursiveTiddlerText(match[1],"[[" + match[1] + "]]",depth-1));
				}
			lastPos = match.index + match[0].length;
			}
		else
			textOut.push(text.substr(lastPos));
	} while(match);
	return(textOut.join(""));
}

TiddlyWiki.prototype.setTiddlerTag = function(title,status,tag)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler)
		{
		var t = tiddler.tags.indexOf(tag);
		if(t != -1)
			tiddler.tags.splice(t,1);
		if(status)
			tiddler.tags.push(tag);
		tiddler.changed();
		this.incChangeCount(title);
		this.notify(title,true);
		this.setDirty(true);
		}
}

TiddlyWiki.prototype.saveTiddler = function(title,newTitle,newBody,modifier,modified,tags,fields)
{
	var tiddler = this.fetchTiddler(title);
	var created;
	if(tiddler)
		{
		created = tiddler.created; // Preserve created date
		this.deleteTiddler(title);
		}
	else
		{
		tiddler = new Tiddler();
		created = modified;
		}
	tiddler.set(newTitle,newBody,modifier,modified,tags,created,fields);
	this.addTiddler(tiddler);
	this.incChangeCount(newTitle);
	if(title != newTitle)
		this.notify(title,true);
	this.notify(newTitle,true);
	this.setDirty(true);
	return tiddler;
}

TiddlyWiki.prototype.incChangeCount = function(title)
{
	var c = this.getValue(title,"changeCount");
	if(!c)
		c = 0;
	this.setValue(title,"changeCount",++c);
}

TiddlyWiki.prototype.createTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(!tiddler)
		{
		tiddler = new Tiddler();
		tiddler.title = title;
		this.addTiddler(tiddler);
		this.setDirty(true);
		}
	return tiddler;
}

// Load contents of a tiddlywiki from an HTML DIV
TiddlyWiki.prototype.loadFromDiv = function(src,idPrefix,noUpdate)
{
	this.idPrefix = idPrefix;
	var storeElem = (typeof src == "string") ? document.getElementById(src) : src;
	if(!storeElem)
		return;
	var tiddlers = this.getLoader().loadTiddlers(this,storeElem.childNodes);
	this.setDirty(false);
	if(!noUpdate)
		{
		for(var i = 0;i<tiddlers.length; i++)
			tiddlers[i].changed();
		}
}

TiddlyWiki.prototype.updateTiddlers = function()
{
	this.tiddlersUpdated = true;
	this.forEachTiddler(function(title,tiddler) {
		tiddler.changed();
		});
}

// Return all tiddlers formatted as an HTML string
TiddlyWiki.prototype.allTiddlersAsHtml = function()
{
	return store.getSaver().externalize(store);
}

// Return an array of tiddlers matching a search regular expression
TiddlyWiki.prototype.search = function(searchRegExp,sortField,excludeTag)
{
	var candidates = this.reverseLookup("tags",excludeTag,false);
	var results = [];
	for(var t=0; t<candidates.length; t++)
		{
		if((candidates[t].title.search(searchRegExp) != -1) || (candidates[t].text.search(searchRegExp) != -1))
			results.push(candidates[t]);
		}
	if(!sortField)
		sortField = "title";
	results.sort(function(a,b) {return a[sortField] < b[sortField] ? -1 : (a[sortField] == b[sortField] ? 0 : +1);});
	return results;
}

// Return an array of all the tags in use. Each member of the array is another array where [0] is the name of the tag and [1] is the number of occurances
TiddlyWiki.prototype.getTags = function(excludeTag)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		for(var g=0; g<tiddler.tags.length; g++)
			{
			var tag = tiddler.tags[g];
			if(excludeTag)
				{
				var t = store.fetchTiddler(tag);
				if(t && t.isTagged(excludeTag))
					return false;
				}
			var f = false;
			for(var c=0; c<results.length; c++)
				if(results[c][0] == tag)
					{
					f = true;
					results[c][1]++;
					}
			if(!f)
				results.push([tag,1]);
			}
		});
	results.sort(function(a,b) {return a[0].toLowerCase() < b[0].toLowerCase() ? -1 : (a[0].toLowerCase() == b[0].toLowerCase() ? 0 : +1);});
	return results;
}

// Return an array of the tiddlers that are tagged with a given tag
TiddlyWiki.prototype.getTaggedTiddlers = function(tag,sortField)
{
	return this.reverseLookup("tags",tag,true,sortField);
}

// Return an array of the tiddlers that link to a given tiddler
TiddlyWiki.prototype.getReferringTiddlers = function(title,unusedParameter,sortField)
{
	if(!this.tiddlersUpdated)
		this.updateTiddlers();
	return this.reverseLookup("links",title,true,sortField);
}

// Return an array of the tiddlers that do or do not have a specified entry in the specified storage array (ie, "links" or "tags")
// lookupMatch == true to match tiddlers, false to exclude tiddlers
TiddlyWiki.prototype.reverseLookup = function(lookupField,lookupValue,lookupMatch,sortField)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		var f = !lookupMatch;
		for(var lookup=0; lookup<tiddler[lookupField].length; lookup++)
			if(tiddler[lookupField][lookup] == lookupValue)
				f = lookupMatch;
		if(f)
			results.push(tiddler);
		});
	if(!sortField)
		sortField = "title";
	results.sort(function(a,b) {return a[sortField] < b[sortField] ? -1 : (a[sortField] == b[sortField] ? 0 : +1);});
	return results;
}

// Return the tiddlers as a sorted array
TiddlyWiki.prototype.getTiddlers = function(field,excludeTag)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		if(excludeTag == undefined || !tiddler.isTagged(excludeTag))
			results.push(tiddler);
		});
	if(field)
		results.sort(function(a,b) {return a[field] < b[field] ? -1 : (a[field] == b[field] ? 0 : +1);});
	return results;
}

// Return array of names of tiddlers that are referred to but not defined
TiddlyWiki.prototype.getMissingLinks = function(sortField)
{
	if(!this.tiddlersUpdated)
		this.updateTiddlers();
	var results = [];
	this.forEachTiddler(function (title,tiddler) {
		for(var n=0; n<tiddler.links.length;n++)
			{
			var link = tiddler.links[n];
			if(this.fetchTiddler(link) == null && !this.isShadowTiddler(link))
				results.pushUnique(link);
			}
		});
	results.sort();
	return results;
}

// Return an array of names of tiddlers that are defined but not referred to
TiddlyWiki.prototype.getOrphans = function()
{
	var results = [];
	this.forEachTiddler(function (title,tiddler) {
		if(this.getReferringTiddlers(title).length == 0 && !tiddler.isTagged("excludeLists"))
			results.push(title);
		});
	results.sort();
	return results;
}

// Return an array of names of all the shadow tiddlers
TiddlyWiki.prototype.getShadowed = function()
{
	var results = [];
	for(var t in config.shadowTiddlers)
		if(typeof config.shadowTiddlers[t] == "string")
			results.push(t);
	results.sort();
	return results;
}

// Resolves a Tiddler reference or tiddler title into a Tiddler object, or null if it doesn't exist
TiddlyWiki.prototype.resolveTiddler = function(tiddler) 
{
	var t = (typeof tiddler == 'string') ? this.getTiddler(tiddler) : tiddler;
	return t instanceof Tiddler ? t : null;
}

TiddlyWiki.prototype.getLoader = function() 
{
	if (!this.loader) 
		this.loader = new TW21Loader();
	return this.loader;
}
 
TiddlyWiki.prototype.getSaver = function() 
{
	if (!this.saver) 
		this.saver = new TW21Saver();
	return this.saver;
}

// Returns true if path is a valid field name (path),
// i.e. a sequence of identifiers, separated by '.'
TiddlyWiki.isValidFieldName = function (name) {
	var match = /[a-zA-Z_]\w*(\.[a-zA-Z_]\w*)*/.exec(name);
	return match && (match[0] == name);
}

// Throws an exception when name is not a valid field name.
TiddlyWiki.checkFieldName = function(name) {
	if (!TiddlyWiki.isValidFieldName(name))
		throw config.messages.invalidFieldName.format([name]);
}

function StringFieldAccess(n, readOnly) {
	this.set = readOnly 
		? function(t,v) {if (v != t[n]) throw config.messages.fieldCannotBeChanged.format([n]);}
		: function(t,v) {if (v != t[n]) {t[n] = v; return true;}};
	this.get = function(t) {return t[n];};
}

function DateFieldAccess(n) {
	this.set = function(t,v) {
			var d = v instanceof Date ? v : Date.convertFromYYYYMMDDHHMM(v); 
			if (d != t[n]) {
				t[n] = d; return true;
			}
		};
	this.get = function(t)   {return t[n].convertToYYYYMMDDHHMM();}
}

function LinksFieldAccess(n) {
	this.set = function(t,v) {
			var s = (typeof v == "string") ? v.readBracketedList() : v; 
			if (s.toString() != t[n].toString()) {
				t[n] = s; return true;
			}
		};
	this.get = function(t)   {return String.encodeTiddlyLinkList(t[n]);}
}

TiddlyWiki.standardFieldAccess = {
	// The set functions return true when setting the data has changed the value.
	
	"title":    new StringFieldAccess("title", true),
	// Handle the "tiddler" field name as the title
	"tiddler":  new StringFieldAccess("title", true),
	
	"text":     new StringFieldAccess("text"),
	"modifier": new StringFieldAccess("modifier"),
	"modified": new DateFieldAccess("modified"),
	"created":  new DateFieldAccess("created"),
	"tags":     new LinksFieldAccess("tags")
};

TiddlyWiki.isStandardField = function(name) {
	return TiddlyWiki.standardFieldAccess[name] != undefined;
}

// Sets the value of the given field of the tiddler to the value. 
// Setting an ExtendedField's value to null or undefined removes the field. 
// Setting a namespace to undefined removes all fields of that namespace.
// The fieldName is case-insensitive.
// All values will be converted to a string value.
TiddlyWiki.prototype.setValue = function(tiddler, fieldName, value) {
	TiddlyWiki.checkFieldName(fieldName);
	var t = this.resolveTiddler(tiddler);
	if (!t)
		return;
		
	fieldName = fieldName.toLowerCase();

	var isRemove = (value === undefined) || (value === null);

	if (!t.fields) 
		t.fields = {};
		
	var accessor = TiddlyWiki.standardFieldAccess[fieldName];
	if (accessor) {
		if (isRemove)
			// don't remove StandardFields
			return;
		var h = TiddlyWiki.standardFieldAccess[fieldName];
		if (!h.set(t, value))
			return;

	} else {
		var oldValue = t.fields[fieldName];
		
		if (isRemove) {
			if (oldValue !== undefined) {
				// deletes a single field
				delete t.fields[fieldName];
			} else {
				// no concrete value is defined for the fieldName
				// so we guess this is a namespace path.
				
				// delete all fields in a namespace
				var re = new RegExp('^'+fieldName+'\\.');
				var dirty = false;
				for (var n in t.fields) {
					if (n.match(re)) {
						delete t.fields[n];
						dirty = true;
					}
				}
				if (!dirty)
					return
			}
				
		} else {
			// the "normal" set case. value is defined (not null/undefined)
			// For convenience provide a nicer conversion Date->String
 			value = value instanceof Date 
				? value.convertToYYYYMMDDHHMMSSMMM() 
				: String(value);
			if (oldValue == value) 
				return;
			t.fields[fieldName] = value;
		}
	}
	
	// When we are here the tiddler/store really was changed.
	this.notify(t.title,true);
	if (!fieldName.match(/^temp\./))
		this.setDirty(true);
}

// Returns the value of the given field of the tiddler. 
// The fieldName is case-insensitive.
// Will only return String values (or undefined).
TiddlyWiki.prototype.getValue = function(tiddler, fieldName) {
	var t = this.resolveTiddler(tiddler);
	if (!t)
		return undefined;

	fieldName = fieldName.toLowerCase();

	var accessor = TiddlyWiki.standardFieldAccess[fieldName];
	if (accessor) {
		return accessor.get(t);
	}
	
	return t.fields ? t.fields[fieldName] : undefined;
}

// Calls the callback function for every field in the tiddler.
//
// When callback function returns a non-false value the iteration stops 
// and that value is returned. 
//
// The order of the fields is not defined.
// 
// @param callback a function(tiddler, fieldName, value). 
// 
TiddlyWiki.prototype.forEachField = function(tiddler, callback, onlyExtendedFields) {
	var t = this.resolveTiddler(tiddler);
	if (!t)
		return undefined;
	
	if (t.fields) {
		for (var n in t.fields) {
			var result = callback(t, n, t.fields[n]);
			if (result)
				return result;
		}
	}
	
	if (onlyExtendedFields)
		return undefined;

	for (var n in TiddlyWiki.standardFieldAccess) {
		if (n == "tiddler")
			// even though the "title" field can also be referenced through the name "tiddler"
			// we only visit this field once.
			continue;
			
		var result = callback(t, n, TiddlyWiki.standardFieldAccess[n].get(t));
		if (result)
			return result;
	}

	return undefined;
};
// ---------------------------------------------------------------------------------
// Story functions
// ---------------------------------------------------------------------------------

function Story(container,idPrefix)
{
	this.container = container;
	this.idPrefix = idPrefix;
	this.highlightRegExp = null;
}

Story.prototype.forEachTiddler = function(fn)
{
	var place = document.getElementById(this.container);
	if(!place)
		return;
	var e = place.firstChild;
	while(e)
		{
		var n = e.nextSibling;
		var title = e.getAttribute("tiddler");
		fn.call(this,title,e);
		e = n;
		}
}

Story.prototype.displayTiddlers = function(srcElement,titles,template,animate,slowly,customFields)
{
	for(var t = titles.length-1;t>=0;t--)
		this.displayTiddler(srcElement,titles[t],template,animate,slowly,customFields);
}

Story.prototype.displayTiddler = function(srcElement,title,template,animate,slowly,customFields)
{
	var place = document.getElementById(this.container);
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem)
		this.refreshTiddler(title,template,false,customFields);
	else
		{
		var before = this.positionTiddler(srcElement);
		tiddlerElem = this.createTiddler(place,before,title,template,customFields);
		}
	if(srcElement && typeof srcElement !== "string")
		{
		if(config.options.chkAnimate && (animate == undefined || animate == true) && anim && typeof Cascade == "function" && typeof Scroller == "function")
			anim.startAnimating(new Cascade(title,srcElement,tiddlerElem,slowly),new Scroller(tiddlerElem,slowly));
		else
			window.scrollTo(0,ensureVisible(tiddlerElem));
		}
}

Story.prototype.positionTiddler = function(srcElement)
{
	var place = document.getElementById(this.container);
	var before;
	if(typeof srcElement == "string")
		{
		switch(srcElement)
			{
			case "top":
				before = place.firstChild;
				break;
			case "bottom":
				before = null;
				break;
			}
		}
	else
		{
		var after = this.findContainingTiddler(srcElement);
		if(after == null)
			before = place.firstChild;
		else if(after.nextSibling)
			before = after.nextSibling;
		else
			before = null;
		}
	return before;
}

Story.prototype.createTiddler = function(place,before,title,template,customFields)
{
	var tiddlerElem = createTiddlyElement(null,"div",this.idPrefix + title,"tiddler");
	tiddlerElem.setAttribute("refresh","tiddler");
	place.insertBefore(tiddlerElem,before);
	this.refreshTiddler(title,template,false,customFields);
	return tiddlerElem;
}

Story.prototype.chooseTemplateForTiddler = function(title,template)
{
	if(!template)
		template = DEFAULT_VIEW_TEMPLATE;
	if(template == DEFAULT_VIEW_TEMPLATE || template == DEFAULT_EDIT_TEMPLATE)
		template = config.tiddlerTemplates[template];
	return template;
}

Story.prototype.getTemplateForTiddler = function(title,template,tiddler)
{
	return store.getRecursiveTiddlerText(template,null,10);
}

Story.prototype.refreshTiddler = function(title,template,force,customFields)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem)
		{
		if(tiddlerElem.getAttribute("dirty") == "true" && !force)
			return tiddlerElem;
		template = this.chooseTemplateForTiddler(title,template);
		var currTemplate = tiddlerElem.getAttribute("template");
		if((template != currTemplate) || force)
			{
			var tiddler = store.getTiddler(title);
			if(!tiddler)
				{
				tiddler = new Tiddler();
				if(store.isShadowTiddler(title))
					tiddler.set(title,store.getTiddlerText(title),config.views.wikified.shadowModifier,version.date,[],version.date);
				else
					{
					var text = template=="EditTemplate"
								? config.views.editor.defaultText.format([title])
								: config.views.wikified.defaultText.format([title]);
					tiddler.set(title,text,config.views.wikified.defaultModifier,version.date,[],version.date);
					}
				}
			tiddlerElem.setAttribute("tags",tiddler.tags.join(" "));
			tiddlerElem.setAttribute("tiddler",title);
			tiddlerElem.setAttribute("template",template);
			var me = this;
			tiddlerElem.onmouseover = this.onTiddlerMouseOver;
			tiddlerElem.onmouseout = this.onTiddlerMouseOut;
			tiddlerElem.ondblclick = this.onTiddlerDblClick;
			tiddlerElem[window.event?"onkeydown":"onkeypress"] = this.onTiddlerKeyPress;
			var html = this.getTemplateForTiddler(title,template,tiddler);
			tiddlerElem.innerHTML = html;
			applyHtmlMacros(tiddlerElem,tiddler);
			if(store.getTaggedTiddlers(title).length > 0)
				addClass(tiddlerElem,"isTag");
			else
				removeClass(tiddlerElem,"isTag");
			if(!store.tiddlerExists(title))
				{
				if(store.isShadowTiddler(title))
					addClass(tiddlerElem,"shadow");
				else
					addClass(tiddlerElem,"missing");
				}
			else
				{
				removeClass(tiddlerElem,"shadow");
				removeClass(tiddlerElem,"missing");
				}
			if(customFields)
				this.addCustomFields(tiddlerElem,customFields);
			}
		}
	return tiddlerElem;
}

Story.prototype.addCustomFields = function(place,customFields)
{
	var fieldsPattern = "(?:(" + config.textPrimitives.anyLetter + "+)\\(([^\\)\\|\\n]+)(?:\\):))|(?:(" + config.textPrimitives.anyLetter + "+):([^;\\|\\n]+);)";
	var fieldsPattern = "([^:]*):([^;]*);";
	var fieldsRegExp = new RegExp(fieldsPattern,"mg");
	var fields = [];
	var lastMatch = 0;
	var match = fieldsRegExp.exec(customFields);
	while(match && match.index == lastMatch)
		{
		fields.push({field: match[1], value: match[2]});
		lastMatch = match.index + match[0].length;
		fieldsRegExp.lastIndex = lastMatch;
		match = fieldsRegExp.exec(customFields);
		}
	var w = document.createElement("div");
	w.style.display = "none";
	place.appendChild(w);
	for(var t=0; t<fields.length; t++)
		{
		var e = document.createElement("input");
		e.setAttribute("type","text");
		e.setAttribute("value",fields[t].value);
		w.appendChild(e);
		e.setAttribute("edit",fields[t].field);
		}
}

Story.prototype.refreshAllTiddlers = function() 
{
	var place = document.getElementById(this.container);
	var e = place.firstChild;
	if(!e)
		return;
	this.refreshTiddler(e.getAttribute("tiddler"),e.getAttribute("template"),true);
	while((e = e.nextSibling) != null) 
		this.refreshTiddler(e.getAttribute("tiddler"),e.getAttribute("template"),true);
}

Story.prototype.onTiddlerMouseOver = function(e)
{
	if(window.addClass instanceof Function)
		addClass(this,"selected");
}

Story.prototype.onTiddlerMouseOut = function(e)
{
	if(window.removeClass instanceof Function)
		removeClass(this,"selected");
}

Story.prototype.onTiddlerDblClick = function(e)
{
	if(!e) var e = window.event;
	var theTarget = resolveTarget(e);
	if(theTarget && theTarget.nodeName.toLowerCase() != "input" && theTarget.nodeName.toLowerCase() != "textarea")
		{
		if(document.selection && document.selection.empty)
			document.selection.empty();
		config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
		e.cancelBubble = true;
		if (e.stopPropagation) e.stopPropagation();
		return true;
		}
	else
		return false;
}

Story.prototype.onTiddlerKeyPress = function(e)
{
	if(!e) var e = window.event;
	clearMessage();
	var consume = false; 
	var title = this.getAttribute("tiddler");
	var target = resolveTarget(e);
	switch(e.keyCode)
		{
		case 9: // Tab
			if(config.options.chkInsertTabs && target.tagName.toLowerCase() == "textarea")
				{
				replaceSelection(target,String.fromCharCode(9));
				consume = true; 
				}
			if(config.isOpera)
				{
				target.onblur = function()
					{
					this.focus();
					this.onblur = null;
					}
				}
			break;
		case 13: // Ctrl-Enter
		case 10: // Ctrl-Enter on IE PC
		case 77: // Ctrl-Enter is "M" on some platforms
			if(e.ctrlKey)
				{
				blurElement(this);
				config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
				consume = true;
				}
			break; 
		case 27: // Escape
			blurElement(this);
			config.macros.toolbar.invokeCommand(this,"cancelCommand",e);
			consume = true;
			break;
		}
	e.cancelBubble = consume;
	if(consume)
		{
		if(e.stopPropagation) e.stopPropagation(); // Stop Propagation
		e.returnValue = true; // Cancel The Event in IE
		if(e.preventDefault ) e.preventDefault(); // Cancel The Event in Moz
		}
	return(!consume);
};

Story.prototype.getTiddlerField = function(title,field)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	var e = null;
	if(tiddlerElem != null)
		{
		var children = tiddlerElem.getElementsByTagName("*");
		for (var t=0; t<children.length; t++)
			{
			var c = children[t];
			if(c.tagName.toLowerCase() == "input" || c.tagName.toLowerCase() == "textarea")
				{
				if(!e)
					e = c;
				if(c.getAttribute("edit") == field)
					e = c;
				}
			}
		}
	return e;
}

Story.prototype.focusTiddler = function(title,field)
{
	var e = this.getTiddlerField(title,field);
	if(e)
		{
		e.focus();
		e.select();
		}
}

Story.prototype.blurTiddler = function(title)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem != null && tiddlerElem.focus && tiddlerElem.blur)
		{
		tiddlerElem.focus();
		tiddlerElem.blur();
		}
}

Story.prototype.setTiddlerField = function(title,tag,mode,field)
{
	var c = story.getTiddlerField(title,field);

	var tags = c.value.readBracketedList();
	tags.setItem(tag,mode);
	c.value = String.encodeTiddlyLinkList(tags);
}

Story.prototype.setTiddlerTag = function(title,tag,mode)
{
	Story.prototype.setTiddlerField(title,tag,mode,"tags");
}

Story.prototype.closeTiddler = function(title,animate,slowly)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem != null)
		{
		clearMessage();
		this.scrubTiddler(tiddlerElem);
		if(config.options.chkAnimate && animate && anim && typeof Slider == "function")
			anim.startAnimating(new Slider(tiddlerElem,false,slowly,"all"));
		else
			tiddlerElem.parentNode.removeChild(tiddlerElem);
		}
}

Story.prototype.scrubTiddler = function(tiddlerElem)
{
	tiddlerElem.id = null;
}

Story.prototype.setDirty = function(title,dirty)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem != null)
		tiddlerElem.setAttribute("dirty",dirty ? "true" : "false");
}

Story.prototype.isDirty = function(title)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem != null)
		return tiddlerElem.getAttribute("dirty") == "true";
	return null;
}

Story.prototype.areAnyDirty = function()
{
	var r = false;
	this.forEachTiddler(function(title,element) {
		if(this.isDirty(title))
			r = true;
		});
	return r;
}

Story.prototype.closeAllTiddlers = function(exclude)
{
	clearMessage();
	this.forEachTiddler(function(title,element) {
		if((title != exclude) && element.getAttribute("dirty") != "true")
			this.closeTiddler(title);
		});
	window.scrollTo(0,ensureVisible(this.container));
}

Story.prototype.isEmpty = function()
{
	var place = document.getElementById(this.container);
	return(place && place.firstChild == null);
}

Story.prototype.search = function(text,useCaseSensitive,useRegExp)
{
	this.closeAllTiddlers();
	highlightHack = new RegExp(useRegExp ?	 text : text.escapeRegExp(),useCaseSensitive ? "mg" : "img");
	var matches = store.search(highlightHack,"title","excludeSearch");
	var titles = [];
	for(var t=matches.length-1; t>=0; t--)
		titles.push(matches[t].title);
	this.displayTiddlers(null,titles);
	highlightHack = null;
	var q = useRegExp ? "/" : "'";
	if(matches.length > 0)
		displayMessage(config.macros.search.successMsg.format([titles.length.toString(),q + text + q]));
	else
		displayMessage(config.macros.search.failureMsg.format([q + text + q]));
}

Story.prototype.findContainingTiddler = function(e)
{
	while(e && !hasClass(e,"tiddler"))
		e = e.parentNode;
	return(e);
}

Story.prototype.gatherSaveFields = function(e,fields)
{
	if(e && e.getAttribute)
		{
		var f = e.getAttribute("edit");
		if(f)
			fields[f] = e.value.replace(/\r/mg,"");;
		if(e.hasChildNodes())
			{
			var c = e.childNodes;
			for(var t=0; t<c.length; t++)
				this.gatherSaveFields(c[t],fields)
			}
		}
}

Story.prototype.hasChanges = function(title)
{
	var e = document.getElementById(this.idPrefix + title);
	if(e != null)
		{
		var fields = {};
		this.gatherSaveFields(e,fields);
		var tiddler = store.fetchTiddler(title);
		if (!tiddler)
			return false;
		for(var n in fields)
			if (store.getValue(title,n) != fields[n])
				return true;
		}
	return false;
}

Story.prototype.saveTiddler = function(title,minorUpdate)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem != null)
		{
		var fields = {};
		this.gatherSaveFields(tiddlerElem,fields);
		var newTitle = fields.title ? fields.title : title;
		if(store.tiddlerExists(newTitle) && newTitle != title)
			{
			if(confirm(config.messages.overwriteWarning.format([newTitle.toString()])))
				this.closeTiddler(newTitle,false,false);
			else
				return null;
			}
		tiddlerElem.id = this.idPrefix + newTitle;
		tiddlerElem.setAttribute("tiddler",newTitle);
		tiddlerElem.setAttribute("template",DEFAULT_VIEW_TEMPLATE);
		tiddlerElem.setAttribute("dirty","false");
		if(config.options.chkForceMinorUpdate)
			minorUpdate = !minorUpdate;
		var newDate = new Date();
		store.saveTiddler(title,newTitle,fields.text,config.options.txtUserName,minorUpdate ? undefined : newDate,fields.tags);
		for (var n in fields) 
			if (!TiddlyWiki.isStandardField(n))
				store.setValue(newTitle,n,fields[n]);
		if(config.options.chkAutoSave)
			saveChanges();
		return newTitle;
		}
	return null;
}

Story.prototype.permaView = function()
{
	var links = [];
	this.forEachTiddler(function(title,element) {
		links.push(String.encodeTiddlyLink(title));
		});
	var t = encodeURIComponent(links.join(" "));
	if(t == "")
		t = "#";
	if(window.location.hash != t)
		window.location.hash = t;
}

// ---------------------------------------------------------------------------------
// Backstage
// ---------------------------------------------------------------------------------

var backstage = {
	backstage: null,
	cloak: null,
	tabs: null,
	panel: null,
	panelBody: null,
	panelFooter: null,
	currTabName: null,
	currTabElem: null,

	init: function() {
		this.cloak = document.getElementById("backstageCloak");
		this.backstage = document.getElementById("backstage");
		this.tabs = document.getElementById("backstageTabs");
		this.panel = document.getElementById("backstagePanel");
		this.panelBody = createTiddlyElement(this.panel,"div",null,"backstagePanelBody");
		this.panelFooter = createTiddlyElement(this.panel,"div",null,"backstagePanelFooter wizardFooter");
		createTiddlyButton(this.panelFooter,"close","Close backstage",backstage.hidePanel);
		this.backstage.onmouseover = function(e) {
			backstage.tabs.style.visibility = "visible";
		};
		this.backstage.onmouseout = function(e) {
			backstage.tabs.style.visibility = "hidden";
		};
		this.cloak.onmousedown = function(e) {
			backstage.switchTab(null);
		};
		createTiddlyText(this.tabs,config.messages.backstagePrompt);
		for(var t=0; t<config.backstageTasks.length; t++) {
			var taskName = config.backstageTasks[t];
			var task = config.tasks[taskName];
			var btn = createTiddlyButton(this.tabs,task.text,task.tooltip,this.onClickTab,"backstageTab");
			btn.setAttribute("task",taskName);
			}
		this.switchTab(null);
	},

	onClickTab: function(e) {
		backstage.switchTab(this.getAttribute("task"));
		return false;
	},

	// Switch to a given tab, or none if null is passed
	switchTab: function(tabName) {
		var tabElem = null;
		var e = this.tabs.firstChild;
		while(e)
			{
			if(e.getAttribute && e.getAttribute("task") == tabName)
				tabElem = e;
			e = e.nextSibling
			}
		if(tabName == backstage.currTabName)
			return;
		if(backstage.currTabElem) {
			removeClass(this.currTabElem,"backstageSelTab");
			}
		if(tabElem && tabName) {
			backstage.preparePanel();
			addClass(tabElem,"backstageSelTab");
			var task = config.tasks[tabName];
			wikify(task.content,backstage.panelBody,null,null)
			backstage.showPanel();
		} else if(backstage.currTabElem) {
			backstage.hidePanel();
		}
		backstage.currTabName = tabName;
		backstage.currTabElem = tabElem;
	},

	preparePanel: function() {
		backstage.cloak.style.height = document.documentElement.scrollHeight + "px";
		backstage.cloak.style.display = "block";
		removeChildren(backstage.panelBody);
		return backstage.panelBody;
	},
	
	showPanel: function() {
		if(anim && config.options.chkAnimate)
			anim.startAnimating(new Slider(backstage.panel,true,false,"none"),new Scroller(backstage.backstage,false));
		else
			{
			backstage.panel.height = "auto";
			backstage.panel.style.display = "block";
			}
		return backstage.panelBody;
	},
	
	hidePanel: function() {
		backstage.currTabName = null;
		backstage.currTabElem = null;
		if(anim && config.options.chkAnimate)
			anim.startAnimating(new Slider(backstage.panel,false,false,"none"));
		else
			backstage.panel.style.display = "none";
		backstage.cloak.style.display = "none";
	},
	
	setButtons: function(buttons,callback) {
		removeChildren(backstage.panelFooter);
		for(t=0; t<buttons.length; t++)
			{
			var a = buttons[t];
			if(a && a.name != "")
				createTiddlyButton(backstage.panelFooter,a.caption,a.tooltip,function (e) {a.onclick.apply(this,arguments); return false;});
			}
	}
};

config.macros.backstage = {};

config.macros.backstage.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var backstageTask = config.tasks[params[0]];
	if(backstageTask)
		createTiddlyButton(place,backstageTask.text,backstageTask.tooltip,function(e) {backstage.switchTab(params[0]); return false;})
}
// ---------------------------------------------------------------------------------
// ImportTiddlers macro
// ---------------------------------------------------------------------------------

config.macros.importTiddlers.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(readOnly)
		{
		createTiddlyElement(place,"div",null,"marked",this.readOnlyWarning);
		return;
		}
	var importer = createTiddlyElement(null,"div",null,"importTiddler wizard");
	createTiddlyElement(importer,"h1",null,null,this.wizardTitle);
	createTiddlyElement(importer,"h2",null,"step1",this.step1);
	var step = createTiddlyElement(importer,"div",null,"wizardStep");
	createTiddlyText(step,this.step1prompt);
	var input = createTiddlyElement(null,"input",null,"txtOptionInput");
	input.type = "text";
	input.size = 50;
	step.appendChild(input);
	importer.inputBox = input;
	createTiddlyElement(step,"br");
	createTiddlyText(step,this.step1promptFile);
	var fileInput = createTiddlyElement(null,"input",null,"txtOptionInput");
	fileInput.type = "file";
	fileInput.size = 50;
	fileInput.onchange = this.onBrowseChange;
	fileInput.onkeyup = this.onBrowseChange;
	step.appendChild(fileInput);
	createTiddlyElement(step,"br");
	createTiddlyText(step,this.step1promptFeeds);
	var feeds = this.getFeeds([{caption: this.step1feedPrompt, name: ""}]);
	createTiddlyDropDown(step,this.onFeedChange,feeds);
	createTiddlyElement(step,"br");
	createTiddlyButton(step,this.fetchLabel,this.fetchPrompt,this.onFetch,null,null,null);
        place.appendChild(importer);
}

config.macros.importTiddlers.getFeeds = function(feeds)
{
	var tagged = store.getTaggedTiddlers("contentPublisher","title");
	for(var t=0; t<tagged.length; t++)
		feeds.push({caption: tagged[t].title, name: store.getTiddlerSlice(tagged[t].title,"URL")});
	return feeds;
}

config.macros.importTiddlers.onFeedChange = function(e)
{
	var importer = findRelated(this,"importTiddler","className","parentNode");
	importer.inputBox.value = this.value;
	this.selectedIndex = 0;
}

config.macros.importTiddlers.onBrowseChange = function(e)
{
	var importer = findRelated(this,"importTiddler","className","parentNode");
	importer.inputBox.value = "file://" + this.value;
}

config.macros.importTiddlers.onFetch = function(e)
{
	var importer = findRelated(this,"importTiddler","className","parentNode");
	var url = importer.inputBox.value;
	var cutoff = findRelated(importer.firstChild,"step2","className","nextSibling");
	while(cutoff)
		{
		var temp = cutoff.nextSibling;
		cutoff.parentNode.removeChild(cutoff);
		cutoff = temp;
		}
	createTiddlyElement(importer,"h2",null,"step2",config.macros.importTiddlers.step2);
	var step = createTiddlyElement(importer,"div",null,"wizardStep",config.macros.importTiddlers.step2Text.format([url]));
	loadRemoteFile(url,config.macros.importTiddlers.onLoad,importer);
}

config.macros.importTiddlers.onLoad = function(status,params,responseText,url,xhr)
{
	if(!status)
		{
		displayMessage(this.fetchError);
		return;
		}
	var importer = params;
	// Check that the tiddler we're in hasn't been closed - doesn't work on IE
//	var p = importer;
//	while(p.parentNode)
//		p = p.parentNode;
//	if(!(p instanceof HTMLDocument))
//		return;
	// Crack out the content - (should be refactored)
	var posOpeningDiv = responseText.indexOf(startSaveArea);
	var limitClosingDiv = responseText.indexOf("<!--STORE-AREA-END--"+">");
	var posClosingDiv = responseText.lastIndexOf(endSaveArea,limitClosingDiv == -1 ? responseText.length : limitClosingDiv);
	if((posOpeningDiv == -1) || (posClosingDiv == -1))
		{
		alert(config.messages.invalidFileError.format([url]));
		return;
		}
	var content = "<html><body>" + responseText.substring(posOpeningDiv,posClosingDiv + endSaveArea.length) + "</body></html>";
	// Create the iframe
	var iframe = document.createElement("iframe");
	iframe.style.display = "none";
	importer.insertBefore(iframe,importer.firstChild);
	var doc = iframe.document;
	if(iframe.contentDocument)
		doc = iframe.contentDocument; // For NS6
	else if(iframe.contentWindow)
		doc = iframe.contentWindow.document; // For IE5.5 and IE6
	// Put the content in the iframe
	doc.open();
	doc.writeln(content);
	doc.close();
	// Load the content into a TiddlyWiki() object
	var storeArea = doc.getElementById("storeArea");
	var importStore = new TiddlyWiki();
	importStore.loadFromDiv(storeArea,"store");
	// Get rid of the iframe
	iframe.parentNode.removeChild(iframe);
	// Extract data for the listview
	var tiddlers = [];
	importStore.forEachTiddler(function(title,tiddler)
		{
		var t = {};
		t.title = title;
		t.modified = tiddler.modified;
		t.modifier = tiddler.modifier;
		t.text = tiddler.text.substr(0,50);
		t.tags = tiddler.tags;
		tiddlers.push(t);
		});
	// Display the listview
	createTiddlyElement(importer,"h2",null,"step3",config.macros.importTiddlers.step3);
	var step = createTiddlyElement(importer,"div",null,"wizardStep");
	ListView.create(step,tiddlers,config.macros.importTiddlers.listViewTemplate,config.macros.importTiddlers.onSelectCommand);
	// Save the importer
	importer.store = importStore;
}

config.macros.importTiddlers.onSelectCommand = function(listView,command,rowNames)
{
	var importer = findRelated(listView,"importTiddler","className","parentNode");
	switch(command)
		{
		case "import":
			config.macros.importTiddlers.doImport(importer,rowNames);
			break;
		}
	if(config.options.chkAutoSave)
		saveChanges(true);
}

config.macros.importTiddlers.doImport = function(importer,rowNames)
{
	var theStore = importer.store;
	var overwrite = new Array();
	var t;
	for(t=0; t<rowNames.length; t++)
		{
		if(store.tiddlerExists(rowNames[t]))
			overwrite.push(rowNames[t]);
	}
	if(overwrite.length > 0)
		if(!confirm(this.confirmOverwriteText.format([overwrite.join(", ")])))
			return;
	for(t=0; t<rowNames.length; t++)
		{
		var inbound = theStore.fetchTiddler(rowNames[t]);
		store.saveTiddler(inbound.title, inbound.title, inbound.text, inbound.modifier, inbound.modified, inbound.tags);
		store.fetchTiddler(inbound.title).created = inbound.created;
		store.notify(rowNames[t],false);
		}
	store.notifyAll();
	store.setDirty(true);
	createTiddlyElement(importer,"h2",null,"step4",this.step4.format([rowNames.length]));
	var step = createTiddlyElement(importer,"div",null,"wizardStep");
	for(t=0; t<rowNames.length; t++)
		{
		createTiddlyLink(step,rowNames[t],true);
		createTiddlyElement(step,"br");
		}
	createTiddlyElement(importer,"h2",null,"step5",this.step5);
}
// ---------------------------------------------------------------------------------
// Sync macro
// ---------------------------------------------------------------------------------

// Synchronisation handlers
config.syncers = {};

// Translateable strings
config.macros.sync = {
	label: "sync",
	prompt: "Plug back in to the server and synchronize changes",
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'selected', rowName: 'title', type: 'Selector'},
			{name: 'Title', field: 'title', tiddlerLink: 'title', title: "Title", type: 'TiddlerLink'},
			{name: 'Local Status', field: 'localStatus', title: "Changed on your computer?", type: 'String'},
			{name: 'Server Status', field: 'serverStatus', title: "Changed on server?", type: 'String'},
			{name: 'Server URL', field: 'serverUrl', title: "Server URL", text: "View", type: 'Link'}
			],
		rowClasses: [
			],
		buttons: [
			{caption: "Sync these tiddlers", name: 'sync'}
			]},
	wizardTitle: "Synchronize your content with external servers and feeds",
	step1: "Choose the tiddlers you want to synchronize"
};

// Sync state. Members:
//	syncList - List of sync objects (title, tiddler, server, workspace, page, version)
//	listView - DOM element of the listView table
var currSync = null;

// sync macro
config.macros.sync.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(!wikifier.isStatic)
		config.macros.sync.startSync(place);
}

config.macros.sync.startSync = function(place)
{
	if(currSync)
		config.macros.sync.cancelSync();
	currSync = {};
	var syncer;
	for(syncer in config.syncers)
		if(config.syncers[syncer].init)
			config.syncers[syncer].init(currSync);
	currSync.syncList = [];
	store.forEachTiddler(function(title,tiddler) {
		var syncType = store.getValue(tiddler,"sync");
		if(store.getValue(tiddler,"socialtext.server"))
			syncType = "socialtext";
		var syncItem = {title: title,
			tiddler: tiddler,
			syncType: syncType,
			changeCount: store.getValue(tiddler,"changeCount"),
			serverStatus: "..."
			};
		syncItem.localStatus = syncItem.changeCount > 0 ? "Changed while unplugged" : "Unchanged while unplugged";
		syncItem.selected = syncItem.changeCount > 0;
		syncer = config.syncers[syncType];
		if(syncType && syncer)
			{
			if(syncer.addSyncable)
				syncer.addSyncable(currSync,tiddler,syncItem);
			currSync.syncList.push(syncItem);
			}
		});
	var wizard = createTiddlyElement(place,"div",null,"importTiddler wizard");
	createTiddlyElement(wizard,"h1",null,null,this.wizardTitle);
	createTiddlyElement(wizard,"h2",null,"step1",this.step1);
	var step = createTiddlyElement(wizard,"div",null,"wizardStep");
	currSync.listView = ListView.create(step,currSync.syncList,this.listViewTemplate,this.onSelectCommand);
}

config.macros.sync.cancelSync = function()
{
}

config.macros.sync.onSelectCommand = function(listView,command,rowNames)
{
	switch(command)
		{
		case "cancel":
			break;
		case "sync":
			config.macros.sync.doSync(rowNames);
			break;
		}
}

config.macros.sync.doSync = function(selNames)
{
	for(var t=0; t<selNames.length; t++)
		{
		var f = currSync.syncList.findByField("title",selNames[t])
		var s = currSync.syncList[f];
		var syncer = config.syncers[s.syncType];
		if(syncer.doSync)
			syncer.doSync(currSync,s);
		}
}
// ---------------------------------------------------------------------------------
// Manager UI for groups of tiddlers
// ---------------------------------------------------------------------------------

config.macros.plugins.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var wizard = createTiddlyElement(place,"div",null,"importTiddler wizard");
	createTiddlyElement(wizard,"h1",null,null,this.wizardTitle);
	createTiddlyElement(wizard,"h2",null,"step1",this.step1);
	var step = createTiddlyElement(wizard,"div",null,"wizardStep");
	var e = createTiddlyElement(step,"div");
	e.setAttribute("refresh","macro");
	e.setAttribute("macroName","plugins");
	e.setAttribute("params",paramString);
	this.refresh(e,paramString);
}

config.macros.plugins.refresh = function(place,params)
{
	var selectedRows = [];
	ListView.forEachSelector(place,function(e,rowName) {
			if(e.checked)
				selectedRows.push(e.getAttribute("rowName"));
		});
	removeChildren(place);
	params = params.parseParams("anon");
	var plugins = installedPlugins.slice(0);
	var t,tiddler,p;
	var configTiddlers = store.getTaggedTiddlers("systemConfig");
	for(t=0; t<configTiddlers.length; t++)
		{
		tiddler = configTiddlers[t];
		if(plugins.findByField("title",tiddler.title) == null)
			{
			p = getPluginInfo(tiddler);
			p.executed = false;
			p.log.splice(0,0,this.skippedText);
			plugins.push(p);
			}
		}
	for(t=0; t<plugins.length; t++)
		{
		var p = plugins[t];
		p.forced = p.tiddler.isTagged("systemConfigForce");
		p.disabled = p.tiddler.isTagged("systemConfigDisable");
		p.Selected = selectedRows.indexOf(plugins[t].title) != -1;
		}
	if(plugins.length == 0)
		createTiddlyElement(place,"em",null,null,this.noPluginText);
	else
		ListView.create(place,plugins,this.listViewTemplate,this.onSelectCommand);
}

config.macros.plugins.onSelectCommand = function(command,rowNames)
{
	var t;
	switch(command)
		{
		case "remove":
			for(t=0; t<rowNames.length; t++)
				store.setTiddlerTag(rowNames[t],false,"systemConfig");
			break;
		case "delete":
			if(rowNames.length > 0 && confirm(config.macros.plugins.confirmDeleteText.format([rowNames.join(", ")])))
				{
				for(t=0; t<rowNames.length; t++)
					{
					store.removeTiddler(rowNames[t]);
					story.closeTiddler(rowNames[t],true,false);
					}
				}
			break;
		}
	if(config.options.chkAutoSave)
		saveChanges(true);
}

// ---------------------------------------------------------------------------------
// Message area
// ---------------------------------------------------------------------------------

function getMessageDiv()
{
	var msgArea = document.getElementById("messageArea");
	if(!msgArea)
		return null;
	if(!msgArea.hasChildNodes())
		createTiddlyButton(createTiddlyElement(msgArea,"div",null,"messageToolbar"),
			config.messages.messageClose.text,
			config.messages.messageClose.tooltip,
			clearMessage);
	msgArea.style.display = "block";
	return createTiddlyElement(msgArea,"div");
}

function displayMessage(text,linkText)
{
	var e = getMessageDiv();
	if(!e)
		{
		alert(text);
		return;
		}
	if(linkText)
		{
		var link = createTiddlyElement(e,"a",null,null,text);
		link.href = linkText;
		link.target = "_blank";
		}
	else
		e.appendChild(document.createTextNode(text));
}

function clearMessage()
{
	var msgArea = document.getElementById("messageArea");
	if(msgArea)
		{
		removeChildren(msgArea);
		msgArea.style.display = "none";
		}
	return false;
}

// ---------------------------------------------------------------------------------
// Refresh mechanism
// ---------------------------------------------------------------------------------

config.refreshers = {
	link: function(e,changeList)
		{
		var title = e.getAttribute("tiddlyLink");
		refreshTiddlyLink(e,title);
		return true;
		},
	
	tiddler: function(e,changeList)
		{
		var title = e.getAttribute("tiddler");
		var template = e.getAttribute("template");
		if(changeList && changeList.indexOf(title) != -1 && !story.isDirty(title))
			story.refreshTiddler(title,template,true);
		else
			refreshElements(e,changeList);
		return true;
		},

	content: function(e,changeList)
		{
		var title = e.getAttribute("tiddler");
		var force = e.getAttribute("force");
		if(force != null || changeList == null || changeList.indexOf(title) != -1)
			{
			removeChildren(e);
			wikify(store.getTiddlerText(title,title),e);
			return true;
			}
		else
			return false;
		},

	macro: function(e,changeList)
		{
		var macro = e.getAttribute("macroName");
		var params = e.getAttribute("params");
		if(macro)
			macro = config.macros[macro];
		if(macro && macro.refresh)
			macro.refresh(e,params);
		return true;
		}
};

function refreshElements(root,changeList)
{
	var nodes = root.childNodes;
	for(var c=0; c<nodes.length; c++)
		{
		var e = nodes[c],type;
		if(e.getAttribute)
			type = e.getAttribute("refresh");
		else
			type = null;
		var refresher = config.refreshers[type];
		var refreshed = false;
		if(refresher != undefined)
			refreshed = refresher(e,changeList);
		if(e.hasChildNodes() && !refreshed)
			refreshElements(e,changeList);
		}
}

function applyHtmlMacros(root,tiddler)
{
	var e = root.firstChild;
	while(e)
		{
		var nextChild = e.nextSibling;
		if(e.getAttribute)
			{
			var macro = e.getAttribute("macro");
			if(macro)
				{
				var params = "";
				var p = macro.indexOf(" ");
				if(p != -1)
					{
					params = macro.substr(p+1);
					macro = macro.substr(0,p);
					}
				invokeMacro(e,macro,params,null,tiddler);
				}
			}
		if(e.hasChildNodes())
			applyHtmlMacros(e,tiddler);
		e = nextChild;
		}
}

function refreshPageTemplate(title)
{
	var stash = createTiddlyElement(document.body,"div");
	stash.style.display = "none";
	var display = document.getElementById("tiddlerDisplay");
	var nodes,t;
	if(display)
		{
		nodes = display.childNodes;
		for(t=nodes.length-1; t>=0; t--)
			stash.appendChild(nodes[t]);
		}
	var wrapper = document.getElementById("contentWrapper");
	if(!title)
		title = "PageTemplate";
	var html = store.getRecursiveTiddlerText(title,null,10);
	wrapper.innerHTML = html;
	applyHtmlMacros(wrapper);
	refreshElements(wrapper);
	display = document.getElementById("tiddlerDisplay");
	removeChildren(display);
	if(!display)
		display = createTiddlyElement(wrapper,"div","tiddlerDisplay");
	nodes = stash.childNodes;
	for(t=nodes.length-1; t>=0; t--)
		display.appendChild(nodes[t]);
	stash.parentNode.removeChild(stash);
}

function refreshDisplay(hint)
{
	var e = document.getElementById("contentWrapper");
	if(typeof hint == "string")
		hint = [hint];
	refreshElements(e,hint);
}

function refreshPageTitle()
{
	document.title = wikifyPlain("SiteTitle") + " - " + wikifyPlain("SiteSubtitle");
}

function refreshStyles(title)
{
	setStylesheet(title == null ? "" : store.getRecursiveTiddlerText(title,"",10),title);
}

function refreshColorPalette(title)
{
	if(!startingUp)
		refreshAll();
}

function refreshAll()
{
	refreshPageTemplate();
	refreshDisplay();
	refreshStyles("StyleSheetLayout");
	refreshStyles("StyleSheetColors");
	refreshStyles("StyleSheet");
	refreshStyles("StyleSheetPrint");
}

// ---------------------------------------------------------------------------------
// Options cookie stuff
// ---------------------------------------------------------------------------------

function loadOptionsCookie()
{
	if(safeMode)
		return;
	var cookies = document.cookie.split(";");
	for(var c=0; c<cookies.length; c++)
		{
		var p = cookies[c].indexOf("=");
		if(p != -1)
			{
			var name = cookies[c].substr(0,p).trim();
			var value = cookies[c].substr(p+1).trim();
			switch(name.substr(0,3))
				{
				case "txt":
					config.options[name] = unescape(value);
					break;
				case "chk":
					config.options[name] = value == "true";
					break;
				}
			}
		}
}

function saveOptionCookie(name)
{
	if(safeMode)
		return;
	var c = name + "=";
	switch(name.substr(0,3))
		{
		case "txt":
			c += escape(config.options[name].toString());
			break;
		case "chk":
			c += config.options[name] ? "true" : "false";
			break;
		}
	c += "; expires=Fri, 1 Jan 2038 12:00:00 UTC; path=/";
	document.cookie = c;
}

// ---------------------------------------------------------------------------------
// Saving
// ---------------------------------------------------------------------------------

var saveUsingSafari = false;

var startSaveArea = '<div id="' + 'storeArea">'; // Split up into two so that indexOf() of this source doesn't find it
var endSaveArea = '</d' + 'iv>';

// If there are unsaved changes, force the user to confirm before exitting
function confirmExit()
{
	hadConfirmExit = true;
	if((store && store.isDirty && store.isDirty()) || (story && story.areAnyDirty && story.areAnyDirty()))
		return config.messages.confirmExit;
}

// Give the user a chance to save changes before exitting
function checkUnsavedChanges()
{
	if(store && store.isDirty && store.isDirty() && window.hadConfirmExit === false)
		{
		if(confirm(config.messages.unsavedChangesWarning))
			saveChanges();
		}
}

function updateMarkupBlock(s,blockName,tiddlerName)
{
	return s.replaceChunk(
			"<!--%0-START-->".format([blockName]),
			"<!--%0-END-->".format([blockName]),
			"\n" + store.getRecursiveTiddlerText(tiddlerName,"") + "\n");
}

// Save this tiddlywiki with the pending changes
function saveChanges(onlyIfDirty)
{
	if(onlyIfDirty && !store.isDirty())
		return;
	clearMessage();
	// Get the URL of the document
	var originalPath = document.location.toString();
	// Check we were loaded from a file URL
	if(originalPath.substr(0,5) != "file:")
		{
		alert(config.messages.notFileUrlError);
		if(store.tiddlerExists(config.messages.saveInstructions))
			story.displayTiddler(null,config.messages.saveInstructions);
		return;
		}
	var localPath = getLocalPath(originalPath);
	// Load the original file
	var original = loadFile(localPath);
	if(original == null)
		{
		alert(config.messages.cantSaveError);
		if(store.tiddlerExists(config.messages.saveInstructions))
			story.displayTiddler(null,config.messages.saveInstructions);
		return;
		}
	// Locate the storeArea div's
	var posOpeningDiv = original.indexOf(startSaveArea);
	var limitClosingDiv = original.indexOf("<!--STORE-AREA-END--"+">");
	var posClosingDiv = original.lastIndexOf(endSaveArea,limitClosingDiv == -1 ? original.length : limitClosingDiv);
	if((posOpeningDiv == -1) || (posClosingDiv == -1))
		{
		alert(config.messages.invalidFileError.format([localPath]));
		return;
		}
	// Save the backup
	if(config.options.chkSaveBackups)
		{
		var backupPath = getBackupPath(localPath);
		var backup = saveFile(backupPath,original);
		if(backup)
			displayMessage(config.messages.backupSaved,"file://" + backupPath);
		else
			alert(config.messages.backupFailed);
		}
	// Save Rss
	if(config.options.chkGenerateAnRssFeed)
		{
		var rssPath = localPath.substr(0,localPath.lastIndexOf(".")) + ".xml";
		var rssSave = saveFile(rssPath,convertUnicodeToUTF8(generateRss()));
		if(rssSave)
			displayMessage(config.messages.rssSaved,"file://" + rssPath);
		else
			alert(config.messages.rssFailed);
		}
	// Save empty template
	if(config.options.chkSaveEmptyTemplate)
		{
		var emptyPath,p;
		if((p = localPath.lastIndexOf("/")) != -1)
			emptyPath = localPath.substr(0,p) + "/empty.html";
		else if((p = localPath.lastIndexOf("\\")) != -1)
			emptyPath = localPath.substr(0,p) + "\\empty.html";
		else
			emptyPath = localPath + ".empty.html";
		var empty = original.substr(0,posOpeningDiv + startSaveArea.length) + original.substr(posClosingDiv);
		var emptySave = saveFile(emptyPath,empty);
		if(emptySave)
			displayMessage(config.messages.emptySaved,"file://" + emptyPath);
		else
			alert(config.messages.emptyFailed);
		}
	var save;
	try 
		{
		// Save new file
		var revised = original.substr(0,posOpeningDiv + startSaveArea.length) + "\n" +
					convertUnicodeToUTF8(store.allTiddlersAsHtml()) + "\n" +
					original.substr(posClosingDiv);
		var newSiteTitle = convertUnicodeToUTF8((wikifyPlain("SiteTitle") + " - " + wikifyPlain("SiteSubtitle")).htmlEncode());
		revised = revised.replaceChunk("<title"+">","</title"+">"," " + newSiteTitle + " ");
		revised = updateMarkupBlock(revised,"PRE-HEAD","MarkupPreHead");
		revised = updateMarkupBlock(revised,"POST-HEAD","MarkupPostHead");
		revised = updateMarkupBlock(revised,"PRE-BODY","MarkupPreBody");
		revised = updateMarkupBlock(revised,"POST-BODY","MarkupPostBody");
		save = saveFile(localPath,revised);
		}
	catch (e) 
		{
		showException(e);
		}
	if(save)
		{
		displayMessage(config.messages.mainSaved,"file://" + localPath);
		store.setDirty(false);
		}
	else
		alert(config.messages.mainFailed);
}

function getLocalPath(originalPath)
{
	// Remove any location or query part of the URL
	var argPos = originalPath.indexOf("?");
	if(argPos != -1)
		originalPath = originalPath.substr(0,argPos);
	var hashPos = originalPath.indexOf("#");
	if(hashPos != -1)
		originalPath = originalPath.substr(0,hashPos);
	// Convert file://localhost/ to file:///
	if(originalPath.indexOf("file://localhost/") == 0)
		originalPath = "file://" + originalPath.substr(16);
	// Convert to a native file format assuming
	// "file:///x:/path/path/path..." - pc local file --> "x:\path\path\path..."
	// "file://///server/share/path/path/path..." - FireFox pc network file --> "\\server\share\path\path\path..."
	// "file:///path/path/path..." - mac/unix local file --> "/path/path/path..."
	// "file://server/share/path/path/path..." - pc network file --> "\\server\share\path\path\path..."
	var localPath;
	if(originalPath.charAt(9) == ":") // pc local file
		localPath = unescape(originalPath.substr(8)).replace(new RegExp("/","g"),"\\");
	else if(originalPath.indexOf("file://///") == 0) // FireFox pc network file
		localPath = "\\\\" + unescape(originalPath.substr(10)).replace(new RegExp("/","g"),"\\");
	else if(originalPath.indexOf("file:///") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(7));
	else if(originalPath.indexOf("file:/") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(5));
	else // pc network file
		localPath = "\\\\" + unescape(originalPath.substr(7)).replace(new RegExp("/","g"),"\\");
	return localPath;
}

function getBackupPath(localPath)
{
	var backSlash = true;
	var dirPathPos = localPath.lastIndexOf("\\");
	if(dirPathPos == -1)
		{
		dirPathPos = localPath.lastIndexOf("/");
		backSlash = false;
		}
	var backupFolder = config.options.txtBackupFolder;
	if(!backupFolder || backupFolder == "")
		backupFolder = ".";
	var backupPath = localPath.substr(0,dirPathPos) + (backSlash ? "\\" : "/") + backupFolder + localPath.substr(dirPathPos);
	backupPath = backupPath.substr(0,backupPath.lastIndexOf(".")) + "." + (new Date()).convertToYYYYMMDDHHMMSSMMM() + ".html";
	return backupPath;
}

function generateRss()
{
	var s = [];
	var d = new Date();
	var u = store.getTiddlerText("SiteUrl");
	// Assemble the header
	s.push("<" + "?xml version=\"1.0\"?" + ">");
	s.push("<rss version=\"2.0\">");
	s.push("<channel>");
	s.push("<title" + ">" + wikifyPlain("SiteTitle").htmlEncode() + "</title" + ">");
	if(u)
		s.push("<link>" + u.htmlEncode() + "</link>");
	s.push("<description>" + wikifyPlain("SiteSubtitle").htmlEncode() + "</description>");
	s.push("<language>en-us</language>");
	s.push("<copyright>Copyright " + d.getFullYear() + " " + config.options.txtUserName.htmlEncode() + "</copyright>");
	s.push("<pubDate>" + d.toGMTString() + "</pubDate>");
	s.push("<lastBuildDate>" + d.toGMTString() + "</lastBuildDate>");
	s.push("<docs>http://blogs.law.harvard.edu/tech/rss</docs>");
	s.push("<generator>TiddlyWiki " + version.major + "." + version.minor + "." + version.revision + "</generator>");
	// The body
	var tiddlers = store.getTiddlers("modified","excludeLists");
	var n = config.numRssItems > tiddlers.length ? 0 : tiddlers.length-config.numRssItems;
	for (var t=tiddlers.length-1; t>=n; t--)
		s.push(tiddlers[t].saveToRss(u));
	// And footer
	s.push("</channel>");
	s.push("</rss>");
	// Save it all
	return s.join("\n");
}


// UTF-8 encoding rules:
// 0x0000 - 0x007F:	0xxxxxxx
// 0x0080 - 0x07FF:	110xxxxx 10xxxxxx
// 0x0800 - 0xFFFF:	1110xxxx 10xxxxxx 10xxxxxx

function convertUTF8ToUnicode(u)
{
	if(window.netscape == undefined)
		return manualConvertUTF8ToUnicode(u);
	else
		return mozConvertUTF8ToUnicode(u);
}

function manualConvertUTF8ToUnicode(utf)
{
	var uni = utf;
	var src = 0;
	var dst = 0;
	var b1, b2, b3;
	var c;
	while(src < utf.length)
		{
		b1 = utf.charCodeAt(src++);
		if(b1 < 0x80)
			dst++;
		else if(b1 < 0xE0)
			{
			b2 = utf.charCodeAt(src++);
			c = String.fromCharCode(((b1 & 0x1F) << 6) | (b2 & 0x3F));
			uni = uni.substring(0,dst++).concat(c,utf.substr(src));
			}
		else
			{
			b2 = utf.charCodeAt(src++);
			b3 = utf.charCodeAt(src++);
			c = String.fromCharCode(((b1 & 0xF) << 12) | ((b2 & 0x3F) << 6) | (b3 & 0x3F));
			uni = uni.substring(0,dst++).concat(c,utf.substr(src));
			}
	}
	return(uni);
}

function mozConvertUTF8ToUnicode(u)
{
	try
		{
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
		converter.charset = "UTF-8";
		}
	catch(e)
		{
		return manualConvertUTF8ToUnicode(u);
		} // fallback
	var s = converter.ConvertToUnicode(u);
	var fin = converter.Finish();
	return (fin.length > 0) ? s+fin : s;
}

function convertUnicodeToUTF8(s)
{
	if(window.netscape == undefined)
		return manualConvertUnicodeToUTF8(s);
	else
		return mozConvertUnicodeToUTF8(s);
}

function manualConvertUnicodeToUTF8(s)
{
	var re = /[^\u0000-\u007F]/g ;
	return s.replace(re, function($0) {return("&#" + $0.charCodeAt(0).toString() + ";");})
}

function mozConvertUnicodeToUTF8(s)
{
	try
		{
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
		converter.charset = "UTF-8";
		}
	catch(e)
		{
		return manualConvertUnicodeToUTF8(s);
		} // fallback
	var u = converter.ConvertFromUnicode(s);
	var fin = converter.Finish();
	if(fin.length > 0)
		return u + fin;
	else
		return u;
}

function saveFile(fileUrl, content)
{
	var r = null;
	if((r == null) || (r == false))
		r = mozillaSaveFile(fileUrl, content);
	if((r == null) || (r == false))
		r = ieSaveFile(fileUrl, content);
	if((r == null) || (r == false))
		r = javaSaveFile(fileUrl, content);
	return(r);
}

function loadFile(fileUrl)
{
	var r = null;
	if((r == null) || (r == false))
		r = mozillaLoadFile(fileUrl);
	if((r == null) || (r == false))
		r = ieLoadFile(fileUrl);
	if((r == null) || (r == false))
		r = javaLoadFile(fileUrl);
	return(r);
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function ieSaveFile(filePath, content)
{
	try
		{
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		}
	catch(e)
		{
		//alert("Exception while attempting to save\n\n" + e.toString());
		return(null);
		}
	var file = fso.OpenTextFile(filePath,2,-1,0);
	file.Write(content);
	file.Close();
	return(true);
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function ieLoadFile(filePath)
{
	try
		{
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		var file = fso.OpenTextFile(filePath,1);
		var content = file.ReadAll();
		file.Close();
		}
	catch(e)
		{
		//alert("Exception while attempting to load\n\n" + e.toString());
		return(null);
		}
	return(content);
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function mozillaSaveFile(filePath, content)
{
	if(window.Components)
		try
			{
			netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
			var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
			file.initWithPath(filePath);
			if (!file.exists())
				file.create(0, 0664);
			var out = Components.classes["@mozilla.org/network/file-output-stream;1"].createInstance(Components.interfaces.nsIFileOutputStream);
			out.init(file, 0x20 | 0x02, 00004,null);
			out.write(content, content.length);
			out.flush();
			out.close();
			return(true);
			}
		catch(e)
			{
			//alert("Exception while attempting to save\n\n" + e);
			return(false);
			}
	return(null);
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function mozillaLoadFile(filePath)
{
	if(window.Components)
		try
			{
			netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
			var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
			file.initWithPath(filePath);
			if (!file.exists())
				return(null);
			var inputStream = Components.classes["@mozilla.org/network/file-input-stream;1"].createInstance(Components.interfaces.nsIFileInputStream);
			inputStream.init(file, 0x01, 00004, null);
			var sInputStream = Components.classes["@mozilla.org/scriptableinputstream;1"].createInstance(Components.interfaces.nsIScriptableInputStream);
			sInputStream.init(inputStream);
			return(sInputStream.read(sInputStream.available()));
			}
		catch(e)
			{
			//alert("Exception while attempting to load\n\n" + e);
			return(false);
			}
	return(null);
}

function javaUrlToFilename(url)
{
	var f = "//localhost";
	if(url.indexOf(f) == 0)
		return url.substring(f.length);
	var i = url.indexOf(":");
	if(i > 0)
		return url.substring(i-1);
	return url;
}

function javaSaveFile(filePath, content)
{
	try
		{
		if(document.applets["TiddlySaver"])
			return document.applets["TiddlySaver"].saveFile(javaUrlToFilename(filePath),"UTF-8",content);
		}
	catch(e)
		{
		}
	try
		{
		var s = new java.io.PrintStream(new java.io.FileOutputStream(javaUrlToFilename(filePath)));
		s.print(content);
		s.close();
		}
	catch(e)
		{
		return null;
		}
	return true;
}

function javaLoadFile(filePath)
{
	try
		{
	if(document.applets["TiddlySaver"])
		return String(document.applets["TiddlySaver"].loadFile(javaUrlToFilename(filePath),"UTF-8"));
		}
	catch(e)
		{
		}
	var content = [];
	try
		{
		var r = new java.io.BufferedReader(new java.io.FileReader(javaUrlToFilename(filePath)));
		var line;
		while ((line = r.readLine()) != null)
			content.push(new String(line));
		r.close();
		}
	catch(e)
		{
		return null;
		}
	return content.join("\n");
}


// ---------------------------------------------------------------------------------
// Remote HTTP requests
// ---------------------------------------------------------------------------------

// Load a file over http
//   url - the source url
//   callback - function to call when there's a response
//   params - parameter object that gets passed to the callback for storing it's state
// Return value is the underlying XMLHttpRequest object, or 'null' if there was an error
// Callback function is called like this:
//   callback(status,params,responseText,xhr)
//     status - true if OK, false if error
//     params - the parameter object provided to loadRemoteFile()
//     responseText - the text of the file
//     xhr - the underlying XMLHttpRequest object
function loadRemoteFile(url,callback,params)
{
	var x = doHttp("GET",url,null,null,null,null,callback,params,null);
}

// HTTP status codes
var httpStatus = {
	OK: 200,
	ContentCreated: 201,
	NoContent: 204,
	Unauthorized: 401,
	Forbidden: 403,
	NotFound: 404,
	MethodNotAllowed: 405
};

// Perform an http request
//   type - GET/POST/PUT/DELETE
//   url - the source url
//   data - optional data for POST and PUT
//   contentType - optionalContent type for the data (defaults to application/x-www-form-urlencoded)
//   username - optional username for basic authentication
//   password - optional password for basic authentication
//   callback - function to call when there's a response
//   params - parameter object that gets passed to the callback for storing it's state
//   headers - optional hashmap of additional headers
// Return value is the underlying XMLHttpRequest object, or a string if there was an error
// Callback function is called like this:
//   callback(status,params,responseText,xhr)
//     status - true if OK, false if error
//     params - the parameter object provided to loadRemoteFile()
//     responseText - the text of the file
//     url - requested URL
//     xhr - the underlying XMLHttpRequest object
function doHttp(type,url,data,contentType,username,password,callback,params,headers)
{
	// Get an xhr object
	var x;
	try
		{
		x = new XMLHttpRequest(); // Modern
		}
	catch(e)
		{
		try
			{
			x = new ActiveXObject("Msxml2.XMLHTTP"); // IE 6
			}
		catch (e)
			{
			return "Can't create XMLHttpRequest object";
			}
		}
	// Install callback
	x.onreadystatechange = function()
		{
		if (x.readyState == 4 && callback)
			{
			if([0, httpStatus.OK, httpStatus.ContentCreated, httpStatus.NoContent].contains(x.status))
				callback(true,params,x.responseText,url,x);
			else
				callback(false,params,null,url,x);
			x.onreadystatechange = function(){};
			x = null;
			}
		}
	// Send request
	if(window.netscape && window.netscape.security && document.location.protocol.indexOf("http") == -1)
		window.netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
	try
		{
		url = url + (url.indexOf("?") < 0 ? "?" : "&") + "nocache=" + Math.random();
		x.open(type,url,true,username,password);
		if (data)
			x.setRequestHeader("Content-Type", contentType ? contentType : "application/x-www-form-urlencoded");
		if (x.overrideMimeType)
			x.setRequestHeader("Connection", "close");
		if(headers)
			{
			for(n in headers)
				x.setRequestHeader(n,headers[n]);
			}
		x.setRequestHeader("X-Requested-With", "TiddlyWiki " + version.major + "." + version.minor + "." + version.revision + (version.beta ? " (beta " + version.beta + ")" : ""));
		x.send(data);
		}
	catch (e)
		{
		return exceptionText(e);
		}
	return x;
}
// ---------------------------------------------------------------------------------
// TiddlyWiki-specific utility functions
// ---------------------------------------------------------------------------------

function createTiddlyButton(theParent,theText,theTooltip,theAction,theClass,theId,theAccessKey)
{
	var theButton = document.createElement("a");
	if(theAction)
		{
		theButton.onclick = theAction;
		theButton.setAttribute("href","javascript:;");
		}
	if(theTooltip)
		theButton.setAttribute("title",theTooltip);
	if(theText)
		theButton.appendChild(document.createTextNode(theText));
	if(theClass)
		theButton.className = theClass;
	else
		theButton.className = "button";
	if(theId)
		theButton.id = theId;
	if(theParent)
		theParent.appendChild(theButton);
	if(theAccessKey)
		theButton.setAttribute("accessKey",theAccessKey);
	return(theButton);
}

function createTiddlyLink(place,title,includeText,theClass,isStatic)
{
	var text = includeText ? title : null;
	var i = getTiddlyLinkInfo(title,theClass)
	var btn;
	if(isStatic)
		btn = createExternalLink(place,"#" + title);
	else
		btn = createTiddlyButton(place,text,i.subTitle,onClickTiddlerLink,i.classes);
	btn.setAttribute("refresh","link");
	btn.setAttribute("tiddlyLink",title);
	return(btn);
}

function refreshTiddlyLink(e,title)
{
	var i = getTiddlyLinkInfo(title,e.className);
	e.className = i.classes;
	e.title = i.subTitle;
}

function getTiddlyLinkInfo(title,currClasses)
{
	var classes = currClasses ? currClasses.split(" ") : [];
	classes.pushUnique("tiddlyLink");
	var tiddler = store.fetchTiddler(title);
	var subTitle;
	if(tiddler)
		{
		subTitle = tiddler.getSubtitle();
		classes.pushUnique("tiddlyLinkExisting");
		classes.remove("tiddlyLinkNonExisting");
		classes.remove("shadow");
		}
	else
		{
		classes.remove("tiddlyLinkExisting");
		classes.pushUnique("tiddlyLinkNonExisting");
		if(store.isShadowTiddler(title))
			{
			subTitle = config.messages.shadowedTiddlerToolTip.format([title]);
			classes.pushUnique("shadow");
			}
		else
			{
			subTitle = config.messages.undefinedTiddlerToolTip.format([title]);
			classes.remove("shadow");
			}
		}
	return {classes: classes.join(" "), subTitle: subTitle};
}

function createExternalLink(place,url)
{
	var theLink = document.createElement("a");
	theLink.className = "externalLink";
	theLink.href = url;
	theLink.title = config.messages.externalLinkTooltip.format([url]);
	if(config.options.chkOpenInNewWindow)
		theLink.target = "_blank";
	place.appendChild(theLink);
	return(theLink);
}

// Event handler for clicking on a tiddly link
function onClickTiddlerLink(e)
{
	if (!e) var e = window.event;
	var theTarget = resolveTarget(e);
	var theLink = theTarget;
	var title = null;
	do {
		title = theLink.getAttribute("tiddlyLink");
		theLink = theLink.parentNode;
	} while(title == null && theLink != null);
	if(title)
		{
		var toggling = e.metaKey || e.ctrlKey;
		if(config.options.chkToggleLinks)
			toggling = !toggling;
		var opening;
		if(toggling && document.getElementById("tiddler" + title))
			story.closeTiddler(title,true,e.shiftKey || e.altKey);
		else
			story.displayTiddler(theTarget,title,null,true,e.shiftKey || e.altKey);
		}
	clearMessage();
	return(false);
}

// Create a button for a tag with a popup listing all the tiddlers that it tags
function createTagButton(place,tag,excludeTiddler)
{
	var theTag = createTiddlyButton(place,tag,config.views.wikified.tag.tooltip.format([tag]),onClickTag);
	theTag.setAttribute("tag",tag);
	if(excludeTiddler)
		theTag.setAttribute("tiddler",excludeTiddler);
	return(theTag);
}

// Event handler for clicking on a tiddler tag
function onClickTag(e)
{
	if (!e) var e = window.event;
	var theTarget = resolveTarget(e);
	var popup = Popup.create(this);
	var tag = this.getAttribute("tag");
	var title = this.getAttribute("tiddler");
	if(popup && tag)
		{
		var tagged = store.getTaggedTiddlers(tag);
		var titles = [];
		var li,r;
		for(r=0;r<tagged.length;r++)
			if(tagged[r].title != title)
				titles.push(tagged[r].title);
		var lingo = config.views.wikified.tag;
		if(titles.length > 0)
			{
			var openAll = createTiddlyButton(createTiddlyElement(popup,"li"),lingo.openAllText.format([tag]),lingo.openAllTooltip,onClickTagOpenAll);
			openAll.setAttribute("tag",tag);
			createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
			for(r=0; r<titles.length; r++)
				{
				createTiddlyLink(createTiddlyElement(popup,"li"),titles[r],true);
				}
			}
		else
			createTiddlyText(createTiddlyElement(popup,"li",null,"disabled"),lingo.popupNone.format([tag]));
		createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
		var h = createTiddlyLink(createTiddlyElement(popup,"li"),tag,false);
		createTiddlyText(h,lingo.openTag.format([tag]));
		}
	Popup.show(popup,false);
	e.cancelBubble = true;
	if (e.stopPropagation) e.stopPropagation();
	return(false);
}

// Event handler for 'open all' on a tiddler popup
function onClickTagOpenAll(e)
{
	if (!e) var e = window.event;
	var tag = this.getAttribute("tag");
	var tagged = store.getTaggedTiddlers(tag);
	var titles = [];
	for(var t=0; t<tagged.length; t++)
		titles.push(tagged[t].title);
	story.displayTiddlers(this,titles);
	return(false);
}

function onClickError(e)
{
	if (!e) var e = window.event;
	var popup = Popup.create(this);
	var lines = this.getAttribute("errorText").split("\n");
	for(var t=0; t<lines.length; t++)
		createTiddlyElement(popup,"li",null,null,lines[t]);
	Popup.show(popup,false);
	e.cancelBubble = true;
	if (e.stopPropagation) e.stopPropagation();
	return false;
}

function createTiddlyDropDown(place,onchange,options)
{
	var sel = createTiddlyElement(place,"select");
	sel.onchange = onchange;
	for(var t=0; t<options.length; t++)
		{
		var e = createTiddlyElement(sel,"option",null,null,options[t].caption);
		e.value = options[t].name;
		}
}

function createTiddlyError(place,title,text)
{
	var btn = createTiddlyButton(place,title,null,onClickError,"errorButton");
	if (text) btn.setAttribute("errorText",text);
}

function merge(dst,src,preserveExisting)
{
	for (p in src)
		if (!preserveExisting || dst[p] === undefined)
			dst[p] = src[p];
	return dst;
}

// Returns a string containing the description of an exception, optionally prepended by a message
function exceptionText(e, message)
{
	var s = e.description ? e.description : e.toString();
	return message ? "%0:\n%1".format([message, s]) : s;
}

// Displays an alert of an exception description with optional message
function showException(e, message)
{
	alert(exceptionText(e, message));
}

function alertAndThrow(m)
{
	alert(m);
	throw(m);
}

// ---------------------------------------------------------------------------------
// Animation engine
// ---------------------------------------------------------------------------------

function Animator()
{
	this.running = 0; // Incremented at start of each animation, decremented afterwards. If zero, the interval timer is disabled
	this.timerID = 0; // ID of the timer used for animating
	this.animations = []; // List of animations in progress
	return this;
}

// Start animation engine
Animator.prototype.startAnimating = function() // Variable number of arguments
{
	for(var t=0; t<arguments.length; t++)
		this.animations.push(arguments[t]);
	if(this.running == 0)
		{
		var me = this;
		this.timerID = window.setInterval(function() {me.doAnimate(me);},5);
		}
	this.running += arguments.length;
}

// Perform an animation engine tick, calling each of the known animation modules
Animator.prototype.doAnimate = function(me)
{
	var a = 0;
	while(a < me.animations.length)
		{
		var animation = me.animations[a];
		if(animation.tick())
			a++;
		else
			{
			me.animations.splice(a,1);
			if(--me.running == 0)
				window.clearInterval(me.timerID);
			}
		}
}

// Map a 0..1 value to 0..1, but slow down at the start and end
Animator.slowInSlowOut = function(progress)
{
	return(1-((Math.cos(progress * Math.PI)+1)/2));
}

// ---------------------------------------------------------------------------------
// Cascade animation
// ---------------------------------------------------------------------------------

function Cascade(text,startElement,targetElement,slowly)
{
	var winWidth = findWindowWidth();
	var winHeight = findWindowHeight();
	this.elements = [];
	this.startElement = startElement;
	this.startLeft = findPosX(this.startElement);
	this.startTop = findPosY(this.startElement);
	this.startWidth = Math.min(this.startElement.offsetWidth,winWidth);
	this.startHeight = Math.min(this.startElement.offsetHeight,winHeight);
	this.targetElement = targetElement;
	targetElement.style.position = "relative";
	targetElement.style.zIndex = 2;
	this.targetLeft = findPosX(this.targetElement);
	this.targetTop = findPosY(this.targetElement);
	this.targetWidth = Math.min(this.targetElement.offsetWidth,winWidth);
	this.targetHeight = Math.min(this.targetElement.offsetHeight,winHeight);
	this.progress = -1;
	this.steps = slowly ? config.cascadeSlow : config.cascadeFast;
	this.text = text;
	this.tick();
	return this;
}

Cascade.prototype.tick = function()
{
	this.progress++;
	if(this.progress >= this.steps)
		{
		while(this.elements.length > 0)
			this.removeTail();
		this.targetElement.style.position = "static";
		this.targetElement.style.zIndex = "";
		return false;
		}
	else
		{
		if(this.elements.length > 0 && this.progress > config.cascadeDepth)
			this.removeTail();
		if(this.progress < (this.steps - config.cascadeDepth))
			{
			var f = Animator.slowInSlowOut(this.progress/(this.steps - config.cascadeDepth - 1));
			var e = createTiddlyElement(document.body,"div",null,"cascade",this.text);
			e.style.zIndex = 1;
			e.style.left = this.startLeft + (this.targetLeft-this.startLeft) * f + "px";
			e.style.top = this.startTop + (this.targetTop-this.startTop) * f + "px";
			e.style.width = this.startWidth + (this.targetWidth-this.startWidth) * f + "px";
			e.style.height = this.startHeight + (this.targetHeight-this.startHeight) * f + "px";
			e.style.display = "block";
			this.elements.push(e);
			}
		return true;
		}
}

Cascade.prototype.removeTail = function()
{
	var e = this.elements[0];
	e.parentNode.removeChild(e);
	this.elements.shift();
}

// ---------------------------------------------------------------------------------
// Scroller animation
// ---------------------------------------------------------------------------------

function Scroller(targetElement,slowly)
{
	this.targetElement = targetElement;
	this.startScroll = findScrollY();
	this.targetScroll = ensureVisible(targetElement);
	this.progress = 0;
	this.step = slowly ? config.animSlow : config.animFast;
	return this;
}

Scroller.prototype.tick = function()
{
	this.progress += this.step;
	if(this.progress > 1)
		{
		window.scrollTo(0,this.targetScroll);
		return false;
		}
	else
		{
		var f = Animator.slowInSlowOut(this.progress);
		window.scrollTo(0,this.startScroll + (this.targetScroll-this.startScroll) * f);
		return true;
		}
}

// ---------------------------------------------------------------------------------
// Slider animation
// ---------------------------------------------------------------------------------

// deleteMode - "none", "all" [delete target element and it's children], [only] "children" [but not the target element]
function Slider(element,opening,slowly,deleteMode)
{
	this.element = element;
	element.style.display = "block";
	this.deleteMode = deleteMode;
	this.element.style.height = "auto";
	this.realHeight = element.offsetHeight;
	this.opening = opening;
	this.step = slowly ? config.animSlow : config.animFast;
	if(opening)
		{
		this.progress = 0;
		element.style.height = "0px";
		element.style.display = "block";
		}
	else
		{
		this.progress = 1;
		this.step = -this.step;
		}
	element.style.overflow = "hidden";
	return this;
}

Slider.prototype.stop = function()
{
	if(this.opening)
		{
		this.element.style.height = "auto";
		this.element.style.opacity = 1;
		this.element.style.filter = "alpha(opacity:100)";
		}
	else
		{
		switch(this.deleteMode)
			{
			case "none":
				this.element.style.display = "none";
				break;
			case "all":
				this.element.parentNode.removeChild(this.element);
				break;
			case "children":
				removeChildren(this.element);
				break;
			}
		}
}

Slider.prototype.tick = function()
{
	this.progress += this.step;
	if(this.progress < 0 || this.progress > 1)
		{
		this.stop();
		return false;
		}
	else
		{
		var f = Animator.slowInSlowOut(this.progress);
		var h = this.realHeight * f;
		this.element.style.height = h + "px";
		this.element.style.opacity = f;
		this.element.style.filter = "alpha(opacity:" + f * 100 +")";
		return true;
		}
}

// ---------------------------------------------------------------------------------
// Popup menu
// ---------------------------------------------------------------------------------

var Popup = {
	stack: [] // Array of objects with members root: and popup:
	};

Popup.create = function(root)
{
	Popup.remove();
	var popup = createTiddlyElement(document.body,"ol","popup","popup");
	Popup.stack.push({root: root, popup: popup});
	return popup;
}

Popup.onDocumentClick = function(e)
{
	if (!e) var e = window.event;
	var target = resolveTarget(e);
	if(e.eventPhase == undefined)
		Popup.remove();
	else if(e.eventPhase == Event.BUBBLING_PHASE || e.eventPhase == Event.AT_TARGET)
		Popup.remove();
	return true;
}

Popup.show = function(unused,slowly)
{
	var curr = Popup.stack[Popup.stack.length-1];
	var rootLeft = findPosX(curr.root);
	var rootTop = findPosY(curr.root);
	var rootHeight = curr.root.offsetHeight;
	var popupLeft = rootLeft;
	var popupTop = rootTop + rootHeight;
	var popupWidth = curr.popup.offsetWidth;
	var winWidth = findWindowWidth();
	if(popupLeft + popupWidth > winWidth)
		popupLeft = winWidth - popupWidth;
	curr.popup.style.left = popupLeft + "px";
	curr.popup.style.top = popupTop + "px";
	curr.popup.style.display = "block";
	addClass(curr.root,"highlight");
	if(config.options.chkAnimate && anim && typeof Scroller == "function")
		anim.startAnimating(new Scroller(curr.popup,slowly));
	else
		window.scrollTo(0,ensureVisible(curr.popup));
}

Popup.remove = function()
{
	if(Popup.stack.length > 0)
		{
		Popup.removeFrom(0);
		}
}

Popup.removeFrom = function(from)
{
	for(var t=Popup.stack.length-1; t>=from; t--)
		{
		var p = Popup.stack[t];
		removeClass(p.root,"highlight");
		p.popup.parentNode.removeChild(p.popup);
		}
	Popup.stack = Popup.stack.slice(0,from);
}

// ---------------------------------------------------------------------------------
// ListView gadget
// ---------------------------------------------------------------------------------

var ListView = {};

// Create a listview
//   place - where in the DOM tree to insert the listview
//   listObject - array of objects to be included in the listview
//   listTemplate - template for the listview
//   callback - callback for a command being selected
//   className - optional classname for the <table> element
ListView.create = function(place,listObject,listTemplate,callback,className)
{
	var table = createTiddlyElement(place,"table",null,className ? className : "listView");
	var thead = createTiddlyElement(table,"thead");
	var r = createTiddlyElement(thead,"tr");
	for(var t=0; t<listTemplate.columns.length; t++)
		{
		var columnTemplate = listTemplate.columns[t];
		var c = createTiddlyElement(r,"th");
		var colType = ListView.columnTypes[columnTemplate.type];
		if(colType && colType.createHeader)
			colType.createHeader(c,columnTemplate,t);
		}
	var tbody = createTiddlyElement(table,"tbody");
	for(var rc=0; rc<listObject.length; rc++)
		{
		rowObject = listObject[rc];
		r = createTiddlyElement(tbody,"tr");
		for(var c=0; c<listTemplate.rowClasses.length; c++)
			{
			if(rowObject[listTemplate.rowClasses[c].field])
				addClass(r,listTemplate.rowClasses[c].className);
			}
		rowObject.rowElement = rowObject;
		rowObject.colElements = {};
		for(var cc=0; cc<listTemplate.columns.length; cc++)
			{
			var c = createTiddlyElement(r,"td");
			var columnTemplate = listTemplate.columns[cc];
			var field = columnTemplate.field;
			var colType = ListView.columnTypes[columnTemplate.type];
			if(colType && colType.createItem)
				colType.createItem(c,rowObject,field,columnTemplate,cc,rc);
			rowObject.colElements[field] = c;
			}
		}
	if(callback && listTemplate.actions)
		createTiddlyDropDown(place,ListView.getCommandHandler(callback),listTemplate.actions);
	if(callback && listTemplate.buttons)
		{
		for(t=0; t<listTemplate.buttons.length; t++)
			{
			var a = listTemplate.buttons[t];
			if(a && a.name != "")
				createTiddlyButton(place,a.caption,null,ListView.getCommandHandler(callback,a.name,a.allowEmptySelection));
			}
		}
	return table;
}

ListView.getCommandHandler = function(callback,name,allowEmptySelection)
{
	return function(e)
		{
		var view = findRelated(this,"TABLE",null,"previousSibling");
		var tiddlers = [];
		ListView.forEachSelector(view,function(e,rowName) {
					if(e.checked)
						tiddlers.push(rowName);
					});
		if(tiddlers.length == 0 && !allowEmptySelection)
			alert(config.messages.nothingSelected);
		else
			{
			if(this.nodeName.toLowerCase() == "select")
				{
				callback(view,this.value,tiddlers);
				this.selectedIndex = 0;
				}
			else
				callback(view,name,tiddlers);
			}
		};
}

// Invoke a callback for each selector checkbox in the listview
//   view - <table> element of listView
//   callback(checkboxElement,rowName)
//     where
//       checkboxElement - DOM element of checkbox
//       rowName - name of this row as assigned by the column template
//   result: true if at least one selector was checked
ListView.forEachSelector = function(view,callback)
{
	var checkboxes = view.getElementsByTagName("input");
	var hadOne = false;
	for(var t=0; t<checkboxes.length; t++)
		{
		var cb = checkboxes[t];
		if(cb.getAttribute("type") == "checkbox")
			{
			var rn = cb.getAttribute("rowName");
			if(rn)
				{
				callback(cb,rn);
				hadOne = true;
				}
			}
		}
	return hadOne;
}

ListView.columnTypes = {};

ListView.columnTypes.String = {
	createHeader: function(place,columnTemplate,col)
		{
			createTiddlyText(place,columnTemplate.title);
		},
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				createTiddlyText(place,v);
		}
};

ListView.columnTypes.Link = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			var c = columnTemplate.text;
			if(v != undefined)
				createTiddlyText(createExternalLink(place,v),c ? c : v);
		}
};

ListView.columnTypes.Date = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				createTiddlyText(place,v.formatString(columnTemplate.dateFormat));
		}
};

ListView.columnTypes.StringList = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				{
				for(var t=0; t<v.length; t++)
					{
					createTiddlyText(place,v[t]);
					createTiddlyElement(place,"br");
					}
				}
		}
};

ListView.columnTypes.Selector = {
	createHeader: function(place,columnTemplate,col)
		{
			createTiddlyCheckbox(place,null,false,this.onHeaderChange);
		},
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var e = createTiddlyCheckbox(place,null,listObject[field],null);
			e.setAttribute("rowName",listObject[columnTemplate.rowName]);
		},
	onHeaderChange: function(e)
		{
			var state = this.checked;
			var view = findRelated(this,"TABLE");
			if(!view)
				return;
			ListView.forEachSelector(view,function(e,rowName) {
								e.checked = state;
							});
		}
};

ListView.columnTypes.Tags = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var tags = listObject[field];
			createTiddlyText(place,String.encodeTiddlyLinkList(tags));
		}
};

ListView.columnTypes.Boolean = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			if(listObject[field] == true)
				createTiddlyText(place,columnTemplate.trueText);
			if(listObject[field] == false)
				createTiddlyText(place,columnTemplate.falseText);
		}
};

ListView.columnTypes.TagCheckbox = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var e = createTiddlyCheckbox(place,null,listObject[field],this.onChange);
			e.setAttribute("tiddler",listObject.title);
			e.setAttribute("tag",columnTemplate.tag);
		},
	onChange : function(e)
		{
			var tag = this.getAttribute("tag");
			var tiddler = this.getAttribute("tiddler");
			store.setTiddlerTag(tiddler,this.checked,tag);
		}
};

ListView.columnTypes.TiddlerLink = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				{
				var link = createTiddlyLink(place,listObject[columnTemplate.tiddlerLink],false,null);
				createTiddlyText(link,listObject[field]);
				}
		}
};
// ---------------------------------------------------------------------------------
// Augmented methods for the JavaScript Number(), Array(), String() and Date() objects
// ---------------------------------------------------------------------------------

// Clamp a number to a range
Number.prototype.clamp = function(min,max)
{
	var c = this;
	if(c < min)
		c = min;
	if(c > max)
		c = max;
	return c;
}

// Add indexOf function if browser does not support it
if(!Array.indexOf) {
Array.prototype.indexOf = function(item,from)
{
	if(!from)
		from = 0;
	for(var i=from; i<this.length; i++)
		if(this[i] === item)
			return i;
	return -1;
}}

// Find an entry in a given field of the members of an array
Array.prototype.findByField = function(field,value)
{
	for(var t=0; t<this.length; t++)
		if(this[t][field] == value)
			return t;
	return null;
}

// Return whether an entry exists in an array
Array.prototype.contains = function(item)
{
	return this.indexOf(item) != -1;
};

// Adds, removes or toggles a particular value within an array
//  value - value to add
//  mode - +1 to add value, -1 to remove value, 0 to toggle it
Array.prototype.setItem = function(value,mode)
{
	var p = this.indexOf(value);
	if(mode == 0)
		mode = (p == -1) ? +1 : -1;
	if(mode == +1)
		{
		if(p == -1)
			this.push(value);
		}
	else if(mode == -1)
		{
		if(p != -1)
			this.splice(p,1);
		}
}

// Return whether one of a list of values exists in an array
Array.prototype.containsAny = function(items)
{
	for(var i=0; i<items.length; i++)
		if (this.indexOf(items[i]) != -1)
			return true;
	return false;
};

// Return whether all of a list of values exists in an array
Array.prototype.containsAll = function(items)
{
	for (var i = 0; i<items.length; i++)
		if (this.indexOf(items[i]) == -1)
			return false;
	return true;
};

// Push a new value into an array only if it is not already present in the array. If the optional unique parameter is false, it reverts to a normal push
Array.prototype.pushUnique = function(item,unique)
{
	if(unique != undefined && unique == false)
		this.push(item);
	else
		{
		if(this.indexOf(item) == -1)
			this.push(item);
		}
}

Array.prototype.remove = function(item)
{
	var p = this.indexOf(item);
	if(p != -1)
		this.splice(p,1);
}

// Get characters from the right end of a string
String.prototype.right = function(n)
{
	if(n < this.length)
		return this.slice(this.length-n);
	else
		return this;
}

// Trim whitespace from both ends of a string
String.prototype.trim = function()
{
	return this.replace(/^\s*|\s*$/g,"");
}

// Convert a string from a CSS style property name to a JavaScript style name ("background-color" -> "backgroundColor")
String.prototype.unDash = function()
{
	var s = this.split("-");
	if(s.length > 1)
		for(var t=1; t<s.length; t++)
			s[t] = s[t].substr(0,1).toUpperCase() + s[t].substr(1);
	return s.join("");
}

// Substitute substrings from an array into a format string that includes '%1'-type specifiers
String.prototype.format = function(substrings)
{
	var subRegExp = /(?:%(\d+))/mg;
	var currPos = 0;
	var r = [];
	do {
		var match = subRegExp.exec(this);
		if(match && match[1])
			{
			if(match.index > currPos)
				r.push(this.substring(currPos,match.index));
			r.push(substrings[parseInt(match[1])]);
			currPos = subRegExp.lastIndex;
			}
	} while(match);
	if(currPos < this.length)
		r.push(this.substring(currPos,this.length));
	return r.join("");
}

// Escape any special RegExp characters with that character preceded by a backslash
String.prototype.escapeRegExp = function()
{
	var s = "\\^$*+?()=!|,{}[].";
	var c = this;
	for(var t=0; t<s.length; t++)
		c = c.replace(new RegExp("\\" + s.substr(t,1),"g"),"\\" + s.substr(t,1));
	return c;
}

// Convert "\" to "\s", newlines to "\n" (and remove carriage returns)
String.prototype.escapeLineBreaks = function()
{
	return this.replace(/\\/mg,"\\s").replace(/\n/mg,"\\n").replace(/\r/mg,"");
}

// Convert "\n" to newlines, "\b" to " ", "\s" to "\" (and remove carriage returns)
String.prototype.unescapeLineBreaks = function()
{
	return this.replace(/\\n/mg,"\n").replace(/\\b/mg," ").replace(/\\s/mg,"\\").replace(/\r/mg,"");
}

// Convert & to "&amp;", < to "&lt;", > to "&gt;" and " to "&quot;"
String.prototype.htmlEncode = function()
{
	return(this.replace(/&/mg,"&amp;").replace(/</mg,"&lt;").replace(/>/mg,"&gt;").replace(/\"/mg,"&quot;"));
}

// Convert "&amp;" to &, "&lt;" to <, "&gt;" to > and "&quot;" to "
String.prototype.htmlDecode = function()
{
	return(this.replace(/&amp;/mg,"&").replace(/&lt;/mg,"<").replace(/&gt;/mg,">").replace(/&quot;/mg,"\""));
}

// Parse a space-separated string of name:value parameters where:
//   - the name or the value can be optional (in which case separate defaults are used instead)
//     - in case of ambiguity, a lone word is taken to be a value
//     - if 'cascadeDefaults' is set to true, then the defaults are modified by updated by each specified name or value
//     - name prefixes are not allowed if the 'noNames' parameter is true
//   - if both the name and value are present they must be separated by a colon
//   - the name and the value may both be quoted with single- or double-quotes, double-square brackets
//   - names or values quoted with {{double-curly braces}} are evaluated as a JavaScript expression
//     - as long as the 'allowEval' parameter is true
// The result is an array of objects:
//   result[0] = object with a member for each parameter name, value of that member being an array of values
//   result[1..n] = one object for each parameter, with 'name' and 'value' members
String.prototype.parseParams = function(defaultName,defaultValue,allowEval,noNames,cascadeDefaults)
{
	var parseToken = function(match,p)
		{
		var n;
		if(match[p]) // Double quoted
			n = match[p];
		else if(match[p+1]) // Single quoted
			n = match[p+1];
		else if(match[p+2]) // Double-square-bracket quoted
			n = match[p+2];
		else if(match[p+3]) // Double-brace quoted
			try
				{
				n = match[p+3];
				if(allowEval)
					n = window.eval(n);
				}
			catch(e)
				{
				throw "Unable to evaluate {{" + match[p+3] + "}}: " + exceptionText(e);
				}
		else if(match[p+4]) // Unquoted
			n = match[p+4];
		else if(match[p+5]) // empty quote
			n = "";
		return n;
		};
	var r = [{}];
	var dblQuote = "(?:\"((?:(?:\\\\\")|[^\"])+)\")";
	var sngQuote = "(?:'((?:(?:\\\\\')|[^'])+)')";
	var dblSquare = "(?:\\[\\[((?:\\s|\\S)*?)\\]\\])";
	var dblBrace = "(?:\\{\\{((?:\\s|\\S)*?)\\}\\})";
	var unQuoted = noNames ? "([^\"'\\s]\\S*)" : "([^\"':\\s][^\\s:]*)";
	var emptyQuote = "((?:\"\")|(?:''))";
	var skipSpace = "(?:\\s*)";
	var token = "(?:" + dblQuote + "|" + sngQuote + "|" + dblSquare + "|" + dblBrace + "|" + unQuoted + "|" + emptyQuote + ")";
	var re = noNames
		? new RegExp(token,"mg")
		: new RegExp(skipSpace + token + skipSpace + "(?:(\\:)" + skipSpace + token + ")?","mg");
	var params = [];
	do {
		var match = re.exec(this);
		if(match)
			{
			var n = parseToken(match,1);
			if(noNames)
				r.push({name: "", value: n});
			else
				{
				var v = parseToken(match,8);
				if(v == null && defaultName)
					{
					v = n;
					n = defaultName;
					}
				else if(v == null && defaultValue)
					v = defaultValue;
				r.push({name: n, value: v});
				if(cascadeDefaults)
					{
					defaultName = n;
					defaultValue = v;
					}
				}
			}
	} while(match);
	// Summarise parameters into first element
	for(var t=1; t<r.length; t++)
		{
		if(r[0][r[t].name])
			r[0][r[t].name].push(r[t].value);
		else
			r[0][r[t].name] = [r[t].value];
		}
	return r;
}

// Process a string list of macro parameters into an array. Parameters can be quoted with "", '',
// [[]], {{ }} or left unquoted (and therefore space-separated). Double-braces {{}} results in
// an *evaluated* parameter: e.g. {{config.options.txtUserName}} results in the current user's name.
String.prototype.readMacroParams = function()
{
	var p = this.parseParams("list",null,true,true);
	var n = [];
	for(var t=1; t<p.length; t++)
		n.push(p[t].value);
	return n;
}

// Process a string list of unique tiddler names into an array. Tiddler names that have spaces in them must be [[bracketed]]
String.prototype.readBracketedList = function(unique)
{
	var p = this.parseParams("list",null,false,true);
	var n = [];
	for(var t=1; t<p.length; t++)
		n.pushUnique(p[t].value,unique);
	return n;
}

// Returns array with start and end index of chunk between given start and end marker, or undefined.
String.prototype.getChunkRange = function(start,end) 
{
	var s = this.indexOf(start);
	if(s != -1)
		{
		s += start.length;
		var e = this.indexOf(end,s);
		if(e != -1)
			return [s, e];
		}
}

// Replace a chunk of a string given start and end markers
String.prototype.replaceChunk = function(start,end,sub)
{
	var r = this.getChunkRange(start,end);
	return r 
		? this.substring(0,r[0]) + sub + this.substring(r[1])
		: this;
}

// Returns a chunk of a string between start and end markers, or undefined
String.prototype.getChunk = function(start,end)
{
	var r = this.getChunkRange(start,end);
	if (r)
		return this.substring(r[0],r[1]);
}


// Static method to bracket a string with double square brackets if it contains a space
String.encodeTiddlyLink = function(title)
{
	if(title.indexOf(" ") == -1)
		return(title);
	else
		return("[[" + title + "]]");
}

// Static method to encodeTiddlyLink for every item in an array and join them with spaces
String.encodeTiddlyLinkList = function(list)
{
	if(list)
		{
		var results = [];
		for(var t=0; t<list.length; t++)
			results.push(String.encodeTiddlyLink(list[t]));
		return results.join(" ");
		}
	else
		return "";
}

// Static method to left-pad a string with 0s to a certain width
String.zeroPad = function(n,d)
{
	var s = n.toString();
	if(s.length < d)
		s = "000000000000000000000000000".substr(0,d-s.length) + s;
	return(s);
}

String.prototype.startsWith = function(prefix) 
{
	return !prefix || this.substring(0,prefix.length) == prefix;
}

// Returns the first value of the given named parameter.
function getParam(params, name, defaultValue) {
	if (!params)
		return defaultValue;
	var p = params[0][name];
	return p ? p[0] : defaultValue;
}

// Returns the first value of the given boolean named parameter.
function getFlag(params, name, defaultValue) {
	return !!getParam(params, name, defaultValue);
} 
	
// Substitute date components into a string
Date.prototype.formatString = function(template)
{
	var t = template.replace(/0hh12/g,String.zeroPad(this.getHours12(),2));
	t = t.replace(/hh12/g,this.getHours12());
	t = t.replace(/0hh/g,String.zeroPad(this.getHours(),2));
	t = t.replace(/hh/g,this.getHours());
	t = t.replace(/0mm/g,String.zeroPad(this.getMinutes(),2));
	t = t.replace(/mm/g,this.getMinutes());
	t = t.replace(/0ss/g,String.zeroPad(this.getSeconds(),2));
	t = t.replace(/ss/g,this.getSeconds());
	t = t.replace(/[ap]m/g,this.getAmPm().toLowerCase());
	t = t.replace(/[AP]M/g,this.getAmPm().toUpperCase());
	t = t.replace(/wYYYY/g,this.getYearForWeekNo());
	t = t.replace(/wYY/g,String.zeroPad(this.getYearForWeekNo()-2000,2));
	t = t.replace(/YYYY/g,this.getFullYear());
	t = t.replace(/YY/g,String.zeroPad(this.getFullYear()-2000,2));
	t = t.replace(/MMM/g,config.messages.dates.months[this.getMonth()]);
	t = t.replace(/mmm/g,config.messages.dates.shortMonths[this.getMonth()]);
	t = t.replace(/0MM/g,String.zeroPad(this.getMonth()+1,2));
	t = t.replace(/MM/g,this.getMonth()+1);
	t = t.replace(/0WW/g,String.zeroPad(this.getWeek(),2));
	t = t.replace(/WW/g,this.getWeek());
	t = t.replace(/DDD/g,config.messages.dates.days[this.getDay()]);
	t = t.replace(/ddd/g,config.messages.dates.shortDays[this.getDay()]);
	t = t.replace(/0DD/g,String.zeroPad(this.getDate(),2));
	t = t.replace(/DDth/g,this.getDate()+this.daySuffix());
	t = t.replace(/DD/g,this.getDate());
	return t;
}

Date.prototype.getWeek = function()
{
	var dt = new Date(this.getTime());
	var d = dt.getDay();
	if (d==0) d=7;// JavaScript Sun=0, ISO Sun=7
	dt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week to calculate weekNo
	var n = Math.floor((dt.getTime()-new Date(dt.getFullYear(),0,1)+3600000)/86400000); 
	return Math.floor(n/7)+1;
}

Date.prototype.getYearForWeekNo = function()
{
	var dt = new Date(this.getTime());
	var d = dt.getDay();
	if (d==0) d=7;// JavaScript Sun=0, ISO Sun=7
	dt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week
	return dt.getFullYear();
}

Date.prototype.getHours12 = function()
{
	var h = this.getHours();
	return h > 12 ? h-12 : ( h > 0 ? h : 12 );
}

Date.prototype.getAmPm = function()
{
	return this.getHours() >= 12 ? config.messages.dates.pm : config.messages.dates.am;
}

Date.prototype.daySuffix = function()
{
	var num = this.getDate();
	if (num >= 11 && num <= 13) return "th";
	else if (num.toString().substr(-1)=="1") return "st";
	else if (num.toString().substr(-1)=="2") return "nd";
	else if (num.toString().substr(-1)=="3") return "rd";
	return "th";
}

// Convert a date to local YYYYMMDDHHMM string format
Date.prototype.convertToLocalYYYYMMDDHHMM = function()
{
	return(String.zeroPad(this.getFullYear(),4) + String.zeroPad(this.getMonth()+1,2) + String.zeroPad(this.getDate(),2) + String.zeroPad(this.getHours(),2) + String.zeroPad(this.getMinutes(),2));
}

// Convert a date to UTC YYYYMMDDHHMM string format
Date.prototype.convertToYYYYMMDDHHMM = function()
{
	return(String.zeroPad(this.getUTCFullYear(),4) + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2));
}

// Convert a date to UTC YYYYMMDD.HHMMSSMMM string format
Date.prototype.convertToYYYYMMDDHHMMSSMMM = function()
{
	return(String.zeroPad(this.getUTCFullYear(),4) + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + "." + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2) + String.zeroPad(this.getUTCSeconds(),2) + String.zeroPad(this.getUTCMilliseconds(),4));
}

// Static method to create a date from a UTC YYYYMMDDHHMM format string
Date.convertFromYYYYMMDDHHMM = function(d)
{
	var theDate = new Date(Date.UTC(parseInt(d.substr(0,4),10),
							parseInt(d.substr(4,2),10)-1,
							parseInt(d.substr(6,2),10),
							parseInt(d.substr(8,2),10),
							parseInt(d.substr(10,2),10),0,0));
	return(theDate);
}

// ---------------------------------------------------------------------------------
// Crypto functions and associated conversion routines
// ---------------------------------------------------------------------------------

// Crypto "namespace"
function Crypto() {}

// Convert a string to an array of big-endian 32-bit words
Crypto.strToBe32s = function(str)
{
	var be = Array();
	var len = Math.floor(str.length/4);
	var i, j;
	for(i=0, j=0; i<len; i++, j+=4)
		{
		be[i] = ((str.charCodeAt(j)&0xff) << 24)|((str.charCodeAt(j+1)&0xff) << 16)|((str.charCodeAt(j+2)&0xff) << 8)|(str.charCodeAt(j+3)&0xff);
		}
	while (j<str.length)
		{
		be[j>>2] |= (str.charCodeAt(j)&0xff)<<(24-(j*8)%32);
		j++;
		}
	return be;
}

// Convert an array of big-endian 32-bit words to a string
Crypto.be32sToStr = function(be)
{
	var str = "";
	for(var i=0;i<be.length*32;i+=8)
		str += String.fromCharCode((be[i>>5]>>>(24-i%32)) & 0xff);
	return str;
}

// Convert an array of big-endian 32-bit words to a hex string
Crypto.be32sToHex = function(be)
{
	var hex = "0123456789ABCDEF";
	var str = "";
	for(var i=0;i<be.length*4;i++)
		str += hex.charAt((be[i>>2]>>((3-i%4)*8+4))&0xF) + hex.charAt((be[i>>2]>>((3-i%4)*8))&0xF);
	return str;
}

// Return, in hex, the SHA-1 hash of a string
Crypto.hexSha1Str = function(str)
{
	return Crypto.be32sToHex(Crypto.sha1Str(str));
}

// Return the SHA-1 hash of a string
Crypto.sha1Str = function(str)
{
	return Crypto.sha1(Crypto.strToBe32s(str),str.length);
}

// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
Crypto.sha1 = function(x,blen)
{
	// Add 32-bit integers, wrapping at 32 bits
	add32 = function(a,b)
	{
		var lsw = (a&0xFFFF)+(b&0xFFFF);
		var msw = (a>>16)+(b>>16)+(lsw>>16);
		return (msw<<16)|(lsw&0xFFFF);
	};
	// Add five 32-bit integers, wrapping at 32 bits
	add32x5 = function(a,b,c,d,e)
	{
		var lsw = (a&0xFFFF)+(b&0xFFFF)+(c&0xFFFF)+(d&0xFFFF)+(e&0xFFFF);
		var msw = (a>>16)+(b>>16)+(c>>16)+(d>>16)+(e>>16)+(lsw>>16);
		return (msw<<16)|(lsw&0xFFFF);
	};
	// Bitwise rotate left a 32-bit integer by 1 bit
	rol32 = function(n)
	{
		return (n>>>31)|(n<<1);
	};

	var len = blen*8;
	// Append padding so length in bits is 448 mod 512
	x[len>>5] |= 0x80 << (24-len%32);
	// Append length
	x[((len+64>>9)<<4)+15] = len;
	var w = Array(80);

	var k1 = 0x5A827999;
	var k2 = 0x6ED9EBA1;
	var k3 = 0x8F1BBCDC;
	var k4 = 0xCA62C1D6;

	var h0 = 0x67452301;
	var h1 = 0xEFCDAB89;
	var h2 = 0x98BADCFE;
	var h3 = 0x10325476;
	var h4 = 0xC3D2E1F0;

	for(var i=0;i<x.length;i+=16)
		{
		var j,t;
		var a = h0;
		var b = h1;
		var c = h2;
		var d = h3;
		var e = h4;
		for(j = 0;j<16;j++)
			{
			w[j] = x[i+j];
			t = add32x5(e,(a>>>27)|(a<<5),d^(b&(c^d)),w[j],k1);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a = t;
			}
		for(j=16;j<20;j++)
			{
			w[j] = rol32(w[j-3]^w[j-8]^w[j-14]^w[j-16]);
			t = add32x5(e,(a>>>27)|(a<<5),d^(b&(c^d)),w[j],k1);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a = t;
			}
		for(j=20;j<40;j++)
			{
			w[j] = rol32(w[j-3]^w[j-8]^w[j-14]^w[j-16]);
			t = add32x5(e,(a>>>27)|(a<<5),b^c^d,w[j],k2);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a = t;
			}
		for(j=40;j<60;j++)
			{
			w[j] = rol32(w[j-3]^w[j-8]^w[j-14]^w[j-16]);
			t = add32x5(e,(a>>>27)|(a<<5),(b&c)|(d&(b|c)),w[j],k3);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a = t;
			}
		for(j=60;j<80;j++)
			{
			w[j] = rol32(w[j-3]^w[j-8]^w[j-14]^w[j-16]);
			t = add32x5(e,(a>>>27)|(a<<5),b^c^d,w[j],k4);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a = t;
			}

		h0 = add32(h0,a);
		h1 = add32(h1,b);
		h2 = add32(h2,c);
		h3 = add32(h3,d);
		h4 = add32(h4,e);
		}
	return Array(h0,h1,h2,h3,h4);
}

// ---------------------------------------------------------------------------------
// RGB colour object
// ---------------------------------------------------------------------------------

// Construct an RGB colour object from a '#rrggbb', '#rgb' or 'rgb(n,n,n)' string or from separate r,g,b values
function RGB(r,g,b)
{
	this.r = 0;
	this.g = 0;
	this.b = 0;
	if(typeof r == "string")
		{
		if(r.substr(0,1) == "#")
			{
			if(r.length == 7)
				{
				this.r = parseInt(r.substr(1,2),16)/255;
				this.g = parseInt(r.substr(3,2),16)/255;
				this.b = parseInt(r.substr(5,2),16)/255;
				}
			else
				{
				this.r = parseInt(r.substr(1,1),16)/15;
				this.g = parseInt(r.substr(2,1),16)/15;
				this.b = parseInt(r.substr(3,1),16)/15;
				}
			}
		else
			{
			var rgbPattern = /rgb\s*\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/ ;
			var c = r.match(rgbPattern);
			if (c)
				{
				this.r = parseInt(c[1],10)/255;
				this.g = parseInt(c[2],10)/255;
				this.b = parseInt(c[3],10)/255;
				}
			}
		}
	else
		{
		this.r = r;
		this.g = g;
		this.b = b;
		}
	return this;
}

// Mixes this colour with another in a specified proportion
// c = other colour to mix
// f = 0..1 where 0 is this colour and 1 is the new colour
// Returns an RGB object
RGB.prototype.mix = function(c,f)
{
	return new RGB(this.r + (c.r-this.r) * f,this.g + (c.g-this.g) * f,this.b + (c.b-this.b) * f);
}

// Return an rgb colour as a #rrggbb format hex string
RGB.prototype.toString = function()
{
	var r = this.r.clamp(0,1);
	var g = this.g.clamp(0,1);
	var b = this.b.clamp(0,1);
	return("#" + ("0" + Math.floor(r * 255).toString(16)).right(2) +
				 ("0" + Math.floor(g * 255).toString(16)).right(2) +
				 ("0" + Math.floor(b * 255).toString(16)).right(2));
}

// ---------------------------------------------------------------------------------
// DOM utilities - many derived from www.quirksmode.org
// ---------------------------------------------------------------------------------

function drawGradient(place,horiz,colours)
{
	for(var t=0; t<= 100; t+=2)
		{
		var bar = document.createElement("div");
		place.appendChild(bar);
		bar.style.position = "absolute";
		bar.style.left = horiz ? t + "%" : 0;
		bar.style.top = horiz ? 0 : t + "%";
		bar.style.width = horiz ? (101-t) + "%" : "100%";
		bar.style.height = horiz ? "100%" : (101-t) + "%";
		bar.style.zIndex = -1;
		var f = t/100;
		var p = f*(colours.length-1);
		bar.style.backgroundColor = colours[Math.floor(p)].mix(colours[Math.ceil(p)],p-Math.floor(p)).toString();
		}
}

function createTiddlyText(theParent,theText)
{
	return theParent.appendChild(document.createTextNode(theText));
}

function createTiddlyCheckbox(theParent,caption,checked,onChange)
{
	var cb = document.createElement("input");
	cb.setAttribute("type","checkbox");
	cb.onclick = onChange;
	theParent.appendChild(cb);
	cb.checked = checked;
	cb.className = "chkOptionInput";
	if(caption)
		wikify(caption,theParent);
	return cb;
}

function createTiddlyElement(theParent,theElement,theID,theClass,theText)
{
	var e = document.createElement(theElement);
	if(theClass != null)
		e.className = theClass;
	if(theID != null)
		e.setAttribute("id",theID);
	if(theText != null)
		e.appendChild(document.createTextNode(theText));
	if(theParent != null)
		theParent.appendChild(e);
	return(e);
}

// Add an event handler
// Thanks to John Resig, via QuirksMode
function addEvent(obj,type,fn)
{
	if(obj.attachEvent)
		{
		obj['e'+type+fn] = fn;
		obj[type+fn] = function(){obj['e'+type+fn](window.event);}
		obj.attachEvent('on'+type,obj[type+fn]);
		}
	else
		obj.addEventListener(type,fn,false);
}

// Remove  an event handler
// Thanks to John Resig, via QuirksMode
function removeEvent(obj,type,fn)
{
	if(obj.detachEvent)
		{
		obj.detachEvent('on'+type,obj[type+fn]);
		obj[type+fn] = null;
		}
	else
		obj.removeEventListener(type,fn,false);
}

function addClass(e,theClass)
{
	var currClass = e.className.split(" ");
	if(currClass.indexOf(theClass) == -1)
		e.className += " " + theClass;
}

function removeClass(e,theClass)
{
	var currClass = e.className.split(" ");
	var i = currClass.indexOf(theClass);
	while(i != -1)
		{
		currClass.splice(i,1);
		i = currClass.indexOf(theClass);
		}
	e.className = currClass.join(" ");
}

function hasClass(e,theClass)
{
	if(e.className)
		{
		if(e.className.split(" ").indexOf(theClass) != -1)
			return true;
		}
	return false;
}

// Find the closest relative with a given property value (property defaults to tagName, relative defaults to parentNode)
function findRelated(e,value,name,relative)
{
	name = name ? name : "tagName";
	relative = relative ? relative : "parentNode";
	if(name == "className")
		{
		while(e && !hasClass(e,value))
			{
			e = e[relative];
			}
		}
	else
		{
		while(e && e[name] != value)
			{
			e = e[relative];
			}
		}
	return e;
}

// Resolve the target object of an event
function resolveTarget(e)
{
	var obj;
	if (e.target)
		obj = e.target;
	else if (e.srcElement)
		obj = e.srcElement;
	if (obj.nodeType == 3) // defeat Safari bug
		obj = obj.parentNode;
	return(obj);
}

// Return the content of an element as plain text with no formatting
function getPlainText(e)
{
	var text = "";
	if(e.innerText)
		text = e.innerText;
	else if(e.textContent)
		text = e.textContent;
	return text;
}

// Get the scroll position for window.scrollTo necessary to scroll a given element into view
function ensureVisible(e)
{
	var posTop = findPosY(e);
	var posBot = posTop + e.offsetHeight;
	var winTop = findScrollY();
	var winHeight = findWindowHeight();
	var winBot = winTop + winHeight;
	if(posTop < winTop)
		return(posTop);
	else if(posBot > winBot)
		{
		if(e.offsetHeight < winHeight)
			return(posTop - (winHeight - e.offsetHeight));
		else
			return(posTop);
		}
	else
		return(winTop);
}

// Get the current width of the display window
function findWindowWidth()
{
	return(window.innerWidth ? window.innerWidth : document.documentElement.clientWidth);
}

// Get the current height of the display window
function findWindowHeight()
{
	return(window.innerHeight ? window.innerHeight : document.documentElement.clientHeight);
}

// Get the current horizontal page scroll position
function findScrollX()
{
	return(window.scrollX ? window.scrollX : document.documentElement.scrollLeft);
}

// Get the current vertical page scroll position
function findScrollY()
{
	return(window.scrollY ? window.scrollY : document.documentElement.scrollTop);
}

function findPosX(obj)
{
	var curleft = 0;
	while (obj.offsetParent)
		{
		curleft += obj.offsetLeft;
		obj = obj.offsetParent;
		}
	return curleft;
}

function findPosY(obj)
{
	var curtop = 0;
	while (obj.offsetParent)
		{
		curtop += obj.offsetTop;
		obj = obj.offsetParent;
		}
	return curtop;
}

// Blur a particular element
function blurElement(e)
{
	if(e != null && e.focus && e.blur)
		{
		e.focus();
		e.blur();
		}
}

// Create a non-breaking space
function insertSpacer(place)
{
	var e = document.createTextNode(String.fromCharCode(160));
	if(place)
		place.appendChild(e);
	return e;
}

// Remove all children of a node
function removeChildren(e)
{
	while(e.hasChildNodes())
		e.removeChild(e.firstChild);
}

// Add a stylesheet, replacing any previous custom stylesheet
function setStylesheet(s,id)
{
	if(!id)
		id = "customStyleSheet";
	var n = document.getElementById(id);
	if(document.createStyleSheet) // Test for IE's non-standard createStyleSheet method
		{
		if(n)
			n.parentNode.removeChild(n);
		// This failed without the &nbsp;
		document.getElementsByTagName("head")[0].insertAdjacentHTML("beforeEnd","&nbsp;<style id='" + id + "'>" + s + "</style>");
		}
	else
		{
		if(n)
			n.replaceChild(document.createTextNode(s),n.firstChild);
		else
			{
			var n = document.createElement("style");
			n.type = "text/css";
			n.id = id;
			n.appendChild(document.createTextNode(s));
			document.getElementsByTagName("head")[0].appendChild(n);
			}
		}
}

// Replace the current selection of a textarea or text input and scroll it into view

function replaceSelection(e,text)
{
	if (e.setSelectionRange)
		{
		var oldpos = e.selectionStart + 1;
		e.value = e.value.substr(0,e.selectionStart) + text + e.value.substr(e.selectionStart);
		e.setSelectionRange( oldpos, oldpos);
		var linecount = e.value.split('\n').length;
		var thisline = e.value.substr(0,e.selectionStart).split('\n').length-1;
		e.scrollTop = Math.floor((thisline-e.rows/2)*e.scrollHeight/linecount);
		}
	else if (document.selection)
		{
		var range = document.selection.createRange();
		if (range.parentElement() == e)
			{
			var isCollapsed = range.text == "";
			range.text = text;
			 if (!isCollapsed)
				{
				range.moveStart('character', -text.length);
				range.select();
				}
			}
		}
}

// Returns the text of the given (text) node, possibly merging subsequent text nodes
function getNodeText(e)
{
	var t = ""; 
	while (e && e.nodeName == "#text")
		{
		t += e.nodeValue;
		e = e.nextSibling;
		}
	return t;
}

function LoaderBase()
{
}

LoaderBase.prototype.loadTiddler = function(store,e,tiddlers)
{
	var title = this.getTitle(store, e);
	if (title)
		{
		var tiddler = store.createTiddler(title);
		this.internalizeTiddler(store, tiddler, title, e);
		tiddlers.push(tiddler);
		}
}

LoaderBase.prototype.loadTiddlers = function(store,nodes)
{
	var tiddlers = [];
	for (var t = 0; t < nodes.length; t++)
		{
		try
			{
			this.loadTiddler(store, nodes[t], tiddlers);
			}
		catch(e)
			{
			showException(e, config.messages.tiddlerLoadError.format([this.getTitle(store, nodes[t])]));
			}
		}
	return tiddlers;
}
	

function SaverBase()
{
}

SaverBase.prototype.externalize = function(store) 
{
	var results = [];
	var tiddlers = store.getTiddlers("title");
	for (var t = 0; t < tiddlers.length; t++)
		results.push(this.externalizeTiddler(store, tiddlers[t]));
	return results.join("\n");
}
//--------------------------------
// TW21Loader (inherits from LoaderBase)

function TW21Loader() {}

TW21Loader.prototype = new LoaderBase();

TW21Loader.prototype.getTitle = function(store,e)
{
	var title = null;
	if(e.getAttribute) {
		title = e.getAttribute("title");
		if(!title)
			title = e.getAttribute("tiddler");
	}
	if(!title && e.id) {
		var lenPrefix = store.idPrefix.length;
		if (e.id.substr(0,lenPrefix) == store.idPrefix)
			title = e.id.substr(lenPrefix);
	}
	return title;
};

TW21Loader.prototype.internalizeTiddler = function(store,tiddler,title,data)
{
	var e = data.firstChild;
	var text = null;
	if(data.getAttribute("tiddler")) {
		text = getNodeText(e).unescapeLineBreaks();
	} else {
		while(e.nodeName!="PRE" && e.nodeName!="pre") {
			e = e.nextSibling;
		}
		text = e.innerHTML.replace(/\r/mg,"").htmlDecode();
	}
	var modifier = data.getAttribute("modifier");
	var c = data.getAttribute("created");
	var m = data.getAttribute("modified");
	var created = c ? Date.convertFromYYYYMMDDHHMM(c) : version.date;
	var modified = m ? Date.convertFromYYYYMMDDHHMM(m) : created;
	var tags = data.getAttribute("tags");
	var fields = {};
	var attrs = data.attributes;
	for(var i = attrs.length-1; i >= 0; i--) {
		var name = attrs[i].name;
		if (attrs[i].specified && !TiddlyWiki.isStandardField(name)) {
			fields[name] = attrs[i].value.unescapeLineBreaks();
		}
	}
	tiddler.assign(title,text,modifier,modified,tags,created,fields);
	return tiddler;
};

//--------------------------------
// TW21Saver (inherits from SaverBase)

function TW21Saver() {}

TW21Saver.prototype = new SaverBase();

TW21Saver.prototype.externalizeTiddler = function(store,tiddler) 
{
	try {
		var extendedAttributes = "";
		var usePre = config.usePreForStorage;
		store.forEachField(tiddler,
			function(tiddler,fieldName,value) {
				// don't store stuff from the temp namespace
				if (!fieldName.match(/^temp\./))
					extendedAttributes += ' %0="%1"'.format([fieldName,value.escapeLineBreaks().htmlEncode()]);
			},true);
		var created = tiddler.created.convertToYYYYMMDDHHMM();
		var modified = tiddler.modified.convertToYYYYMMDDHHMM();
		var vdate = version.date.convertToYYYYMMDDHHMM();
		var attributes = tiddler.modifier ? ' modifier="' + tiddler.modifier.htmlEncode() + '"' : "";
		attributes += (usePre && modified == created) ? "" : ' modified="' + modified +'"';
		attributes += (usePre && created == vdate) ? "" :' created="' + created + '"';
		var tags = tiddler.getTags();
		if(!usePre || tags)
			attributes += ' tags="' + tags.htmlEncode() + '"';
		return '<div %0="%1"%2%3>%4</div>'.format([
				usePre ? "title" : "tiddler",
				tiddler.title.htmlEncode(),
				attributes,
				extendedAttributes,
				usePre ? "\n<pre>" + tiddler.text.htmlEncode() + "</pre>\n" : tiddler.escapeLineBreaks().htmlEncode()
			]);
	} catch (ex) {
		throw exceptionText(ex, config.messages.tiddlerSaveError.format([tiddler.title]));
	}
}

// ---------------------------------------------------------------------------------
// Deprecated code
// ---------------------------------------------------------------------------------

// @Deprecated: Use createElementAndWikify and this.termRegExp instead
config.formatterHelpers.charFormatHelper = function(w)
{
	w.subWikify(createTiddlyElement(w.output,this.element),this.terminator);
}

// @Deprecated: Use enclosedTextHelper and this.lookaheadRegExp instead
config.formatterHelpers.monospacedByLineHelper = function(w)
{
	var lookaheadRegExp = new RegExp(this.lookahead,"mg");
	lookaheadRegExp.lastIndex = w.matchStart;
	var lookaheadMatch = lookaheadRegExp.exec(w.source);
	if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
		{
		var text = lookaheadMatch[1];
		if(config.browser.isIE)
			text = text.replace(/\n/g,"\r");
		createTiddlyElement(w.output,"pre",null,null,text);
		w.nextMatch = lookaheadRegExp.lastIndex;
		}
}

// @Deprecated: Use <br> or <br /> instead of <<br>>
config.macros.br.handler = function(place)
{
	createTiddlyElement(place,"br");
}

// Find an entry in an array. Returns the array index or null
// @Deprecated: Use indexOf instead
Array.prototype.find = function(item)
{
	var i = this.indexOf(item);
	return i == -1 ? null : i;
}

// Load a tiddler from an HTML DIV. The caller should make sure to later call Tiddler.changed()
// @Deprecated: Use store.getLoader().internalizeTiddler instead
Tiddler.prototype.loadFromDiv = function(divRef,title)
{
	return store.getLoader().internalizeTiddler(store,this,title,divRef);
}

// Format the text for storage in an HTML DIV
// @Deprecated Use store.getSaver().externalizeTiddler instead.
Tiddler.prototype.saveToDiv = function()
{
	return store.getSaver().externalizeTiddler(store,this);
}

// @Deprecated: Use store.allTiddlersAsHtml() instead
function allTiddlersAsHtml()
{
	return store.allTiddlersAsHtml();
}

// @Deprecated: Use refreshPageTemplate instead
function applyPageTemplate(title)
{
	refreshPageTemplate(title);
}

// @Deprecated: Use story.displayTiddlers instead
function displayTiddlers(srcElement,titles,template,unused1,unused2,animate,slowly)
{
	story.displayTiddlers(srcElement,titles,template,animate,slowly);
}

// @Deprecated: Use story.displayTiddler instead
function displayTiddler(srcElement,title,template,unused1,unused2,animate,slowly)
{
	story.displayTiddler(srcElement,title,template,animate,slowly);
}

// @Deprecated: Use functions on right hand side directly instead
var createTiddlerPopup = Popup.create;
var scrollToTiddlerPopup = Popup.show;
var hideTiddlerPopup = Popup.remove;

// @Deprecated: Use right hand side directly instead
var regexpBackSlashEn = new RegExp("\\\\n","mg");
var regexpBackSlash = new RegExp("\\\\","mg");
var regexpBackSlashEss = new RegExp("\\\\s","mg");
var regexpNewLine = new RegExp("\n","mg");
var regexpCarriageReturn = new RegExp("\r","mg");
/***
|''Name:''|SocialtextSyncPlugin|
|''Description:''|Allows changes to be synchronised with a Socialtext server|
|''Source:''|http://stunplugged.tiddlywiki.com/#SocialtextSyncPlugin|
|''Author:''|JeremyRuston (jeremy (at) osmosoft (dot) com)|
|''Version:''|1.0.0|
|''Date:''|Nov 28, 2006|
|''Comments:''|Please make comments at http://groups.google.co.uk/group/TiddlyWikiDev|
|''License:''|[[BSD open source license]]|
|''~CoreVersion:''|2.1.3|

This is the SocialtextSyncPlugin, which allows you to synchronise unplugged Socialtext
content back to the server.

***/

//{{{

// Ensure that the SocialtextSyncPlugin is only installed once.
if(!version.extensions.SocialtextSyncPlugin) {
version.extensions.SocialtextSyncPlugin = {installed:true};
// Check version number of core code
if(version.major < 2 || (version.major == 2 && version.minor < 1))
	{alertAndThrow("SocialtextSyncPlugin requires TiddlyWiki 2.1 or later.");}

config.syncers.socialtext = {
	urlGetPageset: "%0data/workspaces/%1/pages",
	urlPutPage: "%0data/workspaces/%1/pages/%2",
	urlViewPage: "%0%1/index.cgi?%2"
};

config.syncers.socialtext.init = function(sync)
{
	this.requestedPagesets = {}; // Hashmap indexed by requested url of array of syncItems
}

config.syncers.socialtext.addSyncable = function(sync,tiddler,syncItem)
{
	syncItem.socialtext = {
		server: store.getValue(tiddler,"socialtext.server"),
		workspace: store.getValue(tiddler,"socialtext.workspace"),
		page: store.getValue(tiddler,"socialtext.page"),
		version: store.getValue(tiddler,"socialtext.version")
		};
	if(!syncItem.socialtext.page)
		{
		syncItem.socialtext.page = encodeURIComponent(tiddler.title);
		store.setValue(tiddler,"socialtext.page",syncItem.socialtext.page);
		}
	syncItem.serverUrl = this.urlViewPage.format([syncItem.socialtext.server,syncItem.socialtext.workspace,syncItem.socialtext.page]);
	var url = this.urlGetPageset.format([syncItem.socialtext.server,syncItem.socialtext.workspace]);
	if(this.requestedPagesets[url] == undefined)
		{
		var r = doHttp("GET",
			url,
			undefined,
			null,
			null,null,
			config.syncers.socialtext.doneGetPageset,
			{server: syncItem.socialtext.server, workspace: syncItem.socialtext.workspace},
			{"Accept": "application/json"});
		if(typeof r == "string")
			syncItem.serverStatus = "Error\n(" + r + ")";
		else
			syncItem.serverStatus = "Checking server";
		this.requestedPagesets[url] = [];
		}
	this.requestedPagesets[url].push(syncItem);
}

config.syncers.socialtext.doneGetPageset = function(status,params,responseText,url,xhr)
{
	var url = config.syncers.socialtext.urlGetPageset.format([params.server,params.workspace]);
	var syncItems = config.syncers.socialtext.requestedPagesets[url];
	// Get the pageset info from the response
	var pagesetInfo = status ? window.eval(responseText) : null;
	// Save each syncable tiddler belonging to this server/workspace combo
	for(var t=0; t<syncItems.length; t++)
		{
		var syncItem = syncItems[t];
		var statusElem = syncItem.colElements["serverStatus"];
		removeChildren(statusElem);
		if(status)
			{
			var url = config.syncers.socialtext.urlPutPage.format([syncItem.socialtext.server,syncItem.socialtext.workspace,syncItem.socialtext.page]);
			var pageInfo = pagesetInfo.findByField("page_id",syncItem.socialtext.page);
			if(pageInfo != null)
				pageInfo = pagesetInfo[pageInfo];
			if(pageInfo)
				{
				syncItem.socialtext.serverVersion = pageInfo.revision_id;
				if(syncItem.socialtext.serverVersion > syncItem.socialtext.version)
					createTiddlyText(statusElem,"Changed on server");
				else
					createTiddlyText(statusElem,"Unchanged on server");
				}
			else
				createTiddlyText(statusElem,"Does not exist on server");
			}
		else
			createTiddlyError(statusElem,"Failed Â»",xhr.statusText + " (" + xhr.status + ")");
		}
}

config.syncers.socialtext.doSync = function(sync,syncItem)
{
	var statusElem = syncItem.colElements["serverStatus"];
	removeChildren(statusElem);
	var url = this.urlPutPage.format([syncItem.socialtext.server,syncItem.socialtext.workspace,syncItem.socialtext.page]);
	createTiddlyText(statusElem,"Saving...");
	var r = doHttp("POST",
		url,
		syncItem.tiddler.text,
		"text/x.socialtext-wiki",
		null,null,
		this.donePut,
		syncItem,
		{"X-Http-Method": "PUT"});
	if(typeof r == "string")
		{
		removeChildren(statusElem);
		createTiddlyError(statusElem,"Error Â»",r);
		}
}

config.syncers.socialtext.donePut = function(status,syncItem,responseText,url,xhr)
{
	var statusElem = syncItem.colElements["serverStatus"];
	removeChildren(statusElem);
	if(status)
		createTiddlyText(statusElem,"Done");
	else
		createTiddlyError(statusElem,"Failed Â»",xhr.statusText + " (" + xhr.status + ")");
}

} // end of "install only once"
//}}}
/***
|''Name:''|SocialtextLocaleOverrides|
|''Description:''|Text changes for Socialtext|
***/

//{{{
merge(config.views.wikified.tag,{
	labelNoTags: "No Tags",
	labelTags: "Tags"});

merge(config.commands.references,{
	text: "incoming links",
	tooltip: "Show tiddlers that link to this one",
	popupNone: "No incoming links"});
//}}}
/***
|''Name:''|SocialtextTweaksPlugin|
|''Description:''|Allows changes to be synchronised with a Socialtext server|
|''Source:''|http://stunplugged.tiddlywiki.com/#SocialtextTweaksPlugin|
|''Author:''|JeremyRuston (jeremy (at) osmosoft (dot) com)|
|''Version:''|1.0.0|
|''Date:''|Dec 4, 2006|
|''Comments:''|Please make comments at http://groups.google.co.uk/group/TiddlyWikiDev|
|''License:''|[[BSD open source license]]|
|''~CoreVersion:''|2.1.3|

Make minor configuration tweaks specific to Socialtext Unplugged

***/

//{{{

// Ensure that the SocialtextTweaksPlugin is only installed once.
if(!version.extensions.SocialtextTweaksPlugin) {
version.extensions.SocialtextTweaksPlugin = {installed:true};
// Check version number of core code
if(version.major < 2 || (version.major == 2 && version.minor < 1))
	{alertAndThrow("SocialtextTweaksPlugin requires TiddlyWiki 2.1 or later.");}

config.options.chkSinglePageMode = true;
config.options.chkEnableAnimations = true;

} // end of "install only once"
//}}}
/***
|''Name:''|SocialtextFormatterPlugin|
|''Description:''|Allows Tiddlers to use [[Socialtext|http://www.socialtext.com/]] text formatting|
|''Source:''|http://martinswiki.com/prereleases.html#SocialtextFormatterPlugin|
|''Author:''|MartinBudden (mjbudden (at) gmail (dot) com)|
|''Version:''|0.9.1|
|''Date:''|Nov 4, 2006|
|''Comments:''|Please make comments at http://groups.google.co.uk/group/TiddlyWikiDev|
|''License:''|[[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|''~CoreVersion:''|2.1.0|

This is the SocialtextFormatterPlugin, which allows you to insert Socialtext formated text into a TiddlyWiki.

The aim is not to fully emulate Socialtext, but to allow you to work with Socialtext content off-line and then resynch the content with your Socialtext wiki later on, with the expectation that only minor edits will be required.

To use Socialtext format in a Tiddler, tag the Tiddler with SocialtextFormat.

Please report any defects you find at http://groups.google.co.uk/group/TiddlyWikiDev

***/

//{{{

// Ensure that the SocialtextFormatter Plugin is only installed once.
if(!version.extensions.SocialtextFormatterPlugin) {
version.extensions.SocialtextFormatterPlugin = {installed:true};

if(version.major < 2 || (version.major == 2 && version.minor < 1))
	{alertAndThrow("SocialtextFormatterPlugin requires TiddlyWiki 2.1 or later.");}

wikify = function(source,output,highlightRegExp,tiddler)
{
	if(source && source != "") {
		var w = new Wikifier(source,getParser(tiddler),highlightRegExp,tiddler);
		var out = output;
		if(tiddler && tiddler.isTagged("SocialtextFormat")) {
			var d1 = createTiddlyElement(output,"div","content-display-body","content-section-visible");
			var d2 = createTiddlyElement(d1,"div","wikipage");
			out = createTiddlyElement(d2,"div",null,"wiki");
		}
		var time1,time0 = new Date();
		w.subWikifyUnterm(out);
		if(tiddler&& config.options.chkDisplayInstrumentation) {
			time1 = new Date();
			var t = tiddler ? tiddler.title : source.substr(0,10);
			displayMessage("Wikify '"+t+"' in " + (time1-time0) + " ms");
		}
	}
};

socialtextFormatter = {}; // "namespace" for local functions

stDebug = function(out,str)
{
	createTiddlyText(out,str.replace(/\n/mg,"\\n").replace(/\r/mg,"RR"));
	createTiddlyElement(out,"br");
};

socialtextFormatter.wafl = function(w)
{
	this.lookaheadRegExp.lastIndex = w.matchStart;
	var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
	if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
		var lm2 = lookaheadMatch[2];
		switch(lookaheadMatch[1]) {
		case "image":
			var img = createTiddlyElement(w.output,"img");
			img.src = w.tiddler.title + "/" + lm2;
			createTiddlyText(img,lm2);
			break;
		case "file":
			var s = createTiddlyElement(w.output,"span",null,"nlw_phrase");
			var a = createTiddlyElement(s,"a");
			a.href = w.tiddler.title + "/" + lm2;
			createTiddlyText(a,lm2);
			break;
		case "link":
//Test: link to header: <span class="nlw_phrase"><a title="section link" href="#googlesoap">googlesoap</a><!-- wiki: {link: googlesoap} --></span></p>
			s = createTiddlyElement(w.output,"span",null,"nlw_phrase");
			a = createTiddlyElement(s,"a");
			var t = w.tiddler ? w.tiddler.title + ":" : "";
			a.setAttribute("href","#" + t + lm2);
			a.title = "section link";
			createTiddlyText(a,lm2);
			break;
		case "weblog":
			s = createTiddlyElement(w.output,"span",null,"nlw_phrase");
			var text = lm2;
			var link = "Weblog: " + lm2;
			createTiddlyText(createTiddlyLink(s,link,false,null,w.isStatic),text);
			break;
		case "section":
			a = createTiddlyElement(w.output,"a");// drop anchor
			t = w.tiddler ? w.tiddler.title + ":" : "";
			a.setAttribute("name",t + lm2);
			break;
		case "date":
			createTiddlyText(w.output,lm2);
			break;
		case "user":
			var oldSource = w.source;
			w.source = lm2;
			w.nextMatch = 0;
			w.subWikifyUnterm(w.output);
			w.source = oldSource;
			break;
// Shortcut expansions - not strictly syntax
		case "google":
			s = createTiddlyElement(w.output,"span",null,"nlw_phrase");
			a = createExternalLink(s,"http://www.google.com/search?q="+lm2);
			createTiddlyText(a,lm2);
			break;
		case "fedex":
			s = createTiddlyElement(w.output,"span",null,"nlw_phrase");
			a = createExternalLink(s,"http://www.fedex.com/Tracking?tracknumbers="+lm2);
			createTiddlyText(a,lm2);
			break;
		case "map":
			s = createTiddlyElement(w.output,"span",null,"nlw_phrase");
			a = createExternalLink(s,"http://maps.google.com/maps?q="+lm2);
			createTiddlyText(a,lm2);
			break;
		case "wikipedia":
			s = createTiddlyElement(w.output,"span",null,"nlw_phrase");
			a = createExternalLink(s,"http://en.wikipedia.org/wiki/"+lm2);
			createTiddlyText(a,lm2);
			break;
		case "rt":
			s = createTiddlyElement(w.output,"span",null,"nlw_phrase");
			a = createExternalLink(s,"http://rt.socialtext.net/Ticket/Display.html?id="+lm2);
			createTiddlyText(a,lm2);
			break;
		case "stcal":
			s = createTiddlyElement(w.output,"span",null,"nlw_phrase");
			a = createExternalLink(s,"https://calendar.socialtext.net:445/view_t.php?timeb=1&id=3&date="+lm2);
			createTiddlyText(a,lm2);
			break;
		case "svn":
			s = createTiddlyElement(w.output,"span",null,"nlw_phrase");
			a = createExternalLink(s,"https://repo.socialtext.net/listing.php?rev="+lm2+"sc=1");
			createTiddlyText(a,lm2);
			break;
		default:
			w.outputText(w.output,w.matchStart,w.nextMatch);
			return;
		}
		w.nextMatch = this.lookaheadRegExp.lastIndex;
	} else {
		w.outputText(w.output,w.matchStart,w.nextMatch);
	}
};

socialtextFormatter.presence = function(w)
{
	this.lookaheadRegExp.lastIndex = w.matchStart;
	var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
	if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
		var p = lookaheadMatch[1];
		var text = lookaheadMatch[2];
		var link;
		var src;
		if(p=="aim") {
			link = "aim:goim?screenname=" + text + "&message=hello";
			src = "http://big.oscar.aol.com/sleepleft?on_url=http://www.aim.com/remote/gr/MNB_online.gif&amp;off_url=http://www.aim.com/remote/gr/MNB_offline.gif";
		} else if(p=="yahoo"||p=="ymsgr") {
			link = "ymsgr:sendIM?"+text;
			src = "http://opi.yahoo.com/online?u=chrislondonbridge&f=.gif";
		} else if(p=="skype"||p=="callto") {
			link = "callto:"+text;
			src = "http://goodies.skype.com/graphics/skypeme_btn_small_green.gif";
		} else if(p=="asap") {
			link = "http://asap2.convoq.com/AsapLinks/Meet.aspx?l="+text;
			src = "http://asap2.convoq.com/AsapLinks/Presence.aspx?l="+text;
		}
		var s = createTiddlyElement(w.output,"span",null,"nlw_phrase");
		var a = createExternalLink(s,link);
		var img = createTiddlyElement(a,"img");
		createTiddlyText(a,text);
		img.src = src;
		img.border="0";
		img.alt = "(" + lookaheadMatch[1] + ")";
		if(p=="aim") {
			img.width="11"; img.height="13";
		}
		w.nextMatch = this.lookaheadRegExp.lastIndex;
	}
};

config.formatterHelpers.singleCharFormat = function(w)
{
	this.lookaheadRegExp.lastIndex = w.matchStart;
	var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
	if(lookaheadMatch && lookaheadMatch.index == w.matchStart && lookaheadMatch[0].substr(lookaheadMatch[0].length-2,1) != " ") {
		w.subWikifyTerm(createTiddlyElement(w.output,this.element),this.termRegExp);
	} else {
		w.outputText(w.output,w.matchStart,w.nextMatch);
	}
};

config.socialTextFormatters = [
{
	name: "socialtextHeading",
	match: "^\\^{1,6} ?",
	termRegExp: /(\n+)/mg,
	handler: function(w)
	{
		var len = w.matchText.trim().length;
		var e = createTiddlyElement(w.output,"h" + len);
		var a = createTiddlyElement(e,"a");// drop anchor
		var t = w.tiddler ? w.tiddler.title + ":" : "";
		len = w.source.substr(w.nextMatch).indexOf("\n");
		a.setAttribute("name",t+w.source.substr(w.nextMatch,len));
		w.subWikifyTerm(e,this.termRegExp);
	}
},

{
	name: "socialtextTable",
	match: "^\\|(?:(?:.|\n)*)\\|$",
	lookaheadRegExp: /^\|(?:(?:.|\n)*)\|$/mg,
	cellRegExp: /(?:\|(?:[^\|]*)\|)(\n|$)?/mg,
	cellTermRegExp: /((?:\x20*)\|)/mg,
	handler: function(w)
	{
		var table = createTiddlyElement(w.output,"table");
		var rowContainer = createTiddlyElement(table,"tbody");
		var prevColumns = [];
		w.nextMatch = w.matchStart;
		this.lookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			var r = this.rowHandler(w,createTiddlyElement(rowContainer,"tr"),prevColumns);
			if(!r) {
				w.nextMatch++;
				break;
			}
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		}
	},
	rowHandler: function(w,e,prevColumns)
	{
		this.cellRegExp.lastIndex = w.nextMatch;
		var cellMatch = this.cellRegExp.exec(w.source);
		while(cellMatch && cellMatch.index == w.nextMatch) {
			w.nextMatch++;
			var cell = createTiddlyElement(e,"td");
			w.subWikifyTerm(cell,this.cellTermRegExp);
			if(cellMatch[1]) {
				// End of row
				w.nextMatch = this.cellRegExp.lastIndex;
				return true;
			}
			// Cell
			w.nextMatch--;
			this.cellRegExp.lastIndex = w.nextMatch;
			cellMatch = this.cellRegExp.exec(w.source);
		}
		return false;
	}
},

{
	name: "socialtextList",
	match: "^[\\*#]+ ",
	lookaheadRegExp: /^([\*#])+ /mg,
	termRegExp: /(\n+)/mg,
	handler: function(w)
	{
		var stack = [w.output];
		var currLevel = 0, currType = null;
		var itemType = "li";
		w.nextMatch = w.matchStart;
		this.lookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			var listType = lookaheadMatch[1] == "*" ? "ul" : "ol";
			var listLevel = lookaheadMatch[0].length;
			w.nextMatch += listLevel;
			if(listLevel > currLevel) {
				for(var i=currLevel; i<listLevel; i++) {
					stack.push(createTiddlyElement(stack[stack.length-1],listType));
				}
			} else if(listLevel < currLevel) {
				for(i=currLevel; i>listLevel; i--) {
					stack.pop();
				}
			} else if(listLevel == currLevel && listType != currType) {
				stack.pop();
				stack.push(createTiddlyElement(stack[stack.length-1],listType));
			}
			currLevel = listLevel;
			currType = listType;
			var e = createTiddlyElement(stack[stack.length-1],itemType);
			w.subWikifyTerm(e,this.termRegExp);
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		}
	}
},

{
	name: "socialtextQuoteByLine",
	match: "^>+",
	lookaheadRegExp: /^>+/mg,
	termRegExp: /(\n)/mg,
	element: "blockquote",
	handler: function(w)
	{
		var stack = [w.output];
		var currLevel = 0;
		var newLevel = w.matchLength;
		var i;
		do {
			if(newLevel > currLevel) {
				for(i=currLevel; i<newLevel; i++) {
					stack.push(createTiddlyElement(stack[stack.length-1],this.element));
				}
			} else if(newLevel < currLevel) {
				for(i=currLevel; i>newLevel; i--) {
					stack.pop();
				}
			}
			currLevel = newLevel;
			w.subWikifyTerm(stack[stack.length-1],this.termRegExp);
			createTiddlyElement(stack[stack.length-1],"br");
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
			var matched = lookaheadMatch && lookaheadMatch.index == w.nextMatch;
			if(matched) {
				newLevel = lookaheadMatch[0].length;
				w.nextMatch += newLevel;
			}
		} while(matched);
	}
},

{
	name: "socialtextRule",
	match: "^----+$\\n+",
	handler: function(w)
	{
		createTiddlyElement(w.output,"hr");
	}
},

{
	name: "socialtextPreformatted",
	match: "^\\.pre\\s*\\n",
	lookaheadRegExp: /^.pre\s*\n((?:.|\n)*?)\n.pre\s*\n/mg,
	element: "pre",
	handler: config.formatterHelpers.enclosedTextHelper
},

{
	name: "socialtextHtml",
	match: "^\\.html",
	lookaheadRegExp: /\.html((?:.|\n)*?)\.html/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			createTiddlyElement(w.output,"span").innerHTML = lookaheadMatch[1];
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "macro",
	match: "<<",
	lookaheadRegExp: /<<([^>\s]+)(?:\s*)((?:[^>]|(?:>(?!>)))*)>>/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart && lookaheadMatch[1]) {
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			invokeMacro(w.output,lookaheadMatch[1],lookaheadMatch[2],w,w.tiddler);
		}
	}
},

{
	name: "socialtextExplicitLink",
	match: '(?:".*?" ?)?\\[',
	lookaheadRegExp: /(?:\"(.*?)\" ?)?\[([^\]]*?)\]/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var link = lookaheadMatch[2];
			var text = lookaheadMatch[1] ? lookaheadMatch[1] : link;
			createTiddlyText(createTiddlyLink(w.output,link,false,null,w.isStatic),text);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "socialtextExternalLink",
	match: '(?:".*?" ?)?<[a-z]{2,8}:',
	lookaheadRegExp: /(?:\"(.*?)\" ?)?<([a-z]{2,8}:.*?)>/mg,
	imgRegExp: /\.(?:gif|ico|jpg|png)/g,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var link = lookaheadMatch[2];
			var text = lookaheadMatch[1] ? lookaheadMatch[1] : link;
			this.imgRegExp.lastIndex = 0;
			if(this.imgRegExp.exec(link)) {
				var img = createTiddlyElement(w.output,"img");
				if(lookaheadMatch[1]) {
					img.title = text;
				}
				img.alt = text;
				img.src = link;
			} else {
				createTiddlyText(createExternalLink(w.output,link),text);
			}
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "socialtextUrlLink",
	match: config.textPrimitives.urlPattern,
	handler: function(w)
	{
		w.outputText(createExternalLink(w.output,w.matchText),w.matchStart,w.nextMatch);
	}
},

{
	name: "socialtextBold",
	match: "\\*(?![\\s\\*])",
	lookaheadRegExp: /\*(?!\s)(?:.*?)(?!\s)\*(?=[$\s\._\-])/mg,
	termRegExp: /((?!\s)\*(?=[$\s\.\-_]))/mg,
	element: "strong",
	handler: config.formatterHelpers.singleCharFormat
},

{
	name: "socialtextItalic",
	match: "_(?![\\s_])",
	lookaheadRegExp: /_(?!\s)(?:.*?)(?!\s)_(?=[$\s\.\*\-])/mg,
	termRegExp: /((?!\s)_(?=[$\s\.\*\-]))/mg,
	element: "em",
	handler: config.formatterHelpers.singleCharFormat
},

{
	name: "socialtextStrike",
	match: "-(?![\\s\\-])",
	lookaheadRegExp: /-(?!\s)(?:.*?)(?!\s)-(?=[$\s\.\*_])/mg,
	termRegExp: /((?!\s)-(?=[$\s\.\*_]))/mg,
	element: "del",
	handler: config.formatterHelpers.singleCharFormat
},

{
	name: "socialtextMonoSpaced",
	match: "`(?![\\s`])",
	lookaheadRegExp: /`(?!\s)(?:.*?)(?!\s)`(?=[$\s\.\*\-_])/mg,
	termRegExp: /((?!\s)`(?=[$\s\.\*\-_]))/mg,
	element: "tt",
	handler: config.formatterHelpers.singleCharFormat
},

{
	name: "socialtextParagraph",
	match: "\\n{2,}",
	handler: function(w)
	{
		createTiddlyElement(w.output,"p");
	}
},

{
	name: "socialtextLineBreak",
	match: "\\n",
	handler: function(w)
	{
		createTiddlyElement(w.output,"br");
	}
},

{
	name: "socialtextNoWiki",
	match: "\\{\\{",
	lookaheadRegExp: /\{\{((?:.|\n)*?)\}\}/mg,
	element: "span",
	handler: config.formatterHelpers.enclosedTextHelper
},

{
	name: "socialtextTrademark",
	match: "\\{tm\\}",
	handler: function(w)
	{
		createTiddlyElement(w.output,"span").innerHTML = "&trade;";
	}
},

{
	name: "socialtextWafl",
	match: "\\{(?:[a-z]{2,16}): ?.*?\\}",
	lookaheadRegExp: /\{([a-z]{2,16}): ?(.*?)\}/mg,
	handler: socialtextFormatter.wafl
},

{
	name: "socialtextPresence",
	match: "(?:aim|yahoo|ymsgr|skype|callto|asap):\\w+",
	lookaheadRegExp: /(aim|yahoo|ymsgr|skype|callto|asap):(\w+)/mg,
	handler: socialtextFormatter.presence
},

{
	name: "socialtextMailTo",
	match: "[\\w\.]+@[\\w]+\.[\\w\.]+",
	lookaheadRegExp: /([\w\.]+@[\w]+\.[\w\.]+)/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var text = lookaheadMatch[1];
			createTiddlyText(createExternalLink(w.output,"mailto:"+text),text);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "socialtextHtmlEntitiesEncoding",
	match: "&#?[a-zA-Z0-9]{2,8};",
	handler: function(w)
	{
		createTiddlyElement(w.output,"span").innerHTML = w.matchText;
	}
}
];

config.parsers.socialTextFormatter = new Formatter(config.socialTextFormatters);
config.parsers.socialTextFormatter.formatTag = "SocialtextFormat";
} // end of "install only once"
//}}}
// ---------------------------------------------------------------------------------
// End of scripts
// ---------------------------------------------------------------------------------
//]]>
</script>
<style type="text/css">

#saveTest {
	display: none;
}

.zoomer {
	display: none;
}

#messageArea {
	display: none;
}

#copyright {
	display: none;
}

.popup {
	position: absolute;
}

#storeArea {
	display: none;
	margin: 4em 10em 3em;
}

#storeArea div {
 padding: 0.5em;
 margin: 1em 0em 0em 0em;
 border-color: #f0f0f0 #606060 #404040 #d0d0d0; 
 border-style: solid; 
 border-width: 2px;
 overflow: auto;
}

#shadowArea {display: none;}

#javascriptWarning {
	width: 100%;
	text-align: center;
	font-weight: bold;
	background-color: #dd1100;
	color: #fff;
	padding:1em 0em; 
}

</style>
<!--POST-HEAD-START-->

<!--POST-HEAD-END-->
</head>
<body onload="main();" onunload="if(window.checkUnsavedChanges) checkUnsavedChanges();">
<!--PRE-BODY-START-->

<!--PRE-BODY-END-->
<script type="text/javascript">
//<![CDATA[
if (useJavaSaver)
	document.write("<applet style='position:absolute;left:-1px' name='TiddlySaver' code='TiddlySaver.class' archive='TiddlySaver.jar' width='1' height='1'></applet>");
//]]>
</script>
<div id="copyright">
Welcome to TiddlyWiki by Jeremy Ruston, Copyright &copy; 2006 Osmosoft Limited
</div>
<noscript>
	<div id="javascriptWarning">This page requires JavaScript to function properly.<br><br>If you are using Microsoft Internet Explorer you may need to click on the yellow bar above and select 'Allow Blocked Content'. You must then click 'Yes' on the following security warning.</div>
</noscript>
<div id="saveTest"></div>
<div id="backstageCloak"></div>
<div id="backstage">
	<div id="backstageTabs"></div>
	<div id="backstagePanel"></div>
</div>
<div id="contentWrapper"></div>
<div id="contentStash"></div>
<div id="shadowArea">
<div tiddler="ColorPalette">Background: #fff\nForeground: #000\nPrimaryPale: #8cf\nPrimaryLight: #18f\nPrimaryMid: #04b\nPrimaryDark: #014\nSecondaryPale: #ffc\nSecondaryLight: #fe8\nSecondaryMid: #db4\nSecondaryDark: #841\nTertiaryPale: #eee\nTertiaryLight: #ccc\nTertiaryMid: #999\nTertiaryDark: #666\nError: #f88\n</div>
<div tiddler="StyleSheetColors">/*{{{*/\nbody {\n	background: [[ColorPalette::Background]];\n	color: [[ColorPalette::Foreground]];\n}\n\na{\n	color: [[ColorPalette::PrimaryMid]];\n}\n\na:hover{\n	background-color: [[ColorPalette::PrimaryMid]];\n	color: [[ColorPalette::Background]];\n}\n\na img{\n	border: 0;\n}\n\nh1,h2,h3,h4,h5 {\n	color: [[ColorPalette::SecondaryDark]];\n	background: [[ColorPalette::PrimaryPale]];\n}\n\n.button {\n	color: [[ColorPalette::PrimaryDark]];\n	border: 1px solid [[ColorPalette::Background]];\n}\n\n.button:hover {\n	color: [[ColorPalette::PrimaryDark]];\n	background: [[ColorPalette::SecondaryLight]];\n	border-color: [[ColorPalette::SecondaryMid]];\n}\n\n.button:active {\n	color: [[ColorPalette::Background]];\n	background: [[ColorPalette::SecondaryMid]];\n	border: 1px solid [[ColorPalette::SecondaryDark]];\n}\n\n.header {\n	background: [[ColorPalette::PrimaryMid]];\n}\n\n.headerShadow {\n	color: [[ColorPalette::Foreground]];\n}\n\n.headerShadow a {\n	font-weight: normal;\n	color: [[ColorPalette::Foreground]];\n}\n\n.headerForeground {\n	color: [[ColorPalette::Background]];\n}\n\n.headerForeground a {\n	font-weight: normal;\n	color: [[ColorPalette::PrimaryPale]];\n}\n\n.tabSelected{\n	color: [[ColorPalette::PrimaryDark]];\n	background: [[ColorPalette::TertiaryPale]];\n	border-left: 1px solid [[ColorPalette::TertiaryLight]];\n	border-top: 1px solid [[ColorPalette::TertiaryLight]];\n	border-right: 1px solid [[ColorPalette::TertiaryLight]];\n}\n\n.tabUnselected {\n	color: [[ColorPalette::Background]];\n	background: [[ColorPalette::TertiaryMid]];\n}\n\n.tabContents {\n	color: [[ColorPalette::PrimaryDark]];\n	background: [[ColorPalette::TertiaryPale]];\n	border: 1px solid [[ColorPalette::TertiaryLight]];\n}\n\n.tabContents .button {\n	 border: 0;}\n\n#sidebar {\n}\n\n#sidebarOptions input {\n	border: 1px solid [[ColorPalette::PrimaryMid]];\n}\n\n#sidebarOptions .sliderPanel {\n	background: [[ColorPalette::PrimaryPale]];\n}\n\n#sidebarOptions .sliderPanel a {\n	border: none;\n	color: [[ColorPalette::PrimaryMid]];\n}\n\n#sidebarOptions .sliderPanel a:hover {\n	color: [[ColorPalette::Background]];\n	background: [[ColorPalette::PrimaryMid]];\n}\n\n#sidebarOptions .sliderPanel a:active {\n	color: [[ColorPalette::PrimaryMid]];\n	background: [[ColorPalette::Background]];\n}\n\n.wizard {\n	background: [[ColorPalette::TertiaryLight]];\n	border-top: 1px solid [[ColorPalette::TertiaryMid]];\n	border-left: 1px solid [[ColorPalette::TertiaryMid]];\n}\n\n.wizard h1 {\n	color: [[ColorPalette::TertiaryDark]];\n}\n\n.wizard h2 {\n	color: [[ColorPalette::Foreground]];\n}\n\n.wizardStep {\n	background: [[ColorPalette::Background]];\n	border-top: 1px solid [[ColorPalette::TertiaryMid]];\n	border-bottom: 1px solid [[ColorPalette::TertiaryMid]];\n	border-left: 1px solid [[ColorPalette::TertiaryMid]];\n}\n\n.wizard .button {\n	color: [[ColorPalette::Background]];\n	background: [[ColorPalette::PrimaryMid]];\n	border-top: 1px solid [[ColorPalette::PrimaryLight]];\n	border-right: 1px solid [[ColorPalette::PrimaryDark]];\n	border-bottom: 1px solid [[ColorPalette::PrimaryDark]];\n	border-left: 1px solid [[ColorPalette::PrimaryLight]];\n}\n\n.wizard .button:hover {\n	color: [[ColorPalette::PrimaryLight]];\n	background: [[ColorPalette::PrimaryDark]];\n	border-color: [[ColorPalette::PrimaryLight]];\n}\n\n.wizard .button:active {\n	color: [[ColorPalette::Background]];\n	background: [[ColorPalette::PrimaryMid]];\n	border-top: 1px solid [[ColorPalette::PrimaryLight]];\n	border-right: 1px solid [[ColorPalette::PrimaryDark]];\n	border-bottom: 1px solid [[ColorPalette::PrimaryDark]];\n	border-left: 1px solid [[ColorPalette::PrimaryLight]];\n}\n\n#messageArea {\n	border: 1px solid [[ColorPalette::SecondaryDark]];\n	background: [[ColorPalette::SecondaryMid]];\n	color: [[ColorPalette::PrimaryDark]];\n}\n\n#messageArea .button {\n	padding: 0.2em 0.2em 0.2em 0.2em;\n	color: [[ColorPalette::PrimaryDark]];\n	background: [[ColorPalette::Background]];\n}\n\n.popup {\n	background: [[ColorPalette::PrimaryLight]];\n	border: 1px solid [[ColorPalette::PrimaryMid]];\n}\n\n.popup hr {\n	color: [[ColorPalette::PrimaryDark]];\n	background: [[ColorPalette::PrimaryDark]];\n	border-bottom: 1px;\n}\n\n.listBreak div{\n	border-bottom: 1px solid [[ColorPalette::PrimaryDark]];\n}\n\n.popup li.disabled {\n	color: [[ColorPalette::PrimaryMid]];\n}\n\n.popup li a, .popup li a:visited {\n	color: [[ColorPalette::TertiaryPale]];\n	border: none;\n}\n\n.popup li a:hover {\n	background: [[ColorPalette::PrimaryDark]];\n	color: [[ColorPalette::Background]];\n	border: none;\n}\n\n.tiddler .defaultCommand {\n font-weight: bold;\n}\n\n.shadow .title {\n	color: [[ColorPalette::TertiaryDark]];\n}\n\n.title {\n	color: [[ColorPalette::SecondaryDark]];\n}\n\n.subtitle {\n	color: [[ColorPalette::TertiaryDark]];\n}\n\n.toolbar {\n	color: [[ColorPalette::PrimaryMid]];\n}\n\n.tagging, .tagged {\n	border: 1px solid [[ColorPalette::TertiaryPale]];\n	background-color: [[ColorPalette::TertiaryPale]];\n}\n\n.selected .tagging, .selected .tagged {\n	background-color: [[ColorPalette::TertiaryLight]];\n	border: 1px solid [[ColorPalette::TertiaryMid]];\n}\n\n.tagging .listTitle, .tagged .listTitle {\n	color: [[ColorPalette::PrimaryDark]];\n}\n\n.tagging .button, .tagged .button {\n		border: none;\n}\n\n.footer {\n	color: [[ColorPalette::TertiaryLight]];\n}\n\n.selected .footer {\n	color: [[ColorPalette::TertiaryMid]];\n}\n\n.sparkline {\n	background: [[ColorPalette::PrimaryPale]];\n	border: 0;\n}\n\n.sparktick {\n	background: [[ColorPalette::PrimaryDark]];\n}\n\n.error, .errorButton {\n	color: [[ColorPalette::Foreground]];\n	background: [[ColorPalette::Error]];\n}\n\n.warning {\n	color: [[ColorPalette::Foreground]];\n	background: [[ColorPalette::SecondaryPale]];\n}\n\n.cascade {\n	background: [[ColorPalette::TertiaryPale]];\n	color: [[ColorPalette::TertiaryMid]];\n	border: 1px solid [[ColorPalette::TertiaryMid]];\n}\n\n.imageLink, #displayArea .imageLink {\n	background: transparent;\n}\n\n.viewer .listTitle {list-style-type: none; margin-left: -2em;}\n\n.viewer .button {\n	border: 1px solid [[ColorPalette::SecondaryMid]];\n}\n\n.viewer blockquote {\n	border-left: 3px solid [[ColorPalette::TertiaryDark]];\n}\n\ntable {\n	border: 2px solid [[ColorPalette::TertiaryDark]];\n}\n\nth, thead td {\n	background: [[ColorPalette::SecondaryMid]];\n	border: 1px solid [[ColorPalette::TertiaryDark]];\n	color: [[ColorPalette::Background]];\n}\n\ntd, tr {\n	border: 1px solid [[ColorPalette::TertiaryDark]];\n}\n\n.viewer pre {\n	border: 1px solid [[ColorPalette::SecondaryLight]];\n	background: [[ColorPalette::SecondaryPale]];\n}\n\n.viewer code {\n	color: [[ColorPalette::SecondaryDark]];\n}\n\n.viewer hr {\n	border: 0;\n	border-top: dashed 1px [[ColorPalette::TertiaryDark]];\n	color: [[ColorPalette::TertiaryDark]];\n}\n\n.highlight, .marked {\n	background: [[ColorPalette::SecondaryLight]];\n}\n\n.editor input {\n	border: 1px solid [[ColorPalette::PrimaryMid]];\n}\n\n.editor textarea {\n	border: 1px solid [[ColorPalette::PrimaryMid]];\n	width: 100%;\n}\n\n.editorFooter {\n	color: [[ColorPalette::TertiaryMid]];\n}\n\n.backstageSelTab {\n	background: [[ColorPalette::Foreground]];\n	color: [[ColorPalette::Background]];\n}\n\n#backstagePanel .wizardStep {\n	background: [[ColorPalette::Foreground]];\n}\n\n#backstagePanel .wizardFooter {\n	background: [[ColorPalette::TertiaryLight]];\n	border-right: 1px solid [[ColorPalette::TertiaryMid]];\n	border-bottom: 1px solid [[ColorPalette::TertiaryMid]];\n	border-left: 1px solid [[ColorPalette::TertiaryMid]];\n}\n\n#backstagePanel .wizardFooter a {	color: [[ColorPalette::Background]];\n	background-color: [[ColorPalette::TertiaryDark]];}\n\n#backstagePanel .wizardFooter a:hover {\n}\n\n#backstagePanel {\n	background:	[[ColorPalette::Foreground]];\n	color: [[ColorPalette::Background]];\n}\n\n#backstagePanel a {\n	color: [[ColorPalette::PrimaryPale]];\n}\n\n#backstagePanel a:hover {\n	background-color: [[ColorPalette::Background]];\n	color: [[ColorPalette::PrimaryMid]];\n}\n\n#backstagePanel table {\n	border: 2px solid [[ColorPalette::TertiaryMid]];\n}\n\n#backstagePanel th, #backstagePanel thead td {\n	background: [[ColorPalette::TertiaryDark]];\n	border: 1px solid [[ColorPalette::TertiaryMid]];\n	color: [[ColorPalette::Background]];\n}\n\n#backstagePanel td, #backstagePanel tr {\n	background: [[ColorPalette::Foreground]];\n	border: 1px solid [[ColorPalette::TertiaryMid]];\n}\n\n#backstageCloak {\n	background: [[ColorPalette::Background]];\n	opacity: 0.5;\n	filter:'alpha(opacity:50)';\n}\n\n/*}}}*/\n</div>
<div tiddler="StyleSheetLayout">/*{{{*/\n* html .tiddler {\n    height: 1%;\n}\n\nbody {\n	font-size: .75em;\n	font-family: arial,helvetica;\n	margin: 0;\n	padding: 0;\n}\n\nh1,h2,h3,h4,h5 {\n	font-weight: bold;\n	text-decoration: none;\n	padding-left: 0.4em;\n}\n\nh1 {font-size: 1.35em;}\nh2 {font-size: 1.25em;}\nh3 {font-size: 1.1em;}\nh4 {font-size: 1em;}\nh5 {font-size: .9em;}\n\nhr {\n	height: 1px;\n}\n\na{\n	text-decoration: none;\n}\n\ndt {font-weight: bold;}\n\nol { list-style-type: decimal }\nol ol { list-style-type: lower-alpha }\nol ol ol { list-style-type: lower-roman }\nol ol ol ol { list-style-type: decimal }\nol ol ol ol ol { list-style-type: lower-alpha }\nol ol ol ol ol ol { list-style-type: lower-roman }\nol ol ol ol ol ol ol { list-style-type: decimal }\n\n.txtOptionInput {\n	width: 11em;\n}\n\n#contentWrapper .chkOptionInput {\n	border: 0;\n}\n\n.externalLink {\n	text-decoration: underline;\n}\n\n.indent {margin-left:3em;}\n.outdent {margin-left:3em; text-indent:-3em;}\ncode.escaped {white-space:nowrap;}\n\n.tiddlyLinkExisting {\n	font-weight: bold;\n}\n\n.tiddlyLinkNonExisting {\n	font-style: italic;\n}\n\n/* the 'a' is required for IE, otherwise it renders the whole tiddler a bold */\na.tiddlyLinkNonExisting.shadow {\n	font-weight: bold;\n}\n\n#mainMenu .tiddlyLinkExisting, \n#mainMenu .tiddlyLinkNonExisting,\n#sidebarTabs .tiddlyLinkNonExisting{\n font-weight: normal;\n font-style: normal;\n}\n\n#sidebarTabs .tiddlyLinkExisting {\n font-weight: bold;\n font-style: normal;\n}\n\n.header {\n		position: relative;\n}\n\n.header a:hover {\n	background: transparent;\n}\n\n.headerShadow {\n	position: relative;\n	padding: 4.5em 0em 1em 1em;\n	left: -1px;\n	top: -1px;\n}\n\n.headerForeground {\n	position: absolute;\n	padding: 4.5em 0em 1em 1em;\n	left: 0px;\n	top: 0px;\n}\n\n.siteTitle {\n	font-size: 3em;\n}\n\n.siteSubtitle {\n	font-size: 1.2em;\n}\n\n#mainMenu {\n	position: absolute;\n	left: 0;\n	width: 10em;\n	text-align: right;\n	line-height: 1.6em;\n	padding: 1.5em 0.5em 0.5em 0.5em;\n	font-size: 1.1em;\n}\n\n#sidebar {\n	position: absolute;\n	right: 3px;\n	width: 16em;\n	font-size: .9em;\n}\n\n#sidebarOptions {\n	padding-top: 0.3em;\n}\n\n#sidebarOptions a {\n	margin: 0em 0.2em;\n	padding: 0.2em 0.3em;\n	display: block;\n}\n\n#sidebarOptions input {\n	margin: 0.4em 0.5em;\n}\n\n#sidebarOptions .sliderPanel {\n	margin-left: 1em;\n	padding: 0.5em;\n	font-size: .85em;\n}\n\n#sidebarOptions .sliderPanel a {\n	font-weight: bold;\n	display: inline;\n	padding: 0;\n}\n\n#sidebarOptions .sliderPanel input {\n	margin: 0 0 .3em 0;\n}\n\n#sidebarTabs .tabContents {\n	width: 15em;\n	overflow: hidden;\n}\n\n.wizard {\n	padding: 0.1em 0em 0em 2em;\n}\n\n.wizard h1 {\n	font-size: 2em;\n	font-weight: bold;\n	background: none;\n	padding: 0em 0em 0em 0em;\n	margin: 0.4em 0em 0.2em 0em;\n}\n\n.wizard h2 {\n	font-size: 1.2em;\n	font-weight: bold;\n	background: none;\n	padding: 0em 0em 0em 0em;\n	margin: 0.2em 0em 0.2em 0em;\n}\n\n.wizardStep {\n	padding: 1em 1em 1em 1em;\n}\n\n.wizard .button {\n	margin: 0.5em 0em 0em 0em;\n	font-size: 1.2em;\n}\n\n#messageArea {\nposition:absolute; top:2em; right:0; margin: 0.5em; padding: 0.5em;\n}\n\n*[id='messageArea'] {\nposition:fixed !important; z-index:99;}\n\n.messageToolbar {\ndisplay: block;\ntext-align: right;\n}\n\n#messageArea a{\n	text-decoration: underline;\n}\n\n.popup {\n	z-index: 100;\n	font-size: .9em;\n	padding: 0.2em;\n	list-style: none;\n	margin: 0;\n}\n\n.popup hr {\n	display: block;\n	height: 1px;\n	width: auto;\n	padding: 0;\n	margin: 0.2em 0em;\n}\n\n.listBreak {\n	font-size: 1px;\n	line-height: 1px;\n}\n\n.listBreak div {\n	margin: 2px 0;\n}\n\n.popup li.disabled {\n	padding: 0.2em;\n}\n\n.popup li a{\n	display: block;\n	padding: 0.2em;\n}\n\n.tabset {\n	padding: 1em 0em 0em 0.5em;\n}\n\n.tab {\n	margin: 0em 0em 0em 0.25em;\n	padding: 2px;\n}\n\n.tabContents {\n	padding: 0.5em;\n}\n\n.tabContents ul, .tabContents ol {\n	margin: 0;\n	padding: 0;\n}\n\n.txtMainTab .tabContents li {\n	list-style: none;\n}\n\n.tabContents li.listLink {\n	 margin-left: .75em;\n}\n\n#displayArea {\n	margin: 1em 17em 0em 14em;\n}\n\n\n.toolbar {\n	text-align: right;\n	font-size: .9em;\n	visibility: hidden;\n}\n\n.selected .toolbar {\n	visibility: visible;\n}\n\n.tiddler {\n	padding: 1em 1em 0em 1em;\n}\n\n.missing .viewer,.missing .title {\n	font-style: italic;\n}\n\n.title {\n	font-size: 1.6em;\n	font-weight: bold;\n}\n\n.missing .subtitle {\n display: none;\n}\n\n.subtitle {\n	font-size: 1.1em;\n}\n\n.tiddler .button {\n	padding: 0.2em 0.4em;\n}\n\n.tagging {\nmargin: 0.5em 0.5em 0.5em 0;\nfloat: left;\ndisplay: none;\n}\n\n.isTag .tagging {\ndisplay: block;\n}\n\n.tagged {\nmargin: 0.5em;\nfloat: right;\n}\n\n.tagging, .tagged {\nfont-size: 0.9em;\npadding: 0.25em;\n}\n\n.tagging ul, .tagged ul {\nlist-style: none;margin: 0.25em;\npadding: 0;\n}\n\n.tagClear {\nclear: both;\n}\n\n.footer {\n	font-size: .9em;\n}\n\n.footer li {\ndisplay: inline;\n}\n\n* html .viewer pre {\n	width: 99%;\n	padding: 0 0 1em 0;\n}\n\n.viewer {\n	line-height: 1.4em;\n	padding-top: 0.5em;\n}\n\n.viewer .button {\n	margin: 0em 0.25em;\n	padding: 0em 0.25em;\n}\n\n.viewer blockquote {\n	line-height: 1.5em;\n	padding-left: 0.8em;\n	margin-left: 2.5em;\n}\n\n.viewer ul, .viewer ol{\n	margin-left: 0.5em;\n	padding-left: 1.5em;\n}\n\ntable {\n	border-collapse: collapse;\n	margin: 0.8em 1.0em;\n}\n\n.viewer th, .viewer td, .viewer tr,.viewer caption{\n	padding: 3px;\n}\n\ntable.listView {\n	font-size: 0.85em;\n	margin: 0.8em 1.0em;\n}\n\ntable.listView th, table.listView td, table.listView tr {\n	padding: 0px 3px 0px 3px;\n}\n\n.viewer pre {\n	padding: 0.5em;\n	margin-left: 0.5em;\n	font-size: 1.2em;\n	line-height: 1.4em;\n	overflow: auto;\n}\n\n.viewer code {\n	font-size: 1.2em;\n	line-height: 1.4em;\n}\n\n.editor {\nfont-size: 1.1em;\n}\n\n.editor input, .editor textarea {\n	display: block;\n	width: 100%;\n	font: inherit;\n}\n\n.editorFooter {\n	padding: 0.25em 0em;\n	font-size: .9em;\n}\n\n.editorFooter .button {\npadding-top: 0px; padding-bottom: 0px;}\n\n.fieldsetFix {border: 0;\npadding: 0;\nmargin: 1px 0px 1px 0px;\n}\n\n.sparkline {\n	line-height: 1em;\n}\n\n.sparktick {\n	outline: 0;\n}\n\n.zoomer {\n	font-size: 1.1em;\n	position: absolute;\n	padding: 1em;\n}\n\n.cascade {\n	font-size: 1.1em;\n	position: absolute;\n	overflow: hidden;\n}\n\n#backstage {\n	position: absolute;\n	z-index: 100;\n	width: 100%;\n}\n\n#backstageTabs {\n	visibility: hidden;\n	position: relative;\n	margin: 0.5em 3em 0.2em 3em;\n	font-size: 1.1em;\n	background: none;\n	text-align: right;\n}\n\n#backstageTabs a {\n	font-weight: bold;\n	padding: 0.2em 0.5em 0.2em 0.5em;\n}\n\n#backstagePanel {\n	display: none;\n	position: relative;\n	margin: 0em 3em 0em 3em;\n	padding: 1em 1em 1em 1em;\n}\n\n#backstagePanel .wizardFooter {	padding: 0.4em 0.4em 0.4em 2em;\n	text-align: right;\n}\n\n#backstagePanel .wizardFooter a {	padding: 0.2em 0.2em 0.2em 0.2em;\n}\n\n#backstagePanel .wizardFooter a:hover {\n}\n\n#backstageCloak {\n	display: none;\n	z-index: 50;\n	position: absolute;\n	width: 100%;\n	height: 100px;\n}\n\n/*}}}*/</div>
<div tiddler="StyleSheetPrint">/*{{{*/\n@media print {\n#mainMenu, #sidebar, #messageArea, .toolbar {display: none ! important;}\n#displayArea {margin: 1em 1em 0em 1em;}\n/* Fixes a feature in Firefox 1.5.0.2 where print preview displays the noscript content */\nnoscript {display:none;}\n}\n/*}}}*/</div>
<div tiddler="PageTemplate">&lt;!--{{{--&gt;\n&lt;div class='header' macro='gradient vert [[ColorPalette::PrimaryLight]] [[ColorPalette::PrimaryMid]]'&gt;\n&lt;div class='headerShadow'&gt;\n&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;\n&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;\n&lt;/div&gt;\n&lt;div class='headerForeground'&gt;\n&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;\n&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;\n&lt;/div&gt;\n&lt;/div&gt;\n&lt;div id='mainMenu' refresh='content' tiddler='MainMenu'&gt;&lt;/div&gt;\n&lt;div id='sidebar'&gt;\n&lt;div id='sidebarOptions' refresh='content' tiddler='SideBarOptions'&gt;&lt;/div&gt;\n&lt;div id='sidebarTabs' refresh='content' force='true' tiddler='SideBarTabs'&gt;&lt;/div&gt;\n&lt;/div&gt;\n&lt;div id='displayArea'&gt;\n&lt;div id='messageArea'&gt;&lt;/div&gt;\n&lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;\n&lt;/div&gt;\n&lt;!--}}}--&gt;</div>
<div tiddler="ViewTemplate">&lt;!--{{{--&gt;\n&lt;div class='toolbar' macro='toolbar closeTiddler closeOthers +editTiddler permalink references jump'&gt;&lt;/div&gt;\n&lt;div class='title' macro='view title'&gt;&lt;/div&gt;\n&lt;div class='subtitle'&gt;&lt;span macro='view modifier link'&gt;&lt;/span&gt;, &lt;span macro='view modified date [[DD MMM YYYY]]'&gt;&lt;/span&gt; (&lt;span macro='message views.wikified.createdPrompt'&gt;&lt;/span&gt; &lt;span macro='view created date [[DD MMM YYYY]]'&gt;&lt;/span&gt;)&lt;/div&gt;\n&lt;div class='tagging' macro='tagging'&gt;&lt;/div&gt;\n&lt;div class='tagged' macro='tags'&gt;&lt;/div&gt;\n&lt;div class='viewer' macro='view text wikified'&gt;&lt;/div&gt;\n&lt;div class='tagClear'&gt;&lt;/div&gt;\n&lt;!--}}}--&gt;</div>
<div tiddler="EditTemplate">&lt;!--{{{--&gt;\n&lt;div class='toolbar' macro='toolbar +saveTiddler -cancelTiddler deleteTiddler'&gt;&lt;/div&gt;\n&lt;div class='title' macro='view title'&gt;&lt;/div&gt;\n&lt;div class='editor' macro='edit title'&gt;&lt;/div&gt;\n&lt;div class='editor' macro='edit text'&gt;&lt;/div&gt;\n&lt;div class='editor' macro='edit tags'&gt;&lt;/div&gt;&lt;div class='editorFooter'&gt;&lt;span macro='message views.editor.tagPrompt'&gt;&lt;/span&gt;&lt;span macro='tagChooser'&gt;&lt;/span&gt;&lt;/div&gt;\n&lt;!--}}}--&gt;</div>
<div tiddler="GettingStarted">To get started with this blank TiddlyWiki, you'll need to modify the following tiddlers:\n* SiteTitle &amp; SiteSubtitle: The title and subtitle of the site, as shown above (after saving, they will also appear in the browser title bar)\n* MainMenu: The menu (usually on the left)\n* DefaultTiddlers: Contains the names of the tiddlers that you want to appear when the TiddlyWiki is opened\nYou'll also need to enter your username for signing your edits: &lt;&lt;option txtUserName&gt;&gt;</div>
<div tiddler="OptionsPanel">These InterfaceOptions for customising TiddlyWiki are saved in your browser\n\nYour username for signing your edits. Write it as a WikiWord (eg JoeBloggs)\n\n&lt;&lt;option txtUserName&gt;&gt;\n&lt;&lt;option chkSaveBackups&gt;&gt; SaveBackups\n&lt;&lt;option chkAutoSave&gt;&gt; AutoSave\n&lt;&lt;option chkRegExpSearch&gt;&gt; RegExpSearch\n&lt;&lt;option chkCaseSensitiveSearch&gt;&gt; CaseSensitiveSearch\n&lt;&lt;option chkAnimate&gt;&gt; EnableAnimations\n\n----\nAdvancedOptions\nPluginManager\nImportTiddlers</div>
<div tiddler="AdvancedOptions">&lt;&lt;option chkGenerateAnRssFeed&gt;&gt; GenerateAnRssFeed\n&lt;&lt;option chkOpenInNewWindow&gt;&gt; OpenLinksInNewWindow\n&lt;&lt;option chkSaveEmptyTemplate&gt;&gt; SaveEmptyTemplate\n&lt;&lt;option chkToggleLinks&gt;&gt; Clicking on links to tiddlers that are already open causes them to close\n^^(override with Control or other modifier key)^^\n&lt;&lt;option chkHttpReadOnly&gt;&gt; HideEditingFeatures when viewed over HTTP\n&lt;&lt;option chkForceMinorUpdate&gt;&gt; Treat edits as MinorChanges by preserving date and time\n^^(override with Shift key when clicking 'done' or by pressing Ctrl-Shift-Enter^^\n&lt;&lt;option chkConfirmDelete&gt;&gt; ConfirmBeforeDeleting\nMaximum number of lines in a tiddler edit box: &lt;&lt;option txtMaxEditRows&gt;&gt;\nFolder name for backup files: &lt;&lt;option txtBackupFolder&gt;&gt;\n&lt;&lt;option chkInsertTabs&gt;&gt; Use tab key to insert tab characters instead of jumping to next field</div>
</div>
<div id="storeArea">
<div tiddler="API 2007-01-29" modifier="zac.bir@socialtext.com" modified="200701311349" created="200701300500" tags="[[api slope blog]] SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="api_2007_01_29" socialtext.version="20070131134901">\n^ Done\n\n* got stalled out on rtf tests\n* zac saved christmas\n* revised ip agreement\n\n^ To Do\n\nThings pending to do, but not necessarily today, trim to today/not today.\n\n^^ Sooner\n\n* -migrate branches (enumurate)-\n** -api (cdent)-\n** -pdf...export (cdent)- recreated as pdf-rtf-export\n* unplugged planning with pedina (cdent), postponed\n* draft letter to lawyers explaining changes (mml)\n* TPS cover sheets (zbir)\n\n^^ Later\n\n* rtf gif handling\n* pair with ingy on HTML cleanup from formatter (cdent friday)\n* rtf tests (mml and cdent on tuesday, perhaps wednesday)\n* -3 remaining pluggable-auth tickets (zbir)-\n* pluggable-auth docs (sysadmin and hacker) (zbir)\n\n^ Notes\n\n* What should we do branchwise down the road? A team work branch with iteration branches, or a project branch setup?\n\n---\nIf prioritization is needed this week amongst the &quot;later&quot; bullets, releasing pluggable auth is higher priority than rtf.\n\n_contributed by {user: adina.levin@socialtext.com} on {date: 2007-01-30 08:29:18 GMT}_\n</div>
<div tiddler="API 2007-01-30" modifier="chris.dent@socialtext.com" modified="200701311942" created="200701310206" tags="[[api slope blog]] SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="api_2007_01_30" socialtext.version="20070131194236">\n^ Notes\n\n(for sake of slope)\n\n* merged the branches (api and pdf-rtf-export) over to the new [open repository]\n* cdent has uncommitted code that implements handling of gifs in rtf using Imager, commit pending discussion relative merits of Imager and Image::Magick. tests would be good too.\n</div>
<div tiddler="API 2007-01-31" modifier="chris.dent@socialtext.com" modified="200701311942" created="200701311904" tags="SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="api_2007_01_31" socialtext.version="20070131194236">\n\n^ Done\n\n* closed the remaining pluggable auth tickets (zbir and mml)\n* TPS reports (almost!)\n* Support for GIFs in RTF export (needs to commit, needs tests, cdent)\n* update project board\n\n^ Do\n\n* finish gif in rtf (cdent)\n* rtf tests (mml)\n* unplugged meeting (cdent, 1:30)\n* auth docs (zbir)\n* tps reports\n\n^ Notes\n\n* We ought to get some &quot;being open&quot; docs out there if/when we have the chance.\n\n{include: [API 2007-01-30]}\n</div>
<div tiddler="API 2007-02-01" modifier="chris.dent@socialtext.com" modified="200702021956" created="200702011857" tags="[[api slope blog]] SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="api_2007_02_01" socialtext.version="20070202195639">^ Done\n\n* RTF tests have made some progress.  Found and worked around a bug in RTF::Parser. (mml)\n* GIF support added to RtfExportPlugin. (cdent)\n* [Pluggable Auth Documentation] written (zbir)\n* Completely redesigned the TPS reports. (zbir, cdent)\n\n^ Do\n\n^^ Now\n\n* Finish RTF tests (mml)\n* Start rudimentary pdf tests (cdent)\n* Pluggable-auth migration script (zbir)\n* Story prep\n\n^^ Later\n\n* HTML Cleanup Ingy Pair friday, (cdent)\n* rtf pdf export release contract, with qa instructions for evaluating output (cdent)\n</div>
<div tiddler="API Iteration: Close Open Loops" modifier="chris.dent@socialtext.com" modified="200702010113" created="200701240015" tags="SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="api_iteration_close_open_loops" socialtext.version="20070201011332">This is an iteration to clean up leftovers from the time before iterations. It is a notepad for the time being which means it is a mess an will change. Do not rely on it. It's possible the existing task lists are too long for one iteration.\n\nTimetable for this iteration is special due to upcoming [wikithon] and other meetings. 8 days, inclusive to February 5th.\nTotal hours: 72 (estimated)\n\n^ Goals\n\n* Finish up loose ends\n* Terminate stray branches\n* Unify task, branch and iteration structures of [API Team]\n\n^ Dates\n\nStarting: 24 January 2007\nEnding: 5 February 2007\n\n^ People\n\n* Chris (28h)\n* Matt (28h)\n* Zac (16h) ?\n\n^ Risks\n\n* Lack of definition could lead to continued distraction so clearly picking, definining and managing stories is important.\n* Administrative overhead at this time is high\n\n^ Tasks\n\n{link Story: REST Release Contract 4}\n\n| *Task* | *Status* | *Owner* | *Estimate* | *Actual* | *Details* |\n| Revert memcache code and tests | done | cdent | 12h | 3h | r15393 (was easier than I feared) |\n| Enumerate the areas that need new or updated documentation | done | mml | 1h | 40m | |\n| Revise release contract | done | cdent | 1h | 15m | |\n| Merge `trunk` up       | done | cdent | 1h | 15m | |\n| Merge `api-rest` down to `api` | done | cdent | 1h | 15m | |\n| Update {link st-rest-docs [REST API]} docs: | done | mml | 4h | 30m | I just transcribed stuff from the release contract and dug through the code a bit.  Went pretty fast. |\n| - New {link st-rest-docs [/data/workspaces/:ws/breadcrumbs]}\n |||*X*|5m||\n| - New {link st-rest-docs [/data/workspaces/:ws/pages/:pname/frontlinks]}\n |||*X*|10m||\n| - New {link st-rest-docs [REST API 0.93 Release Notes]}\n |||*X*|10m||\n| - Update {link st-rest-docs [/data/workspaces/:ws/pages/:pname]}\n-- `PUT text/html`\n-- `PUT application/json` can include tags |||*X*|2m||\n| - Update {link st-rest-docs [/data/workspaces/:ws/attachments]} now includes attachment ids\n |||*X*|3m||\n| Submit contract, respond to QA | started | | 4h | | |\n\n{link Story: Pluggable Auth Release 1}\n\n| *Task* | *Status* | *Owner* | *Estimate* | *Actual* | *Details* |\n| [Pluggable Auth Bugs] | zbir | done | 4h | 2h15m | |\n| Developer HOWTO documentation | | | | | |\n| Sysadmin HOWTO documentation | | | | | |\n| Release contract finalized | | | | | |\n\n{link Story: Prepare Unplugged Stories}\n\n| *Task* | *Owner* | *Estimate* | *Actual* | *Details* |\n| Review and estimate [Socialtext Unplugged Bugs] | | 2h | | |\n| Review, solidify and estimate [Socialtext Unplugged Story Pool] | | 3h | | |\n\n{link Story: RTF PDF Data Handling Release}\n\n| *Task* | *Owner* | *Estimate* | *Actual* | *Details* |\n| Write a 2x2 table test for RTF | | 2h | | |\n| Add support in RTF for GIF | | 4h | 5h | r77 |\n| Write basic PDF parsing test | | 8h | | |\n|\n- Test bold | | 30m | | |\n|\n- Test italics | | 30m | | |\n|\n- Test a 2x2 table | | 2h | | |\n| Remove UI stubs | | 1h | | |\n| Release contract to get code to trunk | | 2h | | |\n\n^ Stories\n\n^^ Story: REST Release Contract 4\n{include [Story: REST Release Contract 4]}\n\n^^ Story: Pluggable Auth Release 1\n{include [Story: Pluggable Auth Release 1]}\n\n^^ Story: Prepare Unplugged Stories}\n{include [Story: Pluggable Auth Release 1]}\n\n^^ Story: RTF PDF Data Handling Release\n{include [Story: RTF PDF Data Handling Release]}\n\n^ Reflection Notes\n\n* Reverting memcached was easier than feared.\n</div>
<div tiddler="Announcements and Links" modifier="falko.ruetten@nexgo.de" modified="200702011243" created="200610291627" tags="SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="announcements_and_links" socialtext.version="20070201124307">*&quot;Download Socialtext Open&quot;&lt;http://sourceforge.net/project/showfiles.php?group_id=170460&gt;* \n*&quot;Download SocialCalc&quot;&lt;http://sourceforge.net/project/showfiles.php?group_id=170460&gt;* \n*&quot;Download Wikiwyg&quot;&lt;http://sourceforge.net/project/showfiles.php?group_id=170460&gt;* \n&quot;Socialtext.com&quot;&lt;http://www.socialtext.com/&gt;\n&quot;Socialtext.com Forums&quot;&lt;http://www.socialtext.com/forum/&gt;\n[Socialtext Community]\n\n----\n\n* [KinoSearch - Benchmarking]\n\n----\n\n&quot;Wikiwyg.net&quot;&lt;http://www.wikiwyg.net/&gt;\n&quot;wikiCalc&quot;&lt;http://www.wikicalc.org/&gt;\n&quot;Socialtext Blog&quot;&lt;http://www.socialtext.com/blog/&gt; (&quot;RSS&quot;&lt;http://www.socialtext.com/blog/feed&gt;)\n\n{fetchrss: &lt;http://www.socialtext.com/blog/feed&gt;}\n\nAttachments for page:\n* {file: pic0005.JPG}\n\n</div>
<div tiddler="BrowseAndEdit" modifier="JeremyRuston" modified="200611081457" created="200611081454" tags="excludeLists excludeSearch">In Socialtext Unplugged, the selected pages of your Socialtext workspace are displayed as individual &quot;tiddlers&quot; on the page. When the mouse passes over a tiddler a short toolbar menu appears at the top right. Use the commands here to manipulate that particular tiddler: notably closing and editting it. (You can double click on a tiddler as a shortcut to directly enter edit mode).\n\nOver on the right hand side of the window are commands that affect the entire page, in particular &quot;close all&quot; which can be useful to clear the decks when many tiddlers are open at once.\n\nThe user is encouraged to ensure that they can SaveChanges before embarking on widespread editing.</div>
<div tiddler="Chicago.pm" modifier="andy.lester@socialtext.com" modified="200702011631" created="200702011631" tags="SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="chicago_pm" socialtext.version="20070201163133">Chicago.pm is the Chicago Perl Mongers. [Andy Lester] is one of the leaders. Static website at &lt;http://chicago.pm.org/&gt;, and Socialtext Open-based wiki at &lt;http://rakudo.org/chicago-pm/&gt;.\n</div>
<div tiddler="Chris Dent, 2007-02-01" modifier="adina.levin@socialtext.com" modified="200702030530" created="200702012212" tags="[[Daily Blog]] [[Daily Dev Blog]] [[Chris Dent Blog]] SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="chris_dent_2007_02_01" socialtext.version="20070203053019">http://static.flickr.com/143/356188825_4eb5346602_m.jpg\nhttp://www.flickr.com/photos/cdent/356188825/\n\n\n\n^ Using Other Programming Languages with Socialtext\n\nIf you had any chance to look around in the Socialtext code you'll have noticed that most of it is written in Perl. Recently it's become possible to go digging around in https://repo.socialtext.net:8999/svn/socialtext/trunk/nlw/lib/Socialtext and see a quite a lot of Perl.\n\nPerl's a fine language for all sorts of stuff, but so are lots of other languages. If some other language is your thing and you want to work with the pages and other data in a Socialtext wiki, there's a growing body of code in https://repo.socialtext.net:8999/svn/socialtext-clients/trunk in other languages. Most of it works with either the [SOAP API] or the [REST API].\n\n^^ SOAP\n\nUnder https://repo.socialtext.net:8999/svn/socialtext-clients/trunk/soap you can find sample SOAP code in \n\n* C++\n* C#\n* Java\n* Perl\n* Python\n* Ruby\n* and a rails setup that uses the SOAP API\n\nMost of that code is simple command line demonstration code, but it could be used as the basis for library code.\n\n^^ REST\n\nThe REST code, found under https://repo.socialtext.net:8999/svn/socialtext-clients/trunk/rest, is a little less diverse but a little more developed (in some cases):\n\n* haskell\n** A very simple test client of the REST API. Rumor has it something much more fancy is percolating.\n* javascript\n** In progress work on creating AJAX widgets for accessing the REST API. Two different approaches to see what works better.\n* Perl\n** [Socialtext::Resting], the most fully fleshed out API client library we have going (thus far).\n** Tools which use `Socialtext::Resting`\n** Other miscellaneous tools\n* Ruby\n** The beginnings of a port of Socialtext::Resting\n** strutty: A suite of tools for using a few different editors on a mac to edit content in a wiki\n\nAll of this stuff is not quite done. If any of it looks useful to you, consider joining next week's [wikithon].\n\n^ WikiChemo\n\nIf we can use the pretty awful metaphor of cancer to describe a wiki that has grown without bounds or purpose, then what functionality would a tool called [WikiChemo] have?\n\n---\n[Incipient link] sweep:\n* Find all incipient links, ordered by frequency of occurance\n* Give user option:\n** Create the page now\n** Enter one sentence summary, perhaps requesting action from someone\n** Make it not a link\n\n_contributed by {user: luke.closs@socialtext.com} on {date: 2007-02-02 01:57:05 GMT}_\n\n---\nGardening incipient links is surely important, but I don't know if it's a good treatment for unbounded purposeless growth.    I'd rather see tools that helped me create bounds and find purpose.  Ways to manage sets of of pages, applying tags whole sale, taking swaths of pages (possibly by tag) and moving them to a new workspace.  Tools to create portal pages, eliminate orphans, and reducing the mean distance between pages.  Tools to take large monolithic pages and break them out into many strongly interconnected pages.  I want tools that make the unwieldily structure organic.  Throw in some magical hand waving (e.g. LSA) and create find natural candidates for islands in the sea of pages and then garden them, interconnect them, find and develop their latent shared language.\n\n_contributed by {user: matthew.oconnor@socialtext.com} on {date: 2007-02-02 04:52:25 GMT}_\n\n---\nI like gardening as a metaphor rather than chemotherapy.  The chemotherapy metaphor assumes that wiki disorganization is a severe and life-threatening state, and if you address it with radical and dramatic treatment it will put the disease into remission.    The gardening metaphor assums that growth is natural, and with regular, non-radical weeding and pruning, the garden can be made more healthy and fruitful.\n\nThe collection of tools is good. The other consideration I have is what incentives help people garden. How to add Tamagotchi-like features that induce people to care for their content?\n\n_contributed by {user: adina.levin@socialtext.com} on {date: 2007-02-02 17:34:57 GMT}_\n\n---\nAdina, yes, gardening is much nicer, but the question was specifically for that case where a wiki has _already_ grown cancerous. Once you've reached that state (and it does sometimes happen) a gardening hoe may be too little too late. It might be time for chemistry. Ideally, of course, one would never get to that state and proper gardening tools and Tamagotchi-like things would be grand.\n\n_contributed by {user: chris.dent@socialtext.com} on {date: 2007-02-02 17:40:28 GMT}_\n\n---\nMolting. Tools that help you find the healthy stuff and move it to a clean new home.\n\n_contributed by {user: adina.levin@socialtext.com} on {date: 2007-02-03 05:30:19 GMT}_\n</div>
<div tiddler="Data Relationships" modifier="andy.lester@socialtext.com" modified="200702011538" created="200702010324" tags="[[Shawn Devlin's Weblog]] SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="data_relationships" socialtext.version="20070201153859">Most PIMs enable you to connect two pieces of information. There is not much to the connection, just a link from one piece of data to another. When I picture this relationship, I picture something like:\n\n{image: rel1.png}\n\nA desktop PIM called InfoCentral was the first app I came across that did more than that when connecting pieces of data. InfoCentral was a real PIM (before &quot;Corel&quot;&lt;http://www.corel.com&gt; got ahold of it, changed it to CorelCentral and then killed it) in that it let you store any piece of information, not just contacts. What InfoCentral did that was innovative was to enable the user to add data to the link that connected two pieces for information. For example, I have an phone extension at Socialtext. That piece of information does not belong to either me or Socialtext. That extension only exists because I have a job at Socialtext. So, in InfoCentral, when you created a link between two pieces of information, you specified what kind of link it was (in this example Job) and then InfoCentral would display a window where you could fill in details specific to a _Job_ link. InfoCentral made it possible to search on both data for the objects in its database as well as on the data contained within the links between the objects. When I visualized that kind of relationship, what I would picture was something like:\n\n{image: rel2.png}\n\nAfter a while I realized that while the power that InfoCentral offered was nice, it was not quite right. The problem is that the _Job_ link was not a link but rather another piece of information. It acted as a connector to other pieces of data but it is data in and of itself. This revelation altered my mental picture again:\n\n{image: rel3.png}\n\nOnce I got there, it was a pretty easy leap to see that any piece of data could be used as a link for other pieces of information. Not only that, but that multiple pieces of data could be used to connect the same other two pieces of date. It stands to reason then that there is meta data in the connecting pieces of data with respect to the other data it connects.\n\n&gt; For example, on our honeymoon my wife and I visited &quot;Castle Nimrod&quot;&lt;http://en.wikipedia.org/wiki/Nimrod_Fortress&gt;. Knowing what the connection is between myself and the castle (my honeymoon) conveys some additional information. Since this was my honeymoon (and I am still married), one can assume that I was there as a tourist and not working there as an archaeologist (although that would be cool). The nature of the connection (honeymoon) conveys additional information about the relationship between Castle Nimrod and myself.\n\nSo what does this have to do with wikis?\n\nWork has started on &quot;sematic wikis&quot;&lt;http://en.wikipedia.org/wiki/Semantic_wiki&gt;. The object is to describe the nature of the link between two topics. This is similar to the InfoCentral approach of attaching information to a link. Incorporating that information when performing searches should help improve the relevance of the search results.\n\nUnfortunately, the need for a sematic wiki lies in the fact that we are not yet able to pull the context for the link from the wiki page itself. The context for the link is already contained within the wiki page; the link would not exist if there was not some relationship between the two pages. The page acts as its own context for the link. Having the context for the link between the data be contained within the data itself is quite powerful. If nothing else, the reader has the full topic to draw inference about the link.\n\nI can appreciate the difficulties in creating software that can extract context from text. It is a difficult problem to solve and if we had it solved the semantic web initiative would not be needed.\n\nSo maybe we turn things around. Perhaps in some instances the context can come not from the page with the link, but the page that is the target of the link. With the originating page one would need to understand what the page is about in order to infer information about the link. Using the target page, one might only need to understand what _kind_ of wiki page it is. For example, the &quot;semantic wikis&quot; link in the paragraph above points to a definition of a semantic wiki. That link could be classified as a _definition_ link based on its target (a &quot;Wikipedia&quot;&lt;http://www.wikipedia.org&gt; entry). If we had a way to classify wiki pages then we could use that to help define the context for a link.\n\nI think there are only a dozen or so classes of wiki pages. I think it is possible to build some simple rules that would enable a computer to determine the class of a wiki page. If we could do that, then we could use that information to describe the nature of the links between pages. And that should help with [gardening] and help to improve the relevance of search results.\n\nMore to come.\n\n---\nI like the idea of the link having some sort of information carried along with it that describes the link.  For instance, when I link to [Rug project] every day in my blog because that's what I'm working on, there's value on the blog posting end, because it lets the reader hop to [Rug project] and see what it's all about.  The problem is that on the [Rug project] page, you see 10 different inbound links that are all noise because they're not really significant.  What if the [Rug project] page could know &quot;I have 12 inbound links, and 10 of them are just passing mentions in a blog post, and I'll hide them from you unless you want to see specifics, and two are meaningful.&quot;\n\nExpanding on this: What if we could aggregate links by type?  What if I could say &quot;I want to see all the 'Working on' links created this week&quot;?  Now we're getting into links being data themselves.\n\nIs a link more or less relevant depending on who created it when?  Does the importance of a link change if it's something I added to your page after the fact, vs. if you'd put it inline in the first place?  Maybe I, as the reader, only want to see links that were your original intention, not the muddy stuff that's been added later, like every date in a Wikipedia article being a hyperlink.  Maybe you only want to see the links that others have added, because it shows you the shortcomings in your linking strategy.\n\n_contributed by {user: andy.lester@socialtext.com} on {date: 2007-02-01 15:38:59 GMT}_\n\nAttachments for page:\n* {file: rel1.png}\n* {file: rel2.png}\n* {file: rel3.png}\n\n</div>
<div tiddler="DisableWikiLinksPlugin" modifier="MartinBudden" modified="200607210000" created="200607210000" tags="systemConfig excludeLists">/***\n|''Name:''|DisableWikiLinksPlugin|\n|''Description:''|Allows you to disable TiddlyWiki's automatic linking of WikiWords|\n|''Source:''|http://martinswiki.com/prereleases.html#DisableWikiLinksPlugin|\n|''Author:''|Martin Budden (mjbudden (at) gmail (dot) com)|\n|''Version:''|0.1.2|\n|''Status:''|beta pre-release|\n|''Date:''|Aug 5, 2006|\n|''Comments:''|Please make comments at http://groups.google.co.uk/group/TiddlyWikiDev|\n|''License:''|[[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|\n|''~CoreVersion:''|2.1.0|\n***/\n\n//{{{\n\n// Ensure that the DisableWikiLinksPlugin is only installed once.\nif(!version.extensions.DisableWikiLinksPlugin) {\nversion.extensions.DisableWikiLinksPlugin = {installed:true};\n\nif(version.major &lt; 2 || (version.major == 2 &amp;&amp; version.minor &lt; 1))\n	{alertAndThrow(&quot;DisableWikiLinksPlugin requires TiddlyWiki 2.1 or newer.&quot;);}\n\nif (config.options.chkDisableWikiLinks==undefined)\n	{config.options.chkDisableWikiLinks = false;}\n\nTiddler.prototype.autoLinkWikiWords = function()\n{\n	if(config.options.chkDisableWikiLinks==true)\n		{return false;}\n	return !this.isTagged(&quot;systemConfig&quot;) &amp;&amp; !this.isTagged(&quot;excludeMissing&quot;);\n};\n\n} // end of &quot;install only once&quot;\n//}}}\n</div>
<div tiddler="Extraclude" modifier="luke.closs@socialtext.com" modified="200702022117" created="200701230414" tags="SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="extraclude" socialtext.version="20070202211743">Extracludes allow you to write a wiki page with the behaviour that certain sections would end up in different pages, and would become included. [wikedit] 0.06 will support extracludes. (This page was created as an extraclude, infact!)\n\n.pre\nBlah blah\n\n.extraclude [Foo Bar]\nThis will be saved to [Foo Bar] and included here\n.extraclude\n\nother text\n.pre\n\nAnd then upon saving it, the backend would create [Foo Bar] and replace the .extraclude block with an include wafl.\n\nSome would say, this should be implemented server side, so it would work from `wikedit` as well as the regular in-browser editor. Others (like Matthew below) say it should be only in the client.\n\nCurrently, extraclude will always overwrite the extracluded page, not append. So be careful.\n\n*Future enhancements:*\n\n* allow extraclude to append to existing pages\n* add a `--pull-includes` option to wikedit, so that included pages will be pulled into extraclude blocks, then pushed back out when the editing is done. This could be useful for people wishing to keep todo lists included in their blog posts *Done*\n\n----\n\nIdeally this *would not* be implemented server side. It's not particularly [Wiki Simple], and having this in the back end would violate separations of concerns. Syntax is not [teh awesome], and more syntax is most certainly not the answer. This is a client side issue, not a server side one. Throwing every random syntax hack into the back end so a few hackers can use vim is just wrong headed. This kind of grossness belongs in the client, clients should be smart and the server dumb. The REST API was designed with this in mind, and indeed it seems to be working well so far. If you want it in both places, then implement it twice.\n\n_contributed by {user: matthew.oconnor@socialtext.com} on {date: 2007-01-23 16:11:17 GMT}_\n\n----\n\nMatthew, I don't get the preference to have extraclude be client side. Another common use for extraclude would be from the web browser. For example, I'm often creating content in a blog post that I'd like to extraclude as a standalone component.\n\n_contributed by {user: adina.levin@socialtext.com} on {date: 2007-01-23 18:22:16 GMT}_\n\n----\n\nThe point is that the backend should be simple, not a conglomeration of things that the frontend wants. If you want to do it in a web browser, then fine, *do it in a web browser* and not on the server.\n\n_contributed by {user: matthew.oconnor@socialtext.com} on {date: 2007-01-24 00:59:48 GMT}_\n</div>
<div tiddler="F2F projects" modifier="andy.lester@socialtext.com" modified="200702021805" created="200702012327" tags="SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="f2f_projects" socialtext.version="20070202180516">^ Appliance / OSR differences.\n\nAndy and Matthew\n\n* Update how tarballs are handled.\n** Move the tarball directory out of `nlw`.\n** Write up the differences between a &quot;module dependency&quot; that's listed in build/*.yaml, and a &quot;module we use in the appliance&quot; that will be listed elsewhere.\n** Move `dev-bin/add-dependency` over to the appliance directory. Update it so that it is read-only on the .yaml files.\n* Update the makefile to make both OSR and Appliance happy.\n** Allow a tarball of nlw/ only\n** Don't build Javascript\n** Don't install/ship appliance-bin for OSR\n\n^ Get Dan/Wikicalc into repo\n\nAndy\n\n* Talk with Dan about opening the kimono, and how he can get on to the stoss train\n* Need to work wikicalc into the new layout\n</div>
<div tiddler="First Post in Anne's SocialText World Weblog" modifier="bwp@gtoal.com" modified="200702022306" created="200702022306" tags="[[Anne's SocialText World Weblog]] SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="first_post_in_anne_s_socialtext_world_weblog" socialtext.version="20070202230652">This is the first post in Anne's SocialText World Weblog. Click *New Post* to add another post.\n</div>
<div tiddler="First Post in CHris Weblog" modifier="chris@lauritz.com" modified="200701310819" created="200701310819" tags="[[CHris Weblog]] SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="first_post_in_chris_weblog" socialtext.version="20070131081954">This is the first post in CHris Weblog. Click *New Post* to add another post.\n</div>
<div tiddler="First Post in Ed Gross Weblog" modifier="paul@mediageekcentral.com" modified="200701302342" created="200701302342" tags="[[Ed Gross Weblog]] SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="first_post_in_ed_gross_weblog" socialtext.version="20070130234216">This is the first post in Ed Gross Weblog. Click *New Post* to add another post.\n</div>
<div tiddler="First Post in JJP's Work Log Weblog" modifier="jon.prettyman@socialtext.com" modified="200702021936" created="200702021932" tags="[[JJP's Work Log Weblog]] SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="first_post_in_jjp_s_work_log_weblog" socialtext.version="20070202193657">So feeling the pressure from an [808Session], I decided to start keeping a work log over here in stoss land.\n\nFor those that don't know who I am, there will be some info on [Jon Prettyman]{{'s}} page.\n\nI'll start working on that profile page after I get back from &quot;Recent Changes Camp&quot;&lt;http://2007.recentchangescamp.org/RecentChangesCamp_2007_--_Portland%2C_Oregon&gt;.  It's a short bike ride from my house, so I'm going to take advantage of the nearness and the sunshine to get a bike ride in :)\n</div>
<div tiddler="First Post in Judy Samuel Weblog" modifier="paul@mediageekcentral.com" modified="200701302342" created="200701302342" tags="[[Judy Samuel Weblog]] SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="first_post_in_judy_samuel_weblog" socialtext.version="20070130234257">This is the first post in Judy Samuel Weblog. Click *New Post* to add another post.\n</div>
<div tiddler="First Post in Matt's Blog" modifier="matt.campbell@metrotech.org" modified="200702011843" created="200702011843" tags="[[Matt's Blog]] SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="first_post_in_matt_s_blog" socialtext.version="20070201184323">This is the first post in Matt's Blog. Click *New Post* to add another post.\n</div>
<div tiddler="First Post in Paul Saunders Weblog" modifier="paul@mediageekcentral.com" modified="200701302343" created="200701302343" tags="[[Paul Saunders Weblog]] SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="first_post_in_paul_saunders_weblog" socialtext.version="20070130234316">This is the first post in Paul Saunders Weblog. Click *New Post* to add another post.\n</div>
<div tiddler="First Post in Sam Test Weblog" modifier="sam@realestateef.org" modified="200702012237" created="200702012237" tags="[[Sam Test Weblog]] SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="first_post_in_sam_test_weblog" socialtext.version="20070201223729">This is the first post in Sam Test Weblog. Click *New Post* to add another post.\n</div>
<div tiddler="First post" modifier="chris@lauritz.com" modified="200701310820" created="200701310820" tags="[[CHris Weblog]] SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="first_post" socialtext.version="20070131082059">First post text\n</div>
<div tiddler="GettingStarted" modifier="JeremyRuston" modified="200611081027" created="200611081014" tags="excludeLists excludeSearch">Welcome to Socialtext Unplugged. This is a specially designed web page that you can use to view and edit your Socialtext content without having to be online to your Socialtext server.\n\nThere are three steps to using Socialtext Unplugged:\n* First, learn how to SaveChanges to your local hard drive. This keeps your work safe even if you close your browser or have to reboot your computer\n* Secondly, find out how to BrowseAndEdit your content while it is unplugged\n* Thirdly, when you can reconnect to your Socialtext server, you can SyncChanges to save your unplugged changes to the server so that other people can see them too\n\nYou should also check your system meets the SystemRequirements.</div>
<div tiddler="Knock knock" modifier="adina.levin@socialtext.com" modified="200702030431" created="200702022307" tags="[[Anne's SocialText World Weblog]] SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="knock_knock" socialtext.version="20070203043155">Hello world!\n\n---\nHi Anne!\n\n_contributed by {user: adina.levin@socialtext.com} on {date: 2007-02-03 04:31:55 GMT}_\n</div>
<div tiddler="Navigation for: Sam Test Weblog" modifier="sam@realestateef.org" modified="200702012238" created="200702012238" tags="SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="navigation_for_sam_test_weblog" socialtext.version="20070201223841">^  Homes Near Philadelphia\n\n^^ asdfasdf\n</div>
<div tiddler="PageTemplate" modifier="JeremyRuston" modified="200611040000" created="200609010000" tags="excludeLists excludeSearch">&lt;div class='header' macro='gradient vert [[ColorPalette::PrimaryLight]] [[ColorPalette::PrimaryMid]]'&gt;\n&lt;div class='headerShadow'&gt;\n&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;\n&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;\n&lt;/div&gt;\n&lt;div class='headerForeground'&gt;\n&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;\n&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;\n&lt;/div&gt;\n&lt;/div&gt;\n&lt;div id='topMenu' refresh='content' tiddler='MainMenu'&gt;&lt;/div&gt;\n&lt;div id='sidebar'&gt;\n&lt;div id='sidebarOptions' refresh='content' tiddler='SideBarOptions'&gt;&lt;/div&gt;\n&lt;div id='sidebarTabs' refresh='content' force='true' tiddler='SideBarTabs'&gt;&lt;/div&gt;\n&lt;/div&gt;\n&lt;div id='displayArea'&gt;\n&lt;div id='messageArea'&gt;&lt;/div&gt;\n&lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;\n\n&lt;div class=&quot;socialtextLogo&quot;&gt;&lt;img src=&quot;http://www.eu.socialtext.net/static/2.3.0.0/images/st/logo/socialtext-logo-152x26.gif&quot; width=152 height=26&gt;&lt;/div&gt;&lt;/div&gt;\n</div>
<div tiddler="Peder Halseide" modifier="halseide@gmail.com" modified="200702040700" created="200702040700" tags="SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="peder_halseide" socialtext.version="20070204070039">update my talk page at http://www.wikiexpert.com/User_talk:Phalseid\n</div>
<div tiddler="Pluggable Auth Bugs" modifier="zac.bir@socialtext.com" modified="200701312006" created="200701261518" tags="SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="pluggable_auth_bugs" socialtext.version="20070131200614">^^ Pluggable Auth: usability feedback {rt 22800}\n\n* -Add a Select/Deselect All checkbox to the results.-\n* -Adjust the whitespace surrounding the Invite button.-\n* -Include a &quot;No matches for SEARCH TERM&quot; message on zero hits.-\n* -For lists longer than 20, include top and bottom Invite buttons-\n\n^^ pluggable-auth: software error on invite user {rt 22969}\n\n-The users guest@socialtext.com and system-user@socialtext.com are returned as viable invitation candidates, but we explicitly disallow granting them roles, so an error is generated. Need to filter these two users from Socialtext::User::Default-&gt;Search-\n\n^^ pluggable-auth: app errors on some searches {rt 22973}\n\n-Some search terms (substrings) generate errors, while others do not. Notably: 'social', 'net', 'd' do not work, while 'text', 'com', 'org', 'v' do.-\n\n^^ pluggable-auth: if search is set, filter is not displayed {rt 22974}\n\n-When we restrict to search and there is a filter in place, we should still display the filter message.-\n\n^^ pluggable-auth: app error on search {rt 22975}\n\n-When searching on a bare &quot;@&quot; for users to invite, an error gets thrown (needs escaping?)-\n\n^^ pluggable-auth: cannot add user to workspace {rt 22976}\n\n-Inviting an existing user, using a case insensitive representation of their email address fails because it tries to create that user (I suspect).-\n\n^^ pluggable-auth: different Standard Welcome Message {rt 22990}\n\n-Standard welcome message that gets displayed on the &quot;Invite New Users&quot; page is incorrect. It displays the &quot;Because you already have a (sic) account...&quot;-\n</div>
<div tiddler="Pluggable Auth Documentation" modifier="zac.bir@socialtext.com" modified="200702011836" created="200702011501" tags="SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="pluggable_auth_documentation" socialtext.version="20070201183631">| Status | *draft* |\n\n{toc}\n\n^^ For Implementors\n\nWe've tried hard to lower the barrier for integrating new user stores. All that's required are a few key methods that you can implement however you wish.\n\n^^^ Minimum interface\n\n^^^^ &quot;Instance&quot; methods\n\nThere are a few methods that are expected to be callable on your instantiated user object:\n\n^^^^^ user_id\n\n&gt; $user-&gt;user_id\n\nReturns the unique id of this user *within your user store.* The Socialtext application maintains its own application-wide unique ids, which will be mapped to a record of your driver_name and your user store's unique id.\n\n^^^^^ username\n\n&gt; $user-&gt;username\n\nReturns the token your user will use to login.\n\n^^^^^ password\n\n&gt; $user-&gt;password\n\nReturns the password your user will use to login.\n\n^^^^^ first_name\n\n&gt; $user-&gt;first_name\n\nReturns the user's first name.\n\n^^^^^ last_name\n\n&gt; $user-&gt;last_name\n\nReturns the user's last name.\n\n^^^^^ email_address\n\n&gt; $user-&gt;email_address\n\nReturns the user's email address.\n\n^^^^^ has_valid_password\n\n&gt; $user-&gt;has_valid_password\n\nThis is a vestigial method from when all users were stored/created in our backend Postgres tables. When new users are created after an invitation gesture, they have an unhashable password and are prompted to set their password upon confirmation. This is one way to check whether the user is incipient or not.\n\n^^^^^ password_is_correct\n\n&gt; $user-&gt;password_is_correct( 'test-password' )\n\nYou can provide the machinery to crypt, hash, or otherwise process a plaintext password (which is passed in) to see if it matches the user's password. \n\n^^^^^ driver_name\n\n&gt; $user-&gt;driver_name\n\nReturn the last part of the package name. This is used to map application-wide user ids back to a particular store.\n\n^^^^ &quot;Class&quot; methods\n\n^^^^^ new\n\n&gt; Socialtext::User::SomeUserStore-&gt;new( user_id =&gt; 123 )\n&gt; Socialtext::User::SomeUserStore-&gt;new( username =&gt; 'zbir' )\n&gt; Socialtext::User::SomeUserStore-&gt;new( email_address =&gt; 'zac.bir@socialtext.com' )\n\nInstantiate a user based on one of three keys: user_id, username, or email_address. The first, user_id, is a disambiguating shortcut, and will only be called when Socialtext::User knows the exact user_id being requested. If your user store class can't locate a record for the parameters passed in, return undef.\n\n^^^^^ Search\n\n&gt; Socialtext::User::SomeUserStore-&gt;Search( 'bir' )\n\nTake a search string and apply it against any fields that may be applicable. In the default case, we match against email address, first name, or last name. Since this method is currently only used for the invitation machinery when we've restricted the invitation process to searching for existing candidates, it returns an array of hashes, with the driver_name, email_address, and a displayable version of the user's name and email address (Socialtext::User-&gt;FormattedEmail is a handy method to generate just such a string).\n\n^^^ Example implementation (JohnMalkovitch)\n\nA silly implementation. It consumes all credential requests and returns a user called John Malkovitch. No matter what username or password you enter, everyone's Malkovitch. Malkovitch malkovitch malkovitch malkovitch. Malkovitch? We punt on the new() method, since everything else is self-contained.\n\n.pre\npackage Socialtext::User::JohnMalkovitch;\n\nsub user_id { 'johnmalkovitch' }\nsub username { 'johnmalkovitch' }\nsub password { 'doesntreallymatter' }\nsub first_name { 'John' }\nsub last_name { 'Malkovitch' }\nsub email_address { 'john.malkovitch@malkovitch.malkovitch' }\n\nsub driver_name { 'JohnMalkovitch' }\nsub has_valid_password { 1 }\nsub password_is_correct { 1 }\nsub Search {\n    my $class = shift;\n    \n    return [\n        {\n            driver_name =&gt; $class-&gt;driver_name,\n            email_address =&gt; $class-&gt;email_address,\n            name_and_email =&gt; Socialtext::User-&gt;FormattedEmail(\n                 $class-&gt;first_name,\n                 $class-&gt;last_name,\n                 $class-&gt;email_address\n            ),\n        }\n    ];\n}\n\n.pre\n\n^^ For Administrators\n\n^^^ User Stores\n\nCurrently, pluggable-auth allows for multiple back-end user stores, but they apply to the entire instance. This configuration is made in the socialtext.conf file, under the heading &quot;user_factories&quot;:\n\n.pre\n# \n# \n# The colon-separated list of drivers to use for user creation.\n# Defaults to Default\n#\n# user_factories: Default\n.pre\n\nIf you wanted to activate the JohnMalkovitch plugin, you'd edit socialtext.conf and change that value to:\n\n.pre\n# \n# \n# The colon-separated list of drivers to use for user creation.\n# Defaults to Default\n#\nuser_factories: JohnMalkovitch:Default\n.pre\n\nOrder matters, since Socialtext::User will call each plugin in turn in an attempt to satisfy new() or create(), and the first plugin that returns something other than undef wins. If we restart this application, everyone's a Malkovitch (even users already defined in Postgres).\n\n^^^ Invitation configuration\n\nThe means to invite new users to a workspace underwent refactoring, and had additional features added. We can now assert the means to build the list of candidate invitees. We can enter them freeform (the default, as the application currently works), or we can restrict our invitation candidates to those found via a search. The admin enters a string which is matched against each user store registered with the system, and the list of matching candidates is returned. From which, the admin can select any (or all or none) for invitation. We can also designate a filter to be applied to all candidates. It is matched against the candidate's email address. Any not matching are marked as invalid and not invited. In the case of search, users not matching the filter are not returned for selection. Another feature requested is the customization of invitation emails. These have been moved into a &quot;skin&quot;, much like CSS, that is queried for each part of the invitation process.\n\nThese three configurations are governed by st-admin, using the get/set-workspace-config command:\n\n^^^^ restrict_invitation_to_search - takes {{t/f}}\n\nBy default (f), we don't restrict any workspace invitations. This means we present the inviter with a text area into which she can add email addresses, one per line. If we change a workspace to restrict invites to search, the inviter is presented with a text field into which she can enter a search string, this string is matched against all the user stores known to the system (registered via a socialtext.conf variable). The inviter can choose invitees from the search results.\n\n^^^^ invitation_filter - takes a regular expression string ('@socialtext.com')\n\nBy default (NULL), we don't force invitees to match any particular pattern. When a user chooses to invite users, she is presented with the form according to the workspace's configuration for &quot;restrict_invitation_to_search&quot; (a text area for email addresses, one per line, or a search field). If we set a filter on the workspace, then all entries in the text are will be matched against the pattern, or all search results will be matched against the pattern. In the former case, a resulting screen will show any email addresses that were invalid, while in the latter case, results that don't match aren't presented to the user for invitation.\n\n^^^^ invitation_template - takes the name of a directory the invitation plugin will search for various templates. Templates are stored in share/template/email/st/\n\nBy default (&quot;st&quot;), we use the standard workspace invitation email templates. If, however, an admin wants to customize the templates governing the emails that are sent out for workspace invitation, she can edit the default templates, and associate the new templates with her workspace. In that case, workspace invitation emails will be composed based on her templates. All four templates need to be customized.\n\n^^^^^ invite-request-email.html and invite-request-email.txt:\n\nUsed when the user inviting can't actually approve the invitation, but wants to effectively nominate some members. This template exposes the following variables:\n\n* inviting_user - the best full name of the user making the invitation request\n* workspace_title - the title of the workspace the invitations are for\n* invited_users - a list of email addresses to be invited\n* url - the URL where the admin can go to invite the users\n* extra_text - any extra boilerplate text to accompany the invitation\n\n^^^^^ workspace-invitation-body.html and workspace-invitation.txt:\n\n* inviting_user - the best full name of the inviting user\n* workspace_title - the title of the workspace the invitation is for\n* requires_confirmation - whether the user already exists in the system or is requires confirmation after being created\n* confirmation_uri - the URL where a newly created user is confirmed\n* workspace_uri - the URL for the workspace\n* username - the username the invitee can use to log into the system\n* app_name - the name of the application (hosting is &quot;Socialtext&quot;, for an appliance, it's &quot;Socialtext Appliance&quot;)\n* forgot_password_uri - the URL for password recovery\n* extra_text - any extra boilerplate text to accompany the invitation\n</div>
<div tiddler="REST API Story Pool" modifier="chris.dent@socialtext.com" modified="200702010041" created="200701160404" tags="rest SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="rest_api_story_pool" socialtext.version="20070201004122">A collection of unordered and insufficiently described candidate stories for the Socialtext {link st-rest-docs [REST API]}. This list will often be incomplete as history has shown that many of the resources that get presented in the API are _discovered_ as the result of use.\n\nEach major section is ordered with priority items at the top. The major sections are _not_ ordered.\n\n{toc}\n\n^ Bugs\n\n^^ Path Info Encoding Problems\n\nIncluding the percent-2F problem.\n\n^ Resources Incomplete\n\n^^ Workspaces Management\n\nSupport the creation of workspaces and modification of workspace configuration settings by properly authorized (admin) users. It is quite likely that we'll need to do of the following:\n\n* Exposes resources for each of the workspace configuration settings\n* Accept partial updates of the resource which represents all the settings\n\nUser feedback is required to make much headway with this story. This story is likely multiple stories.\n\n*Story Tests:*\n* API can create workspaces\n* API can modify workspace settings\n\n^^ User Management\n\nSupport the creation of users, modification of user profiles and preferences, subscription of users to workspaces by properly authorized (admin) users. It is quite likely that we'll need to do of the following:\n\n* Exposes resources for each of the user preference settings\n* Accept partial updates of the resource which represents all the settings\n\nUser feedback is required to make much headway with this story. This story is likely multiple stories.\n\n*Story Tests:*\n* API can create/delete/modify users and their preferences\n* API can subscribe users to workspaces\n\n^^ Attachment Handling\n\nThis story needs work from some use cases and users. Thus far the attachment handling in the API has receive little use. Without use we don't know what needs to happen.\n\n*Story Tests:*\n* To do\n\n^ Representations Incomplete\n\n^^ Atomic JSON Page representation\n\nSome users have requested a JSON representation of a page which includes metadata and content. Otherwise there is a chance that retrieval of page content and page metadata as separate actions can return separate versions.\n\n^^ Collection Pagination\n\nLimit results sets to usable chunks by request.\n\n*Needs use cases*\n\n^^ Atom Publishing Protocol\n\nAtom representation of page entities, in and out, and pages collections.\n\n&gt; _N.B. The standard is not finished for this._\n\n*Story Tests*\n* An atom representation of a page can be retrieved and includes an edit link\n* An atom representation of a page can be sent for edit\n* An atom representation of _any_ collection of pages can be retrieved, each page entity with an edit link\n* Media representations are not in scope for this story\n\n^^ Query Language for Collections\n\nRobust queries for reversing, sorting, limiting and filtering collections.\n\nThese queries have been driving by development needs in the past and should probably continue in that way. Each need can represent a future story.\n\n*Story Tests:*\n* To do\n\n^^ &lt;link&gt; in HTML representations\n\nOne way to enhance discoverability would be, in the HTML representations, to include &lt;link rel&gt; tags to the other representations available for a resource.\n\n^^ Enhanced Navigability\n\nA primary benefit of a REST API is that it may use hypertext to inform the client of what is available and where to go. This is used in only a limited fashion in existing HTML representations. At minimum we should add uris to the HTML and JSON representations linking to the descendants of any entity.\n\n^^ LinkDictionary support\n\nWhen formatting pages to HTML make it possible for a client to make reference to a newly created or existing [LinkDictionary]. This makes it possible to present HTML with clickable links without undue client side processing.\n\n*Story Tests*\n* Use a query parameter with a `GET` of an HTML representation of a page to use a specified [LinkDictionary]\n* Post a link dictionary for storage and later use\n\n^ Protocol Handling\n\n^^ Caching Support\n\nSupport the creation of Etag and proper time headers on all created resources. Correctly deal with `If-Match`, `If-None-Match`, `If-Modified-Since` etc.\n\n* Etags/`If-Match` are already used on Pages\n\n^ Performance/Infrastructure\n\n^^ Return memcache support\n\nReturn reverted memcache code. Add caching for collections beyond pages.\n\n^^ Exract REST Subsystem\n\nIt would be keen for the REST Subsystem to be an optional module that can ben installed separately from the core code.\n\n^^ Replace Image::Magick with Imager\n\nThis is not specifically a REST issue, but came up in the process of API work. We have Imager and Image::Magick both being used in the code. Imager has, to some eyes, a more sensible API and better documentation making it easier for developers to use.\n\nTo reduce the number of dependencies, only use Imager. Image::Magick is currently used in Socialtext::Image, this should be replacable by Imager and common Imager code should be migrated there.\n\nJohnt reports some caveats from long ago that perhaps Imager has since fixed:\n\n&gt;I don't recall exactly why either, though I do recall that Imager had some weird bugs that were fixed when moving to Image:Magick. One was if you uploaded a gif logo with a transparent background, it would destroy the transparency when resizing and then support would have to fix it for them manually, with photoshop or gimp or something.\n\n`Imager::Cookbook` has information on exactly this problem.\n\n*Story Tests*\n* Image::Magick is not used in the code\n* Logo handling, RTF GIF use and Widget generation continue to work as designed\n\n^ Clients\n\n^^ Satisfy S2 Needs\n\nS2 Uses a combination of the REST API and other remote systems to fulfill AJAX needs in the presentation of the application. Centralize on the REST API and remove the temporary API calls that were created.\n\n*Story Tests:*\n* What needs are not satisfied (fill this in)\n\n^^ Release Socialtext-Resting\n\nMake sure Socialtext::Resting code in CPAN is kept up to date.\n\n*Story Tests:*\n* Latest code in subversion is up on CPAN\n\n^^ Update Socialtext-Resting\n\n[Socialtext-Resting] does not support all the features of the [REST API]. For maximum usefulness, it should. In particular, frontlink queries would be nice for gardening tools.\n\n^^ Javascript client library\n\nClient development would be enhanced by the creation of a suite of subclassable Javascript tools that manipulate or present resources available in the API.\n\n^^ Ruby Socialtext-Resting\n\nThere exists a started port of Socialtext::Resting to ruby that should be completed.\n\n^^ Cool Things\n\nWho wants to use a REST API if there aren't cool things to show how awesome it is?\n\n^^ Haskell Socialtext-Resting\n\nThere's been a few stabs at this, completing it would be good for the credibility.\n\n^^ Miki as REST client\n\nMiki may be a perfect choice for demonstrating full featured applications that are clients of the REST API.\n</div>
<div tiddler="Rug and Wikispaces Retrospective" modifier="luke.closs@socialtext.com" modified="200702022347" created="200702022152" tags="SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="rug_and_wikispaces_retrospective" socialtext.version="20070202234758">| ^ When\n\nFri Feb 2 - 2pm | ^ Who\n\n* lukec - retro coach\n* Andy\n* Dave\n* Matthew\n* Adina | ^ What\n\nRetrospective for [Rug project] and [Wikispace] project |\n\n^ Agenda\n\n# Overview of retrospectives\n# Quick review of the projects to date to stir up our memories of what happened\n# Discussion of discussion points\n# Round the table WW/DNWW\n# Optional: Review of WW/DNWW from previous iterations - re-occuring problems?\n# Create concrete suggestions for improvement based on things that didn't work well\n\n^ Discussion points\n\n* Planned rug/wikispaces together, but worked on them alone\n** 1 person teams?\n* Schedule (estimated vs actual)\n** Impacted by bugfixes, kimono opening, underestimation of work?, ...)\n** Updated schedules? end dates?\n* Iteration formats\n\n^ Worked Well\n\n^^ General\n* raising the flag that project may be late is good\n* plans in the open (eg: on wiki pages) are easy to see, good visibility\n\n^^ Rug\n* weekly iteration visibility gave better accuracy to remaining project plan\n* Week long iterations (can fit in my head)\n* f2f planning was good for concept planning, very valuable\n\n^^ Wikispaces\n* dave didn't mind one person project, felt it was easier in this case\n** Linking to &quot;HWD files&quot; &lt;https://repo.socialtext.net:8999/svn/planning/trunk/hwd/wikispace.hwd&gt; from wiki increases project schedule visibility\n* f2f planning with andy/johnt provided different perspectives\n* features/scope well defined, dave could effectively act as the customer\n\n^ Did not work well\n\n^^ General\n* Implied tasks resulted in slower velocity\n** additional miscellaneous cleanup/refactoring work\n** Initially thought 5 hours/day was reasonable, perhaps 4 is more realistic\n* Hard to plan upcoming projects without schedule visibility of existing projects\n* Trac/ticket based systems disliked for project planning\n* People like johnt/brandon are &quot;too busy&quot;, yet really help projects\n* projects seemed opaque to outside developers, never really understood what the projects are about\n* Retro ran a little long, could have done more preparation before the meeting\n\n^^ Rug\n* project had many activities not expected at beginning of the project\n** both in the number of items, and the severity of the items\n* Only clear this week that project will miss estimated completion date\n* Project timelines not visible to outside observers\n** (project page wasn't made for this)\n* running over estimated dates create pressures on other projects\n\n^^ Wikispaces\n* wikispaces: knowledge silo created, as dave is leaving and only person on that project\n** mitigated by docs and &quot;straight-forwardness&quot; of the project\n* Schedule not very visible until linked to from wiki\n* HWD has poorer visibility than wiki pages\n* Luke was surprised about dependency on migration work, recalled earlier discussion\n\n^ Things for next time\n\n* should plan retrospective including customers when projects have finished\n* wikispace: should create testplans ASAP (johnt, with ken as process consultant)\n* recommend kicking off projects f2f\n* retrospectives for each iteration (weekly)\n* have participants list their Worked Wells and Didn't Works before the meeting\n</div>
<div tiddler="Rug project" modifier="andy.lester@socialtext.com" modified="200702012145" created="200701092050" tags="Rug SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="rug_project" socialtext.version="20070201214519">[Rug] is the mod_perl1/mod_perl2 abstraction layer.\n\nSubversion repository is at https://socialtext.svn.sourceforge.net/svnroot/socialtext/branches/rug\n\nThis process is turning out to not be as sequential as I thought. I'm having to do bits of this and bits of that along the way.\n\n^ Week of Jan 15-19\n\n* -Add a .t file or Perl::Critic rule that ensures we do not use Apache::* directly any more. (2h)-\n** Est. 2h, did 2h or so\n* -Adapt Socialtext::Handler::Cleanup (4h)-\n** Make it load Apache::SizeLimit based on Rug-&gt;webapi\n** Est 4h, took 6h\n* -Handle MasonX::WebApp-\n** MasonX::WebApp wants Apache::Constants and Apache::Request\n** Either MasonX::WebApp gets updated or we have to get rid of it.\n** Dave is updating MasonX::WebApp to handle mod_perl2\n* -Make st-apache know if we're apache-perl or apache2 (4h)-\n** Update the apache-perl hardcoding\n** Est 4h, took 1h\n\nPlus I've done a lot of fiddling with templates and startups to be able to start apache2. Basically, everywhere that we referred to &quot;apache-perl&quot; and &quot;apache2&quot; are now &quot;apache-app&quot; and &quot;apache-proxy&quot;.\n\n^ Week of Jan 22-26\n\n* -Start Dual-Apache2 support (15h)-\n** Need to make the &quot;apache-perl&quot; configs for Apache2's back end not conflict with the front-end configs. Since they'll both be Apache2, we need to be careful.\n* -Handle Apache::Reload-\n* -Update Socialtext::Handler &amp; Socialtext::ModPerl-\n** Needed the UID and GID to set permissions on the template dir. Instead of getting this from Apache, get it from new function Socialtext::Build::get_uid_gid().\n** Est 2h, actual 2h\n* -De-Apache Socialtext::Statistics-\n** Just removed the Apache. Didn't use Apache anywhere, even for printing.\n** Est 1h, actual 1h\n* -De-Apache Socialtext::Handler::Cool (2h)-\n* Write Rug::MP2 (27 x 1h each)\n** -get_config-\n** -log_error-\n** -send_http_header-\n** -user-\n\n^ Week of Jan 29-Feb 2\n\n* Get dev apache working\n* Rugify all the unparse() calls\n* -Eliminate etc/init.d/*.in-\n* Figure out why SOAP::Lite doesn't work under Apache 1.x any more. Is it because it's confused with mod_perl 2.0 as well?\n* -Increase Apache2::SizeLimit-\n* Fix Socialtext::Handler::REST\n* Write Rug::MP2 (23 x 1h each)\n** -instance-\n** content_type\n** -current_callback-\n** custom_response\n** -err_header_out-\n** filename\n** get_basic_auth_pw\n** -header_in-\n** -header_out-\n** hostname\n** log_reason\n** method\n** -no_cache-\n** note_basic_auth_failure\n** param\n** path\n** pnotes\n** print\n** read\n** requires\n** send_fd\n** status_line\n** upload\n** uri\n* Dave will have released new MasonX::WebApp\n* Sanity checking on mod_perl2 version (2h)\n** The long series of betas for mod_perl 2.0 were started with 1.99. There was a lot of API churn leading up to mod_perl 2.0 that we do not want to deal with, so we only support mp1 and mp2.0+.\n* Upgrade instructions\n* Remove Socialtext::WebHelpers::* (4h)\n** Make whatever uses them use the Rug instead\n** -Socialtext::Handler::WSDL-\n* Fix all the docs that show how to specify handlers to now use the new Rug format.\n* Merge Rug branch back to Open trunk.\n* Release to SourceForge\n\n^ After the OSR release\n\n* Merge to ST trunk\n* Create rug branch on ST repo\n* Merge the Rug changes back to the main ST trunk\n\n* Singleton support in config file\n** Dave says there's some special way to build MP2 to allow Apache-&gt;request singletons.\n\n----\n\n^ Verification\n\nThings to check before we can consider being done.\n\n* No Apache:: modules in any TT files, unless wrapped in webapi conditional blocks.\n* `t/rug-only.t` passes\n* Make sure every method is called thru a rug. For instance, this should change:\n\n.pre\nlib/Socialtext/Rest/Attachment.pm\n16:#    $self-&gt;request-&gt;send_fd($fh);\n.pre\n\n* Try to rename $r objects to $rug when possible.\n\n----\n\n^ Laundry list\n\n* How do we want to handle the Appliance's Apache::Registry usage?\n* `etc/cron/st-workspace-stats` is hardcoded to apache-perl\n* We may be able to get rid of the substituting stuff when we create the /etc/init.d files, 'cause they can look them up themselves. That will be two fewer .in files.\n* We need a way to get package lists for the Perl dependencies without duplicating them. The dependencies are very fluid, and a single list of packages will no longer cut it.\n</div>
<div tiddler="San Francisco Contemporary Music Players" modifier="s_masud@yahoo.com" modified="200701310053" created="200701310052" tags="[[Contemporary Music]] Orchestra Piano SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="san_francisco_contemporary_music_players" socialtext.version="20070131005315">The website: http://www.sfcmp.org\n\nDon't miss our upcoming &quot;Contemporary Insights&quot; event on Feb 21, 2007 at the Piedmont Piano company in San Francisco.\n</div>
<div tiddler="SaveChanges" modifier="JeremyRuston" modified="200611081026" created="200611081026" tags="excludeLists excludeSearch">Socialtext Unplugged lets you browse and edit your content while you're offline. When you make a change you need to SaveChanges to save the change to your local hard drive, before later performing a SyncChanges to synchronise the change back to the server.\n\nThe procedure for SaveChanges is slightly different for different browsers:\n* SavingOnInternetExplorer\n* SavingOnFireFox\n* SavingOnSafari\n* SavingOnOpera\n</div>
<div tiddler="SavingOnFireFox" modifier="JeremyRuston" modified="200611081352" created="200611081352" tags="excludeLists excludeSearch">You can save changes with any version of FireFox, and also many other browsers in the FireFox family, such as Camino on the Mac and MiniMo on mobile devices. The procedure is:\n# Click the button labelled 'save changes' over in the right hand sidebar\n# If prompted with an &quot;Internet Security&quot; dialog as follows, click the checkbox labelled &quot;Remember this decision&quot; and then the &quot;Allow&quot; button\n## &quot;A script from &quot;file://&quot; is requesting enhanced capabilities that are UNSAFE and could be used to compromise your machine or data...&quot;\n# You should then see a message at the top right of the window saying &quot;Main TiddlyWiki file saved&quot;\nIf you accidentally //deny// permission instead, you may need to UnravelFireFoxPermissions.\n</div>
<div tiddler="SavingOnInternetExplorer" modifier="JeremyRuston" modified="200611081356" created="200611081337" tags="excludeLists excludeSearch">You can save changes with Internet Explorer versions 6 and 7, but not the earlier versions. The procedure is:\n# Click the button labelled 'save changes' over in the right hand sidebar\n# If prompted as follows, click &quot;Yes&quot;:\n## &quot;An ActiveX control on this page might be unsafe to interact with other parts of the page. Do you want to allow this interaction?&quot;\n# You should then see a message at the top right of the window saying &quot;Main TiddlyWiki file saved&quot;\nNote that there is currently [[a bug|http://trac.tiddlywiki.org/tiddlywiki/ticket/39]] that prevents Internet Explorer from saving correctly if you have specified a backup directory in AdvancedOptions.</div>
<div tiddler="SavingOnOpera" modifier="JeremyRuston" modified="200611081354" created="200611081354" tags="excludeLists excludeSearch">To SaveChanges on Opera, see the instructions for using the TiddlySaver Java applet.</div>
<div tiddler="SavingOnSafari" modifier="JeremyRuston" modified="200611081354" created="200611081354" tags="excludeLists excludeSearch">To SaveChanges on Safari, see the instructions for using the TiddlySaver Java applet.</div>
<div tiddler="Shawn Devlin" modifier="andy.lester@socialtext.com" modified="200702011528" created="200702010554" tags="SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="shawn_devlin" socialtext.version="20070201152832">I am a developer here at Socialtext. My work so far has been on the UI side of the Socialtext. I worked on the team that revamped the interface for v2.0.\n\n^^^ 5 Things\n\n* I don't have a high school diploma\n* I love cold weather\n* I am designing a fantasy world and RPG ruleset\n* In a misguided attempt to impress my then girlfriend now wife I set myself on fire\n* I collect dictionaries\n\n---\nExcellent!  I don't have a HS diploma either!\n\n_contributed by {user: andy.lester@socialtext.com} on {date: 2007-02-01 15:28:32 GMT}_\n</div>
<div tiddler="SideBarOptions" modifier="JeremyRuston" modified="200610130000" created="200610130000" tags="excludeLists excludeSearch">&lt;&lt;search&gt;&gt;&lt;&lt;closeAll&gt;&gt;&lt;&lt;permaview&gt;&gt;&lt;&lt;newTiddler 'New Tiddler' SocialtextFormat fields:&quot;socialtext.server:http://www.socialtext.net/;socialtext.workspace:stoss;socialtext.page:;socialtext.version:;&quot;&gt;&gt;&lt;&lt;newJournal 'DD MMM YYYY' SocialtextFormat fields:&quot;socialtext.server:http://www.socialtext.net/;socialtext.workspace:stoss;socialtext.page:;socialtext.version:;&quot;&gt;&gt;&lt;&lt;saveChanges&gt;&gt;&lt;&lt;backstage sync&gt;&gt;&lt;&lt;slider chkSliderOptionsPanel OptionsPanel 'options Â»' 'Change TiddlyWiki advanced options'&gt;&gt;</div>
<div tiddler="SinglePageModePlugin" modifier="ELSDesignStudios" modified="200607041731" created="200512271815" tags="systemConfig addon includeNew">/***\n''Single Page Mode Plugin for TiddlyWiki version 2.0 or above''\n^^author: Eric Shulman - ELS Design Studios\nsource: http://www.TiddlyTools.com/#SinglePageModePlugin\nlicense: [[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]^^\n\nNormally, as you click on the links in TiddlyWiki, more and more tiddlers are displayed on the page. The order of this tiddler display depends upon when and where you have clicked. Some people like this non-linear method of reading the document, while others have reported that when many tiddlers have been opened, it can get somewhat confusing.\n\n!!!!!Usage\n&lt;&lt;&lt;\nSinglePageMode allows you to configure TiddlyWiki to navigate more like a traditional multipage web site with only one item displayed at a time.  When SinglePageMode is enabled, the title of the current tiddler is automatically displayed in the browser window's titlebar and the browser's location URL is updated with a 'permalink' for the current tiddler so that it is easier to create a browser 'bookmark' for the current tiddler.\n\nEven when SinglePageMode is disabled (i.e., displaying multiple tiddlers is permitted), you can reduce the potential for confusion by enable TopOfPageMode, which forces tiddlers to always open at the top of the page instead of being displayed following the tiddler containing the link that was clicked.\n&lt;&lt;&lt;\n!!!!!Configuration\n&lt;&lt;&lt;\nWhen installed, this plugin automatically adds checkboxes in the AdvancedOptions tiddler so you can enable/disable the plugin behavior.  For convenience, these checkboxes are also included here:\n\n&lt;&lt;option chkSinglePageMode&gt;&gt; Display one tiddler at a time\n&lt;&lt;option chkTopOfPageMode&gt;&gt; Always open tiddlers at the top of the page\n&lt;&lt;&lt;\n!!!!!Installation\n&lt;&lt;&lt;\nimport (or copy/paste) the following tiddlers into your document:\n''SinglePageModePlugin'' (tagged with &lt;&lt;tag systemConfig&gt;&gt;)\n^^documentation and javascript for SinglePageMode handling^^\n\nWhen installed, this plugin automatically adds checkboxes in the ''shadow'' AdvancedOptions tiddler so you can enable/disable this behavior.  However, if you have customized your AdvancedOptions, you will need to ''manually add these checkboxes to your customized tiddler.''\n&lt;&lt;&lt;\n!!!!!Revision History\n&lt;&lt;&lt;\n''2006.07.04 [2.2.1]'' in hijack for displayTiddlers(), suspend TPM as well as SPM so that DefaultTiddlers displays in the correct order.\n''2006.06.01 [2.2.0]'' added chkTopOfPageMode (TPM) handling\n''2006.02.04 [2.1.1]'' moved global variable declarations to config.* to avoid FireFox 1.5.0.1 crash bug when assigning to globals\n''2005.12.27 [2.1.0]'' hijack displayTiddlers() so that SPM can be suspended during startup while displaying the DefaultTiddlers (or #hash list).  Also, corrected initialization for undefined SPM flag to &quot;false&quot;, so default behavior is to display multiple tiddlers\n''2005.12.27 [2.0.0]'' Update for TW2.0\n''2005.11.24 [1.1.2]'' When the back and forward buttons are used, the page now changes to match the URL.  Based on code added by Clint Checketts\n''2005.10.14 [1.1.1]'' permalink creation now calls encodeTiddlyLink() to handle tiddler titles with spaces in them\n''2005.10.14 [1.1.0]'' added automatic setting of window title and location bar ('auto-permalink').  feature suggestion by David Dickens.\n''2005.10.09 [1.0.1]'' combined documentation and code in a single tiddler\n''2005.08.15 [1.0.0]'' Initial Release\n&lt;&lt;&lt;\n!!!!!Credits\n&lt;&lt;&lt;\nThis feature was developed by EricShulman from [[ELS Design Studios|http:/www.elsdesign.com]].\nSupport for BACK/FORWARD buttons adapted from code developed by Clint Checketts\n&lt;&lt;&lt;\n!!!!!Code\n***/\n//{{{\nversion.extensions.SinglePageMode= {major: 2, minor: 2, revision: 1, date: new Date(2006,7,3)};\n\nif (config.options.chkSinglePageMode==undefined) config.options.chkSinglePageMode=false;\nconfig.shadowTiddlers.AdvancedOptions += &quot;\ssn&lt;&lt;option chkSinglePageMode&gt;&gt; Display one tiddler at a time&quot;;\n\nif (config.options.chkTopOfPageMode==undefined) config.options.chkTopOfPageMode=false;\nconfig.shadowTiddlers.AdvancedOptions += &quot;\ssn&lt;&lt;option chkTopOfPageMode&gt;&gt; Always open tiddlers at the top of the page&quot;;\n\nconfig.SPMTimer = 0;\nconfig.lastURL = window.location.hash;\nfunction checkLastURL()\n{\n	if (!config.options.chkSinglePageMode)\n		{ window.clearInterval(config.SPMTimer); config.SPMTimer=0; return; }\n	if (config.lastURL == window.location.hash)\n		return;\n	var tiddlerName = convertUTF8ToUnicode(decodeURI(window.location.hash.substr(1)));\n	tiddlerName=tiddlerName.replace(/\ss[\ss[/,&quot;&quot;).replace(/\ss]\ss]/,&quot;&quot;); // strip any [[ ]] bracketing\n	if (tiddlerName.length) story.displayTiddler(null,tiddlerName,1,null,null);\n}\n\nif (Story.prototype.SPM_coreDisplayTiddler==undefined) Story.prototype.SPM_coreDisplayTiddler=Story.prototype.displayTiddler;\nStory.prototype.displayTiddler = function(srcElement,title,template,animate,slowly)\n{\n	if (config.options.chkSinglePageMode) {\n		window.location.hash = encodeURIComponent(String.encodeTiddlyLink(title));\n		config.lastURL = window.location.hash;\n		document.title = wikifyPlain(&quot;SiteTitle&quot;) + &quot; - &quot; + title;\n		story.closeAllTiddlers();\n		if (!config.SPMTimer) config.SPMTimer=window.setInterval(function() {checkLastURL();},1000);\n	}\n	if (config.options.chkTopOfPageMode) { story.closeTiddler(title); window.scrollTo(0,0); srcElement=null; }\n	this.SPM_coreDisplayTiddler.apply(this,arguments)\n}\n\nif (Story.prototype.SPM_coreDisplayTiddlers==undefined) Story.prototype.SPM_coreDisplayTiddlers=Story.prototype.displayTiddlers;\nStory.prototype.displayTiddlers = function(srcElement,titles,template,unused1,unused2,animate,slowly)\n{\n	// suspend single-page mode when displaying multiple tiddlers\n	var saveSPM=config.options.chkSinglePageMode; config.options.chkSinglePageMode=false;\n	var saveTPM=config.options.chkTopOfPageMode; config.options.chkTopOfPageMode=false;\n	this.SPM_coreDisplayTiddlers.apply(this,arguments);\n	config.options.chkSinglePageMode=saveSPM; config.options.chkTopOfPageMode=saveTPM;\n}\n//}}}</div>
<div tiddler="SiteSubtitle" modifier="JeremyRuston" modified="200609010000" created="200609010000" tags="excludeLists excludeSearch">Socialtext Open Source Wiki</div>
<div tiddler="SiteTitle" modifier="JeremyRuston" modified="200609010000" created="200609010000" tags="excludeLists excludeSearch">Socialtext Unplugged</div>
<div tiddler="SiteUrl" modifier="JeremyRuston" modified="200609010000" created="200609010000" tags="excludeLists excludeSearch">http://www.socialtext.net/stoss/</div>
<div tiddler="Smooth unplug" modifier="adina.levin@socialtext.com" modified="200701292208" created="200701282200" tags="Email SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="smooth_unplug" socialtext.version="20070129220802">{toc: }\n\n^^^ User role and goal analysis\n\nRather than start with solutions (&quot;interstitial page&quot;, &quot;zip files&quot;), it\nis helpful to start with an analysis of the mindset and goals of people\nusing unplugged. The model can be used to brainstorm alternative\nsolutions to achieve the user's goals.\n\n^^^ User roles and goals\n\nUnplugging will be a new experience to most folk, at least for the first\nfew times. Unplugging is a powerful concept that people will grok after\nthey do it. But they need to have the initial experience be\nstraightforward and successful, otherwise they will give up.\n\nAfter someone has gotten unplugged to work a couple of times, some users\nare going to want unplugged to work the way *they* want it to work.\nPeople may want to choose the link depth to unplug, for example. In good\ngame design fashion, the UI should enable people to master the simple\nthing first, and then to discover and master the more complex things.\n\nPeople unplug when they are leaving the network -- going to board a\nplane, for example. The choices, even for users who want to have\nchoices, should have low cognitive overhead.\n\n^^^^ I want it to work the first time\n\n&quot;What is this interesting looking power plug icon? What does it do? Aha,\nlooks like I can download wiki pages to my computer. Cool! Let me try.\nOk, I recognize the stuff on my desktop. Neat, these are the wiki pages\nI was working on. Let me make a change. Ok, there's the synch button,\nlet me try that. Excellent, it worked! I'm going to do that again soon!\n\nThe first time a user tries out unplugged, the experience should be\nstraightforward, with clear signposts about what to do next. The UI\nshould tell the user what's about to happen next, in a verbose fashion\nthat practiced users find annoying. First-time users shouldn't have a\nlot of choices in their face. If the process to get attachments adds\nextra steps out of necessity, then it should be optional. Options should\nbe unobtrusive until the user starts to look for them.\n\nQuestions, suggestions, and comments: Is zip the best solution for\nunplugs with files? If so, then the &quot;first choice&quot; should be an html\nonly file, without attachments. The system should tell the user what is\ngoing to happen after they unplug.\n\nThe ui should give the user the option to unplug attachments. If they\nchoose this option, the system should tell them what is going to happen\nnext, and what to do about it.\n\nshould the user have the opportunity to name the unplugged thing? Or,\nshould the filename be human-readable so the user can find the thing on\ntheir desktop. The current naming convention makes it hard to\ndifferentiate between downloads from different wikis on different dates.\n\nIn Tiddlywiki, the Edit and Synch links are unobtrusive. They ought to\nbe made more prominent so first time users can find them. I know to\nlook for them, and I still need to look all over the interface for\n&quot;edit&quot; and &quot;synch&quot;.\n\n^^^^ I want it to do what I want it to do\n\nOnce a user has had one or two successful experience with basic\nunplugging, some are going to want it to do more.\n\nBusiness users often use file attachments. They will want to download\nthose attachments, work on them and be able to upload them when they are\ndone. People who use attachments care about them a lot - when there are\nusability issues with files, we hear from users, loudly and clearly.\n\nPeople who are familiar with synching from other applications may want\nto choose the unplug depth -- unplug this page and pages linked to it.\nIn an intro to Unplugged for the Socialtext sales crew, one of the sales\npeople asked about this option.\n\nAlso, people may want to control the number of pages to download. This\nmay be for convenience reasons -- they only want the top 5 pages in the\nlist they are looking at. Or it may be for performance reasons.\n\nUsers, especially frequent users, are likely to be in a hurry when they\nunplug, and want the action to be efficient. If the instructions for the\nfirst-time user are annoying, the experienced user should be able to\ntell those instructions to go away. With respect to fancier settings\nlike unplug depth, the system should remember what they chose last, and\nhave an unobtrusive affordance allow the user to change those settings.\n\nQuestions:\n\nshould the unplug depth memory also apply to synching. For example, if\nthe user has chosen to unplug each page plus one level of pages that\nlink to each page, should the synch process notice that an additional\nlink has been added on the server, and offer to synch it?\n\nHow prominent should the &quot;deleted page&quot; options be?\n\n{include: [interstitial page]}\n\nAttachments for page:\n* {file: attachment-15603-0.html}\n\n</div>
<div tiddler="Socialtext Open" modifier="email@pfennigsolutions.de" modified="200701300024" created="200608301700" tags="SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="socialtext_open" socialtext.version="20070130002417">Socialtext Open is an open source wiki based on the same great product as Socialtext Enterprise. It is released under a standard open source license.\n\n* &quot;Download Socialtext Open&quot;&lt;http://sourceforge.net/projects/socialtext/&gt; from SourceForge\n* [Socialtext Open FAQ] -- Common questions about Socialtext Open\n* [Socialtext Open requirements] -- System requirements for Socialtext Open\n* [Socialtext Open troubleshooting] -- For help with common problems\n* [Socialtext Open roadmap] -- The future of Socialtext Open\n* [Socialtext Open sites] -- List your Socialtext Open wiki site here\n* [Socialtext Open installation] -- How to install Socialtext Open\n* [Socialtext Open development] -- How you can help\n* [Socialtext Open users] -- Who's using Socialtext Open? Add your name to the list.\n* [Socialtext Open source code] -- Get in on the development with the source code.\n\n{include: [Socialtext Open mailing lists]}\n\n{fetchrss: http://sourceforge.net/export/rss2_projnews.php?group_id=170460}\n\n^^^ Socialtext Open users and developers\n\nWhether you're a user or developer, we want to know more about you. Add your name to the list and make a wiki page telling us about who you are and how you're using Socialtext Open.\n\n* [Andy Lester], project manager for Socialtext Open.\n</div>
<div tiddler="Socialtext Open Source Wiki" modifier="andy.lester@socialtext.com" modified="200702030401" created="200602282001" tags="[[Recent Changes]] SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="socialtext_open_source_wiki" socialtext.version="20070203040106">*Welcome to the Socialtext Open Source Workspace. You'll find the source code, documentation, news, and discussion about our Open Source projects. _Please_ don't hesitate to contact us here, &quot;on Sourceforge&quot;&lt;http://sourceforge.net/projects/socialtext/&gt;, or via one of the [Socialtext Open mailing lists] for any questions, requests, concerns, or comments you may have.*\n\n^^ Announcements\n\nhttp://www.socialtext.com/files/unplug_large.png\n\n* [Socialtext Open release 2.9.5.1] is now out\n* Join us at the [Wikithon] on February 7th!\n* [Socialtext Open release 2.7.1.0] is a maintenance release\n* [Socialtext Open release 2.7.0.2] includes greatly improved searching with [KinoSearch].\n* [Socialtext Open release 2.5.1.0] includes Socialtext Unplugged.\n* [Socialtext Unplugged FAQ] -- offline wiki leveraging [Socialtext APIs] co-developed with [TiddlyWiki]\n* [Socialtext Open 2.3.1.0 released]\n* &quot;Download SocialCalc&quot;&lt;http://sourceforge.net/project/showfiles.php?group_id=170460&gt;\n* [Socialtext Conversion Toolbox] for wiki conversion\n\n^^ Socialtext Open\n\n[Socialtext Open] -- The open source enterprise-class wiki\n\n^^ SocialCalc &amp; wikiCalc\n\n[SocialCalc &amp; wikiCalc] -- The wiki-based spreadsheet\n\n^^ Wikiwyg\n\n[Wikiwyg] -- The ubiquitous WYSIWYG editor for wikis\n\n^^ APIs\n\n[Socialtext APIs] -- REST &amp; SOAP Wiki Web Services\n\n^^ Developer Blogs\n\n* {weblog: alester's weblog}\n* {weblog: luke's dev log}\n* {weblog: Chris Dent Blog}\n\n^^ Socialtext Public License\n\nAll Socialtext Open Source projects are released under the &quot;Socialtext Public License&quot;&lt;http://www.socialtext.net/stoss/index.cgi/spl100.pdf?action=attachments_download;page_name=socialtext_open_source_wiki;id=20060725230840-0&gt; (MPL 1.1with an addendum, please see the [Why the Appendix] page). We believe that we have found the best, and most liberal, way to share our software, make it available to hobbyists, coders, commercial users, and tinkerers alike, while preserving the spirit and letter of the OSI requirements. We recently submitted an [Attribution Memo] to OSI and welcome feedback.\n\n----\n\n^^ Projects Supported by Socialtext\n\nSocialtext has supported work by its employees on a number of existing OSS projects:\n\n^^^ Anti-spam\n\nFighting SPAM on Wikis? &quot;Pete Kaminski and Eugene E. Kim might have the solution for you&quot;&lt;http://peterkaminski.com/archives/000462.html&gt;.\n\n^^^ Perl Modules\n\n* &quot;Alzabo&quot;&lt;http://search.cpan.org/dist/Alzabo/&gt; - bug fix work in 0.88 and 0.89\n* &quot;Template::Iterator::AlzaboWrapperCursor&quot;&lt;http://search.cpan.org/dist/Template-Iterator-AlzaboWrapperCursor/&gt; - developed for Socialtext\n* &quot;Apache::SizeLimit&quot;&lt;http://search.cpan.org/dist/Apache-SizeLimit/&gt; - work on version 0.90\n* &quot;URI::FromHash&quot;&lt;http://search.cpan.org/dist/URI-FromHash/&gt; - extracted from &quot;MasonX::WebApp&quot;&lt;http://search.cpan.org/dist/MasonX-WebApp/&gt; for Socialtext\n* &quot;HTML::WikiConverter::Socialtext&quot;&lt;http://search.cpan.org/dist/HTML-WikiConverter-Socialtext/&gt; - developed for Socialtext\n** Socialtext has been included as a dialect on the WikiConverter website: http://diberri.dyndns.org/wikipedia/html2wiki/\n* &quot;Socialtext::Resting&quot;&lt;http://search.cpan.org/dist/Socialtext-Resting/&gt; - developed for Socialtext\n\n^^^ JSAN Libraries\n\n* &quot;Widget.SortableTable&quot;&lt;http://www.openjsan.org/doc/a/au/autarch/Widget/SortableTable/&gt; - done on Socialtext 20% time\n\n^^ Other ways to participate:\n\nThe &quot;Sourceforge project Overview page&quot;&lt;https://sourceforge.net/projects/socialtext&gt; gives you access to a plethora of resources, including a bug tracker and mailing lists\n\nAttachments for page:\n* {file: bannercreator-nu.gif}\n\n</div>
<div tiddler="Socialtext Open release checklist" modifier="andy.lester@socialtext.com" modified="200702030407" created="200612142045" tags="[[Socialtext Open]] SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="socialtext_open_release_checklist" socialtext.version="20070203040751">*Please duplicate this page into a posting title &quot;Socialtext Open release: $VERSION&quot;.*\n\n* Update dependencies in `docs/deps.txt`\n** Optional, but I'd like to keep this up-to-date\n* Reread and timestamp the `Changes` file.\n* Check the tarball BEFORE uploading to SF\n** `make tardist`\n** Unpack it\n** `./configure &amp;&amp; make &amp;&amp; make test`\n* Make a release note on SF admin page\n* Make a tag in Subversion\n* Release the tarball to SF\n** FTP to upload.sf.net/incoming\n** Add the release via the SF admin pages\n** Make sure you do the &quot;announce this to the N people who are monitoring this package&quot; button.\n* Check the tarball AFTER uploading to SF\n** Download the tarball from SF\n** Unpack it\n** `./configure &amp;&amp; make &amp;&amp; make test`\n* Announce in the /stoss workspace\n* Paste the relevant part of `Changes` here in this page.\n* Announce to socialtext-announce and socialtext-user\n</div>
<div tiddler="Socialtext Open release: 2.9.5.1" modifier="andy.lester@socialtext.com" modified="200702030406" created="200702022115" tags="[[Socialtext Open]] SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="socialtext_open_release_2_9_5_1" socialtext.version="20070203040615">2.9.5.1 Fri Feb 2 14:47:54 CST 2007\n\n^ ENHANCEMENTS\n\nUsers can now add custom JavaScript to pages.\n\nThere is now a &quot;weblog print&quot; feature.\n\nThe ceqlotron should now use memory more efficiently when indexing large pages.\n\nUpdated the Workspace Settings menu with new features for privacy. The Workspace Settings menu is now three separate menus to reduce clutter.\n\nFourth release of the REST API, 0.93. See specifics at: http://www.socialtext.net/st-rest-docs/index.cgi?rest_api_0_93_release_notes\n\n^ FIXES\n\nAttachments were not deleted from the search index when the page was deleted.\n\nSafari users would not get redirected to the new page correctly after leaving comments.\n\nChanged the DocumentRoot from /var/www/socialtext to /var/www/socialtext/docroot. This prevents anyone from accessing other directories under /var/www/socialtext.\n\n----\n\n* -Reread and timestamp the `Changes` file.-\n* -Check the tarball BEFORE uploading to SF-\n** Unpack it\n** `./configure &amp;&amp; make &amp;&amp; make test`\n* -Release the tarball to SF-\n** `make tardist`\n** FTP to upload.sf.net/incoming\n** Add the release via the SF admin pages\n** Make sure you do the &quot;announce this to the N people who are monitoring this package&quot; button.\n* -Check the tarball AFTER uploading to SF-\n** Download the tarball from SF\n** Unpack it\n** `./configure &amp;&amp; make &amp;&amp; make test`\n* -Make a release note on SF admin page-\n* -Announce to socialtext-announce and socialtext-user-\n* -Make a tag in Subversion-\n* -Announce in the /stoss workspace-\n* -Paste the relevant part of `Changes` here in this page.-\n</div>
<div tiddler="SocialtextScreenStyle" modifier="Martin Budden" modified="200611020000" created="200611020000" tags="styles excludeLists excludeSearch">/***\nSocialtextScreenStyle\nhttp://www.eu.socialtext.net/static/2.0.0.1/css/st/screen.css\n***/\n\n/*{{{*/\nbody {\n	font-family: Arial, sans-serif;\n	color: #000;\n	background: #eee;\n	margin: 0;\n}\n\n/* Wiki Navigation */\n\n.st-wiki-nav {\n	clear: both;\n	margin-left: 10px;\n	margin-right: 10px;\n}\n.st-wiki-nav-content {\n	background: url(&quot;../../images/st/wiki-nav/solid.gif&quot;) repeat-x left bottom;\n	margin-left: 24px;\n	margin-right: 24px;\n	padding-top: 3px;\n	min-height: 24px;\n}\n* html .st-wiki-nav-content {\n	padding-bottom: 3px;\n	height: 24px;\n}\n\n.st-wiki-nav-right {\n	background: url(&quot;../../images/st/wiki-nav/right-round.gif&quot;) no-repeat bottom right;\n}\n\n.st-wiki-nav-left {\n	background: url(&quot;../../images/st/wiki-nav/left-round.gif&quot;) no-repeat bottom left;\n}\n\n#st-home {\n	float: left;\n	margin-right: 60px;\n	padding-top: 2px;\n}\n\n#st-home-link {\n	color: white;\n	text-decoration: none;\n	font-weight: bold;\n	font-family: Helvetica, sans-serif;\n	font-size: 90%;\n}\n\n#st-editing-prefix-container {\n	border-collapse: collapse;\n	width: 100%;\n	padding: 0px;\n	margin: 0px;\n	margin-bottom: -20px;\n}\n\n#st-editing-prefix-container tr td {\n	margin: 0px;\n	padding: 0px;\n}\n\n#st-editing-title {\n	color: black;\n	background-color: white;\n	text-decoration: none;\n	font-weight: bold;\n	font-family: Helvetica, sans-serif;\n	font-size: 90%;\n	margin-bottom: 0.4em;\n}\n\n#st-wiki-title-invite {\n	font-size: 50%;\n	font-family: Helvetica, sans-serif;\n}\n\n#st-wiki-title-central-page-link {\n	font-size: 50%;\n	font-family: Helvetica, sans-serif;\n}\n\n#st-wiki-title-invite a {\n	color: #00f;\n}\n\n#st-wiki-logo {\n	text-align: center;\n	clear: both;\n}\n\n#st-wiki-logo-image {\n}\n\n.st-wiki-nav-actions {\n	float: right;\n	color: black;\n	font-size: 75%;\n	padding-top: 3px;\n}\n\n.st-wiki-nav-actions a {\n	padding: 2px;\n	color: white;\n	text-decoration: none;\n	font-family: Helvetica, sans-serif;\n}\n\n/* Wiki Subnav */\n\n#st-wiki-subnav {\n	margin-top: 2px;\n	font-size: 70%;\n	font-weight: bold;\n	font-family: Helvetica, sans-serif;\n	color: #888;\n}\n\n#st-wiki-subnav a {\n	padding: 2px;\n	color: #008;\n	text-decoration: none;\n}\n\n#st-wiki-subnav-right {\n	float: right;\n	margin-right: 6em;\n}\n\n#st-wiki-subnav-left {\n	float: left;\n	margin-left: 6em;\n}\n* html #st-wiki-subnav-left {\n	margin-left: 3em;\n}\n\n/* Wiki Navigation Search Bar */\n\n#st-search-form {\n	margin: 0;\n	padding: 0;\n	padding-top: 1px;\n}\n\n#st-search-form .button-table {\n	float: left;\n	font-size: 79%;\n	font-weight: bold;\n	margin-left: 5px;\n	margin-top: 1px;\n}\n\n#st-search-form #st-search-term {\n	float: left;\n	font-size: 60%;\n}\n\n/* Content Outline */\n\n#st-content-border, #st-edit-border {\n	position: relative;\n	clear: both;\n	margin-left: 3px;\n	margin-right: 2px;\n	margin-bottom: 0px;\n	margin-top: 0px;\n	border-bottom: 1px solid #eee;\n}\n\n#st-content-border-left, #st-edit-border-left {\n	background: url(&quot;../../images/st/page-shadow/left.gif&quot;) left top repeat-y;\n	position: relative;\n}\n\n#st-content-border-right, #st-edit-border-right {\n	background: url(&quot;../../images/st/page-shadow/right.gif&quot;) right top repeat-y;\n	position: relative;\n}\n\n#st-content-border-top, #st-edit-border-top {\n	position: relative;\n	background: url(&quot;../../images/st/page-shadow/top.gif&quot;) left top repeat-x;\n}\n\n#st-content-border-bottom, #st-edit-border-bottom {\n	background: url(&quot;../../images/st/page-shadow/bottom.gif&quot;) left bottom repeat-x;\n	position: relative;\n}\n\n#st-content-border-left-top, #st-edit-border-left-top {\n	background: url(&quot;../../images/st/page-shadow/left-top.gif&quot;) left top no-repeat;\n	position: relative;\n}\n#st-content-border-right-top, #st-edit-border-right-top {\n	background: url(&quot;../../images/st/page-shadow/right-top.gif&quot;) right top no-repeat;\n	position: relative;\n}\n\n#st-content-border-left-bottom, #st-edit-border-left-bottom {\n	background: url(&quot;../../images/st/page-shadow/left-bottom.gif&quot;) left bottom no-repeat;\n	position: relative;\n}\n\n#st-content-border-right-bottom, #st-edit-border-right-bottom {\n	background: url(&quot;../../images/st/page-shadow/right-bottom.gif&quot;) right bottom no-repeat;\n	padding-top: 5px;\n	padding-bottom: 9px;\n	position: relative;\n}\n\n* html #st-content-border-right-bottom, * html #st-edit-border-right-bottom {\n	padding-top: 4px;\n	padding-left: 7px;\n	padding-right: 8px;\n	position: relative;\n}\n\n.st-content-width-controller {\n	width: 100%;\n	position: relative;\n	border-collapse: collapse;\n}\n.st-content-width-controller td {\n	vertical-align: top;\n}\n.st-content {\n	position: relative;\n	background-color: white;\n	margin-top: 0px;\n	margin-left: 7px;\n	margin-right: 8px;\n	margin-bottom: -1px;\n	border-left: 1px dotted #80a9f3;\n	border-right: 1px dotted #80a9f3;\n	border: 1px solid #80a9f3;\n	padding: 6px 12px 12px 12px;\n}\n* html .st-content {\n	margin-top: 0px;\n	margin-left: 0px;\n	margin-right: 0px;\n}\n\n/* This textarea is only for Safari. However, if we use display:none; here Safari ignores the .value operation in JS */\n#st-raw-wikitext-textarea {\n	width:1px;\n	height:1px;\n	margin:0;\n	padding:0;\n}\n\n/* Action Buttons */\n.button-table, .button-table tr td {\n	border-collapse: collapse;\n	margin: 0;\n	padding: 0;\n}\n.button-rounded {\n	background: url('../../images/st/grey-button/left-top-rounded.png') top left no-repeat;\n	margin: 0;\n}\n.button-rounded-right-top {\n	background: url('../../images/st/grey-button/right-top-rounded.png') top right no-repeat;\n	margin: 0;\n}\n.button-rounded-left-bottom {\n	background: url('../../images/st/grey-button/left-bottom-rounded.png') bottom left no-repeat;\n	margin: 0;\n}\n.button-rounded-right-bottom {\n	background: url('../../images/st/grey-button/right-bottom-rounded.png') bottom right no-repeat;\n	margin: 0;\n}\n.button-straight {\n	background: url('../../images/st/grey-button/left-top-straight.png') top left no-repeat;\n	margin: 0;\n}\n.button-straight-right-top {\n	background: url('../../images/st/grey-button/right-top-straight.png') top right no-repeat;\n	margin: 0;\n}\n.button-straight-left-bottom {\n	background: url('../../images/st/grey-button/left-bottom-straight.png') bottom left no-repeat;\n	margin: 0;\n}\n.button-straight-right-bottom {\n	background: url('../../images/st/grey-button/right-bottom-straight.png') bottom right no-repeat;\n	margin: 0;\n}\n.button-content {\n	font-size: 90%;\n}\n.button-content a {\n	display: block;\n	padding: 2px;\n	padding-left: 10px;\n	padding-right: 10px;\n	font-family: Helvetica, Verdana, sans-serif;\n	font-weight: bold;\n	text-decoration: none;\n	color: black;\n}\n\n.button-content input.submit {\n	border: 0px;\n	padding: 2px;\n	padding-left: 10px;\n	padding-right: 10px;\n	font-family: Helvetica, Verdana, sans-serif;\n	font-weight: bold;\n	text-decoration: none;\n	color: black;\n	background-color: transparent;\n}\n\n/* Personal Homepage */\n\n#st-homepage {\n	background: white url(&quot;../../images/st/homepage/blue-fade.gif&quot;) top left no-repeat;\n}\n\n#st-homepage-layout {\n	margin-top: 15px;\n	clear: both;\n	width: 100%;\n	border-collapse: collapse;\n}\n\n#st-homepage-layout tr td.st-homepage-layout-cell {\n	padding: 5px;\n	vertical-align: top;\n}\n\n#st-homepage-layout-dashboard {\n	width: 50%\n}\n\n#st-homepage-layout-notes {\n	width: 50%;\n}\n\n#st-homepage-notes, #st-homepage-dashboard {\n	text-align: left;\n	width: 95%;\n}\n\n#st-user-greeting, #st-wiki-title {\n	font-family: Helvetica, Verdana, sans-serif;\n	font-size: 150%;\n}\n#st-wiki-title {\n	margin-left: 5px;\n}\n\n#st-user-greeting {\n	position: relative;\n	text-align: right;\n	float: right;\n}\n\n#st-group-notes-content, #st-personal-notes-content {\n}\n\n.st-homepage-section {\n	margin-bottom: 15px;\n}\n\n#st-homepage-notes .st-homepage-section {\n	background-color: white;\n	border: 1px solid #aaa;\n	padding: 15px;\n}\n\n.st-homepage-section-title {\n	font-size: 110%;\n	font-family: Helvetica, Verdana, sans-serif;\n}\n\n#st-homepage-notes .st-homepage-section-title {\n	color: #aaa;\n	text-decoration: underline;\n}\n\n.st-homepage-notes-edit-link {\n	background: url(&quot;../../images/st/homepage/edit-icon.gif&quot;) no-repeat left top;\n	display: block;\n	text-indent: -2000px;\n	height: 13px;\n	width: 36px;\n	text-decoration: none;\n	padding:0;\n}\n* html .st-homepage-notes-edit-link {\n	border:1px solid white;\n}\n\n.st-homepage-notes-edit {\n	font-family: Verdana, sans-serif;\n	font-size: 65%;\n	float: right;\n}\n\n.st-homepage-notes-content {\n	font-size: 85%;\n	margin-top: 10px;\n	padding-top: 0px;\n	padding-bottom: 0px;\n	font-family: Verdana, Helvetica, sans-serif;\n}\n\n#st-dyk {\n	border-color: #cca !important;\n	background-color: #ffe !important;\n}\n\n#st-dyk-title {\n	color: #e4a020 !important;\n	text-decoration: none !important;\n}\n\n\n/* Homepage Simple List */\n\n#st-whats-new-title-link {\n	background: url(&quot;../../images/st/homepage/icon-28-pages.gif&quot;) no-repeat left top;\n}\n#st-watchlist-title-link {\n	background: url(&quot;../../images/st/homepage/icon-28-star.gif&quot;) no-repeat left top;\n}\n#st-wikis-title-link {\n	background: url(&quot;../../images/st/homepage/icon-28-group.gif&quot;) no-repeat left top;\n}\n.st-homepage-simplelist-title-link {\n	display: block;\n	padding-left: 32px;\n	min-height: 32px;\n}\n* html .st-homepage-simplelist-title-link {\n	height: 32px;\n}\n\n.st-homepage-simplelist-title {\n}\n\n.st-homepage-simplelist-table {\n	margin-left: 25px;\n	border: 1px dashed #ddd;\n	border-collapse: collapse;\n	font-family: Verdana, Helvetica, sans-serif;\n	font-size: 80%;\n	width: 95%;\n}\n\n.st-homepage-simplelist-table td {\n	padding: 2px;\n}\n\n.st-homepage-simplelist-table tr.st-homepage-simplelist-row-odd {\n	background-color: #f3f7f7;\n}\n\n.st-homepage-simplelist-table tr.st-homepage-simplelist-row-even {\n	background-color: white;\n}\n\n.st-homepage-simplelist-table a {\n	color: #4f55dd;\n	text-decoration: none;\n}\n\n.st-homepage-simplelist-table a:visited {\n	color: #551a8b;\n}\n\n.st-homepage-simplelist-subleft {\n	font-size: 80%;\n	margin-left: 1em;\n	color: #666;\n}\n\n.st-homepage-simplelist-right {\n	width: 20%;\n}\n\n.st-homepage-simplelist-subright {\n	font-size: 80%;\n	color: #666;\n}\n\n.st-homepage-simplelist {\n}\n\n.st-homepage-simplelist-header {\n	min-height: 35px;\n}\n\n.st-homepage-simplelist-header .button-table {\n	float: right;\n	margin-right: 15px;\n	font-size: 95%;\n}\n\n.st-homepage-simplelist-header .button-table .button-content {\n	padding: 1px;\n}\n\n.st-homepage-whatsnew-author, .st-homepage-whatsnew-date {\n	color: #555;\n}\n.st-homepage-whatsnew-attribution {\n	padding-left: 1em;\n	font-size: 80%;\n	color: #aaa;\n}\n\n/* Homepage Wikis List */\n\n#st-wikis-title {\n}\n\n/* Data and Templates */\n\n.st-jst-template, .st-json {\n	display: none;\n}\n\n/* Page Sidebox Common Styles */\n\n#st-page-boxes-toggle {\n	position: relative;\n	float: right;\n	text-align: right;\n	font-family: Verdana, Arial, sans-serif;\n	font-weight: bold;\n	font-size: 80%;\n	margin-bottom: 0.7em;\n}\n\n#st-page-boxes-toggle-link {\n	text-decoration: none;\n}\n\n#st-page-boxes-underlay {\n	float: right;\n	margin-top: -10px;\n	margin-right: 10px;\n	background: white;\n	z-index: 198;\n	clear: both;\n	margin-left: 15px;\n}\n* html #st-page-boxes-underlay {\n	margin-right: 4px;\n}\n#st-page-boxes {\n	background: inherit;\n	position: absolute;\n	right: 23px;\n	z-index: 199;\n	margin-top: 15px;\n	margin-left: 20px;\n}\n#st-page-boxes, #st-page-boxes-underlay {\n	width: 225px;\n	/* padding-left: 15px; */ /* Gives the white border effect, cwest dislikes it. */\n}\n\n.st-page-box {\n	border: 1px solid black;\n	padding: 5px;\n	font-family: Verdana, Helvetica, sans-serif;\n	font-size: 80%;\n	margin-top: 15px;\n}\n\n.st-page-box-title {\n	font-family: Helvetica, Verdana, sans-serif;\n	font-weight: bold;\n	margin-bottom: 10px;\n}\n\n.st-page-box-listing {\n	margin: 0;\n	padding: 0;\n}\n\n.st-page-box-listing-entry {\n	display: block;\n}\n\n.st-page-boxes-nobacklinks {\n	font-family: Verdana, Helvetica, sans-serif;\n	font-size: 90%;\n	color: #888;\n}\n\n.st-page-box-first {\n	margin-top: 0px;\n}\n\n/* Page Display */\n\n#st-page-content {\n	clear: left;\n	margin-top: 6px;\n	margin-bottom: 0;\n	padding-bottom: 0;\n}\n\n#st-page-content, #st-page-content td {\n	font-family: Verdana, Helvetica, sans-serif;\n	font-size: 90%;\n}\n\n#st-page-wiki-title {\n	font-family: Helvetica, Verdana, sans-serif;\n	font-size: 65%;\n	font-weight: bold;\n	color: #aaa;\n	margin-bottom: 0.2em;\n	margin-top: 0.1em;\n	padding-top: 0;\n}\n\n#wiki {\n	margin: 0;\n	padding: 0;\n}\n\n#st-page-title {\n}\n\n#st-page-titletext, .st-page-title {\n	font-family: Helvetica, Verdana, sans-serif;\n	font-size: 150%;\n	font-weight: bold;\n	color: #888;\n	border-bottom: 1px solid #888;\n}\n\n#st-newpage-pagename-edit {\n	font-family: inherit;\n	font-size: inherit;\n	font-weight: inherit;\n	color: #000;\n	border: 1px solid black;\n	padding-left: 0.3em;\n	background-color: #ffd;\n}\n\n#st-page-details {\n	font-style: italic;\n	font-size: 75%;\n	font-family: Georgia, serif;\n	margin: 6px 10px 0 10px;\n}\n\n#st-page-details-feed-icon {\n	vertical-align: middle;\n	border: none;\n}\n\n#st-page-stats {\n	float: right;\n	vertical-align: middle;\n}\n\n#st-attribution {\n	float: left;\n	margin-bottom: 10px;\n}\n\n#st-page-editing-wysiwyg {\n  background: #ffd;\n  border-style: solid;\n  border-color: #888 #ccc #ccc #888;\n  border-width: 2px;\n  width: 100%;\n}\n\n#st-page-editing-toolbar {\n	margin-left: -6px;\n	overflow: hidden;\n	float: left;\n	height: 25px;\n}\n\n#wikiwyg_wikitext_textarea {\n	margin-top: 4px;\n  background: #ffd;\n  border-style: solid;\n  border-color: #888 #ccc #ccc #888;\n  border-width: 2px;\n  width: 100%;\n  font-family: monospace;\n}\n\n#st-page-maincontent {\n}\n\n#st-page-editing, #wikiwyg_wikitext_textarea {\n}\n\n#st-page-editing-pagebody-decoy, #st-page-editing-wysiwyg {\n	display: none;\n}\n\n#st-editing-tools-edit {\n	display: none;\n}\n\n#st-mode-wysiwyg-button\n{\n  font-size: 70%;\n  margin-left: 4em;\n}\n\n#st-mode-wikitext-button\n{\n  font-size: 70%;\n}\n\n#st-edit-tips\n{\n  font-size: 70%;\n}\n\n.wikiwyg_button {\n	background: #FFFFFF;\n	border: 1px solid #FFFFFF;\n	cursor: pointer;\n	width: 20px;\n	height: 20px;\n	vertical-align: bottom;\n}\n\n.wikiwyg_button:hover {\n	border: 1px outset;\n}\n\n.wikiwyg_button:active {\n	border: 1px inset;\n}\n\n#wikiwyg_toolbar {\n	display: none;\n}\n\n/* Sidebox Pagetools: Revisions, Watchlist */\n#st-side-box-pagetools {\n	border-collapse: collapse;\n}\n\n#st-rewind-norevisions {\n	font-family: Helvetica, Arial, sans-serif;\n	font-size: 11px;\n	color: #777;\n	text-decoration: none;\n}\n\n#st-side-box-pagetools a {\n	font-family: Helvetica, Arial, sans-serif;\n	font-size: 11px;\n	color: #555;\n	text-decoration: none;\n}\n\n/* Page View Tags/Incoming Links Sidebox */\n\n#st-tags {\n	background: #f4fff4;\n	border-color: #bbeebb;\n	color: #999;\n}\n\n#st-tags-title {\n	color: #595;\n}\n\n#st-tags-addlink, #st-tags-addbutton {\n	font-weight: bold;\n}\n\n#st-tags-listing {\n	margin-bottom: 5px;\n}\n\n#st-tags-addinput, #st-tags-message, #st-tags-suggestion {\n	display: none;\n}\n\n#st-tags-deletemessage {\n	font-size: 90%;\n	color: #555;\n	display: none;\n	margin-top: 0.5em;\n	margin-bottom: 0.5em;\n}\n\n#st-tags-suggestion {\n	margin-top: 2px;\n}\n\n.st-tags-level1 {\n	font-size: 90%;\n}\n\n.st-tags-level2 {\n	font-size: 100%;\n}\n\n.st-tags-level3 {\n	font-size: 110%;\n}\n\n.st-tags-level4 {\n	font-size: 120%;\n}\n\n.st-tags-level5 {\n	font-size: 130%;\n}\n\n.st-tags-tagline .st-tags-tagdelete {\n	text-decoration: none;\n	color: #ccc;\n}\n\n.st-tags-tagline a {\n	text-decoration: none;\n	color: #444;\n}\n\n#st-tags-field {\n	width: 95%;\n}\n\n#st-incoming-links {\n	border-color: #ebb;\n	background-color: #fff4f4;\n}\n\n#st-incoming-links-title {\n	color: #b78;\n}\n\n#st-attachments {\n	border-color: #bbe;\n	background-color: #f4f4ff;\n}\n\n#st-attachments-uploadbutton, #st-attachments-managebutton {\n\n}\n#st-attachments-buttons-uploadbutton {\n	margin: 0px;\n	padding: 0px;\n	padding-left: 2px;\n}\n#st-attachments-buttons-managebutton {\n	margin: 0px;\n	padding: 0px;\n	padding-right: 2px;\n}\n\n#st-attachments-buttons td {\n	padding-right: 3px;\n	font-size: 99%;\n}\n\n#st-attachments-buttons {\n	border-collapse: collapse;\n	margin: 0px;\n	padding: 0px;\n	margin-top: 5px;\n}\n\n#st-attachments-title {\n	color: #77b;\n}\n\n.st-attachments-line {\n	width:100%;\n	overflow:hidden;\n}\n\n/* Actions Bar */\n\n#st-actions-bar-spacer {\n	clear:both;\n	height:0.5em;\n	overflow:hidden;\n}\n\n#st-actions-bar-spacer-clear {\n	clear:both;\n	height:1px;\n	overflow:hidden;\n}\n\n\n#st-actions-bar, #st-editing-tools-bar {\n	margin-left: 30px !important;\n	margin-right: 30px !important;\n}\n\n/* Footer */\n#st-footer {\n	margin-top: -8px;\n	margin-bottom: 5px;\n	clear: both;\n}\n\n/* Socialtext Attribution */\n\n#st-socialtext-attribution {\n	clear: both;\n	text-align: center;\n	font-size: 80%;\n	font-family: Helvetica, sans-serif;\n}\n\n#st-socialtext-attribution-link {\n	text-decoration: none;\n}\n\n#st-socialtext-attribution-image {\n	border: 0;\n}\n\n\n/* Page Actions */\n\n#st-edit-button-border-left-middle, #st-login-to-edit-button-border-left-middle {\n	background: url(&quot;../../images/st/button-blue/left-middle.gif&quot;) left top repeat-y;\n}\n#st-edit-button-border-right-middle, #st-login-to-edit-button-border-right-middle {\n	background: url(&quot;../../images/st/button-blue/right-middle.gif&quot;) right top repeat-y;\n}\n\n#st-edit-button-border-left-top, #st-login-to-edit-button-border-left-top {\n	background: url(&quot;../../images/st/button-blue/left-top.gif&quot;) left top no-repeat;\n}\n#st-edit-button-border-right-top, #st-login-to-edit-button-border-right-top {\n	background: url(&quot;../../images/st/button-blue/right-top.gif&quot;) right top no-repeat;\n}\n\n#st-edit-button-border-left-bottom, #st-login-to-edit-button-border-left-bottom {\n	background: url(&quot;../../images/st/button-blue/left-bottom.gif&quot;) left bottom no-repeat;\n}\n\n#st-edit-button-border-right-bottom, #st-login-to-edit-button-border-right-bottom {\n	background: url(&quot;../../images/st/button-blue/right-bottom.gif&quot;) right bottom no-repeat;\n}\n\n#st-edit-button-link, #st-login-to-edit-button-link {\n}\n\n#st-comment-button-border-left-middle {\n	background: url(&quot;../../images/st/button-purple/left-middle.gif&quot;) left top repeat-y;\n}\n\n#st-comment-button-border-right-middle {\n	background: url(&quot;../../images/st/button-purple/right-middle.gif&quot;) right top repeat-y;\n}\n\n#st-comment-button-border-left-top {\n	background: url(&quot;../../images/st/button-purple/left-top.gif&quot;) left top no-repeat;\n}\n\n#st-comment-button-border-right-top {\n	background: url(&quot;../../images/st/button-purple/right-top.gif&quot;) right top no-repeat;\n}\n\n#st-comment-button-border-left-bottom {\n	background: url(&quot;../../images/st/button-purple/left-bottom.gif&quot;) left bottom no-repeat;\n}\n\n#st-comment-button-border-right-bottom {\n	background: url(&quot;../../images/st/button-purple/right-bottom.gif&quot;) right bottom no-repeat;\n}\n\n#st-comment-button-link {\n}\n\n#st-save-button-border-left-middle {\n	background: url(&quot;../../images/st/button-green/left-middle.gif&quot;) left top repeat-y;\n}\n#st-save-button-border-right-middle {\n	background: url(&quot;../../images/st/button-green/right-middle.gif&quot;) right top repeat-y;\n}\n\n#st-save-button-border-left-top {\n	background: url(&quot;../../images/st/button-green/left-top.gif&quot;) left top no-repeat;\n}\n#st-save-button-border-right-top {\n	background: url(&quot;../../images/st/button-green/right-top.gif&quot;) right top no-repeat;\n}\n\n#st-save-button-border-left-bottom {\n	background: url(&quot;../../images/st/button-green/left-bottom.gif&quot;) left bottom no-repeat;\n}\n\n#st-save-button-border-right-bottom {\n	background: url(&quot;../../images/st/button-green/right-bottom.gif&quot;) right bottom no-repeat;\n}\n\n#st-save-button-link {\n}\n\n#st-preview-button-border-left-middle {\n	background: url(&quot;../../images/st/button-gold/left-middle.gif&quot;) left top repeat-y;\n}\n#st-preview-button-border-right-middle {\n	background: url(&quot;../../images/st/button-gold/right-middle.gif&quot;) right top repeat-y;\n}\n\n#st-preview-button-border-left-top {\n	background: url(&quot;../../images/st/button-gold/left-top.gif&quot;) left top no-repeat;\n}\n#st-preview-button-border-right-top {\n	background: url(&quot;../../images/st/button-gold/right-top.gif&quot;) right top no-repeat;\n}\n\n#st-preview-button-border-left-bottom {\n	background: url(&quot;../../images/st/button-gold/left-bottom.gif&quot;) left bottom no-repeat;\n}\n\n#st-preview-button-border-right-bottom {\n	background: url(&quot;../../images/st/button-gold/right-bottom.gif&quot;) right bottom no-repeat;\n}\n\n#st-preview-button-link {\n}\n\n#st-cancel-button-border-left-middle {\n	background: url(&quot;../../images/st/button-crimson/left-middle.gif&quot;) left top repeat-y;\n}\n#st-cancel-button-border-right-middle {\n	background: url(&quot;../../images/st/button-crimson/right-middle.gif&quot;) right top repeat-y;\n}\n\n#st-cancel-button-border-left-top {\n	background: url(&quot;../../images/st/button-crimson/left-top.gif&quot;) left top no-repeat;\n}\n#st-cancel-button-border-right-top {\n	background: url(&quot;../../images/st/button-crimson/right-top.gif&quot;) right top no-repeat;\n}\n\n#st-cancel-button-border-left-bottom {\n	background: url(&quot;../../images/st/button-crimson/left-bottom.gif&quot;) left bottom no-repeat;\n}\n\n#st-cancel-button-border-right-bottom {\n	background: url(&quot;../../images/st/button-crimson/right-bottom.gif&quot;) right bottom no-repeat;\n}\n\n#st-cancel-button-link {\n}\n\n#st-edit-more-button-border-left-middle {\n	background: url(&quot;../../images/st/button-blue/left-middle.gif&quot;) left top repeat-y;\n}\n#st-edit-more-button-border-right-middle {\n	background: url(&quot;../../images/st/button-blue/right-middle.gif&quot;) right top repeat-y;\n}\n\n#st-edit-more-button-border-left-top {\n	background: url(&quot;../../images/st/button-blue/left-top.gif&quot;) left top no-repeat;\n}\n#st-edit-more-button-border-right-top {\n	background: url(&quot;../../images/st/button-blue/right-top.gif&quot;) right top no-repeat;\n}\n\n#st-edit-more-button-border-left-bottom {\n	background: url(&quot;../../images/st/button-blue/left-bottom.gif&quot;) left bottom no-repeat;\n}\n\n#st-edit-more-button-border-right-bottom {\n	background: url(&quot;../../images/st/button-blue/right-bottom.gif&quot;) right bottom no-repeat;\n}\n\n#st-edit-more-button-link {\n}\n\n.st-page-action-button-link {\n	min-height: 24px;\n	min-width: 100px;\n	text-align: center;\n	font-family: Helvetica, Verdana, sans-serif;\n	font-size: 90%;\n	text-decoration: none;\n	color: #fff;\n	font-weight: bold;\n	display: block;\n	padding-top: 8px;\n	padding-bottom: 0px;\n	margin-bottom: -3px;\n	width: 100%;\n	margin-left: -2px;\n}\n* html .st-page-action-button-link {\n	padding-top: 5px;\n	padding-bottom: 0px;\n	height: 24px;\n}\n\n.st-page-action-button {\n	float: left;\n	margin: 0;\n	padding: 0;\n	margin-right: 10px;\n	min-height: 20px;\n	border-collapse: collapse;\n	width: 100px;\n}\n\n/* Attach File Interface */\n\n#st-attachments-attachinterface {\n	font-family: Helvetica, sans-serif;\n	font-size: 90%;\n	display: none;\n	position: fixed;\n	left: 0px;\n	top: 0px;\n	width: 100%;\n	height: 100%;\n	z-index: 2000;\n	background-image: url(&quot;../../images/st/popup/bg.png&quot;);\n}\n#st-attachments-manageinterface {\n	font-family: Helvetica, sans-serif;\n	font-size: 90%;\n	display: none;\n	position: absolute;\n	left: 0px;\n	top: 0px;\n	width: 100%;\n	height: 100%;\n	z-index: 2000;\n	background-image: url(&quot;../../images/st/popup/bg.png&quot;);\n}\n\n* html #st-attachments-attachinterface {\n	background-image: none;\n}\n* html #st-attachments-manageinterface {\n	background-image: none;\n}\n* html .popup-overlay {\n	background-image: url(&quot;../../images/st/popup/bg.png&quot;);\n	background-color: #000;\n	opacity: .70;\n	position: absolute;\n	left: 0px;\n	top: 0px;\n	width: 100%;\n	height: 100%;\n	z-index: 2001;\n}\n\n#st-attachments-attach-interface {\n	z-index: 2002;\n	background-color: #fff;\n	color: #000;\n	border: 4px solid #ccc;\n	padding: 1em;\n	width: 520px;\n	margin-left: auto;\n	margin-right: auto;\n	margin-top: 10%;\n	position: absolute;\n	top: 0px;\n}\n\n* html #st-attachments-attach-interface {\n}\n\n#st-attachments-attach-formtarget {\n	width: 0px;\n	height: 0px;\n	border: 0;\n	padding: 0;\n	margin: 0;\n}\n\n#st-attachments-attach-message {\n	font-size: 90%;\n	font-family: Verdana, Arial, Helvetica, Sans-Serif;\n}\n\n#st-attachments-attach-title {\n	font-weight: bold;\n	font-size: 120%;\n}\n\n#st-attachments-attach-close {\n	float: right;\n	margin-top: 6px;\n}\n\n#st-attachments-attach-uploadbutton {\n	float: right;\n	margin-right: 6px;\n	margin-top: 6px;\n	padding-bottom: 0;\n}\n\n#st-attachments-attach-fileprompt {\n	margin: 0.2em 0 0.4em 0;\n	padding-bottom: 0px;\n}\n\n#st-attachments-attach-submit {\n	font-size: 90%;\n	font-weight: bold;\n}\n\n#st-attachments-attach-filename {\n	font-size: 90%;\n}\n\n#st-attachments-attach-uploadmessage {\n	font-weight: bold;\n	margin-bottom: 1em;\n	display: none;\n}\n\n#st-attachments-attach-error {\n	font-weight: bold;\n	color: #f00;\n	margin-bottom: 1em;\n	display: none;\n}\n\n#st-attachments-attach-list {\n	display: none;\n	color: #666;\n	font-size: 90%;\n	margin-top: 1em;\n	margin-bottom: 1em;\n	border-top: 1px solid #4949BA;\n	border-bottom: 1px solid #4949BA;\n	background-color: #F5F5F5;\n	padding: 3px;\n}\n\n.st-attachments-attach-listlabel {\n	font-size: 90%;\n	color: #4949BA;\n}\n\n/* Queue File Dialog */\n\n#st-attachmentsqueue-interface {\n	font-family: Helvetica, sans-serif;\n	font-size: 90%;\n	display: none;\n	position: fixed;\n	left: 0px;\n	top: 0px;\n	width: 100%;\n	height: 100%;\n	background-image: url(&quot;../../images/st/popup/bg.png&quot;); /* Don't forget IE hack for ship! */\n	z-index: 2000;\n}\n\n* html #st-attachmentsqueue-interface {\n	background-image: none;\n}\n\n#st-attachmentsqueue-dialog {\n	z-index: 2002;\n	background-color: #fff;\n	color: #000;\n	border: 4px solid #ccc;\n	padding: 1em;\n	width: 530px;\n	margin-left: auto;\n	margin-right: auto;\n	margin-top: 10%;\n	position: absolute;\n	top: 0px;\n}\n\n* html #st-attachmentsqueue-dialog {\n}\n\n#st-attachmentsqueue-fileprompt {\n	margin-bottom: 0.4em;\n	margin-top: 0;\n	padding-bottom: 0;\n}\n\n#st-attachmentsqueue-title {\n	font-weight: bold;\n	font-size: 120%;\n}\n\n#st-attachmentsqueue-close {\n	float: right;\n	margin-top: 6px;\n}\n\n#st-attachmentsqueue-uploadbutton {\n	float: right;\n	margin-right: 6px;\n	margin-top: 6px;\n	padding-bottom: 0;\n}\n\n#st-attachmentsqueue-submit {\n	font-size: 90%;\n}\n\n#st-attachmentsqueue-filename {\n	font-size: 90%;\n}\n\n#st-attachmentsqueue-message {\n	font-size: 90%;\n	font-family: Verdana, Arial, Helvetica, Sans-Serif;\n}\n\n#st-attachmentsqueue-uploadmessage {\n	font-weight: bold;\n	margin-bottom: 1em;\n	display: none;\n}\n\n#st-attachmentsqueue-error {\n	font-weight: bold;\n	color: #f00;\n	margin-bottom: 1em;\n	display: none;\n}\n\n#st-attachmentsqueue-list {\n	display: none;\n	color: #666;\n	font-size: 90%;\n	margin-top: 1em;\n	margin-bottom: 1em;\n	border-top: 1px solid #4949BA;\n	border-bottom: 1px solid #4949BA;\n	background-color: #F5F5F5;\n	padding: 3px;\n}\n\n.st-attachmentsqueue-listlabel {\n	font-size: 90%;\n	color: #4949BA;\n}\n\n/* Lists */\n\ntr.st-trbg-even, tr.st-trbg-even td{\n	background-color: #f3f7f7;\n}\n\ntr.w-st-even-row, tr.w-st-even-row td {\n	background-color: #f3f7f7;\n}\n\n.query-results-header-title, .query-results-header-last-edit-by {\n	text-align: left;\n}\n\n\n.query-results-row-revisions {\n	text-align: right;\n}\n\n.query-results-content {\n  font-size: 85%;\n  border-collapse: collapse;\n  border: 1px dashed #ddd;\n  border-left: 1px solid #ddd;\n  border-right: 1px solid #ddd;\n}\n\n.query-results-row {\n  border-collapse: collapse;\n  border: 1px dashed #ddd;\n  border-left: 1px solid #ddd;\n  border-right: 1px solid #ddd;\n}\n\n.query-results-row a {\n  text-decoration: underline;\n  color: #00f;\n}\n\n.query-results-row td {\n  font-family: Verdana;\n  padding: 0.3em;\n  border-left: 1px dashed #ddd;\n  border-right: 1px dashed #ddd;\n  border-top: 1px solid #ddd;\n  border-bottom: 1px solid #ddd;\n}\n\n.query-results-header-row {\n  border-collapse: collapse;\n  border: 1px dashed #ddd;\n  border-left: 1px solid #ddd;\n  border-right: 1px solid #ddd;\n}\n\n.query-results-header-row a {\n  text-decoration: underline;\n  color: #00f;\n}\n\n.query-results-header-row th {\n  font-family: Helvetica;\n  padding: 0.3em;\n  border-left: 1px dashed #ddd;\n  border-right: 1px dashed #ddd;\n  border-top: 1px solid #ddd;\n  border-bottom: 1px solid #ddd;\n}\n\ndiv.st-actionbutton {\n	float: left;\n}\n\ndiv#deleteme-st-actions-bar {\n	clear: both;\n	margin: 0.8em 20px 0.2em auto;\n	padding: 0;\n}\n\n/* Manage File Interface */\n\n\n\n#st-attachments-manage-interface {\n	z-index: 2002;\n	background-color: #fff;\n	color: #000;\n	border: 4px solid #ccc;\n	padding: 1em;\n	width: 520px;\n	margin-left: auto;\n	margin-right: auto;\n	margin-top: 10%;\n	position: absolute;\n	top: 0px;\n}\n\n#st-attachments-manage-filetable {\n	height: 150px;\n	margin: 0;\n	padding: 0;\n	width: 100%;\n	overflow: auto;\n	border: 1px solid #ccc;\n}\n\n#st-attachments-manage-filelisting tbody td {\n	font-size: 90%;\n}\n#st-attachments-manage-filelisting {\n	width: 100%;\n	border-collapse: collapse;\n	border: 0;\n	margin: 0;\n	padding: 0;\n}\n\n#st-attachments-manage-fileheader {\n	background: #ccc;\n	font-weight: bold;\n	border-bottom: 1px black solid;\n}\n\n#st-attachments-manage-close {\n	float: right;\n	margin-top: 3px;\n	margin-right: -2px;\n	font-weight: bold;\n}\n\n#st-attachments-manage-delete {\n	margin-top: 3px;\n	float: left;\n	font-weight: bold;\n}\n\n.st-attachments-manage-filerow {\n	border-bottom: 1px solid #ccc;\n}\n\n.row-odd {\n	background-color: #eee;\n}\n\n.row-even {\n	background-color: #fff;\n}\n\n.row-on {\n	background-color: #009 !important;\n	color: white !important;\n}\n\n.row-on a {\n	color: #fff !important;\n}\n\n#st-attachments-manage-deletemessage {\n	color: red;\n}\n\n/* Page tools icons */\n\n#st-pagetools-print {\n	background: url(&quot;../../images/st/pagetools/print.gif&quot;)\n	  left center no-repeat;\n}\n\n#st-pagetools-email {\n	background: url(&quot;../../images/st/pagetools/email.gif&quot;)\n	  left center no-repeat;\n}\n\n#st-pagetools-tools {\n	background: url(&quot;../../images/st/pagetools/tools.gif&quot;)\n	  left center no-repeat;\n}\n\n/*\n #st-pagetools-watch {\n	background: url(&quot;../../images/st/pagetools/watch-blue.gif&quot;)\n	  left center no-repeat;\n}\n*/\n\n\n/* *********** Settings *********** */\n\n#st-settings-pane {\n}\n* html #settings-pane { font-size: 85%;}\n\n.settings-start-table {\n}\n* html .settings-start-table { font-size: 90%;}\n\n#st-settings-select {\n	padding: 0px 10px 10px 10px;\n	vertical-align: top;\n	width: 1px;\n\n	background-color: #eff1ec;\n	border: none;\n}\n\n#st-settings-section {\n	padding: 0px 10px 10px 10px;\n	vertical-align: top;\n}\n\n.settings-top-header {\n	margin-top: 1em;\n	font-weight: bold;\n	width: 15em;\n}\n\n.settings-header {\n	margin-top: 1em;\n	font-weight: bold;\n}\n\n.settings-selections {\n	padding: 0px 0px 0px 20px;\n	line-height: 1.5em;\n}\n\n.settings-selections a:visited, .settings-selections a:active {\n	color: #0000ff;\n}\n\n.settings-link {\n	clear: both;\n	display: block;\n}\n\n.settings-section-left {\n	text-align: right;\n}\n\n.settings-label {\n	font-weight: bold;\n}\n\n.settings-help {\n	color: #888;\n}\n\n.settings-comment {\n}\n\n.users-invite-message {\n	padding: 0.5em 0.5em 0.5em 2em;\n	background-color: #eee;\n	/* This seems necessary to fix an IE bug that sometimes\n	   causes the text in this div to be invisible */\n	z-index: 1000;\n}\n\n.workspace-entry-header {\n	margin-top: .5em;\n	font-weight: bold;\n}\n\n.workspace-entry {\n	margin-left: 3em;\n}\n\n.workspace-entry-p {\n	margin-top: .5em;\n	margin-bottom: .75em;\n}\n\n.workspace-subentry {\n	font-style: italic;\n	font-weight: bold;\n	margin-left: 1.5em;\n}\n\n.preferences-td {\n	padding:.5em 0 1.5em 0;\n}\n\n.preferences-query {\n	text-align: left;\n}\n\n.preference-radio {\n	background-color: #cec;\n}\n.user-settings-listall-headings td {\n	background-color: #eff3ef;\n}\n\n#st-settings-save {\n	padding-bottom: 0.5em;\n}\n\n.standard-button-cancel {\n	font-weight: bold;\n	background-color: #71004b;\n\n	border-left: 1px solid #aaa;\n	border-top: 1px solid #aaa;\n	border-bottom: 2px solid #333;\n	border-right: 2px solid #333;\n	color: #f4f3b9;\n	width: 8em;\n}\n\n.standard-button-submit {\n	font-weight: bold;\n	background-color: #656084;\n\n	border-left: 1px solid #aaa;\n	border-top: 1px solid #aaa;\n	border-bottom: 2px solid #333;\n	border-right: 2px solid #333;\n	color: #f4f3b9;\n	width: 8em;\n}\n\n#st-settings {\n	font-family: Verdana, Arial, Helvetica, Sans-Serif;\n	font-size: 90%;\n}\n\n\n/* Listview Tabs */\n\n\n#st-listview a:visited {\n	color: #551a8b;\n}\n#st-listview-tabs ul {\n  display: block;\n  list-style: none outside;\n  margin: 0 0 0 4em;\n  padding: 0;\n  font-family: Helvetica, Arial, Sans-serif;\n  font-size: 80%;\n}\n\n#st-listview-tabs li {\n  display: block;\n  float: left;\n  margin: 0 0.8em 0 0;\n  padding: 3px 0.6em 0 0.6em;\n  border: 1px solid #d8d8d8;\n  border-bottom: 1px solid rgb(128, 169, 243);\n  background-color: #f4f4f4;\n  position: relative;\n  bottom: -2px;\n}\n\n#st-listview-tabs li.spacer {\n  margin: 0 0.8em 0 2em;\n}\n\n#st-listview-tabs a {\n  color: #bbb;\n  text-decoration: none;\n}\n\n#st-listview-tabs li.selected {\n  background-color: #fff !important;\n  border: 1px solid rgb(128, 169, 243) !important;\n  border-bottom: 1px solid #fff !important;\n  font-weight: bold !important;\n}\n\n#st-listview-tabs li.selected a {\n  color: #000 !important;\n}\n\n/*  Category List Display */\n\n#st-category-display-links {\n	margin-bottom: 1em;\n	font-size: 90%;\n}\n\n#st-tag-listbody {\n	font-family: Helvetica, Verdana, sans-serif;\n}\n\n/* Attachments List Display */\n\n#st-attachments-list-body table.button-table {\n	margin-top: 0.1em;\n	font-size: 80%;\n}\n\n\n/* **********   PageTools Menu   ************** */\n\ndiv#st-editing-tools {\n	float: left;\n}\n\ndiv#st-pagetools {\n	z-index: 300;\n	font-family: Helvetica, Verdana, sans-serif;\n	font-size: 10px;\n	float: right;\n	margin: 18px 0 0 0em;\n	color: #000;\n	vertical-align: bottom;\n	position: relative;\n}\n\n#st-pagetools a {\n	text-decoration: none;\n	color: black;\n	padding-left: 17px;\n}\n\n#st-pagetools span {\n	color: inherit;\n	padding-left: 17px;\n	vertical-align: top;\n}\n\n#st-pagetools span.st-watchlist-link {\n	color: inherit;\n	vertical-align: top;\n}\n\n.st-watchlist-link {\n	cursor: pointer;\n}\n\ndiv#st-pagetools ul.level2 {\n	z-index: 300;\n	margin: 0;\n	padding: 0;\n	background: white;\n	border: 1px solid #CCC;\n	border-width: 0 1px;\n}\n\ndiv#st-pagetools li {\n	position: relative;\n	list-style: none;\n	margin: 0;\n	float: left;\n	width: 7em;\n	line-height: 11px;\n}\n\ndiv#st-pagetools ul ul li:hover {\n	background: #BFE2FF;\n}\n\ndiv#st-pagetools li a {\n	display: block;\n	text-decoration: none;\n}\n\ndiv#st-pagetools&gt;ul a {\n	width: auto;\n}\n\ndiv#st-pagetools ul ul {\n	position: absolute;\n	width: auto;\n	display: none;\n}\n\ndiv#st-pagetools ul ul li {\n	line-height: 1.5em;\n/*	width: 100%; */\n	width: 14em;\n}\n\n.first {\n	border-top: 1px solid #CCC;\n}\n\n.separator {\n	border-bottom: 1px solid #CCC;\n}\n\ndiv#st-pagetools ul ul li a {\n	border-bottom: 1px solid #CCC;\n	padding-left: 15px;\n	padding-right: 3px;\n	margin-right: 3px;\n	border: 0px;\n}\n\ndiv#st-pagetools li.submenu li.submenu:hover {\n	z-index: 300;\n	background-color: #BFE2FF;\n}\n\ndiv#st-pagetools ul.level1 li.submenu:hover ul.level2 {\n	display:block;\n}\n\ndiv#st-pagetools ul.level2 {\n	top: 1.0em;\n	left: -9.5em;\n}\n\n/*\n\n=head2 Revision List Display\n\nChange these styles to update the page revision list.\n\n*/\n\n#st-revision-list-table {\n  border-collapse: collapse;\n  font-size: 85%;\n	color: #000;\n}\n\n.st-page-title-decorator {\n	color: #C80000;\n}\n\n.st-revision-header-emphasis {\n	color: #C80000;\n}\n\n.st-revision-list-compare-button-row {\n}\n\n.st-revision-list-compare-button-cell {\n  padding-top: 0.3em;\n	text-align: center;\n}\n\n.st-revision-list-compare-button {\n}\n\n#st-revision-list-header-row {\n}\n\n#st-revision-list-header-select {\n	padding: 6px 2px 2px 2px;\n	text-align: center;\n}\n\n#st-revision-list-header-revision {\n	padding: 6px 2px 2px 2px;\n	text-align: left;\n}\n\n#st-revision-list-header-edited-by {\n	padding: 6px 2px 2px 2px;\n	text-align: center;\n}\n\n#st-revision-list-header-date {\n	padding: 6px 2px 2px 2px;\n	text-align: center;\n}\n\n.st-revision-list-row {\n  border-collapse: collapse;\n  border: 1px dashed #ddd;\n  border-left: 1px solid #ddd;\n  border-right: 1px solid #ddd;\n}\n\n.st-revision-list-row td {\n  font-family: Verdana;\n  padding: 0.3em;\n  border-left: 1px dashed #ddd;\n  border-right: 1px dashed #ddd;\n  border-top: 1px solid #ddd;\n  border-bottom: 1px solid #ddd;\n}\n\n.st-revision-list-row-select {\n	padding: 3px 0 2px 0;\n	text-align: center;\n}\n\n.st-revision-list-row-select-old {\n}\n\n.st-revision-list-row-select-new {\n}\n\n.st-revision-list-row-revision {\n}\n\n.st-revision-list-row-revision-link {\n}\n\n.st-revision-list-row-edited-by {\n}\n\n.st-revision-list-row-date {\n}\n\n/* Revision Menu */\n\n#st-pagetools.st-revision-view-bar {\n	float: left;\n}\n\nul.st-revision-menu {\n	list-style: none;\n	margin: 0;\n	padding: 0.2em;\n	font-size: 80%;\n}\n\nul.st-revision-menu li {\n	float: left;\n	padding: 0 0.4em 0 0.4em;\n	border-right: thin solid #000000;\n}\n\nul.st-revision-menu li.st-last {\n	border-right: none;\n}\n\n#st-restore-revision-button {\n	font-size: 80%;\n}\n\n/*\n\n=head2 Revision Compare Display\n\nWhen comparing two revisions of a page, these styles apply.\n\n*/\n\n#st-revision-compare-table {\n	background-color: #f0f0f0;\n}\n\n#st-revision-compare-table td {\n	background-color: white;\n}\n\n.st-revision-compare-old {\n	background-color: #fdd;\n	text-decoration: line-through;\n}\n.st-revision-compare-new {\n	background-color: #dfd;\n	font-weight: bold;\n}\n\n/* Weblog View */\n\n#st-weblog {\n	padding: 0;\n}\n\n#st-content-weblog-display-width-controller {\n}\n#st-content-weblog-display-width-controller-nav {\n	width: 230px;\n	margin-left: 15px;\n	border-left: 5px solid #ddd;\n	margin-top: -1px;\n}\n\n#st-weblog-content {\n	font-family: Verdana, Helvetica, sans-serif;\n	margin-top: -1px;\n	margin-bottom: -1px;\n	border-top: 1px solid #80a9f3;\n	border-bottom: 1px solid #80a9f3;\n}\n\n#st-weblog-title {\n	font-family: &quot;Trebuchet MS&quot;, Verdana, Helvetica, sans-serif;\n	font-family: &quot;Times New Roman&quot;, serif;\n	background-color: #80a9f3;\n	color: #fff;\n	font-size: 150%;\n	font-weight: bold;\n	padding: 0.2em;\n	padding-left: 1em;\n}\n\n#st-weblog-wikititle {\n	font-family: Helvetica, Verdana, sans-serif;\n	font-style: italic;\n	font-size: 40%;\n	color: #fff;\n	margin-bottom: 0.2em;\n	margin-top: 0.1em;\n	padding-top: 0;\n}\n\n#st-weblog-titletext {\n	font-family: Helvetica, Verdana, sans-serif;\n	font-weight: bold;\n	color: #fff;\n}\n\ndiv.st-weblog-entry {\n	margin-top: 0.2em;\n	margin-bottom: 4.8em;\n	padding: 0 1.5em 0 1.5em;\n}\n\n.st-page-title {\n	clear: both;\n}\n\ndiv.st-weblog-entrytitle span.text {\n	font-family: Helvetica, Verdana, sans-serif;\n	font-size: 150%;\n	font-weight: bold;\n	color: #000;\n}\n\n.st-weblog-entrycontent {\n	font-family: Verdana, Helvetica, sans-serif;\n	font-size: 90%;\n	border-bottom: 1px solid #888;\n}\n\n.st-weblog-byline {\n	float: left;\n	text-align: left;\n	font-style: italic;\n	font-size: 70%;\n	font-family: Verdana, Helvetica, sans-serif;\n}\n\n.st-weblog-post-links {\n	float: right;\n	text-align: right;\n	font-size: 70%;\n	font-family: Verdana, Helvetica, sans-serif;\n}\n\n#st-weblog-archives, #st-weblog-navigation {\n	position: relative;\n	float: right;\n	width: 230px;\n}\n\n#st-weblog-archives {\n	margin-top: 15px;\n	clear: right;\n}\n\n#st-weblog-archives-title, #st-weblog-navigation-title {\n	margin-left: 15px;\n	font-family: Helvetica, sans-serif;\n	font-size: 95%;\n	font-weight: bold;\n	color: #999;\n	border-bottom: 2px solid #f99;\n	padding-bottom: 5px;\n	padding-top: 5px;\n	margin-bottom: 5px;\n}\n\n#st-weblog-navigation-content {\n	margin-left: 15px;\n	font-size: 80%;\n}\n\n#st-weblog-archives ul {\n	margin: 0;\n	padding: 0;\n}\n\n#st-weblog-archives ul li {\n	/* list-type: none; */\n	display: block;\n	font-size: 80%;\n	font-family: Helvetica, sans-serif;\n	padding-left: 15px;\n}\n\n#st-weblog-newpost {\n	padding: 0.5em 0.7em 0.3em 0.3em;\n}\n\n#st-weblog-newpost-button {\n}\n\n#st-weblog-actionbar-chooseweblog {\n	float: right;\n}\n\n#st-weblog-postbyemail {\n	font-size: 70%;\n	font-family: Verdana, Helvetica, sans-serif;\n	color: #def;\n	padding-top: 0.4em;\n}\n\n#st-weblog-postbyemail-link {\n	color: #00c;\n}\n\n.st-weblog-chooseprompt {\n	font-size: 90%;\n	font-family: Verdana, Helvetica, sans-serif;\n	padding-right: 0.2em;\n	color: #000;\n}\n\n.st-spacer {\n	padding-right: 0.1em;\n	padding-left: 0.1em;\n}\n\n.st-weblog-preventries {\n	padding-bottom: 20px;\n	clear: both;\n}\n.st-weblog-nextentries {\n	clear: both;\n}\n\ndiv.st-weblog-entrynav {\n	margin-top: 0.2em;\n	margin-bottom: 1.8em;\n	padding: 0;\n}\n\nspan.st-weblog-previousentries, span.st-weblog-nextentries {\n	font-size: 90%;\n	font-family: Verdana, Helvetica, sans-serif;\n	padding-left: 1em;\n}\n\n/* ******* Page Stats ******** */\n\n#st-usagereport-navbar {\n	font-size: 80%;\n	padding: 0;\n	margin: 0;\n}\n\n#st-usagereport-date {\n	font-weight: bold;\n	margin-top: 1em;\n}\n\n#st-page-usagereport h1 {\n	font-size: 1.3em;\n	font-weight: bold;\n	margin-top: 1.2em;\n	margin-bottom: 0.3em;\n}\n\n#st-page-usagereport h2 {\n	font-size: 1.1em;\n	font-weight: bold;\n	margin-top: 0.8em;\n	margin-bottom: 0.3em;\n}\n\n/* New Page */\n#st-newpage-save, #st-newpage-duplicate {\n	display: none;\n	position: fixed;\n	left: 0px;\n	top: 0px;\n	width: 100%;\n	height: 100%;\n	background: url(&quot;../../images/st/popup/bg.png&quot;); /* Don't forget IE hack for ship! */\n	z-index: 2000;\n}\n\n#st-newpage-save-interface {\n	background-color: #fff;\n	color: #000;\n	border: 4px solid #ccc;\n	padding: 0.5em;\n	width: 450px;\n	margin-left: auto;\n	margin-right: auto;\n	margin-top: 10%;\n	position:absolute;\n	top:0px;\n	z-index:2003;\n}\n\n#st-newpage-duplicate-interface {\n	background-color: #fff;\n	color: #000;\n	border: 4px solid #ccc;\n	padding: 0.5em;\n	width: 530px;\n	margin-left: auto;\n	margin-right: auto;\n	margin-top: 10%;\n	position:absolute;\n	top:0px;\n	z-index:2003;\n}\n\n#st-newpage-save-title, #st-newpage-duplicate-title {\n	margin: 0;\n	padding: 0;\n	font-weight: bold;\n	font-family: Helvetica, sans-serif;\n	font-size: 100%;\n}\n\n#st-newpage-save-prompt, #st-newpage-duplicate-prompt {\n	font-family: Helvetica, sans-serif;\n	font-size: 90%;\n	margin-bottom: 0.4em;\n}\n\n#st-newpage-save-buttons, #st-newpage-duplicate-buttons {\n	margin-top: 0.8em;\n	text-align: right;\n}\n\n.st-newpage-duplicate-option {\n	font-family: Helvetica, sans-serif;\n	font-size: 90%;\n	margin: 0;\n	padding: 0;\n}\n\n#st-newpage-duplicate-pagename {\n	font-size: 90%;\n}\n\n.st-newpage-duplicate-emphasis {\n	background-color: #FFFF00;\n	font-weight: bold;\n}\n\n#st-newpage-save-field-pagename {\n	margin-bottom: 0;\n	margin-top: 0.2em;\n	padding-bottom: 0;\n	font-size: 90%;\n}\n\n#st-newpage-save-tip {\n	margin-bottom: 0;\n	margin-top: 1.2em;\n	padding-bottom: 0;\n	font-size: 75%;\n	color: #888;\n}\n\n/* Wikitext Styling */\n\n.wiki {\n}\n\n.wiki hr {\n	margin-top: .4em;\n	margin-bottom: .4em;\n}\n\n.wiki .short-rule {\n	width: 25%;\n}\n\n.wiki .medium-rule {\n	width: 50%\n}\n\n.wiki ul,\n.wiki ol,\n.wiki blockquote {\n	margin-left: 2em;\n	padding-left: 0em;\n}\n\n.wiki table {\n	border-collapse: collapse;\n}\n\n.wiki td {\n	border: 1px;\n	border-style: solid;\n	padding: .2em;\n	vertical-align: top;\n}\n\n.wiki h1,\n.wiki h2,\n.wiki h3,\n.wiki h4,\n.wiki h5,\n.wiki h6 {\n	font-weight: bold;\n	font-style: normal;\n	margin-top: 0.1em;\n	margin-bottom: 8px;\n}\n\n.wiki h1 {font-size: 200%;}\n.wiki h2 {font-size: 170%;}\n.wiki h3 {font-size: 145%;}\n.wiki h4 {font-size: 125%;}\n.wiki h5 {font-size: 110%;}\n.wiki h6 {font-size: 100%;}\n\n.wiki pre {\n	background-color: #eee; /* XXX */\n	margin-left: 1em;\n	margin-right: 1em;\n	padding: .2em;\n}\n\n.wiki .incipient {\n	text-decoration: none;\n	border-bottom: 1px dashed;\n}\n\n.wiki-include-title {\n	background-color: #ccccff;\n}\n\n.wiki .wiki {\n	position: relative;\n	background-color: #ddddff;\n	border: 1px solid #ccccff;\n	padding: 3px;\n}\n\n.wafl_existence_error {\n	color: rgb(200,0,0);\n	border-bottom: 0.2em dashed rgb(200,0,0);\n}\n\n#st-edit-mode-container {\n}\n\n#st-edit-mode-view {\n}\n\n#st-page-editing-uploadbutton {\n	z-index: 1500;\n	float: left;\n}\n\n/* Comment UI */\n\n\nbody#st-commentui {\n	background: #ffffff;\n}\n\n#st-commentui-container {\n}\n\n#st-commentui-container a:visited,\n#st-commentui-container a:active {\n	color: #00f;\n}\n\n#st-commentui-notetop {\n}\n\n#st-commentui-controls {\n}\n\n#st-commentui-savelink {\n	background-color: #fffebd;\n}\n\n#st-commentui-cancellink {\n}\n\n#st-commentui-customfield {\n}\n\n#st-commentui-customfield .customfield-label {\n}\n\n#st-commentui-customfield .customfield-input {\n}\n\n#st-commentui-textarea {\n	padding: 0;\n	border-style: inset;\n	border-width: thin;\n	background-color: #ffd;\n	color: black;\n	width: 99%;\n	height: 150px;\n}\n\n/*\n\n=head2 Send Page by Email\n\nStyles for the &quot;Send Page by Email&quot; popup, accessed from the &quot;Email&quot; dropdown\nmenu on the page bar.\n\n*/\n\n#email-page {\n	background: #ffffff;\n	font-size: 80%;\n}\n\n.email-page-row {\n	clear: both;\n}\n\n.email-page-row-label {\n	font-weight: bold;\n	float: left;\n	width: 5em;\n	margin-left: 1.2em;\n	margin-right: 1.2em;\n	text-align: right;\n}\n\n.email-page-row-content {\n	float: left;\n	padding-bottom: 1.2em;\n}\n\n.email-page-user-select-column {\n	float: left;\n	padding-right: 1.2em;\n	width: 14em;\n}\n\n#email-page-user-select-column-center {\n	width: 10em;\n}\n\n.email-page-user-select-label {\n	text-align: center;\n}\n\n#email-page-user-select-add-label {\n	padding-top: 1em;\n}\n\n.email-page-user-select-button-group {\n	padding-bottom: 2em;\n}\n\n.email-page-input {\n	width: 120px;\n	clear: both;\n	display: block;\n}\n\n\n.email-page-select {\n   width: 175px;\n   font-size: x-small;\n}\n\n#email-page-error-message {\n	text-align: center;\n}\n\n#email-page-buttons-container {\n	clear: both;\n}\n\n#email-page-buttons {\n	text-align: center;\n}\n\n.email-page-input-new {\n	width: 175px;\n}\n\n/* System Status, Red with icon */\n\n#st-system-status-alert {\n	clear: both;\n	width: 50%;\n	margin-left: 25%;\n	margin-top: 10px;\n	padding: 5px;\n	color: #c00;\n	font-weight: bold;\n	font-size: 80%;\n	background: transparent url(&quot;../../images/st/system-message/important-note.gif&quot;) no-repeat 5px center;\n	padding-left: 60px;\n	min-height: 38px;\n}\n* html #st-system-status-alert {\n	height: 38px;\n}\n\n/* System Status, Green */\n\n#st-system-status {\n	clear: both;\n	text-align:center;\n	width: 80%;\n	margin-left: 10%;\n	padding: 8px 0 3px 0;\n	color: #0a0;\n	font-family: Arial, Helvetica, sans-serif;\n	font-size: 80%;\n}\n\n.socialtextLogo {\n	text-align: center;\n}\n\n/*}}}*/\n</div>
<div tiddler="SocialtextStyleOverrides" modifier="Martin Budden" modified="200611040000" created="200609300000" tags="styles excludeLists excludeSearch">/***\nSocialtextStyleOverrides\n***/\n\n/*{{{*/\n.headerShadow {padding: 2em 0em .5em 1em;}\n.headerForeground {padding: 2em 0em .5em 1em;}\n\n#st-page-wiki-title {\n	font-size: 80%;\n}\n.subtitle {\n	font-style: italic;\n	font-size 80%;\n}\n\n/* from #st-tags */\n.tagged {\n	border-color: #bbeebb;\n	background-color: #f4fff4;\n}\n\n.tagged .listTitle {\n	color: #595;\n	font-weight: bold;\n}\n\n.tagged .button {\n	color: #000;\n}\n\n.selected .tagged {\n	background-color: ColorPalette::TertiaryLight;\n	border: 1px solid ColorPalette::TertiaryMid;\n}\n\n/* from #st-incoming-links */\n.tagging {\n	border-color: #ebb;\n	background-color: #fff4f4;\n}\n\n.tagging .listTitle {\n	color: #b78;\n	font-weight: bold;\n}\n\n.tagging .button {\n	color: #999;\n}\n\n.selected .tagging {\n	background-color: ColorPalette::TertiaryLight;\n	border: 1px solid ColorPalette::TertiaryMid;\n}\n\n.tiddler {/* Tiddler body */\n	border:1px solid #ccc;\n	margin:0.5em;\n	background:#fff;\n	padding:0.5em;\n}\n\n.viewer blockquote {border-left: 0px solid}\n\n.tiddlyLinkNonExisting {\n	font-style: italic;\n	border-bottom: 1px dashed;\n}\n\n.editor input, .editor textarea {\n	background: #ffd;\n	border-style: solid;\n	border-color: #888 #ccc #ccc #888;\n	border-width: 2px;\n}\n\n.tabContents {white-space: nowrap;}\n\n#displayArea {margin: 1em 20em 0em 14em;}\n\n#sidebar {\n	position: absolute;\n	right: 3px;\n	width: 21em;\n	font-size: .9em;\n}\n\n#sidebarOptions .button {\n	border-color: #eee;\n}\n\n#sidebarTabs .tabContents {\n	width: 20em;\n	overflow: hidden;\n}\n\n.viewer tt {\n	font-size: 1.2em;\n	line-height: 1.4em;\n}\n\nul {list-style-type: square;}\nul ul {list-style-type: circle;}\n\nol {list-style-type: decimal;}\nol ol {list-style-type: decimal;}\nol ol ol {list-style-type: decimal;}\nol ol ol ol {list-style-type: decimal;}\nol ol ol ol ol {list-style-type: decimal;}\nol ol ol ol ol ol {list-style-type: decimal;}\n\n/*}}}*/\n</div>
<div tiddler="StyleSheet" modifier="JeremyRuston" modified="200611020000" created="200609300000" tags="excludeLists excludeSearch">[[SocialtextScreenStyle]]\n[[SocialtextStyleOverrides]]\n[[Styles HorizontalMainMenu]]</div>
<div tiddler="Styles HorizontalMainMenu" modifier="Martin Budden" modified="200611040000" created="200609300000" tags="excludeLists excludeSearch">/***\nTo use, add {{{[[Styles HorizontalMainMenu]]}}} to your StyleSheet tiddler.\nYou must also copy the contents of [[PageTemplate HorizontalMenu]] to PageTemplate.\n***/\n/*{{{*/\n#topMenu br {display:none;}\n#topMenu {background: #08c}\n#topMenu {padding:2px;}\n#topMenu .button,  #topMenu .tiddlyLink {\n	margin-left:1em; margin-right:1em;\n	color:white;\n	font-size:115%;\n}\n\n#displayArea {margin: 1em 20em 0em 1em;}\n\n/* just in case want some QuickOpenTags in your topMenu */\n#topMenu .quickopentag {padding:0px; margin:0px; border:0px;}\n#topMenu .quickopentag .tiddlyLink {padding-right:1px;}\n#topMenu .quickopentag .button {padding-left:1px; border:0px;}\n\n@media print { #topMenu {display: none ! important;} }\n/*}}}*/\n</div>
<div tiddler="Sync" modifier="JeremyRuston" modified="200610260000" created="200610260000" tags="excludeLists excludeSearch">&lt;&lt;sync&gt;&gt;</div>
<div tiddler="SyncChanges" modifier="JeremyRuston" modified="200611081502" created="200611081502" tags="excludeLists excludeSearch">@@The user interface for synchronization is not finalized@@\nTo synchronize your changes back to the Socialtext server:\n# click on [[Sync]] in the right-hand sidebar</div>
<div tiddler="TabMore" modifier="JeremyRuston" modified="200611190000" created="200611190000" tags="excludeLists excludeSearch">&lt;&lt;tabs txtMoreTab Orphans 'Orphaned tiddlers' TabMoreOrphans Shadowed 'Shadowed tiddlers' TabMoreShadowed&gt;&gt;</div>
<div tiddler="Test" modifier="matt.campbell@metrotech.org" modified="200702011844" created="200702011844" tags="[[Matt's Blog]] Email SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="test" socialtext.version="20070201184433">From: &quot;Matt Campbell&quot; &lt;mailto:matt.campbell@metrotech.org&gt;\nDate: Thu, 1 Feb 2007 12:43:57 -0600 \nTest of email into weblog\n\nAttachments for page:\n* {file: attachment-22722-0.html}\n\n</div>
<div tiddler="TiddlySaver" modifier="JeremyRuston" modified="200611031222" created="200608211539" tags="">The TiddlySaver Java applet allows TiddlyWiki from a {{{file://}}} URL to save changes Safari, Opera and other browsers.\n\nIt is a small file named [[&quot;TiddlySaver.jar&quot;|TiddlySaver.jar]] that must be placed in the same directory as your TiddlyWiki file. Before you can use it, you need to give it the necessary privileges by editting your {{{.java.policy}}} file.\n\nFor Windows, the file will be at {{{C:\sDocuments and Settings\syour-user-name\s.java.policy}}}. Add the following lines (substituting the directory of your TiddlyWiki file as appropriate):\n{{{\ngrant codeBase &quot;file:${user.home}/My Documents/tiddlywiki-folder/*&quot; {\n  permission java.io.FilePermission &quot;${user.home}${/}My Documents${/}tiddlywiki-folder${/}*&quot;, &quot;read,write&quot;;\n};\n}}}\nOn Mac OS X, the file is found at {{{/Users/your-user-name/.java.policy}}}:\n{{{\ngrant codeBase &quot;file:${user.home}/Documents/tiddlywiki-folder/*&quot; {\n  permission java.io.FilePermission &quot;${user.home}${/}Documents${/}tiddlywiki-folder${/}*&quot;, &quot;read,write&quot;;\n};\n}}}\nIt can be tricky creating files whose name starts with a period, so you can use this [[pre-built .java.policy file|.java.policy]]. The same file is suitable for Macs too, just edit it and delete the &quot;My &quot; bit, leaving just &quot;Documents&quot;. Make sure you save it in the right place for each operating system!\n\nNote that there is currently [[a bug|http://trac.tiddlywiki.org/tiddlywiki/ticket/172]] that prevents TiddlySaver from working if you have specified a backup directory in AdvancedOptions.\n</div>
<div tiddler="UnravelFireFoxPermissions" modifier="JeremyRuston" modified="200611081353" created="200611081353" tags="excludeLists excludeSearch">Under FireFox, you can run into problems if you accidentally click 'Deny' on the permission request dialog, and have selected //Remember this decision//.\n\nTo reverse the effects, first locate the file {{{prefs.js}}} in your FireFox profile directory. Under Windows you'll find it at something like {{{C:\sDocuments and Settings\sJeremy\sApplication Data\sMozilla\sFirefox\sProfiles\so3dhupu6.default\sprefs.js}}}, where {{{Jeremy}}} is the name of your windows profile and {{{o3dhupu6}}} will be a similar string of gobbledegook. On the Mac it'll be at {{{~/Library/Application Support/Firefox/Profiles/o3dhupu6.default/prefs.js}}} and on most versions of Linux, at {{{~/.mozilla/firefox/o3dhupu6.default/prefs.js}}}.\n\nOpen the file in a text editor and find the line {{{user_pref(&quot;capability.principal.codebase.p0.denied&quot;, &quot;UniversalXPConnect&quot;);}}} and simply replace the word {{{denied}}} with {{{granted}}}.\n//(Thanks to JonScully for figuring out this fix)//</div>
<div tiddler="ViewTemplate" modifier="JeremyRuston" modified="200611081453" created="200611020000" tags="excludeLists excludeSearch">&lt;!--{{{--&gt;\n&lt;div class='toolbar' macro='toolbar closeTiddler closeOthers +editTiddler references jump'&gt;&lt;/div&gt;\n&lt;div class='workspace' id='st-page-wiki-title' macro='view socialtext.workspace'&gt;&lt;/div&gt;\n&lt;div class='title' id='st-page-titletext' macro='view title'&gt;&lt;/div&gt;\n&lt;div class='subtitle'&gt;\nCreated on &lt;span macro='view created date [[MMM DD, 0hh:0mm]]'&gt;&lt;/span&gt;.\nUpdated by &lt;span macro='view modifier link'&gt;&lt;/span&gt;\non &lt;span macro='view modified date [[MMM DD, 0hh:0mm]]'&gt;&lt;/span&gt;&lt;/div&gt;\n&lt;div class='tagging' macro='tagging'&gt;&lt;/div&gt;\n&lt;div class='tagged' macro='tags'&gt;&lt;/span&gt;&lt;/div&gt;\n&lt;div class='viewer' macro='view text wikified'&gt;&lt;/div&gt;\n&lt;div class='tagClear'&gt;&lt;/div&gt;\n&lt;!--}}}--&gt;</div>
<div tiddler="Wikispace" modifier="dave.rolsky@socialtext.com" modified="200702022240" created="200612271703" tags="SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="wikispace" socialtext.version="20070202224011">^ What is it?\n\nThis is a project to allow a Socialtext installation to use the same wiki *name* (like &quot;stoss&quot; or &quot;help&quot;) across multiple &quot;wikispaces&quot;. In practice, a wikispace is generally going to be three things, a web hostname (www.socialtext.net), an email hostname (socialtext.net), and an IP address.\n\n^ Goals\n\nThe main goal of this project is to allow Socialtext to offer our hosted service customers their own choice of domain name, and to allow different domains to use the same workspace name, so we can have socialtext.net/stoss and example.com/stoss on the same server and Socialtext installation.\n\n^ Plan\n\nSee https://repo.socialtext.net:8999/svn/planning/trunk/hwd/wikispace.hwd for the project plan. Sorry, non-ST folks, this still requires auth, but will eventually be public once we finish jiggering about our repos.\n\n^^ Implementation\n\nThe data will be stored in a table named &quot;Wikispace&quot; where name + web hostname and name + email hostname are both unique keys.\n\nIn the simplest case, the web and email hostname will be the same. For the Socialtext hosted service, this is likely to be fairly common. We'll have clients that want to use wiki.someclient.com for both web and email. As a bonus, if they move over to an appliance hosted in-house, they can just change their DNS.\n\nFor appliance users, a common pattern may be to use www.someclient.com for the web side and someclient.com.\n\nJohn T, our sysadmin, suggested that we could simply store one hostname, and special-case a missing &quot;www.&quot; in the email receiving code. This would probably be ok, but I like to avoid special cases, and supporting two hostnames instead of one is not a big deal.\n\nThe reason for requiring an IP address is to allow for our config generation scripts to generate proper Apache2 config bits when using SSL.\n\n^^^ Code changes\n\nThere will be at least one Wikispace row in every Socialtext installation. This will use the system's hostname as web and email hostnames. This is the default wikispace.\n\nIn every spot where we instantiate a new `Socialtext::Workspace` object, we need to (optionally) pass a wikispace_id parameter. The wikispace_id will be determined in one of the following ways:\n\n* `Socialtext::Workspace` will default to using the default wikispace_id.\n* In the web app code, we will determine what hostname was used in the request and use this to find a wikispace_id.\n* In the email handling code, we will use the email address's domain.\n* The CLI code will allow an optional --wikispace_id or --hostname parameter when it needs to determine a workspace.\n** The CLI code will also accept a --workspace_id parameter, which will simplify our use of it in the Ceqlotron and other internals uses.\n* When creating a new workspace via the web UI, the new workspace will inherit the wikispace_id of the workspace from which the user is using the UI.\n\n^^^^ Filesystem paths\n\nWorkspaces will now use their workspace_id as the distinguishing part of path names on the filesystem, rather than the workspace name. Support/sysadmin staff may want an easy way to determine what paths belong to a workspace, and vice versa.\n\nTODO: Consult with support on how to make this change easiest for them.\n\nThis will require a migration tool to rename the directories and change existing _index.txt_ symlinks in the _data_ directories.\n\n^^^ Apache2 config changes\n\nApache2 is already configured to listen to &quot;*:80&quot; for non-SSL requests. This means it will handle requests for all names &amp; ips, so adding a new hostname will just work, without requiring an additional `&lt;VirtualHost&gt;` block. However, we will still need to list all of the valid hostnames with `ServerAlias` directives in order for Apache2 to accept a request for a hostname.\n\nApache2 allows for one `ServerName` directive per VHost block. This value is only used when Apache generates a URI internally, either for redirects or error pages. I do not think this will affect our app, but we need to double check.\n\nFor SSL, we need to generate one &lt;VirtualHost&gt; block for each hostname/IP/SSL cert. Handling wildcard certs is an open issue.\n\nSocialtext's hosted service configuration includes some rewrite rules to redirect all requests to www.socialtext.net. This needs to be revisited. We also have a special-case where we redirect SSL requests for socialtext.net to www.socialtext.net. This requires an additional SSL cert for the socialtext.net hostname. This sort of configuration will continue to be a special-case handled by the sysadmin.\n\nFor usage reporting to work properly, we will need to change the access logs to include the hostname, and change the log parsing code to look for this.\n\n^^^ Email (SMTP) changes\n\nWe want to move away from the _aliases.deliver_ file we currently use, and have the SMTP server simply look up a given address to see if it should be delivered to the application.\n\nSince we will be making this change, John T wants to take this opportunity to move to Postfix on the production server. According to John T, we can have Postfix make a SQL query to determine whether or not a given address matches a workspace.\n\nAs a bonus, we will configure postfix to pass the email address to which it is delivering when calling `st-admin`. This means that if a workspace is BCC'd, we can still parse the address for categories.\n\nTODO: Determine how this affects appliances.\n\n^^^ Application &quot;control&quot; changes\n\nNote for STOSS readers, this is feature not yet available in the Open version of the software.\n\nWe will add a new column to the workspace listing table to show the web hostname. This will be the leftmost column in the table, and will be sortable.\n\nThe new default sort order will be by web hostname and then workspace name.\n\nWe will also add a new &quot;button&quot; at the top of the control system to list all web hostnames. This will be a table listing the hostname and number of workspaces it contains. The hostname will be clickable, and will lead to a page listing just the workspaces for that hostname, similar to how the account detail page works.\n\n^^ User Interface/Experience Implications\n\nThis project involves several user-facing changes.\n\n^^^ Login is per domain\n\nThis is because being logged-in is controlled by the presence of a cookie. A cookie can be shared across a domain (www.socialtext.net and wiki.socialtext.net) but not across hostnames (www.socialtext.net and www.example.com).\n\nThis means that if a user logs into one domain and follows a link to another domain, they have to log in to that domain, whether or not we host both of them.\n\nDiscussing this and other related issues with Adina, we decided that we will need [Single Sign-on] before actually offering per-customer domains on the hosted service. We'll still release this project without that, but we won't start selling custom domains until [Single Sign-on] is done.\n\n^^^ WAFL which refers to workspace name\n\nWe have a variety of WAFL constructs that refer to other workspaces by name, for example {{ {category workspace} }}. In the initial release, the assumption will be that the workspace being named is in the same wikispace as the current workspace. In the future, we can tweak the wafl syntax to allow for a hostname parameter. Chris suggested something like {{ {category www.example.com:workspace} }} which I like.\n\n^^ Open Loops\n\nThere are some aspects of this project which could use some feedback.\n\n^^^ Updating dev-bin scripts\n\nTo what degree should scripts in dev-bin be changed to work with the wikispace concept. Specifically, there are various scripts that expect to be able to load a workspace by name only. I'm inclined to leave at least some of them alone, since I don't think they'll be used going forward.\n\n^^^^ upgrade-index-files\n\nThis was a migration script from the Huxley release. *Not being updated*\n\n^^^^ import-workspace-user-data-2\n\nAnother Huxley migration script. *Not being updated*\n\n^^^^ purge-old-help-pages\n\nAnd yet another Huxley migration script. *Not being updated*\n\n^^^^ nlwsearch\n\nExpects a workspace name followed by a search query as CLI args. There is no backwards compatible way to handle this. There is no wa to distinguish an optional wikispace id or hostname from search query.\n\nMy opinion is that if this is useful, it might as well be made part of the `st-admin` script:\n\n.pre\nautarch&gt; st-admin search-workspace --name help --query &quot;socialtext&quot;\n.pre\n\n^^^ Identify a workspace in the application log\n\nCurrently, the application logs some things via syslog to a file named _/var/log/nlw.log_. We currently parse those logs in order to generate per-workspace statistics. To make things more complicated, we compile these stats by simplying copying the relevant lines out of this log to per-workspace files, timestamped by date. Every time the stats are requested we re-parse those per-workspace files. This means that we can't simply change the file format going format and change the parser at the same time. We still have to contend with all those old files.\n\nThe logs contain the workspace name, as opposed to the workspace id, so in the new wikispace world, we cannot reliably identify a workspace based on what's in the logs.\n\nMy plan is to change the workspace name in the log file to a workspace id. In theory, this should be backwards compatible, since in the old lines copied to the per-workspace files, we no longer need to get the workspace name. The files are already associated with a workspace by virtue of being in the proper directory on the filesystem.\n\n^^^ Apache logs\n\nTo make things extra fun, we also parse the Apache logs for some other stats. The apache logs need to changed to include the hostname that was used in the request, and parser needs to look for that.\n\n^^ Questions (and some Answers)\n\n^^^ Where does the help workspace go?\n\nWe _don't_ want to allow this workspace name in more than one wikispace. We already have a set of reserved words which can't be used for workspace names. We will add a check to ensure that no more than one help workspace exists per installation.\n\nWhen generating the URI for help links, we can simply instantiate a `Socialtext::Workspace` object for the help workspace and call `uri()` on it to get the right URI.\n\nHowever, the *same* help workspace will actually be available under all hostnames.\n\n^^^ How are user accounts and cookies handled?\n\nWe should make sure that the code uses the most generic domain settings for cookies, so that cookies are shared across a domain (like socialtext.net). Users will still need to log once for each domain (but not hostname).\n\nNote that user accounts are still global across an installation, so even though they're logging in more than once, they're logging in with the same account.\n\nA future enhancement would be to implement some sort of single sign-on system per-installation.\n\n^^^ What will the workflow look like for adding a new Wikispace?\n\nThe workflow will be substantially the same for new or existing customers on the hosted service, as well as on an appliance.\n\n* Configure DNS for the new domain name. For the hosted service, this may require Socialtext to change our DNS, for example to support a domain like &quot;someclient.socialtext.net&quot;.\n* If the new domain will require SSL support ...\n** We will have to provide a new IP address for the new DNS record on the hosted service.\n** Make sure that the system is configured to use the new IP address.\n** The appropriate SSL certificates need to be installed. For the hosted service, we will probably want a script to confirm that the cert we get is in the right format, isn't expired, etc.\n* Add the new Wikispace via the `st-admin` CLI tool.\n* Regen the Apache2 config with the `gen-config` tool. This will need a new option for `gen-config` telling it to generate part of the config based on the contents of the Wikispace table.\n** Whether or not to generate SSL config for a Wikispace's web hostname will be based on the presence of matching SSL certs.\n** This can't be the default, since `gen-config` needs to work before the application is installed, meaning before the DBMS is configured. (note to self, double-check this assumption)\n* Move workspace(s) to the new wikispace. This can be done via `st-admin set-workspace-config` or via the `psql` shell if there are a huge number of workspaces to move.\n* Restart Apache2 if we added new SSL domains.\n\nIf we make sysadmin scripts for facilitating this, we will want to package them for the appliance.\n\n^^^ How does this affect the sales provisioning code?\n\nPresumably not at all, since the default wikispace_id will be for &quot;www.socialtext.net&quot;.\n\n^^^ How will Socialtext bill for this on the hosted service?\n\nThere are two costs for Socialtext to consider.\n\nThe initial setup will require some support/sysadmin work to add a new Wikispace, regen Apache config, possibly install SSL certs, etc. If we are providing SSL support for the web hostname, then we need to use an IP address for that domain, and that represents an ongoing cost.\n</div>
<div tiddler="Wikithon" modifier="raines@mac.com" modified="200702032317" created="200701231634" tags="SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="wikithon" socialtext.version="20070203231756">^ Come to our Wikithon!\n\nOn Wednesday February 7th in Palo Alto, the same day as &quot;&quot;&lt;http://upcoming.org/event/147681/&gt;&quot;Wiki Wednesday&quot;&lt;http://upcoming.org/event/147681/&gt;, Socialtext is hosting an all day open hackathon. Our entire development team will be in town and our doors are open for you. For now, reserve the date, note your participation below and check this page for updates.\n\n^^ Remote Access\n\nCan't make it to our offices at 665 High St. in Palo Alto? No problem! Please feel free to follow along remotely (and if you want to remotely pair with someone to accomplish a particular task, please note that here as well). When you've completed your project, make a page in &quot;/stoss&quot;&lt;http://socialtext.net/stoss&gt; describing it, and tag it 'wikithon' so other people can find it. We'll be doing a show and tell of the hackathon output in the evening at &quot;Wiki Wednesday&quot;&lt;http://upcoming.org/event/147681/&gt; - so even if you can't hack with us, please come to Wiki Wednesday and admire all the cool things people made.\n\n^^ Infrastructure\n\nWe're putting some infrastructure in place so that local and remote participants can collaborate:\n\n* IRC - irc.freenode.net, channel #socialtext\n* One open conference meeting rooms - 555 (external callers call 1 877-GET-WIKI and then the extension)\n* VNC servers available for connection: oak.socialtext.net:1 and oak.socialtext.net:2\n* Food and beverages will be available at the office\n\n^^ Ideas\n\nEven if you're having trouble thinking of anything to work on, come on by and see if you can lend someone else a hand. We're eagerly looking forward to some cool new Socialtext plugins and hopefully some new API clients. We'll have some folks hanging out who are familiar with Socialtext internals, to help you get started on your widget.\n\n^^ Contest\n\nWe're going to have two contests during the Wikithon - best Socialtext Plugin or best new Socialtext API Client. Prizes are still to be determined, but we hope to encourage our hackers to come up with cool new ways to extend and use our application.\n\n^^^ Who will be there?\n\nIf you'll be there, let us know on the &quot;Upcoming&quot;&lt;http://upcoming.org/event/146659&gt;, and your name and your interest to the table below.\n\n| *who* | *what* |\n| zbir | Hack on News Boy? |\n| [Andy Lester] | [Performance investigation and enhancements] |\n| [Luke Closs] | Wiki streams? |\n| [Matthew O'Connor] | Whatever strikes my fancy |\n| [Eugene Eric Kim] | Philanthropic grants/Wiki mashup. Or something else (purple). |\n| Gordon McCreight | wikiCalc, SQLite, and Rose::DB::Object. Also, how cool is &quot;Inkscape&quot;&lt;http://www.inkscape.org/&gt;? |\n| [Casey West] | undecided... (I'm still on vacation) |\n| [Chris Dent] | Probably whatever Matthew or Eugene fancy. And general helping out. |\n| [Matt Liggett] | Purple transclusion using external nid server (proof of concept done w/Ingy at last wikithon), and then getting a purplized modern mailman installed for Socialtext's mailing lists. |\n| [Don Park] | Add &quot;Identicon&quot;&lt;http://tinyurl.com/2rslq8&gt; to Wiki and WikiCalc/SocialCalc |\n| [Dan Bricklin] | wikiCalc vs. SocialCalc, wikiCalc/SocialCalc Q&amp;A, work on SocialCalc quick hack together? Anything else? (Using Skype Video between my Massachusetts office/studio and a machine set up somewhere at Socialtext) |\n| &quot;Kevin Marks&quot;&lt;http://epeus.blogspot.com&gt; | I'll think of something microformatty |\n| [Adina Levin] | [xpost] |\n| [Shawn Devlin] | Widget to pull values from other wiki pages (variables?) |\n| Edwin Khodabakchian | Undecided |\n| &quot;Liz Henry&quot;&lt;http://bookmaniac.net&gt; | Learn stuff, compile information, try an install, work on FAQ |\n| [Zak Greant] | Learn more about the Socialtext and wiki community; Get involved in crazytalk about data structures for personal information; Learn more cool wiki hacks. |\n| [Raines Cohen] | Explore wikis for real-world community-building, placeblogs, citizen journalism, and save-the-world climate-crisis advocacy. |\n</div>
<div tiddler="Wikiwyg" modifier="halseide@gmail.com" modified="200702040659" created="200611061520" tags="Wikiwyg SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="wikiwyg" socialtext.version="20070204065946">^^ Welcome to the Wikiwyg Wiki Homepage\n\n----\n\n^^^^ Site Guide:\n\n* [Wikiwyg Features]\n* [Wikiwyg Architecture]\n* [Wikiwyg Documentation Index]\n* [Wikiwyg Implementors Guide]\n* [Wikiwyg on Socialtext]\n* [Wikiwyg on Kwiki]\n* [Wikiwyg on MediaWiki]\n* [Wikiwyg on Trac]\n* [Wikiwyg on TWiki]\n* [Spread Wikiwyg]\n\n----\n\n&quot;Wikiwyg&quot;&lt;http://www.wikiwyg.net/&gt; is a &quot;WYSIWYG browser editor framework&quot;&lt;http://www.geniisoft.com/showcase.nsf/WebEditors&gt; for wikis. It is designed to be pluggable on top of existing &quot;wiki engines&quot;&lt;http://www.wikimatrix.org/&gt;, with little or no change to the wiki engine's core software.\n\nWikiwyg has been successfully integrated with the following wiki engines: Socialtext, Kwiki, MediaWiki, Trac and TWiki.\n\nWikiwyg is designed to be a modal editor. You can flip back and forth between WYSIWYG and WikiText and Preview modes in a single editing session. Other available/possible modes are Raw-HTML and Multi-User modes. Wikiwyg can even be configured to use just WikiText mode, and still provides many user benefits over a traditional textarea.\n\nWikiwyg currently support WYSIWYG mode in Firefox and IE 6+. It supports WikiText mode in those browsers, and Safari as well. In unsupported browsers, a Wikiwyg integration should fall back to the wiki engines regular edit interface.\n\n----\n\n[Ross Mayfield] of Socialtext asked that we put the &quot;Wikiwyg Wiki&quot;&lt;http://www.socialtext.net/stoss/index.cgi?wikiwyg&gt; inside of the &quot;Socialtext Open Source Projects Wiki&quot;&lt;http://www.socialtext.net/stoss/&gt;. To help differentiate Wikiwyg pages from other projects, please tag Wikiwyg pages with {category: Wikiwyg}.\n\n{category_list: Wikiwyg}\n\n---\nanyone want to do an inst all for me on my mediawiki site? must be completely client-side\n\n_contributed by {user: halseide@gmail.com} on {date: 2007-02-04 06:59:46 GMT}_\n</div>
<div tiddler="Wikiwyg Implementors Guide" modifier="halseide@gmail.com" modified="200702032347" created="200611272121" tags="[[Recent Changes]] SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="wikiwyg_implementors_guide" socialtext.version="20070203234710">Integrating Wikiwyg into an existing wiki engine or other Web application is a multi-step process.\n\n^^ Add CSS and JS headers to pages\n\n^^ Subclass Wikiwyg\n\n^^ Subclass Wikiwyg.Wikitext\n\n^^ Subclass Wikiwyg.Preview\n\n^^ Customize Wiki syntax\n\n^^ Handle rendering requests\n\n^^ Handle save requests\n\n^^ Further customizations\n\n^^^ format_*\n\n^^^ do_*\n\n^^^ Dynamic content\n\n^^^ Custom toolbar buttons\n\n^^^ Image browsing\n\n^^^ Image upload\n\n^^^ Tables\n</div>
<div tiddler="Wikiwyg on TWiki" modifier="ross.mayfield@socialtext.com" modified="200702030532" created="200702030150" tags="Wikiwyg SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="wikiwyg_on_twiki" socialtext.version="20070203053241">up: [Wikiwyg]\n\nsee http://twiki.org/cgi-bin/view/Plugins/WikiwygContrib\n</div>
<div tiddler="Zac Bir, 2007-01-31" modifier="zac.bir@socialtext.com" modified="200701311416" created="200701311401" tags="[[zac blog]] [[daily blog]] [[daily dev blog]] SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="zac_bir_2007_01_31" socialtext.version="20070131141625">^^^ &quot;I coulda been a contendah. I coulda been somebody, instead of a bum, which is what I am.&quot;\n\nWatched _On the Waterfront_ last night. Am glad to be a knowledge worker.\n\n^^^ Plug it up\n\nPushed out my two pluggable branches to the new public repository. Pluggable-auth is further along in terms of documentation and approachability. The new branch pluggable-creds-extractor is little more than a spike at the moment, and needs more iteration planning in the future.\n</div>
<div tiddler="Zak Greant" modifier="zak@fooassociates.com" modified="200702030712" created="200702030701" tags="SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="zak_greant" socialtext.version="20070203071200">*About Me:* Lite-weight hacker. Hobbyist cook. Free Software and Open Source advocate. \n*Personal:* http://zak.greant.com\n*Professional:* http://fooassociates.com\n</div>
<div tiddler="alester 2007-01-30" modifier="andy.lester@socialtext.com" modified="200701310539" created="200701302119" tags="[[alester's weblog]] [[Daily Blog]] [[Recent Changes]] SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="alester_2007_01_30" socialtext.version="20070131053943">^ Socialtext Open under mod_perl2\n\nI've successfully pulled together all the parts to actually serve up a login page for Socialtext Open only using mod_perl 2.\n\nPutting the pieces together is a lot like the joke of carving a ship out of a block of wood. &quot;Carve away all the pieces of wood that don't look like a ship.&quot; Every time I get something working in the code, I move forward a little bit and find a new unexpected something. It's slow and tedious work, but at least there's progress to be had.\n\n^ More public workspaces\n\nThe European Perl Hackathon is now at &lt;http://rakudo.org/perlhack2007nl/&gt;.\n\n^ Phoenix Perl Mongers and open development\n\nThe Phoenix Perl Mongers group has asked me to come speak. One of the things they specifically asked if I could talk about was about internals of development here at Socialtext: &quot;whatever you're authorized to talk about on the technical side -- it's always interesting to get peeks into other Perl-using companies&quot;. This could be an interesting little topic, and could be of value to new non-staff folks as we open the kimono.\n\n----\n\n^ Tuesday\n\n* Continuing Rug project work\n* -Announce next Chicago.PM meetings-\n\n^ This week\n\n* Release an update of WWW::Mechanie\n* Talk with Dan about opening the kimono, and how he can get on to the stoss train\n** Need to work wikicalc into the new layout\n* OSCON proposals: Deadline is 2/5\n** Mech in Ruby\n** Job hunting\n** Tech debt\n* Talk to Phoenix.pm about planning\n</div>
<div tiddler="alester 2007-01-31" modifier="andy.lester@socialtext.com" modified="200702010604" created="200701312146" tags="[[alester's weblog]] [[Daily Blog]] [[Recent Changes]] SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="alester_2007_01_31" socialtext.version="20070201060420">^ My worthless head\n\nI have a head cold, so I've done almost nothing today. I spent the morning sleeping on the couch, waiting for the glorious Robitussin CF to kick in, and this afternoon I'm so stuffy I can't think about much.\n\nI hate a head cold more than any other affliction. Anything that messes with my head, with how I think, makes me unhappy. At least with a stomach flu or something I could think clearly about my misery.\n\n^ Real talking\n\nHad a great talk today w/Shawn, just about nothing in particular. We were IMing for about 10 minutes about blogging, and I said &quot;Why are we typing this? Call me,&quot; and we talked for a good half hour after that.\n\nI'd really like to see us talking more. The bandwidth is so much higher, especially in the human aspects. If nothing else, it was nice to hear someone wish me well, since I am all wheezy. I think we forget the importance of the little social grease.\n\n----\n\n^ Wednesday\n\n* Continuing Rug project work\n\n^ This week\n\n* Release an update of WWW::Mechanize\n* Talk with Dan about opening the kimono, and how he can get on to the stoss train\n** Need to work wikicalc into the new layout\n* OSCON proposals: Deadline is 2/5\n** Mech in Ruby\n** Job hunting\n** Tech debt\n* Talk to Phoenix.pm about planning\n</div>
<div tiddler="alester 2007-02-01" modifier="andy.lester@socialtext.com" modified="200702020617" created="200702011628" tags="[[alester's weblog]] [[Daily Blog]] [[Recent Changes]] SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="alester_2007_02_01" socialtext.version="20070202061747">^ My head is better\n\nMost of my head cold is gone, but I'm still a little fuzzy.\n\n^ Wikithon\n\nFinally sent out an announcement to the [Socialtext Open mailing lists] about the upcoming [Wikithon]. It's less than a week away! I should send a note to Chicago.pm, too, since the [Chicago.pm] wiki runs on Socialtext Open.\n\n^ F2F projects\n\nI've started an [F2F projects] page, for the things we need to work on that aren't going to be done at the [Wikithon].\n\n^ What I've been doing in the code\n\nFolks who have only just now seen all the code that I've been committing to our new local repo may be interest in code changes that I've been making here and there:\n\n* Only use those modules necessary\n** I've been checking to make sure that we're not including unnecessary modules. It's not for any sort of programmatic efficiency, but for programmer efficiency and de-clutter.\n* Explicitly specify import lists.\n** When use-ing a module, I'm trying to specify imports, or an explicit empty `()` if there are none. This makes it clear what is or isn't getting pulled into your namespace.\n* In test files, explicitly check the type returned on objects via isa_ok()\n** It makes sure that you have a valid object coming back, and it's of the type you want.\n* Add func docs as much as I can\n** So many of our functions have no docs. As I've been digging through code for the [Rug project], I'm slapping documentation on any function that wasn't immediately obvious as to its purpose and parameters.\n* Quote the heredocs to make it explicitly if we have interpolation.\n** Specifying `$foo =&lt;&lt;'END'` or `$foo =&lt;&lt;&quot;END&quot;` makes it explicit whether or not you want to interpolate in the string. `$foo =&lt;&lt;END` makes the reader think about it.\n\n----\n\n^ Thursday\n\n* -Move trunk from SF to new repo-\n* Announce move\n* Continuing Rug project work\n* Figure how to handle the OSR default flag in build/defaults.pl\n\n^ Friday\n\n* Release 2.9.5.1 to SF\n** Update the CHANGES file from all the releases\n** Upload to SF\n* Bring over Rug as branch off of `sf-open`\n\n^ This week\n\n* Release an update of WWW::Mechanize\n* Talk with Dan about opening the kimono, and how he can get on to the stoss train\n** Need to work wikicalc into the new layout\n* OSCON proposals: Deadline is 2/5\n** Mech in Ruby\n** Job hunting\n** Tech debt\n* Talk to Phoenix.pm about planning\n</div>
<div tiddler="alester 2007-02-02" modifier="andy.lester@socialtext.com" modified="200702031947" created="200702021802" tags="[[alester's weblog]] [[Daily Blog]] [[Recent Changes]] SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="alester_2007_02_02" socialtext.version="20070203194704">^ WoW Poetry\n\nI've been getting back into World Of Warcraft lately. Last night, a little bit of overzealous exploring inspired me to write a poem, which I will recite for you now:\n\n&gt; The Burning Steppes\n&gt; Are not for you\n&gt; If you're level\n&gt; 22\n\nThank you.\n\n^ Is time an illusion\n\nhttp://digg.com/general_sciences/Is_time_an_illusion is pointing at one page of Wired's 42 questions wiki. 650 diggs as I write this.\n\n----\n\n^ Friday\n\n* [Rug and Wikispaces Retrospective]\n* Release 2.9.5.1 to SF: [Socialtext Open release: 2.9.5.1]\n** Update the CHANGES file from all the releases\n** Upload to SF\n* Bring over Rug as branch off of `sf-open`\n* Announce move\n* Continuing Rug project work\n* Figure how to handle the OSR default flag in build/defaults.pl\n* Talk to lukec about extracludes\n\n^ This week\n\n* Release an update of WWW::Mechanize\n* OSCON proposals: Deadline is 2/5\n** Mech in Ruby\n** Job hunting\n** Tech debt\n* Talk to Phoenix.pm about planning\n</div>
<div tiddler="lukec, 2007-01-30" modifier="luke.closs@socialtext.com" modified="200701310655" created="200701310403" tags="[[Daily Blog]] [[Daily Dev Blog]] [[Luke's Dev Log]] SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="lukec_2007_01_30" socialtext.version="20070131065529">http://farm1.static.flickr.com/59/374004336_1f0b436341.jpg?v=0\n\n^ Back from Vacation\n\nI had an awesome mini-vacation at &quot;Big White&quot; &lt;http://bigwhite.com&gt; this weekend.  Learning to snowboard is _hard_.\n\n^^ Catching up\n\nI was impressed by and greatful for the great job Matthew did with the iteration plan this week.  The plan made it really easy for me to catch up on this week's priorities, goals and tasks.  I felt like I could jump in and be productive with the team on this week's stories right away.  Admittedly, I was only away for a day, so things hadn't changed _that_ much, but it was a great catch-up.  And story tests too!  Oh my.\n\n^ Wiiki\n\nWell, it was over a month ago that I created [Wiiki], showing Socialtext to be the first enterprise wiki to run on the &quot;Wii&quot; &lt;http://wii.nintendo.com&gt;.  &quot;Atlassian has it wrong!&quot; &lt;http://blogs.atlassian.com/rebelutionary/archives/2007/01/confluence_on_a_nintendo_wii.html&gt;.\n\n^ Open ID\n\n&quot;Ross&quot; &lt;http://ross.typepad.com/blog/&gt; introduced me to some folks at &quot;Janrain&quot; &lt;http://janrain.com&gt; for help implementing Open ID in Socialtext.  I'm going to wait for more of Zac's pluggable goodness, which should make this easier.\n\nI also just saw &quot;this post&quot; &lt;http://radar.oreilly.com/archives/2007/01/openid_get_it_f.html&gt;, which talks about idproxy.net which uses &quot;Yahoo's authentication API&quot; &lt;http://developer.yahoo.com/auth/&gt; to allow you to use your Yahoo ID as an openID.\n\n^ Agile Open Northwest\n\nI stumbled upon &quot;Agile Open Northwest&quot; &lt;http://agileopennorthwest.com&gt;, a conference in Portland right now.  Check out their &quot;Session Notes&quot; &lt;http://agileopennorthwest.com/cgi-bin/wiki.pl?SessionNotes&gt; as the conference goes on.\n\n^ Wikedit: edit last page\n\nI added a new feature to `wikedit` tonight to open the last modified page that has a given tag.  So I can now edit my current iteration plan like this:\n\n  `wikedit -l iteration`\n\nWhich folds neatly into a new alias:\n\n  `alias appiter='appedit -l iteration'`\n</div>
<div tiddler="lukec, 2007-01-31" modifier="luke.closs@socialtext.com" modified="200702010701" created="200702010409" tags="[[Daily Blog]] [[Daily Dev Blog]] [[Luke's Dev Log]] SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="lukec_2007_01_31" socialtext.version="20070201070126">^ Offset\n\nI just purchased carbon offsets for $10 USD for my flight to the f2f from &quot;TerraPass&quot; &lt;http://terrapass.com&gt;.  The money helps fund clean energy projects in areas like wind energy, biomass and industrial efficiency. (Industrial efficiency - ooh, how sexy)\n\nI'm challenging the other socialtexters to offset as well.  Oh yeah, I went there.\n\n^ Migration tools\n\nI spent this evening hacking on the migration framework defined &quot;here&quot; &lt;https://www2.socialtext.net/dev-tasks/index.cgi?data_migration&gt; (internal).  I have it at a state where I'm ready to begin integrating with Zac to build the first migration scripts for the Pluggable Auth project.\n\nZac, check out:\n* `t/Socialtext/Migration.t` for the unit tests\n* `share/migration/1-pluggable-auth/*` for the scripts you'll add to\n\nI'll pair with you in the morning SOT.\n</div>
<div tiddler="lukec, 2007-02-01" modifier="luke.closs@socialtext.com" modified="200702020040" created="200702012211" tags="[[Daily Blog]] [[Daily Dev Blog]] [[Luke's Dev Log]] SocialtextFormat" socialtext.server="http://www.socialtext.net/" socialtext.workspace="stoss" socialtext.page="lukec_2007_02_01" socialtext.version="20070202004050">^ Wikedit templates\n\nI just took a brief break from Appliance work to hack in `--template` support into [wikedit].\n\nSo I can now easily create a new story or iteration page like this:\n\n&gt; `appedit -t 'story template' 'Story: New Story'`\n\nSuh-weet.\n\n^ Blogging for Geeks?\n\nThe upcoming &quot;Northern Voice&quot; &lt;http://www.northernvoice.ca/&gt; conference in Vancouver (Feb 23-34) is about (somewhat) blogging for the masses.\n\nBut what about blogging for the hackers out there?  With the [REST API] and [wikedit], we should start showing off these cool tools to the alpha-geeks and other hackers.\n\n^ YAPC::NA\n\nIs anyone planning on putting together a session about Socialtext at YAPC?  We could focus on various aspects of the product:\n\n* Installing OSR\n* Hacktastic tools ([wikedit], [REST API], ...)\n* Extending with Plugins\n* Hacktastic Wiki Tricks?\n** [Wiki Tests]\n** [wikedit]\n* others?\n\n^ Misc\n\n* Simple interface to Ceqlotron?\n* Firefox socialtext pluggin?\n</div>
</div>
<!--STORE-AREA-END-->
<!--POST-BODY-END-->
</body>
</html>
