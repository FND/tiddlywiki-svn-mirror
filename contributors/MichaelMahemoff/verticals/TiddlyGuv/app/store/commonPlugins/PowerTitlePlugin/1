modifier: MichaelMahemoff
created: 200508181151
modified: 200609101232
tags: systemConfig

/***
|Name|PowerTitlePlugin|
|Description|Make the title clickable|
|Source|http://tiddlyguv.org/PowerTitle.html#PowerTitlePlugin|
|Documentation|http://tiddlyguv.org/PowerTitlePlugin.html#PowerTitlePluginInfo|
|Version|0.1|
|Author|Michael Mahemoff, Osmosoft|
|''License:''|[[BSD open source license]]|
|~CoreVersion|2.2|
***/

var stylesheet = store.getTiddlerText(tiddler.title + "##StyleSheet");
config.shadowTiddlers["PowerTitleStylesheet"] = stylesheet;
store.addNotification("PowerTitleStylesheet", refreshStyles);

/*
TiddlyWiki.prototype.getTiddlerText = function(title,defaultText)
{
  if (title)
    return "<span onclick='PowerTitlePlugin.onTitleClick();' class='siteTitle' tiddler='SiteTitle'>" + store.getTiddlerText("SiteTitle") + "</span>"

	if(!title)
		return defaultText;
	var pos = title.indexOf(config.textPrimitives.sectionSeparator);
	var section = null;
	if(pos != -1) {
		section = title.substr(pos + config.textPrimitives.sectionSeparator.length);
		title = title.substr(0,pos);
	}
	pos = title.indexOf(config.textPrimitives.sliceSeparator);
	if(pos != -1) {
		var slice = this.getTiddlerSlice(title.substr(0,pos),title.substr(pos + config.textPrimitives.sliceSeparator.length));
		if(slice)
			return slice;
	}
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		if(!section)
			return tiddler.text;
		var re = new RegExp("(^!{1,6}" + section.escapeRegExp() + "[ \t]*\n)","mg");
		re.lastIndex = 0;
		var match = re.exec(tiddler.text);
		if(match) {
			var t = tiddler.text.substr(match.index+match[1].length);
			var re2 = /^!/mg;
			re2.lastIndex = 0;
			match = re2.exec(t); //# search for the next heading
			if(match)
				t = t.substr(0,match.index-1);//# don't include final \n
			return t;
		}
		return defaultText;
	}
	if(this.isShadowTiddler(title))
		return this.getShadowTiddlerText(title);
	if(defaultText != undefined)
		return defaultText;
	return null;
};
*/

/*
var origRestart = restart;
window.restart = function() {
  origRestart();

  // Rewrite site title. This (a) adds onclick event; (b) suppresses tiddler
  var template;
  if (typeof(store.getTiddlerText("PageTemplate"))!="undefined") {
    template = store.getTiddlerText("PageTemplate");
  } else {
    template = store.getShadowTiddlerText("PageTemplate");
  }
  var pageTemplate = store.createTiddler("PageTemplate");
  pageTemplate.text =
    store.getTiddler("PageTemplate").text = template.replace(
      /<span class='siteTitle' refresh='content' tiddler='SiteTitle'><\/span>/g,
      "<span onclick='PowerTitlePlugin.onTitleClick();' class='siteTitle' tiddler='SiteTitle'>" + store.getTiddlerText("SiteTitle") + "</span>"
    );
  store.saveTiddler("PageTemplate");

} 
*/

PowerTitlePlugin = {
  onTitleClick: function() {
    story.closeAllTiddlers();
    document.location.hash="#";
    origRestart();
 }
}

/***
!StyleSheet

.siteTitle { cursor: pointer; }
.siteTitle:hover { background: [[ColorPalette::Background]]; color: [[ColorPalette::PrimaryDark]]; }

!(end of StyleSheet)

***/
