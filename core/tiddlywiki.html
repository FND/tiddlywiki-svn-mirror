<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!--
TiddlyWiki 1.2.2 by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)
Incorporating improvements by Isao Sonobe, http://www-gauge.scphys.kyoto-u.ac.jp/~sonobe/OgreKit/OgreKitWiki.html

Copyright (c) Osmosoft Limited, 14 April 2005

All rights reserved.

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.

Redistributions in binary form must reproduce the above copyright notice, this
list of conditions and the following disclaimer in the documentation and/or other
materials provided with the distribution.

Neither the name of the Osmosoft Limited nor the names of its contributors may be
used to endorse or promote products derived from this software without specific
prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE.
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" >
<title>TiddlyWiki</title>
<script type="text/javascript">

// ---------------------------------------------------------------------------------
// Main
// ---------------------------------------------------------------------------------

// Default options
var options = {};
options.chkRegExp = false;
options.chkCaseSens = false;
options.txtUserName = "YourName";

// Starting up
function main()
{
    loadOptionsCookie();
    setupOptionsPanel();
    setupRegexp();
    hideMessage();
    refreshAll();
    var start = getTiddlerText("DefaultTiddlers");
    if(window.location.hash)
        displayTiddlers(null,decodeURI(window.location.hash.substr(1)),1,null,null);
    else if(start)
        displayTiddlers(null,start,1,null,null);
}

// ---------------------------------------------------------------------------------
// Tiddler functions
// ---------------------------------------------------------------------------------

// Display several tiddlers from a list of space separated titles
function displayTiddlers(src,titles,state,highlightText,highlightCaseSensitive,slowly)
{
    var tiddlers = titles.split(" ");
    for(var t=tiddlers.length-1;t>=0;t--)
        displayTiddler(src,tiddlers[t],state,highlightText,highlightCaseSensitive,slowly);
}

// Display a tiddler with animation and scrolling, as though a link to it has been clicked on
//  src = source element object (eg link) for animation effects and positioning
//  title = title of tiddler to display
//  state = 0 is default or current state, 1 is read only and 2 is edittable
//  highlightText = text to highlight in the displayed tiddler
//  highlightCaseSensitive = flag for whether the highlight text is case sensitive
function displayTiddler(src,title,state,highlightText,highlightCaseSensitive,slowly)
{
    var place = document.getElementById("tiddlerDisplay");
    var after = findContainingTiddler(src); // Which tiddler this one will be positioned after
    var before = after ? after.nextSibling : null;
    var theTiddler = createTiddler(place,before,title,state,highlightText,highlightCaseSensitive);
    if(src)
        {
        theTiddler.style.opacity = 0;
        var floater = document.getElementById("floater");
        var floaterTitle = document.createTextNode(title);
        if(floater.firstChild)
            floater.replaceChild(floaterTitle,floater.firstChild);
        startZoomer(floater,src,theTiddler,slowly);
        }
}

// Create a tiddler if it doesn't exist (with no fancy animating)
//  place = parent element
//  before = node before which to create/move the tiddler
//  title = title of tiddler to display
//  state = 0 is default or current state, 1 is read only and 2 is edittable
//  highlightText = text to highlight in the displayed tiddler
//  highlightCaseSensitive = flag for whether the highlight text is case sensitive
function createTiddler(place,before,title,state,highlightText,highlightCaseSensitive)
{
    var theTiddler = createTiddlerSkeleton(place,before,title);
    createTiddlerTitle(title,highlightText,highlightCaseSensitive);
    var theViewer = document.getElementById("viewer" + title);
    var theEditor = document.getElementById("editor" + title);
    switch(state)
        {
        case 0:
            if(!theViewer && !theEditor)
                {
                createTiddlerToolbar(title,false);
                createTiddlerViewer(title,highlightText,highlightCaseSensitive);
                }
            break;
        case 1: // Viewer
            if(theViewer)
                theViewer.parentNode.removeChild(theViewer);
            if(theEditor)
                theEditor.parentNode.removeChild(theEditor);
            createTiddlerToolbar(title,false);
            createTiddlerViewer(title,highlightText,highlightCaseSensitive);
            break;
        case 2: // Editor
            if(!theEditor)
                {
                if(theViewer)
                    theViewer.parentNode.removeChild(theViewer);
                createTiddlerToolbar(title,true);
                createTiddlerEditor(title);
                }
            break;
        }
    return(theTiddler);
}

function createTiddlerSkeleton(place,before,title)
{
    var theTiddler = document.getElementById("tiddler" + title);
    if(!theTiddler)
        {
        theTiddler = createTiddlyElement(null,"div","tiddler" + title,"tiddler",null);
        theTiddler.onmouseover = onMouseOverTiddler;
        theTiddler.onmouseout = onMouseOutTiddler;
        theTiddler.ondblclick = onDblClickTiddler;
        var theInnerTiddler = createTiddlyElement(theTiddler,"div",null,"innerTiddler",null);
        var theTitle = createTiddlyElement(theInnerTiddler,"div","title" + title,"title",null);
        var theToolbar = createTiddlyElement(theInnerTiddler,"div","toolbar" + title,"toolbar", null);
        var theBody = createTiddlyElement(theInnerTiddler,"div","body" + title,"body",null);
        if(before)
            place.insertBefore(theTiddler,before);
        else
            place.insertBefore(theTiddler,place.firstChild);
        }
    return(theTiddler);
}

function createTiddlerTitle(title,highlightText,highlightCaseSensitive)
{
    var theTitle = document.getElementById("title" + title);
    if(theTitle)
        {
        removeChildren(theTitle);
        if(highlightText == "")
            highlightText = null;
        var highlightRegExp,highlightMatch;
        if(highlightText)
            {
            highlightRegExp = new RegExp(highlightText,highlightCaseSensitive ? "mg" : "img");
            highlightMatch = highlightRegExp.exec(title);
            }
        highlightMatch = subWikify(theTitle,title,0,title.length,highlightRegExp,highlightMatch);
        var subtitle = getTiddlerSubtitle(title);
        theTitle.title = subtitle;
        }
}

// Create a tiddler toolbar according to whether it's an editor or not
function createTiddlerToolbar(title,editor)
{
    var theToolbar = document.getElementById("toolbar" + title);
    if(theToolbar)
        {
        removeChildren(theToolbar);
        insertSpacer(theToolbar);
        if(!editor)
            {
            // Non-editor toolbar
            createTiddlyButton(theToolbar,"close","Close this tiddler",onClickToolbarClose);
            insertSpacer(theToolbar);
            createTiddlyButton(theToolbar,"edit","Edit this tiddler",onClickToolbarEdit);
            insertSpacer(theToolbar);
            createTiddlyButton(theToolbar,"permalink","Permalink for this tiddler",onClickToolbarPermaLink);
            insertSpacer(theToolbar);
            createTiddlyButton(theToolbar,"references","Show tiddlers that link to this one",onClickToolbarBackLink);
            }
        else
            {
            // Editor toolbar
            createTiddlyButton(theToolbar,"done","Save changes to this tiddler",onClickToolbarSave);
            insertSpacer(theToolbar);
            createTiddlyButton(theToolbar,"cancel","Undo changes to this tiddler",onClickToolbarUndo);
            insertSpacer(theToolbar);
            createTiddlyButton(theToolbar,"delete","Delete this tiddler",onClickToolbarDelete);
            }
        insertSpacer(theToolbar);
        }
}

// Create the body section of a read-only tiddler
function createTiddlerViewer(title,highlightText,highlightCaseSensitive)
{
    var theBody = document.getElementById("body" + title);
    if(theBody)
        {
        var tiddlerText = getTiddlerText(title);
        var tiddlerExists = (tiddlerText != null);
        if(!tiddlerExists)
            tiddlerText = "This tiddler doesn't yet exist. Double-click to create it";
        var theViewer = createTiddlyElement(theBody,"div","viewer" + title,"viewer",null);
        if(!tiddlerExists)
            theViewer.style.fontStyle = "italic";
        wikify(tiddlerText,theViewer,highlightText,highlightCaseSensitive);
        }
}

// Create the body section of an edittable tiddler
function createTiddlerEditor(title)
{
    var theBody = document.getElementById("body" + title);
    if(theBody)
        {
        var tiddlerText = getTiddlerText(title);
        var tiddlerExists = (tiddlerText != null);
        if(!tiddlerExists)
            tiddlerText = "Type the text for '" + title + "' here.";
        var theEditor = createTiddlyElement(theBody,"div","editor" + title,"editor",null);
        var theTitleBox = createTiddlyElement(theEditor,"input","editorTitle" + title,null,null);
        theTitleBox.setAttribute("type","text");
        theTitleBox.value = title;
        theTitleBox.setAttribute("size","40");
        var theBodyBox = createTiddlyElement(theEditor,"textarea","editorBody" + title,null,null);
        theBodyBox.value = tiddlerText;
        theBodyBox.setAttribute("rows","10");
        theBodyBox.style.width = "100%";
        //theBodyBox.setAttribute("cols","80");
        }
}

function saveTiddler(title)
{
    var theNewTitle = document.getElementById("editorTitle" + title).value;
    var theNewBody = document.getElementById("editorBody" + title).value;
    var theExisting = document.getElementById("store" + title);
    if(theExisting)
        theExisting.parentNode.removeChild(theExisting);
    if(title != theNewTitle)
       {
       theExisting = document.getElementById("store" + theNewTitle);
       if(theExisting)
            theExisting.parentNode.removeChild(theExisting);
        }
    var place = document.getElementById("storeArea");
    var storeItem = createTiddlyElement(place,"div","store" + theNewTitle,null,escapeTiddler(theNewBody));
    var now = new Date();
    storeItem.setAttribute("modified",ConvertToYYYYMMDDHHMM(now));
    storeItem.setAttribute("modifier",options.txtUserName);
    displayTiddler(null,theNewTitle,1,null,null,null,false);
    // Close the old tiddler if this is a rename
    if(title != theNewTitle)
        {
        var oldTiddler = document.getElementById("tiddler" + title);
        oldTiddler.parentNode.removeChild(oldTiddler);
        }
    refreshAll();
}

function searchTiddlers(text,caseSensitive,useRegExp)
{
    var searchText;
    closeAllTiddlers();
    if (useRegExp)
        searchText = text;
    else
        searchText = escapeRegExp(text);
    if(document.getElementById("store" + text))
        displayTiddler(null,text,1,text,caseSensitive,false); // Special case of searching for a tiddler title
    var theTiddler = document.getElementById("tiddler" + text);
    var store = document.getElementById("storeArea").childNodes;
    var c = 0;
    var regExp = new RegExp(searchText,caseSensitive ? "m" : "im");
    for(var t = 0; t < store.length; t++)
        {
        var e = store[t];
        if(e.id)
            if(e.id.substr(0,5) == "store")
                if(regExp.exec(e.id.substr(5)) || regExp.exec(unescapeTiddler(e.firstChild.nodeValue)))
                    {
                    displayTiddler(null,e.id.substr(5),1,searchText,caseSensitive,false);
                    c++;
                    }
        }
    var q = useRegExp ? "/" : "'";
    displayMessage(c + " tiddlers found matching " + q + text + q);
}

function selectTiddler(title)
{
    var e = document.getElementById("toolbar" + title);
    if(e != null)
        e.style.visibility = "visible";
}

function deselectTiddler(title)
{
    var e = document.getElementById("toolbar" + title);
    if(e != null)
        e.style.visibility = "hidden";
}

function deleteTiddler(title)
{
    closeTiddler(title,false);
    var tiddler = document.getElementById("store" + title);
    if(tiddler)
        tiddler.parentNode.removeChild(tiddler);
    refreshAll();
}

function closeTiddler(title,slowly)
{
    var tiddler = document.getElementById("tiddler" + title);
    if(tiddler != null)
        {
        scrubIds(tiddler);
        startSlider(tiddler,false,slowly,true);
        }
}

function scrubIds(e)
{
    if(e.id)
        e.id = null;
    var children = e.childNodes;
    for(var t=0; t<children.length; t++)
        {
        var c = children[t];
        if(c.id)
            c.id = null;
        }
}

function closeAllTiddlers()
{
    hideMessage();
    var place = document.getElementById("tiddlerDisplay");
    var tiddler = place.firstChild;
    var nextTiddler;
    while(tiddler)
        {
        nextTiddler = tiddler.nextSibling;
        if(tiddler.id)
            if(tiddler.id.substr(0,7) == "tiddler")
                {
                var title = tiddler.id.substr(7);
                if(!document.getElementById("editor" + title))
                    place.removeChild(tiddler);
                }
        tiddler = nextTiddler;
        }
}

// ---------------------------------------------------------------------------------
// Regular expression stuff
// ---------------------------------------------------------------------------------

var upperLetter = "[A-Z]";
var lowerLetter = "[a-z_0-9\\-]";
var anyLetter = "[A-Za-z_0-9\\-]";
var anyDigit = "[0-9]";
var anyNumberChar = "[0-9\\.E]";

var wikiNameRegExp;
var structurePatterns;
var stylePatterns;
var tableRegExp;
var tableRowColRegExp;
var invalidPreWikiNamePattern;

function setupRegexp()
{
    // Table rows pattern
    var rowPattern = "^\\|([^\\n]*\\|)([fhc]?)$";
    tableRegExp = new RegExp(rowPattern,"mg");
    // Table columns pattern
    var elementPattern = "(?:(?:BGCOLOR|bgcolor)\\(([^\\)]+)\\):)?([^\\|]*)\\|";
    tableRowColRegExp = new RegExp(elementPattern,"g");
    // Link patterns
    var wikiNamePattern = "(?:" + upperLetter + "+" + lowerLetter + "+" + upperLetter + anyLetter + "*)|(?:" + upperLetter + "{2,}" + lowerLetter + "+)";
    var urlPattern = "(?:http|https|mailto|ftp):[^\\s\"']*";
    var explicitLinkPattern = "\\[\\[([^\\[\\]\\|]+)\\|([^\\[\\]\\|]+)\\]\\]";
    var bracketNamePattern = "\\[\\[([^\\]]+)\\]\\]";
    var patterns = "(" + wikiNamePattern + 
        ")|(" + urlPattern + 
        ")|(?:" + explicitLinkPattern + 
        ")|(?:" + bracketNamePattern + 
        ")";
    wikiNameRegExp = new RegExp(patterns,"mg");
    invalidPreWikiNamePattern = anyLetter;
    // Structural patterns
    var breakPattern = "\\n";
    var horizontalRulePattern = "^----$\\n?";
    var headerPattern = "^!{1,5}";
    var bulletListItemPattern = "^\\*+";
    var numberedListItemPattern = "^#+";
    var tablePattern = "(?:^\\|[^\\n]*$\\n?)+";
    var blockquotePattern = "(?:^>[^\\n]*$\\n?)+";
    var blockquotePattern2 = "^<<<\\n((?:^[^\\n]*\\n)+)(^<<<$\\n?)";
    var imagePattern = "\\[[Ii][Mm][Gg]\\[(?:([^\\|]+)\\|)?([^\\[\\]\\|]+)\\]\\]";
    structurePatterns = "(" + breakPattern + 
        ")|(" + horizontalRulePattern + 
        ")|(" + headerPattern + 
        ")|(" + bulletListItemPattern + 
        ")|(" + numberedListItemPattern + 
        ")|(" + tablePattern + 
        ")|(" + blockquotePattern + 
        ")|(?:" + blockquotePattern2 + 
        ")|(?:" + imagePattern + 
        ")";
    // Style patterns
    var boldPattern = "''([^']+)''";
    var strikePattern = "==([^=]+)==";
    var underlinePattern = "__([^_]+)__";
    var italicPattern = "//([^/]+)//";
    var supPattern = "\\^\\^([^\\^]+)\\^\\^";
    var subPattern = "~~([^~]+)~~";
    var colorPattern = "@@(?:color\\(([^\\)]+)\\):|bgcolor\\(([^\\)]+)\\):){0,2}([^@]+)@@";
    stylePatterns = "(?:" + boldPattern + 
        ")|(?:" + strikePattern + 
        ")|(?:" + underlinePattern + 
        ")|(?:" + italicPattern + 
        ")|(?:" + supPattern + 
        ")|(?:" + subPattern + 
        ")|(?:" + colorPattern + 
        ")";
}

// Create child text nodes and link elements to represent a wiki-fied version of some text
function wikify(text,parent,highlightText,highlightCaseSensitive)
{
    // Prepare the regexp for the highlighted selection
    if(highlightText == "")
        highlightText = null;
    var highlightRegExp,highlightMatch;
    if(highlightText)
        {
        highlightRegExp = new RegExp(highlightText,highlightCaseSensitive ? "mg" : "img");
        highlightMatch = highlightRegExp.exec(text);
        }
    wikifyStructures(parent,text,text,0,text.length,highlightRegExp,highlightMatch);
}


function wikifyStructures(parent,text,targetText,startPos,endPos,highlightRegExp,highlightMatch)
{
    var body = parent;
    var structureRegExp = new RegExp(structurePatterns,"mg");
    var theList = new Array();  // theList[0]: don't use
    var isInListMode = false;
    var isInHeaderMode = false;
    var isNewline = false;
    // The start of the fragment of the text being considered
    var nextPos = 0;
    // Loop through the bits of the body text
    do {
        // Get the next formatting match
        var formatMatch = structureRegExp.exec(targetText);
        var matchPos = formatMatch ? formatMatch.index : targetText.length;
        // Subwikify the plain text before the match
        if(nextPos < matchPos)
            {
            isNewline = false;
            highlightMatch = wikifyStyles(body,text,targetText.substring(nextPos,matchPos),startPos+nextPos,startPos+matchPos,highlightRegExp,highlightMatch);
            }
        // Dump out the formatted match
        var level;
        var theBlockquote;
        if(formatMatch)
            {
            // Dump out the link itself in the appropriate format
            if(formatMatch[1])
                {
                if(isNewline && isInListMode)
                    {
                    theList = new Array();
                    body = parent;
                    isInListMode = false;
                    }
                else if(isInHeaderMode)
                    {
                    body = parent;
                    isInHeaderMode = false;
                    }
                else
                    {
                    isNewline = true;
                    body.appendChild(document.createElement("br"));
                    }
                }
            else if(formatMatch[2])
                {
                isNewline = false;
                body.appendChild(document.createElement("hr"));
                }
            else if(formatMatch[3])
                {
                level = formatMatch[3].length + 1;
                isNewline = false;
                isInHeaderMode = true;
                var theHeader = document.createElement("h" + level);
                parent.appendChild(theHeader);
                body = theHeader;
                }
            else if(formatMatch[4])
                {
                level = formatMatch[4].length;
                isNewline = false;
                isInListMode = true;
                if (theList[level] == null)
                    {
                    theList[level] = document.createElement("ul");
                    body.appendChild(theList[level]);
                    }
                theList = theList.slice(0,level + 1);
                body = document.createElement("li");
                theList[level].appendChild(body);
                }
            else if(formatMatch[5])
                {
                level = formatMatch[5].length;
                isNewline = false;
                isInListMode = true;
                if (theList[level] == null)
                    {
                    theList[level] = document.createElement("ol");
                    body.appendChild(theList[level]);
                    }
                theList = theList.slice(0,level + 1);
                body = document.createElement("li");
                theList[level].appendChild(body);
                }
            else if(formatMatch[6])
                {
                isNewline = false;
                highlightMatch = wikifyTable(body,text,formatMatch[6],startPos+matchPos,startPos+structureRegExp.lastIndex,highlightRegExp,highlightMatch);
                }
            else if(formatMatch[7])
                {
                isNewline = false;
                var quotedText = formatMatch[7].replace(new RegExp("^>(>*)","mg"),"$1");
                theBlockquote = document.createElement("blockquote");
                var newHighlightRegExp,newHighlightMatch;
                if (highlightRegExp) {
                    newHighlightRegExp = new RegExp(highlightRegExp.toString(), "img");
                    newHighlightMatch = newHighlightRegExp.exec(quotedText);
                }
                wikifyStructures(theBlockquote,quotedText,quotedText,0,quotedText.length,newHighlightRegExp,newHighlightMatch);
                body.appendChild(theBlockquote);
                }
            else if(formatMatch[8])
                {
                isNewline = false;
                theBlockquote = document.createElement("blockquote");
                highlightMatch = wikifyStructures(theBlockquote,text,formatMatch[8],startPos+matchPos+4,startPos+structureRegExp.lastIndex-formatMatch[9].length,highlightRegExp,highlightMatch);
                body.appendChild(theBlockquote);
                }
            else if(formatMatch[11])
                {
                isNewline = false;
                var theImage = document.createElement("img");
                theImage.alt = formatMatch[10];
                theImage.src = formatMatch[11];
                body.appendChild(theImage);
                }
            }
        // Move the next position past the formatting match
        nextPos = structureRegExp.lastIndex;
    } while(formatMatch);
    return highlightMatch;
}

function wikifyLinks(parent,text,targetText,startPos,endPos,highlightRegExp,highlightMatch)
{
    // The start of the fragment of the text being considered
    var nextPos = 0;
    // Loop through the bits of the body text
    var theLink;
    do {
        // Get the next formatting match
        var formatMatch = wikiNameRegExp.exec(targetText);
        var matchPos = formatMatch ? formatMatch.index : targetText.length;
        // Subwikify the plain text before the match
        if(nextPos < matchPos)
            highlightMatch = subWikify(parent,text,startPos+nextPos,startPos+matchPos,highlightRegExp,highlightMatch);
        // Dump out the formatted match
        if(formatMatch)
            {
            // Dump out the link itself in the appropriate format
            if(formatMatch[1])
                {
                if(matchPos > 0 && new RegExp(invalidPreWikiNamePattern,"").exec(targetText.charAt(matchPos - 1)))
                    {
                    theLink = parent;
                    }
                else
                    {
                     theLink = createTiddlyLink(parent,formatMatch[0],false);
                     }
                 highlightMatch = subWikify(theLink,text,startPos+matchPos,startPos+wikiNameRegExp.lastIndex,highlightRegExp,highlightMatch);
                }
            else if(formatMatch[2])
                {
                theLink = createExternalLink(parent,formatMatch[0]);
                highlightMatch = subWikify(theLink,text,startPos+matchPos,startPos+wikiNameRegExp.lastIndex,highlightRegExp,highlightMatch);
                }
            else if(formatMatch[3])
                {
                theLink = createExternalLink(parent,formatMatch[4]);
                highlightMatch = subWikify(theLink,text,startPos+matchPos+2,startPos+matchPos+2+formatMatch[3].length,highlightRegExp,highlightMatch);
                }
            else if(formatMatch[5])
                {
                theLink = createTiddlyLink(parent,formatMatch[5],false);
                highlightMatch = subWikify(theLink,text,startPos+matchPos+2,startPos+wikiNameRegExp.lastIndex-2,highlightRegExp,highlightMatch);
                }
            }
        // Move the next position past the formatting match
        nextPos = wikiNameRegExp.lastIndex;
    } while(formatMatch);
    return highlightMatch;
}

function wikifyStyles(parent,text,targetText,startPos,endPos,highlightRegExp,highlightMatch)
{
    var formatRegExp = new RegExp(stylePatterns,"mg");
    // The start of the fragment of the text being considered
    var nextPos = 0;
    // Loop through the bits of the body text
    do {
        // Get the next formatting match
        var formatMatch = formatRegExp.exec(targetText);
        var matchPos = formatMatch ? formatMatch.index : targetText.length;
        // Subwikify the plain text before the match
        if(nextPos < matchPos)
            highlightMatch = wikifyLinks(parent,text,targetText.substring(nextPos,matchPos),startPos+nextPos,startPos+matchPos,highlightRegExp,highlightMatch);
        // Dump out the formatted match
        if(formatMatch)
            {
            // Dump out the link itself in the appropriate format
            if(formatMatch[1])
                {
                var theBold = createTiddlyElement(parent,"b",null,null,null);
                highlightMatch = wikifyStyles(theBold,text,formatMatch[1],startPos+matchPos+2,startPos+formatRegExp.lastIndex-2,highlightRegExp,highlightMatch);
                }
            else if(formatMatch[2])
                {
                var theStrike = createTiddlyElement(parent,"strike",null,null,null);
                highlightMatch = wikifyStyles(theStrike,text,formatMatch[2],startPos+matchPos+2,startPos+formatRegExp.lastIndex-2,highlightRegExp,highlightMatch);
                }
            else if(formatMatch[3])
                {
                var theUnderline = createTiddlyElement(parent,"u",null,null,null);
                highlightMatch = wikifyStyles(theUnderline,text,formatMatch[3],startPos+matchPos+2,startPos+formatRegExp.lastIndex-2,highlightRegExp,highlightMatch);
                }
            else if(formatMatch[4])
                {
                var theItalic = createTiddlyElement(parent,"i",null,null,null);
                highlightMatch = wikifyStyles(theItalic,text,formatMatch[4],startPos+matchPos+2,startPos+formatRegExp.lastIndex-2,highlightRegExp,highlightMatch);
                }
            else if(formatMatch[5])
                {
                var theSup = createTiddlyElement(parent,"sup",null,null,null);
                highlightMatch = wikifyStyles(theSup,text,formatMatch[5],startPos+matchPos+2,startPos+formatRegExp.lastIndex-2,highlightRegExp,highlightMatch);
                }
            else if(formatMatch[6])
                {
                var theSub = createTiddlyElement(parent,"sub",null,null,null);
                highlightMatch = wikifyStyles(theSub,text,formatMatch[6],startPos+matchPos+2,startPos+formatRegExp.lastIndex-2,highlightRegExp,highlightMatch);
                }
            else if(formatMatch[9])
                {
                var theSpan;
                if (formatMatch[7] == "" && formatMatch[8] == "" )
                    {
                    theSpan = createTiddlyElement(parent,"span",null,"marked",null);
                    }
                    else
                    {
                    theSpan = createTiddlyElement(parent,"span",null,null,null);
                    if (formatMatch[7] != "") theSpan.style.color = formatMatch[7];
                    if (formatMatch[8] != "") theSpan.style.background = formatMatch[8];
                    }
                highlightMatch = wikifyStyles(theSpan,text,formatMatch[9],startPos+formatRegExp.lastIndex-2-formatMatch[9].length,startPos+formatRegExp.lastIndex-2,highlightRegExp,highlightMatch);
                }
            }
        // Move the next position past the formatting match
        nextPos = formatRegExp.lastIndex;
    } while(formatMatch);
    return highlightMatch;
}

// Create a table 
function wikifyTable(parent,text,targetText,startPos,endPos,highlightRegExp,highlightMatch)
{
    // The start of the fragment of the text being considered
    var nextPos = 0;
    var theTable = document.createElement("table");
    var bodyRowLen = 0;
    var headRowLen = 0;
    var footRowLen = 0;
    var bodyRows = new Array();
    var headRows = new Array();
    var footRows = new Array();
    var theCaption = null;
    // Loop through the bits of the body text
    do {
        // Get the next formatting match
        var formatMatch = tableRegExp.exec(targetText);
        var matchPos = formatMatch ? formatMatch.index : targetText.length;
        // Dump out the formatted match
        if(formatMatch) {
            if (formatMatch[2] == "c") {
                var cap = formatMatch[1].substring(0,formatMatch[1].length-1);
                theCaption = document.createElement("caption");
                highlightMatch = wikifyStyles(theCaption,text,cap,startPos+matchPos+1,startPos+cap.length,highlightRegExp,highlightMatch);
                if (bodyRowLen == 0 && headRowLen == 0 && footRowLen == 0) {
                    theCaption.setAttribute("align", "top");
                } else {
                    theCaption.setAttribute("align", "bottom");
                }
            } else if (formatMatch[2] == "h") {
                highlightMatch = wikifyTableRow(headRows,headRowLen,text,formatMatch[1],startPos+matchPos,startPos+matchPos+formatMatch[1].length,highlightRegExp,highlightMatch);
                headRowLen++;
            } else if (formatMatch[2] == "f") {
                highlightMatch = wikifyTableRow(footRows,footRowLen,text,formatMatch[1],startPos+matchPos,startPos+matchPos+formatMatch[1].length,highlightRegExp,highlightMatch);
                footRowLen++;
            } else {
                highlightMatch = wikifyTableRow(bodyRows,bodyRowLen,text,formatMatch[1],startPos+matchPos,startPos+matchPos+formatMatch[1].length,highlightRegExp,highlightMatch);
                bodyRowLen++;
            }
        }
        nextPos = tableRegExp.lastIndex;
    } while(formatMatch);
    
    if (theCaption != null) {
        theTable.appendChild(theCaption);
    }
    
    if (headRowLen > 0) {
        var theTableHead = document.createElement("thead");
        createTableRows(headRows,theTableHead);
        theTable.appendChild(theTableHead);
    }
    
    if (bodyRowLen > 0) {
        var theTableBody = document.createElement("tbody");
        createTableRows(bodyRows,theTableBody);
        theTable.appendChild(theTableBody);
    }
    
    if (footRowLen > 0) {
        var theTableFoot = document.createElement("tfoot");
        createTableRows(footRows,theTableFoot);
        theTable.appendChild(theTableFoot);
    }
    
    parent.appendChild(theTable);
    return highlightMatch;
}

function wikifyTableRow(rows,rowIndex,text,targetText,startPos,endPos,highlightRegExp,highlightMatch)
{
    // The start of the fragment of the text being considered
    var eIndex = 0;
    var elements = new Array();
    // Loop through the bits of the body text
    do {
        // Get the next formatting match
        var formatMatch = tableRowColRegExp.exec(targetText);
        var matchPos = formatMatch ? formatMatch.index : targetText.length;
        if(formatMatch) {
            var eText = formatMatch[2];
            if (eText == "~" || eText == ">") {
                elements[eIndex] = eText;
            } else {
                var eTextLen = eText.length;
                var align = "";
                if (eTextLen >= 1 && eText.charAt(0) == " ") {
                    if (eTextLen >= 3 && eText.charAt(eTextLen - 1) == " ") {
                        align = "center";
                        eText = eText.substring(1,eTextLen - 1);
                        //eTextLen -= 2;
                        eTextLen--;
                    } else {
                        align = "right";
                        eText = eText.substring(1);
                        eTextLen--;
                    }
                } else if (eTextLen >= 2 && eText.charAt(eTextLen - 1) == " ") {
                    align = "left";
                    eText = eText.substring(0,eTextLen - 1);
                    //eTextLen--;
                }
                
                var theElement;
                if (eTextLen >= 1 && eText.charAt(0) == "!") {
                    theElement = document.createElement("th");
                    eText = eText.substring(1);
                    eTextLen--;
                } else {
                    theElement = document.createElement("td");
                }
                
                if (align != "") {
                    theElement.align = align;
                }
                
                if (formatMatch[1]) {
                    theElement.style.background = formatMatch[1];
                }
                
                highlightMatch = wikifyStyles(theElement,text,eText,startPos+tableRowColRegExp.lastIndex-eTextLen,startPos+tableRowColRegExp.lastIndex-1,highlightRegExp,highlightMatch);
                elements[eIndex] = theElement;
            }
            eIndex++;
        }
    } while(formatMatch);
    rows[rowIndex] = elements;
    return highlightMatch;
}

function createTableRows(rows,parent)
{
    var i, j, k, cols;
    for (i = 0; i < rows.length; i++) {
        cols = rows[i];
        var theRow = document.createElement("tr");
        for (j = 0; j < cols.length; j++) {
            if (cols[j] == "~") continue;
            
            var rowspan = 1;
            for (k = i+1; k < rows.length; k++) {
                if (rows[k][j] != "~") break;
                rowspan++;
            }
            
            var colspan = 1;
            for (; j < cols.length - 1; j++) {
                if (cols[j] != ">") break;
                colspan++;
            }
            
            var theElement = cols[j];
            if (rowspan > 1) {
                theElement.setAttribute("rowspan",rowspan);
                theElement.valign = "center";
            }
            if (colspan > 1) theElement.setAttribute("colspan",colspan);
            theRow.appendChild(theElement);
        }
        parent.appendChild(theRow);
    }
}

// Helper for wikify that handles highlights within runs of text
function subWikify(parent,text,startPos,endPos,highlightRegExp,highlightMatch)
{
    // Check for highlights
    while(highlightMatch && (highlightRegExp.lastIndex > startPos) && (highlightMatch.index < endPos) && (startPos < endPos))
        {
        // Deal with the plain text before the highlight
        if(highlightMatch.index > startPos)
            {
            parent.appendChild(document.createTextNode(text.substring(startPos,highlightMatch.index)));
            startPos = highlightMatch.index;
            }
        // Deal with the highlight
        var highlightEnd = Math.min(highlightRegExp.lastIndex,endPos);
        var theHighlight = createTiddlyElement(parent,"span",null,"highlight",text.substring(startPos,highlightEnd));
        startPos = highlightEnd;
        // Nudge along to the next highlight if we're done with this one
        if(startPos >= highlightRegExp.lastIndex)
            highlightMatch = highlightRegExp.exec(text);
        }
    // Do the unhighlighted text left over
    if(startPos < endPos)
        {
        parent.appendChild(document.createTextNode(text.substring(startPos,endPos)));
        //startPos = endPos;
        }
    return(highlightMatch);
}

// ---------------------------------------------------------------------------------
// Tiddler-related utility functions
// ---------------------------------------------------------------------------------

function getTiddlerText(title)
{
    var tiddlerStore = document.getElementById("store" + title);
    if(tiddlerStore == null)
        return(null);
    else if(tiddlerStore.firstChild)
        return(unescapeTiddler(tiddlerStore.firstChild.nodeValue));
    else
        return("");
}

var regexpBackSlashEn = new RegExp("\\\\n","mg");
var regexpSingleBackSlash = new RegExp("\\\\","mg");
var regexpDoubleBackSlash = new RegExp("\\\\\\\\","mg");
var regexpNewLine = new RegExp("\n","mg");

// Convert "\n" to newlines
function unescapeTiddler(text)
{
    return(text.replace(regexpBackSlashEn,"\n").replace(regexpSingleBackSlash,"\\\\"));
}

// Convert newlines to "\n"
function escapeTiddler(text)
{
    return(text.replace(regexpDoubleBackSlash,"\\").replace(regexpNewLine,"\\n"));
}

function getTiddlerSubtitle(title)
{
    var tiddlerStore = document.getElementById("store" + title);
    if(tiddlerStore != null)
        {
        var theModifier = tiddlerStore.getAttribute("modifier");
        if(!theModifier)
            theModifier = "(unknown)";
        var theModified = tiddlerStore.getAttribute("modified");
        if(theModified)
            theModified = ConvertFromYYYYMMDDHHMM(theModified).toLocaleString();
        else
            theModified = "(unknown)";
        return(theModifier + ", " + theModified);
        }
    else
        return(null);
}

function createTiddlyElement(theParent,theElement,theID,theClass,theText)
{
    var e = document.createElement(theElement);
    if(theClass != null)
        e.className = theClass;
    if(theID != null)
        e.setAttribute("id",theID);
    if(theText != null)
        e.appendChild(document.createTextNode(theText));
    if(theParent != null)
        theParent.appendChild(e);
    return(e);
}

function createTiddlyButton(theParent,theText,theTooltip,theAction)
{
    var theButton = document.createElement("a");
    if(theAction)
        {
        theButton.onclick = theAction;
        theButton.setAttribute("href","JavaScript:;");
        }
    theButton.setAttribute("title",theTooltip);
    if(theText)
        {
        theButton.appendChild(document.createTextNode(theText));
        }
    theParent.appendChild(theButton);
    return(theButton);
}

function createTiddlyLink(place,title,includeText)
{
    var text = includeText ? title : null;
    var subTitle = getTiddlerSubtitle(title);
    var theClass = subTitle ? "tiddlyLinkExisting" : "tiddlyLinkNonExisting";
    if(!subTitle)
        subTitle = title + " doesn't yet exist";
    var btn = createTiddlyButton(place,text,subTitle,onClickTiddlerLink);
    btn.className = theClass;
    btn.setAttribute("tiddlyLink",title);
    return(btn);
}

function createExternalLink(place,url)
{
    var theLink = document.createElement("a");
    theLink.className = "externalLink";
    theLink.href = url;
    theLink.title = "External link to " + url;
    theLink.target = "_blank";
    place.appendChild(theLink);
    return(theLink);
}

// Find the tiddler instance (if any) containing a specified element
function findContainingTiddler(e)
{
    if(e == null)
        return(null);
    do {
        if(e != document)
            {
            if(e.id)
                if(e.id.substr(0,7) == "tiddler")
                    return(e);
            }
        e = e.parentNode;
    } while(e != document);
    return(null);
}

function displayMessage(text)
{
    var msgArea = document.getElementById("messageArea");
    var msg = document.createTextNode(text);
    msgArea.replaceChild(msg,msgArea.firstChild);
    msgArea.style.display = "block";
}

function hideMessage()
{
    var msgArea = document.getElementById("messageArea");
    msgArea.style.display = "none";
}

// ---------------------------------------------------------------------------------
// Menu and sidebar functions
// ---------------------------------------------------------------------------------

var currentTab; // The id of the currently selected tab

function refreshAll()
{
    refreshHeader();
    refreshMenu();
    refreshSidebar();
}

// Refresh all parts of the header
function refreshHeader()
{
    var theTitle = getTiddlerText("SiteTitle");
    if(!theTitle) theTitle = "SiteTitle";
    var theSubtitle = getTiddlerText("SiteSubtitle");
    if(!theSubtitle) theSubtitle = "SiteSubtitle";
    document.title = theTitle + " - " + theSubtitle;
    var place = document.getElementById("siteTitle");
    while(place.firstChild != null)
        place.removeChild(place.firstChild);
    wikify(theTitle,place,null,null);
    place = document.getElementById("siteSubtitle");
    while(place.firstChild != null)
        place.removeChild(place.firstChild);
    wikify(theSubtitle,place,null,null);
}

function refreshMenu()
{
    var place = document.getElementById("mainMenu");
    while(place.firstChild != null)
        place.removeChild(place.firstChild);
    var menu = getTiddlerText("MainMenu");
    if(!menu) menu = "MainMenu";
    wikify(menu,place,null,null);
}

function refreshSidebar()
{
    var tabContent = document.getElementById("sidebarContent");
    switch(currentTab)
        {
            case "tabTimeline":
                tabContent.className = "tabContentTimeline";
                refreshTabTimeline();
                break;
            case "tabAll":
                tabContent.className = "tabContentAll";
                refreshTabAll();
                break;
            default:
                tabContent.className = "tabContentTimeline";
                refreshTabTimeline();
                break;
        }
}

function refreshTabTimeline()
{
    var allTiddlers = new Array(); // An array of 2-entry arrays, where entry 0 = name, 1 = date
    var storeNodes = document.getElementById("storeArea").childNodes;
    for (var t = 0; t < storeNodes.length; t++)
        {
        var n = storeNodes[t];
        if(n.id)
            if(n.id.substr(0,5) == "store")
                allTiddlers.push(new Array(n.id.substr(5),n.getAttribute("modified")));
        }
    allTiddlers.sort(function (a,b) { if(a[1] == b[1]) return(1); else return (a[1] < b[1]) ? +1 : -1; }); // Sort by date
    var place = document.getElementById("sidebarContent");
    while(place.firstChild != null)
        place.removeChild(place.firstChild);
    var lastDay = "";
    for (t = 0; t < allTiddlers.length; t++)
        {
        var theDay = allTiddlers[t][1].substr(0,8);
        if(theDay != lastDay)
            {
            var theDateElement = document.createElement("span");
            var theDateCaption = ConvertFromYYYYMMDDHHMM(allTiddlers[t][1]).toLocaleDateString();
            theDateElement.appendChild(document.createTextNode(theDateCaption));
            theDateElement.className = "sidebarSubHeading";
            place.appendChild(theDateElement);
            place.appendChild(document.createElement("br")); 
            lastDay = theDay;
            }
        place.appendChild(document.createTextNode(String.fromCharCode(160)));
        place.appendChild(document.createTextNode(String.fromCharCode(160)));
        createTiddlyLink(place,allTiddlers[t][0],true);
        place.appendChild(document.createElement("br"));
        }
}

function refreshTabAll()
{
    var allTiddlers = new Array(); // An array of 2-entry arrays, where entry 0 = name, 1 = date
    var storeNodes = document.getElementById("storeArea").childNodes;
    for (var t = 0; t < storeNodes.length; t++)
        {
        var n = storeNodes[t];
        if(n.id)
            if(n.id.substr(0,5) == "store")
                allTiddlers.push(new Array(n.id.substr(5),n.getAttribute("modified")));
        }
    allTiddlers.sort(function (a,b) { if(a[0] == b[0]) return(0); else return (a[0] > b[0]) ? +1 : -1; }); // Sort by name
    var place = document.getElementById("sidebarContent");
    while(place.firstChild != null)
        place.removeChild(place.firstChild);
    for (t = 0; t < allTiddlers.length; t++)
        {
        createTiddlyLink(place,allTiddlers[t][0],true);
        place.appendChild(document.createElement("br"));
        }
}

// ---------------------------------------------------------------------------------
// Options stuff
// ---------------------------------------------------------------------------------

function setupOptionsPanel()
{
    for(var opt in options)
        {
        var e = document.getElementById(opt);
        switch(opt.substr(0,3))
            {
            case "txt":
                e.value = options[opt];
                break;
            case "chk":
                e.checked = options[opt];
                break;
            }
        }
}

function loadOptionsCookie()
{
    var cookies = document.cookie;
    if(cookies.length > 0)
        for(var opt in options)
            {
            var n = opt + "=";
            var p = cookies.indexOf(n);
            if(p > -1)
                {
                p += n.length;
                var e = cookies.indexOf(";",p);
                if(e == -1)
                    e = cookies.length;
                var v = cookies.substr(p,e-p);
                switch(opt.substr(0,3))
                    {
                    case "txt":
                        options[opt] = v;
                        break;
                    case "chk":
                        options[opt] = v == "true";
                        break;
                    }
                }
            }
}

function saveOptionCookie(name)
{
    var c = name + "=";
    switch(name.substr(0,3))
        {
        case "txt":
            c += escape(options[name].toString());
            break;
        case "chk":
            c += options[name] ? "true" : "false";
            break;
        }
    c += "; expires=Fri, 1 Jan 2038 12:00:00 UTC; path=/";
    document.cookie = c;
}

function onChangeOption(e)
{
    if (!e) var e = window.event;
    var opt = resolveTarget(e);
    if(opt.id)
        {
        switch(opt.id.substr(0,3))
            {
            case "txt":
                options[opt.id] = opt.value;
                break;
            case "chk":
                options[opt.id] = opt.checked;
                break;
            }
        saveOptionCookie(opt.id);
        changeOption(opt.id);
        }
    return(true);
}

// React to an option having been changed
function changeOption(name)
{
    switch(name)
        {
        case "chkRegExp":
            break;
        case "chkCaseSens":
            break;
        case "txtUserName":
            break;
        }
}

// ---------------------------------------------------------------------------------
// Saving
// ---------------------------------------------------------------------------------

var startSaveArea = '<div id="' + 'storeArea">'; // Split up into two so that indexOf() of this source doesn't find it
var endSaveArea = '</d' + 'iv>';

// Save this tiddlywiki with the pending changes
function saveChanges()
{
    // Get the URL of the document
    var originalPath = document.location.toString();
    // Check we were loaded from a file URL
    if(originalPath.substr(0,5) != "file:")
        {
        alert("You need to save this TiddlyWiki to a file before you can save changes");
        displayTiddler(null,"SaveChanges",0,null,null,null);
        return;
        }
    // Remove any location part of the URL
    var hashPos = originalPath.indexOf("#");
    if(hashPos != -1)
        originalPath = originalPath.substr(0,hashPos);
    // Convert to a native file format assuming
    // "file:///x:/path/path/path..." - pc local file --> "x:\path\path\path..."
    // "file://server/share/path/path/path..." - pc network file --> "\\server\share\path\path\path..."
    // "file:///path/path/path..." - mac/unix local file --> "/path/path/path..."
    var localPath;
    if(originalPath.charAt(9) == ":") // pc local file
        localPath = unescape(originalPath.substr(8)).replace(new RegExp("/","g"),"\\");
    else if(originalPath.charAt(7) == "/") // mac/unix local file
        localPath = unescape(originalPath.substr(7));
    else // pc network file
        localPath = "\\\\" + unescape(originalPath.substr(7)).replace(new RegExp("/","g"),"\\");
    // Create backup filename
    var backupPath = localPath.substr(0,localPath.lastIndexOf(".")) + "." + ConvertToYYYYMMDDHHMMSSMMM(new Date()) + ".html";
    var original = loadFile(localPath);
    if(original == null)
        {
        alert("It's not possible to save changes using this browser. Use FireFox if you can");
        displayTiddler(null,"SaveChanges",0,null,null,null);
        return;
        }
    else
        {
        var posOpeningDiv = original.indexOf(startSaveArea);
        var posClosingDiv = original.lastIndexOf(endSaveArea);
        if((posOpeningDiv == -1) || (posClosingDiv == -1))
            alert("Doesn't appear to be a TiddlyWiki");
        else
            {
            var backup = saveFile(backupPath,original);
            var revised = original.substr(0,posOpeningDiv + startSaveArea.length) + saveTiddlersAsHtml() + original.substr(posClosingDiv);
            var save = saveFile(localPath,revised)
            if(save)
                alert("Saved successfully as '" + localPath + "'");
            else
                alert("Error while saving");
            }
        }
}

function saveTiddlersAsHtml()
{
    var storeNodes = document.getElementById("storeArea").childNodes;
    var savedTiddlers = new Array();
    for (var t = 0; t < storeNodes.length; t++)
        {
        var n = storeNodes[t];
        if(n.id)
            if(n.id.substr(0,5) == "store")
                {
                var title = n.id.substr(5);
                savedTiddlers.push('<div id="store' + title + '" modified="' +
                                    n.getAttribute("modified") + '" modifier="' + n.getAttribute("modifier") + '">' +
                                    n.firstChild.nodeValue + '</div>');
                }
        }
    return savedTiddlers.join("\n");
}

function saveFile(fileUrl, content)
{
    var r = mozillaSaveFile(fileUrl, content);
    if((r == null) || (r == false))
        r = ieSaveFile(fileUrl, content);
    return(r);
}

function loadFile(fileUrl)
{
    var r = mozillaLoadFile(fileUrl);
    if((r == null) || (r == false))
        r = ieLoadFile(fileUrl);
    return(r);
}

// Returns null if it can't do it, false if there's an error
function ieSaveFile(filePath, content)
{
    try
        {
        var fso = new ActiveXObject("Scripting.FileSystemObject");
        }
    catch(e)
        {
        //alert("Exception while attempting to save\n\n" + e.toString());
        return(null);
        }
    var file = fso.OpenTextFile(filePath,2,-1,0);
    file.Write(content);
    file.Close();
    return(true);
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function ieLoadFile(filePath)
{
    try
        {
        var fso = new ActiveXObject("Scripting.FileSystemObject");
        }
    catch(e)
        {
        //alert("Exception while attempting to load\n\n" + e.toString());
        return(null);
        }
    var file = fso.OpenTextFile(filePath,1);
    var content = file.ReadAll();
    file.Close();
    return(content);
}

// Returns null if it can't do it, false if there's an error
function mozillaSaveFile(filePath, content)
{
    if(window.Components)
        try
            {
            netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
            var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
            file.initWithPath(filePath);
            if (!file.exists())
                file.create(0, 0664);
            var out = Components.classes["@mozilla.org/network/file-output-stream;1"].createInstance(Components.interfaces.nsIFileOutputStream);
            out.init(file, 0x20 | 0x02, 00004,null);
            out.write(content, content.length);
            out.flush();
            out.close();
            return(true);
            }
        catch(e)
            {
            //alert("Exception while attempting to save\n\n" + e);
            return(false);
            }
    return(null);
}
    
// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function mozillaLoadFile(filePath)
{
    if(window.Components)
        try 
            {
            netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
            var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
            file.initWithPath(filePath);
            if (!file.exists())
                return(null);
            var inputStream = Components.classes["@mozilla.org/network/file-input-stream;1"].createInstance(Components.interfaces.nsIFileInputStream);
            inputStream.init(file, 0x01, 00004, null);
            var sInputStream = Components.classes["@mozilla.org/scriptableinputstream;1"].createInstance(Components.interfaces.nsIScriptableInputStream);
            sInputStream.init(inputStream);
            return(sInputStream.read(sInputStream.available()));
            }
        catch(e)
            {
            //alert("Exception while attempting to load\n\n" + e);
            return(false);
            }
    return(null);
}

// ---------------------------------------------------------------------------------
// Event handlers
// ---------------------------------------------------------------------------------

// Event handler for clicking on a tiddly link
function onClickTiddlerLink(e)
{
    if (!e) var e = window.event;
    var theLink = resolveTarget(e);
    hideMessage();
    var title = theLink.getAttribute("tiddlyLink");
    if(title)
        displayTiddler(theLink,title,0,null,null,e.shiftKey || e.altKey);
}

// Event handler for mouse over a tiddler
function onMouseOverTiddler(e)
{
    var tiddler;
    if(this.id.substr(0,7) == "tiddler")
        tiddler = this.id.substr(7);
    if(tiddler)
        selectTiddler(tiddler);
}

// Event handler for mouse out of a tiddler
function onMouseOutTiddler(e)
{
    var tiddler;
    if(this.id.substr(0,7) == "tiddler")
        tiddler = this.id.substr(7);
    if(tiddler)
        deselectTiddler(tiddler);
}

// Event handler for double click on a tiddler
function onDblClickTiddler(e)
{
    hideMessage();
    if(document.selection)
        document.selection.empty();
    var tiddler;
    if(this.id.substr(0,7) == "tiddler")
        tiddler = this.id.substr(7);
    if(tiddler)
        displayTiddler(null,tiddler,2,null,null,false);
}

// Event handler for clicking on toolbar close
function onClickToolbarClose(e)
{
    if (!e) var e = window.event;
    hideMessage();
    if(this.parentNode.id)
        closeTiddler(this.parentNode.id.substr(7),e.shiftKey || e.altKey);
    e.cancelBubble = true;
    if (e.stopPropagation) e.stopPropagation();
    return(false);
}

// Event handler for clicking on toolbar permalink
function onClickToolbarPermaLink(e)
{
    if(this.parentNode.id)
        window.location.hash = encodeURIComponent(this.parentNode.id.substr(7));
}

// Event handler for clicking on toolbar close
function onClickToolbarDelete(e)
{
    hideMessage();
    if(this.parentNode.id)
        deleteTiddler(this.parentNode.id.substr(7));
}

// Event handler for clicking on the toolbar backlink
function onClickToolbarBackLink(e)
{
    hideMessage();
    if(this.parentNode.id)
        searchTiddlers(this.parentNode.id.substr(7),true,false);
}

// Event handler for clicking on toolbar close
function onClickToolbarEdit(e)
{
    hideMessage();
    if(this.parentNode.id)
        displayTiddler(null,this.parentNode.id.substr(7),2,null,null,false);
}

// Event handler for clicking on toolbar save
function onClickToolbarSave(e)
{
    if(this.parentNode.id)
        saveTiddler(this.parentNode.id.substr(7));
}

// Event handler for clicking on toolbar save
function onClickToolbarUndo(e)
{
    if(this.parentNode.id)
        displayTiddler(null,this.parentNode.id.substr(7),1,null,null,false);
}

var optionsOpen = false;

// Options button
function onClickOptions(e)
{
    if (!e) var e = window.event;
    var thePanel = document.getElementById("optionsPanel");
    optionsOpen = !optionsOpen;
    startSlider(thePanel,optionsOpen,e.shiftKey || e.altKey,false);
    e.cancelBubble = true;
    if (e.stopPropagation) e.stopPropagation();
    return(false);
}

// Event handler for clicking on a tab
function onClickTab(e)
{
    if (!e) var e = window.event;
    var theTab = resolveTarget(e);
    currentTab = theTab.id;
    refreshSidebar();
}

var lastSearchText = ""; // For keeping track of when the search text actually changes

function onSearch(e)
{
    var text = document.getElementById("searchText").value;
    if((text.length > 2) && (text != lastSearchText))
        {
        searchTiddlers(text,options.chkCaseSens,options.chkRegExp);
        lastSearchText = text;
        }
}

function onClearSearch()
{
    var text = document.getElementById("searchText");
    text.value = "";
    hideMessage();
}

// Eek... it's bad that this is done via a function rather than a normal, copy-able href
function onClickPermaView()
{
    var tiddlerDisplay = document.getElementById("tiddlerDisplay");
    var openTiddlers = "";
    var separator = "";
    for(var t=0;t<tiddlerDisplay.childNodes.length;t++)
        {
        openTiddlers = openTiddlers + separator + tiddlerDisplay.childNodes[t].id.substr(7);
        separator = " ";
        }
    window.location.hash = encodeURIComponent(openTiddlers);
}

// ---------------------------------------------------------------------------------
// Animation engine
// ---------------------------------------------------------------------------------

// Animation housekeeping
var animating = 0; // Incremented at start of each animation, decremented afterwards. If zero, the interval timer is disabled
var animaterID; // ID of the timer used for animating
// 'zoomer' module of the animation engine smoothly moves an element from the position/size of the start element to the target element
var zoomerElement = null; // Element being shifted; null if none
var zoomerStart; // Where we're shifting from
var zoomerTarget; // Where we're shifting to
var zoomerStartScroll; // Where we're scrolling from
var zoomerTargetScroll; // Where we're scrolling to
var zoomerProgress; // 0..1 of how far we are
var zoomerStep; // 0..1 of how much to shift each step
// 'slider' module of the animation engine slides an element smoothly open or closed
var sliderElement = null; // Element being slid open or closed; null if none
var sliderDeleteAfterwards;
var sliderOpening; // True if the element is being opened
var sliderRealHeight; // Starting height
var sliderProgress; // 0..1 of how far we are
var sliderStep; // 0..1 of how much to shift each step

// Start animation engine
function startAnimating()
{
    if(animating++ == 0)
        animaterID = window.setInterval("doAnimate();",25);
}

// Stop animation engine
function stopAnimating()
{
    if(--animating == 0)
        window.clearInterval(animaterID)
}

// Perform an animation engine tick, calling each of the known animation modules
function doAnimate()
{
    if(zoomerElement)
        doZoomer();
    if(sliderElement)
        doSlider();
}

// Start moving the element 'e' from the position of the element 'start' to the position of the element 'target'
function startZoomer(e,start,target,slowly)
{
    stopZoomer();
    zoomerElement = e;
    zoomerStart = start;
    zoomerStartScroll = findScrollY();
    zoomerTargetScroll = ensureVisible(target);
    zoomerTarget = target;
    zoomerProgress = 0;
    zoomerStep = slowly ? 0.01 : 0.12;
    startAnimating();
}

// Stop any ongoing zoomer animation
function stopZoomer()
{
    if(zoomerElement)
        {
        stopAnimating();
        zoomerElement.style.visibility = "hidden";
        zoomerTarget.style.opacity = 1;
        window.scrollTo(0,zoomerTargetScroll);
        zoomerElement = null;
        }
}

// Perform a tick of the zoomer animation
function doZoomer()
{
    zoomerProgress += zoomerStep;
    if(zoomerProgress >= 1.0)
        stopZoomer();
    else
        {
        var f = slowInSlowOut(zoomerProgress);
        var zoomerStartLeft = findPosX(zoomerStart);
        var zoomerStartTop = findPosY(zoomerStart);
        var zoomerStartWidth = zoomerStart.offsetWidth;
        var zoomerStartHeight = zoomerStart.offsetHeight;
        var zoomerTargetLeft = findPosX(zoomerTarget);
        var zoomerTargetTop = findPosY(zoomerTarget);
        var zoomerTargetWidth = zoomerTarget.offsetWidth;
        var zoomerTargetHeight = zoomerTarget.offsetHeight;
        zoomerElement.style.left = zoomerStartLeft + (zoomerTargetLeft-zoomerStartLeft) * f;
        zoomerElement.style.top = zoomerStartTop + (zoomerTargetTop-zoomerStartTop) * f;
        zoomerElement.style.width = zoomerStartWidth + (zoomerTargetWidth-zoomerStartWidth) * f;
        zoomerElement.style.height = zoomerStartHeight + (zoomerTargetHeight-zoomerStartHeight) * f;
        zoomerElement.style.visibility = "visible";
        zoomerTarget.style.opacity = zoomerProgress;
        window.scrollTo(0,zoomerStartScroll + (zoomerTargetScroll-zoomerStartScroll) * f);
        }
}

// Start sliding an element
function startSlider(e,opening,slowly,deleteAfterwards)
{
    stopSlider();
    sliderDeleteAfterwards = deleteAfterwards;
    sliderElement = e;
        sliderElement.style.display = "block";
    sliderElement.style.height = "auto";
    sliderRealHeight = sliderElement.offsetHeight;
    sliderOpening = opening;
    sliderStep = slowly ? 0.01 : 0.16;
    if(opening)
        {
        sliderProgress = 0;
        sliderElement.style.height = "2px";
        sliderElement.style.display = "block";
        }
    else
        {
        sliderStep = -sliderStep;
        sliderProgress = 1;
        }
    sliderElement.style.overflow = "hidden";
    startAnimating();
}

// Stop sliding the current element
function stopSlider()
{
    if(sliderElement)
        {
        stopAnimating();
        if(sliderOpening)
            sliderElement.style.height = "auto";
        else
            {
            if(sliderDeleteAfterwards)
                sliderElement.parentNode.removeChild(sliderElement);
            else
                sliderElement.style.display = "none";
            }
        sliderElement = null;
        }
}

// Perform a tick of the slider animation
function doSlider()
{
    sliderProgress += sliderStep;
    if((sliderProgress < 0) || (sliderProgress > 1.0))
        stopSlider();
    else
        {
        var f = slowInSlowOut(sliderProgress);
        var h = sliderRealHeight*f;
        sliderElement.style.height = (h <= 2) ? 2 : h;
        sliderElement.style.opacity = f;
        }
}

// ---------------------------------------------------------------------------------
// Standalone utility functions
// ---------------------------------------------------------------------------------

// Escape a string to ensure it doesn't have any RegExp special characters
function escapeRegExp(s)
{
    // Escape any special characters with that character preceded by a backslash
    return(s.replace(new RegExp("[\\\\\\^\\$\\*\\+\\?\\(\\)\\=\\!\\|\\,\\{\\}\\[\\]\\.]","g"),"\\$0"));
}

// Return a date in UTC YYYYMMDDHHMM format
function ConvertToYYYYMMDDHHMM(d)
{
    return(zeroPad(d.getFullYear(),4) + zeroPad(d.getMonth()+1,2) + zeroPad(d.getDate(),2) + zeroPad(d.getHours(),2) + zeroPad(d.getMinutes(),2));
}

// Left-pad a string with 0s to a certain width
function zeroPad(n,d)
{
    var s = n.toString();
    if(s.length < d)
        s = "000000000000000000000000000".substr(0,d-s.length) + s;
    return(s);
}

// Return a date in UTC YYYYMMDD.HHMMSSMMM format
function ConvertToYYYYMMDDHHMMSSMMM(d)
{
    return(zeroPad(d.getFullYear(),4) + zeroPad(d.getMonth()+1,2) + zeroPad(d.getDate(),2) + "." + zeroPad(d.getHours(),2) + zeroPad(d.getMinutes(),2) + zeroPad(d.getSeconds(),2) + zeroPad(d.getMilliseconds(),4));
}

// Convert a date in UTC YYYYMMDDHHMM format to date type
function ConvertFromYYYYMMDDHHMM(d)
{
    var theDate = new Date(parseInt(d.substr(0,4),10),
                            parseInt(d.substr(4,2),10)-1,
                            parseInt(d.substr(6,2),10),
                            parseInt(d.substr(8,2),10),
                            parseInt(d.substr(10,2),10),0,0);
    return(theDate);
}

// Map a 0..1 value to 0..1, but slow down at the start and end
function slowInSlowOut(progress)
{
    return(1-((Math.cos(progress * Math.PI)+1)/2));
}

// Resolve the target object of an event
function resolveTarget(e)
{
    var obj;
    if (e.target)
        obj = e.target;
    else if (e.srcElement)
        obj = e.srcElement;
    if (obj.nodeType == 3) // defeat Safari bug
        obj = obj.parentNode;
    return(obj);
}

// Get the scroll position for window.scrollTo necessary to scroll a given element into view
function ensureVisible(e)
{
    var posTop = findPosY(e);
    var posBot = posTop + e.offsetHeight;
    var winTop = findScrollY();
    var winHeight = findWindowHeight();
    var winBot = winTop + winHeight;
    if(posTop < winTop)
        return(posTop);
    else if(posBot > winBot)
        {
        if(e.offsetHeight < winHeight)
            return(posTop - (winHeight - e.offsetHeight));
        else
            return(posTop);
        }
    else
        return(winTop);
}

function findWindowHeight()
{
    return(window.innerHeight ? window.innerHeight : document.body.clientHeight);
}

function findScrollY()
{
    return(window.scrollY ? window.scrollY : document.body.scrollTop);
}

// From QuirksMode.com
function findPosX(obj)
{
    var curleft = 0;
    if (obj.offsetParent)
    {
        while (obj.offsetParent)
        {
            curleft += obj.offsetLeft;
            obj = obj.offsetParent;
        }
    }
    else if (obj.x)
        curleft += obj.x;
    return curleft;
}

// From QuirksMode.com
function findPosY(obj)
{
    var curtop = 0;
    if (obj.offsetParent)
    {
        while (obj.offsetParent)
        {
            curtop += obj.offsetTop;
            obj = obj.offsetParent;
        }
    }
    else if (obj.y)
        curtop += obj.y;
    return curtop;
}

// Create a non-breaking space
function insertSpacer(place)
{
    place.appendChild(document.createTextNode(String.fromCharCode(160)));
}

function removeChildren(e)
{
    while(e.hasChildNodes())
        e.removeChild(e.firstChild);
}

// ---------------------------------------------------------------------------------
// End of scripts
// ---------------------------------------------------------------------------------

</script>
<style type="text/css">

body {
    background-color: #ffffff;
    font-size: 9pt;
    font-family: verdana,arial,helvetica;
    margin: 0em 0em 0em 0em;
    padding: 0em 0em 0em 0em;
}

a:link, a:visited {
    text-decoration: none;
}

a:hover, a:active {
    text-decoration: none;
}

#header {
    margin-bottom: 0em;
}

#titleLine {
    color: #ffffff;
    background-color: #330000;
    padding: 5em 1em 1em 1em;
}

#titleLine a {
    color: #CCFF66;
}

#siteTitle {
    font-size: 26pt;
}

#siteSubtitle {
    padding-left: 1em;
    font-size: 10pt;
}

#mainMenu {
    float: left;
    width: 10em;
    line-height: 166%;
    padding: 1.5em 0.5em 0.5em 0.5em;
    font-size: 10pt;
    color: black;
    text-align: right;
}

#mainMenu a {
    color: #996633;
}

#mainMenu a:hover {
    background-color: #996633;
    color: #ffffff;
}

#displayArea {
    margin: 1em 14em 0em 13em;
}

#messageArea {
    background-color: #999999;
    color: #ffffff;
    padding: 0.3em 0.3em 0.3em 0.3em;
    margin: 0em 0em 0.6em 0em;
    display: none;
}

.tiddler {
    padding: 0em 0em 0em 0em;
}

.innerTiddler {
    padding: 1em 1em 1em 1em;
    font-size: 9pt;
}

#displayArea .tiddlyLinkExisting {
    font-weight: bold;
}

#displayArea .tiddlyLinkNonExisting {
    font-style: italic;
}

#displayArea .externalLink {
    text-decoration: underline;
}

.title {
    font-size: 10pt;
    font-weight: bold;
    display: inline;
}

.toolbar {
    font-weight: normal;
    font-size: 8pt;
    padding: 0em 0em 0em 0em;
    color: #aaaaaa;
    display: inline;
    visibility: hidden;
}

.toolbar A {
    padding: 0.2em 0.4em 0.2em 0.4em;
    color: #cc9900;
}

.toolbar A:hover {
    text-decoration: none;
    color: #ccff66;
    background-color: #993300;
}

.toolbar A:active {
    color: #ffffff;
    background-color: #cc9900;
}

.body {
    padding-top: 0.5em;
}

.viewer {
    color: #000000;
    line-height: 140%;
}

.viewer a:link, .body a:visited {
    text-decoration: none;
    color: #996633;
}

.viewer a:hover {
    color: #ffffff;
    background-color: #996633;
    text-decoration: none;
}

.viewer blockquote {
    font-size: 8pt;
    line-height: 150%;
    border-left: 3px solid #666666;
    padding-left: 0.8em;
    margin-left: 2.5em;
}

.viewer ul {
    margin-left: 0.5em;
    padding-left: 1.5em;
}

.viewer ol {
    margin-left: 0.5em;
    padding-left: 1.5em;
}

.viewer h2,h3,h4,h5,h6 {
    font-weight: bold;
    text-decoration: none;
    background-color: #cccc99;
    padding-left: 0.4em
}

.viewer h2 {
    font-size: 12pt;
}

.viewer h3 {
    font-size: 11pt;
}

.viewer h4 {
    font-size: 10pt;
}

.viewer h5 {
    font-size: 9pt;
}

.viewer h6 {
    font-size: 8pt;
}

.viewer table {
    border-collapse: collapse;
    border: 2px solid #303030;
    margin-left: 1.0em;
    margin-right: 1.0em;
    margin-top: 0.8em;
    margin-bottom: 0.8em;
}

.viewer th {
    background-color: #999966;
    border: 1px solid #606060;
    color: #ffffff;
    padding: 3px;
}

.viewer td, tr {
    border: 1px solid #606060;
    padding: 3px;
}

.viewer caption {
    padding: 3px;
}

.viewer hr {
    border-top: dashed 1px #606060;
    border-left: none;
    border-right: none;
    border-bottom: none;
    height: 1px;
    color: #666666;
}

.highlight {
    color: #000000;
    background-color: #ffe72f;
}

.editor {
    font-size: 8pt;
    color: #402C74;
    font-weight: normal;
}

.editor input {
    display: block;
    border: 1px solid black;
}

.editor textarea {
    display: block;
    font: inherit;
    border: 1px solid black;
}

#sidebar {
    float: right;
    width: 14em;
    color: #000000;
    font-size: 8pt;
    background-color: #ffffff;
}

.sidebarSubHeading {
    font-size: 7pt;
    color: #330000;
}

#commandPanel {
    padding-top: 0.5em;
    background-color: #cc9900;
    color: #996633;
    font-size: 8pt;
}

#commandPanel A {
    display: block;
    padding: 0.3em 0.2em 0.3em 1em;
    color: #993300;
}

#commandPanel A:hover {
    text-decoration: none;
    color: #ccff66;
    background-color: #993300;
}

#commandPanel A:active {
    color: #993300;
    background-color: #ccff66;
}

#commandPanel input {
    margin: 0.4em 0em 0.3em 1em;
    border: 1px solid #000000;
}

#optionsPanel {
    display: none;
    padding: 0.5em 0.5em 0.5em 0.5em;
    background-color: #eeeeaa;
    font-size: 7pt;
    color: #444400;
}

#optionsPanel a:link, #optionsPanel a:visited {
    color: #777700;
    font-weight: bold;
}

#optionsPanel a:hover {
    text-decoration: none;
    color: #ffffff;
    background-color: #444400;
}

.optionsText {
    margin-top: 0.25em;
    margin-bottom: 0.75em;
}

.optionsItem {
}

#sidebarTabs {
    background-color: #cc9900;
    padding: 1em 0em 0em 0.5em;
}

#sidebarTabs a {
    color: #ccff66;
}

#sidebarTabs a:hover {
    background-color: #ccff66;
    color: #330000;
    text-decoration: none;
}

#sidebarTabs a:active {
    color: #000000;
}

#tabTimeline {
    font-weight: bold;
    display: inline;
    background-color: #996633;
    padding: 2px 3px 0px 3px;
    margin: 0px 1px 0px 1px;
}

#tabAll {
    font-weight: bold;
    display: inline;
    background-color: #993300;
    padding: 2px 3px 0px 3px;
    margin: 0px 1px 0px 1px;
}

.tabContentTimeline {
    background-color: #996633;
    padding: 0.5em 0.5em 0.5em 0.5em;
}

.tabContentAll {
    background-color: #993300;
    padding: 0.5em 0.5em 0.5em 0.5em;
}

#sidebarContent a {
    color: #ccff66;
}

#sidebarContent a:hover {
    color: #330000;
    background-color: #ccff66;
    text-decoration: none;
}

#licensePanel {
    padding: 0.5em 0em 0.5em 0em;
}

#licensePanel A {
    display: block;
    padding: 0.2em 0.2em 0.2em 0.2em;
    color: #993300;
}

#licensePanel A:hover {
    text-decoration: none;
    color: #ccff66;
    background-color: #993300;
}

#licensePanel A:active {
    color: #993300;
    background-color: #ccff66;
}

#storeArea, #copyright {
    display: none;
}

#floater {
    font-size: 10pt;
    visibility: hidden;
    color: white;
    background-color: #b8b896;
    position: absolute;
    padding: 1em 1em 1em 1em;
    opacity: 0.5;
    filter: alpha(opacity=50);
}


</style>
</head>
<body onload="main()">
    <div id="copyright">
    Welcome to TiddlyWiki by Jeremy Ruston, Copyright &copy; 2005 Osmosoft Limited
    </div>
    <div id="header">
        <div id="titleLine">
            <span id="siteTitle"></span>
            <span id="siteSubtitle"></span>
        </div>
    </div>
    <div id="sidebar">
        <div id="commandPanel">
            <a href="JavaScript:;" onclick="onSearch()">search</a>
            <input id="searchText" size=15 onKeyUp="onSearch()" autocomplete=off>
            <a href="javascript:;" onclick="closeAllTiddlers(event)" title="Close all displayed tiddlers (except any that are being edited)">close all</a>
            <a href="javascript:;" onclick="onClickPermaView(event)" title="Link to an URL that retrieves all the currently displayed tiddlers">permaview</a>
            <a href="javascript:;" onclick="saveChanges(event)" title="Save all tiddlers to create a new TiddlyWiki">save changes</a>
            <a href="javascript:;" onclick="onClickOptions(event)" title="Change TiddlyWikiOptions">options</a>
        </div>
        <div id="optionsPanel">
            <div class="optionsText">These
                <a href="javascript:;" tiddlyLink="InterfaceOptions" onclick="onClickTiddlerLink(event);">InterfaceOptions</a>
                for customising
                <a href="javascript:;" tiddlyLink="TiddlyWiki" onclick="onClickTiddlerLink(event);">TiddlyWiki</a>
                are saved in your browser
            </div>
            <div class="optionsItem"><input type=checkbox onclick="onChangeOption(event);" id="chkRegExp">
                <a href="javascript:;" tiddlyLink="RegExpSearch" onclick="onClickTiddlerLink(event);">RegExpSearch</a>
            </div>
            <div class="optionsItem"><input type=checkbox onclick="onChangeOption(event);" id="chkCaseSens">
                <a href="javascript:;" tiddlyLink="CaseSensitiveSearch" onclick="onClickTiddlerLink(event);">CaseSensitiveSearch</a>
            </div>
            <div class="optionsText">Your username for signing your edits. Write it as a 
                <a href="javascript:;" tiddlyLink="WikiWord" onclick="onClickTiddlerLink(event);">WikiWord</a>
                (eg 
                <a href="javascript:;" tiddlyLink="JoeBloggs" onclick="onClickTiddlerLink(event);">JoeBloggs</a>) 
            </div>
            <input id="txtUserName" size=15 onKeyUp="onChangeOption(event)" autocomplete=off>
        </div>
        <div id="sidebarTabs">
            <a href="JavaScript:;" onclick="onClickTab(event)" id="tabTimeline">Timeline</a>
            <a href="JavaScript:;" onclick="onClickTab(event)" id="tabAll">All</a>
        </div>
        <div id="sidebarContent" class="tabContentTimeline">
        </div>
        <div id="licensePanel">
            <a rel="license" href="http://www.tiddlywiki.com" target="_new">
                TiddlyWiki is published by Osmosoft under a BSD open source license
            </a>
        </div>
    </div>
    <div id="mainMenu">
    </div>
    <div id="displayArea">
        <div id="messageArea">Message Area</div>
        <div id="tiddlerDisplay"></div>
        &nbsp;
        <div id="floater">&nbsp;</div>
    </div>
    <div id="storeArea"><div id="storeEmailMe" modified="200409072350" modifier="JeremyRuston">My email address is jeremy (at) osmosoft (dot) com</div>
<div id="storeSiteTitle" modified="200409161548" modifier="JeremyRuston">TiddlyWiki</div>
<div id="storeSiteSubtitle" modified="200409171651" modifier="JeremyRuston">a reusable non-linear personal web notebook</div>
<div id="storeSelfContained" modified="200409201452" modifier="JeremyRuston">One of the neatest features of TiddlyWiki is that it is entirely self-contained in a single HTML file. It contains the actual hypertext document, and the JavaScript, CascadingStyleSheets and HTML necessary to both view and edit the document. This means that it is trivial to host a TiddlyWiki on a website, or to distribute one by email. And anyone with a reasonably recent web browser will be able to read and edit it.</div>
<div id="storeMicroContent" modified="200409251844" modifier="JeremyRuston">MicroContent being a fashionable word for self-contained fragments of content that are typically smaller than entire pages. Often MicroContent is presented via some kind of aggregation that reduces the perceptual shock and resource cost of context switching (eg Blogs aggregating several entries onto a page or Flickr presenting photos in an album). This TiddlyWiki aggregates MicroContent items that I call 'tiddlers' into pages that are loaded in one gulp and progressively displayed as the user clicks hypertext links to read them.</div>
<div id="storeStartupBehaviour" modified="200412192141" modifier="JeremyRuston">When it loads, TiddlyWiki looks for the names of tiddlers to open as a space-separated list after the # in the URL. If there are no tiddlers in the URL it instead loads the tiddlers named in DefaultTiddlers, one of the SpecialTiddlers.</div>
<div id="storeExtendedFormatting" modified="200503112345" modifier="JeremyRuston">''Bold''\n==Strike==\n__Underline__\n//Italic//\n2^^3^^=8\na~~ij~~ = -a~~ji~~\n@@highlight@@\n@@color(green):green colored@@\n@@bgcolor(#ff0000):color(#ffffff):red colored@@</div>
<div id="storeHtmlTables" modified="200503120002" modifier="JeremyRuston">*sample:\n|!th1111111111|!th2222222222|\n|>| colspan |\n| rowspan |left|\n|~| right|\n|bgcolor(#a0ffa0):colored| center |\n|caption|c\n*another sample: see PeriodicTable.\n</div>
<div id="storeHorizontalRules" modified="200503120015" modifier="JeremyRuston">You can divide a tiddler into\n----\nsections by typing four dashes on a line by themselves</div>
<div id="storeTiddlyWikiPod" modified="200503232231" modifier="JeremyRuston">IsaoSonobe's TiddlyWikiPod is a nifty utility for Mac OS X that copies the content of a TiddlyWiki to an iPod where it can be read, and links followed, using the touch wheel. Isao has also added the ability to link to songs from the TiddlyWiki text which enables some interesting applications. At the moment, it only works with the older SecondVersion of TiddlyWiki. It can be found at http://www8.ocn.ne.jp/~sonoisa/TiddlyWikiPod/index.html</div>
<div id="storePrettyLinks" modified="200503311848" modifier="JeremyRuston">You can now link to [[external sites|http://www.osmosoft.com]] with ordinary words, without the messiness of the full URL appearing. Edit this tiddler to see how.</div>
<div id="storeSubHeadings" modified="200503311852" modifier="JeremyRuston">!Header 1\n!!Header 2\n!!!Header 3\n!!!!Header 4\n!!!!!Header 5\n</div>
<div id="storeNumberedLists" modified="200503311852" modifier="JeremyRuston">start\n#item1\n#item2\n##item2.1\n##item2.2\n##item2.3\n#item3\n##item3.1\n###item3.1.1\n###item3.1.2\n\nend</div>
<div id="storeHelloThere" modified="200504081813" modifier="JeremyRuston">Welcome to the ThirdVersion of TiddlyWiki, an experimental MicroContent WikiWikiWeb built by JeremyRuston. It's written in HTML, CSS and JavaScript to run on any modern browser without needing any ServerSide logic. It allows anyone to create personal SelfContained hypertext documents that can be posted to any web server, sent by email or kept on a USB thumb drive to make a WikiOnAStick. If you like it, do please EmailMe and let me know.</div>
<div id="storeWikiOnAStick" modified="200504081823" modifier="JeremyRuston">Putting TiddlyWiki on a USB thumb drive lets you carry around a SelfContained notebook that you can update wherever there's a reasonably modern computer, whether it's a Mac, Linux or a PC. (To be even more independent you can [[install FireFox on the drive|http://www.mozilla.org/support/firefox/tips#oth_usb]] as well).</div>
<div id="storeBulletPoints" modified="200504091848" modifier="JeremyRuston">Edit this tiddler to see how to create BulletPoints\n* Like this one\n* And this one\n** And this second-level one\n* And a final one</div>
<div id="storeFireFox" modified="200504091848" modifier="JeremyRuston">FireFox lets you SaveChanges in TiddlyWiki, but you will see up to three dialogs asking your permission for the local file operations. You must allow all three operations for it to work properly. Note that you can select the //Remember this decision// option to avoid seeing the dialogs in future.  </div>
<div id="storeOpenSourceLicense" modified="200504091859" modifier="JeremyRuston">TiddlyWiki is published under a BSD OpenSourceLicense that gives you the freedom to use it pretty much however you want, including for commercial purposes, as long as you keep my copyright notice. I'd appreciate a link back to http://www.tiddlywiki.com as well. </div>
<div id="storeDefaultTiddlers" modified="200504100039" modifier="JeremyRuston">HelloThere UsingThisSite NewFeatures</div>
<div id="storeJeremyRuston" modified="200504100122" modifier="JeremyRuston">I'm Jeremy Ruston, a technologist based in London. I do consultancy work through my company [[Osmosoft|http://www.osmosoft.com]], as well as pursuing some independent projects like TiddlyWiki.</div>
<div id="storeEmbeddedImages" modified="200504100129" modifier="JeremyRuston">Edit this tiddler to see how to insert images.\n[img[Fractal vegetable|fractalveg.jpg]]</div>
<div id="storeNoWarranty" modified="200504100156" modifier="JeremyRuston">TiddlyWiki is a spare time project that I'm making available under an OpenSourceLicense. Accordingly, there's no warranty on it, and you can only use it at your own risk. I am interested in hearing about new bugs to add to the rather rapidly growing pile; just EmailMe.</div>
<div id="storeThirdVersion" modified="200504100159" modifier="JeremyRuston">This is the ThirdVersion of TiddlyWiki, released in April 2005. The SecondVersion was released in December 2004, and before that the FirstVersion in September 2004.</div>
<div id="storeFirstVersion" modified="200504100201" modifier="JeremyRuston">Released in September 2004, the [[first version|firstversion.html]] was pretty basic, weighing in at 52KB.</div>
<div id="storeSecondVersion" modified="200504100203" modifier="JeremyRuston">Released in December 2004, the [[second version|secondversion.html]] of TiddlyWiki grew 50% over the FirstVersion to 76KB. It added IncrementalSearch, the ReferencesButton, the PermaLinkButton, PermaView, CloseAll, SmoothScrolling, an ImprovedSidebar, an animation for the CloseButton and a tiny EasterEgg in homage to Macintosh OS X. It also introduced a new SiteDesign.</div>
<div id="storeDownloadSoftware" modified="200504112306" modifier="JeremyRuston">Because TiddlyWiki is a single HTML file, you've actually already downloaded the entire software just by viewing this site. If you want to be able to SaveChanges, you can save your own TiddlyWiki to your local drive by right clicking on [[this link|#]] and selecting 'Save link as...' or 'Save target as...'. You can choose where to save the file, and what to call it (but keep the .HTML extension).</div>
<div id="storeInternetExplorer" modified="200504120008" modifier="JeremyRuston">InternetExplorer on Windows allows you to SaveChanges in TiddlyWiki. It will give you an ActiveX warning, and ask for your permission to proceed each time. It should work from version 4, but I have only extensively tested against version 6. I have found some annoying difficulties with XpServicePack2, but there's always FireFox.</div>
<div id="storeWikiWord" modified="200504132135" modifier="JeremyRuston">A WikiWord is a word composed of a bunch of other words slammed together with each of their first letters capitalised. WikiWord notation in a conventional WikiWikiWeb is used to name individual pages while TiddlyWiki uses WikiWord titles for smaller chunks of MicroContent. Referring to a page with a WikiWord automatically creates a link to it. Clicking on a link jumps to that page or, if it doesn't exist, to an editor to create it. This ThirdVersion of TiddlyWiki also adds NonWikiWordLinks.</div>
<div id="storeNonWikiWordLinks" modified="200504132137" modifier="JeremyRuston">To make a tiddler that doesn't have a WikiWord as it's name, you can enclose the name in [[double square brackets]] - edit this tiddler to see an example. After saving the tiddler you can then click on the link to create the new tiddler. NonWikiWordLinks permits tiddlers to be created with names that are made from character sets that don't have upper and lower case.</div>
<div id="storeThankYou" modified="200504132138" modifier="JeremyRuston">Thank you to everybody who has helped me with support and suggestions for TiddlyWiki, but especially IsaoSonobe for his cunning regular expression code, and to my friend RebeccaWelby for the SiteDesign.</div>
<div id="storeWikiWikiWeb" modified="200504132139" modifier="JeremyRuston">A Wiki is a popular way of building collaborative websites. It's based on the ideas of easy editing of pages and the use of special WikiWord notation to automagically create links between pages. See Wikipedia for [[more details|http://en.wikipedia.org/wiki/Wiki]]. TiddlyWiki is different from a conventional Wiki because it is not based on entire pages of content, but rather items of MicroContent that are referred to as 'tiddlers'.</div>
<div id="storeUsingThisSite" modified="200504132143" modifier="JeremyRuston">Reading TiddlyWiki is fairly self explanatory. Within the main story column, click on bold links to read a linked tiddler. Click on italic links to create a new tiddler. When you hover the mouse over a tiddler several ToolbarButtons appear. You can edit the text of any tiddler by double-clicking on it (or selecting 'edit' from the toolbar), but your changes won't get saved permanently until you make your own copy of TiddlyWiki, as described in SaveChanges.</div>
<div id="storeToolbarButtons" modified="200504132148" modifier="JeremyRuston">A row of ToolbarButtons appears to the right of a tiddler title when the mouse is hovered over it. The buttons are:\n* ''close'' - close the current tiddler\n* ''edit'' - edit the current tiddler\n* ''permalink'' - puts a link direct to the current tiddler into the address bar\n* ''references'' - displays all the tiddlers that link to the current tiddler\n* ''done'' - save changes to a tiddler being editted\n* ''cancel'' - cancel changes to a tiddler being editted\n* ''delete'' - delete the current tiddler</div>
<div id="storeWritingStyle" modified="200504132150" modifier="JeremyRuston">I'm hoping that after using TiddlyWiki for a while a new WritingStyle will emerge that is appropriate for this medium.  Jakob Neilsen wrote an article about [[writing styles|http://www.useit.com/alertbox/980906.html]] for MicroContent back in 1998 that still seems surprisingly relevant.</div>
<div id="storeServerSide" modified="200504132225" modifier="JeremyRuston">TiddlyWiki doesn't have a server-side back end at the moment, so when you SaveChanges you're saving the whole document, as you would with Microsoft Word. That means that it is essentially only really a SingleUser thing (unless it gets passed round as a ChainTiddlyWiki). There are several TiddlyWikiAdaptations that //do// have a ServerSide, though.</div>
<div id="storeReusingThisSite" modified="200504132235" modifier="JeremyRuston">It's easy to make your own TiddlyWiki that you can publish yourself - see how to SaveChanges for details. If you want to change the layout or the colour scheme, you'll need some basic HTML and CSS knowledge.</div>
<div id="storeServicePack2Problems" modified="200504132259" modifier="JeremyRuston">Internet Explorer Windows XP SP2 seems to have a magical ability to keep track of html files that have been downloaded from the internet and saved on an NTFS drive. By storing additional data in an [[alternate data stream|http://www.jsware.net/jsware/sviewer.html]], it manages to keep them in the 'Internet Zone' regardless of attempts to rename or modify the file. But, in order to be able to SaveChanges, TiddlyWiki needs to run in the 'My Computer Zone'.\n\nThere are a couple of ways around the problem:\n* save the TiddlyWiki HTML file to a FAT drive (eg a USB thumb drive)\n* open the downloaded file with a text editor and save it again under a different name\n\nIn either case, The new file will open in 'My Computer Zone', which in turn causes Internet Explorer to put up it's information bar asking you whether you want to run it. You need to 'Allow blocked content' to let TiddlyWiki do it's stuff.\n\nThis is all a bit frustrating. An easy alternative is to use FireFox, which seems to do the trick on all platforms.</div>
<div id="storeSaveChanges" modified="200504132300" modifier="JeremyRuston">You can SaveChanges if you're using FireFox or InternetExplorer:\n# if you're using Windows XP you might run into ServicePack2Problems\n# right click on [[this link|#]] and select 'Save link as...' or 'Save target as...'\n** choose where to save the file, and what to call it (but keep the .HTML extension)\n# open the newly downloaded file in your browser\n# click the 'options' button on the right to set your username\n# edit, create and delete the tiddlers you want\n** you can change the SpecialTiddlers to change the SiteTitle and MainMenu etc.\n# click the 'save changes' button on the right to save your changes\n# TiddlyWiki will make a backup copy of the existing file, and then replace it with the new version\n</div>
<div id="storeSpecialTiddlers" modified="200504132300" modifier="JeremyRuston">TiddlyWiki uses several special tiddlers to hold the text used for the MainMenu, the SiteTitle and the SiteSubtitle. DefaultTiddlers is used to store the titles of the tiddlers that are shown at startup. SaveChanges is automatically displayed if there's a problem with saving. Any of them can be editted with the changes taking effect immediately.</div>
<div id="storeTiddlyWiki" modified="200504132300" modifier="JeremyRuston">A TiddlyWiki is like a blog because it's divided up into neat little chunks, but it encourages you to read it by hyperlinking rather than sequentially: if you like, a non-linear blog analogue that binds the individual microcontent items into a cohesive whole. I think that TiddlyWiki represents a novel medium for writing, and will promote it's own distinctive WritingStyle. This is the ThirdVersion of TiddlyWiki, which adds several NewFeatures. There are also several TiddlyWikiAdaptations by other developers based on earlier versions.</div>
<div id="storePermaView" modified="200504132301" modifier="JeremyRuston">I think this feature from the SecondVersion of TiddlyWiki is quite original. It's a button in the right-hand sidebar that sets the browser address bar to a URL embodying all the currently open tiddlers in the order that they are currently shown. To use it, arrange the open tiddlers that you want, click the permaview button, copy the URL from the browser address bar, and then paste it into an email, web page or whatever.</div>
<div id="storeIncrementalSearch" modified="200504132301" modifier="JeremyRuston">When you type more than three characters in the search box at the upper right, any matching tiddlers are automatically displayed with the text highlighted. There's a couple of minor issues: the highlights don't get removed when you clear the search, and occasionally, on some browsers, keystrokes get missed if you type quickly so you may need to click the 'search' button to manually trigger the search.</div>
<div id="storeTiddlyWikiFiction" modified="200504132301" modifier="JeremyRuston">TiddlyWiki has been used as the basis of a couple of experiments in hypertext fiction. GinaTrapani created [[Baby Dog Sitter|http://scribbling.net/tiddlywiki-and-non-linear-fiction]] with the FirstVersion of TiddlyWiki, followed by "[[Die, Vampire! Die!|http://www.davidvanwert.com/wiki/dievampiredie.html]]" from DavidVanWert.</div>
<div id="storeReadingExperience" modified="200504132333" modifier="JeremyRuston">The rules governing where a tiddler is displayed sound complicated written down. When you click on a tiddler link within another tiddler, the new one is opened immediately below the current one. If the target tiddler is already open, TiddlyWiki just uses SmoothScrolling to bring it into view. More or less the same thing happens when clicking on a tiddler link within the menu or sidebar, except that the tiddler opens at the top of the page if it is not already open.</div>
<div id="storeEasterEgg" modified="200504132334" modifier="JeremyRuston">Try holding down the alt- or shift-key while clicking on a link to a tiddler, on the 'options' button or on the CloseButton for a tiddler. Kind of a respectful homage to Mac OS X, which does something similar for many of its system animations. (On browsers like InternetExplorer that use the shift key to open a new window, it's best to use the alt-key).</div>
<div id="storeInterfaceOptions" modified="200504132338" modifier="JeremyRuston">InterfaceOptions are displayed when you click the 'options' button on the right. They are saved in a cookie on your browser, making them sticky between visits. RegExpSearch allows more complex search expressions; CaseSensitiveSearch does as it's name implies. The user name for edits should be set //before// starting to edit things (ouch. another bug).</div>
<div id="storeRegExpSearch" modified="200504132345" modifier="JeremyRuston">RegExpSearch uses JavaScript's [[RegExp syntax|http://www.programmershelp.co.uk/docs/javascript/regexp.html#1193188]] to allow flexible searches.</div>
<div id="storeNewFeatures" modified="200504132352" modifier="JeremyRuston">This ThirdVersion of TiddlyWiki adds:\n* the ability to easily SaveChanges on FireFox and InternetExplorer\n* a new liquid CSS layout that fills the width of the browser window \n* some BugFixes\n* a more flexible OpenSourceLicense\n* a bunch of features from IsaoSonobe's [[adaptation|http://www-gauge.scphys.kyoto-u.ac.jp/~sonobe/OgreKit/OgreKitWiki.html]] of TiddlyWiki including ExtendedFormatting, NonWikiWordLinks, PrettyLinks, SubHeadings, BulletPoints, NumberedLists, HtmlTables, BlockQuotes, HorizontalRules and...\n* ...EmbeddedImages:\n[img[brixhamharbour.jpg]]</div>
<div id="storeBlockQuotes" modified="200504140131" modifier="JeremyRuston">JeremyRuston said:\n<<<\nA TiddlyWiki is like a blog because it's divided up into neat little chunks, but it encourages you to read it by hyperlinking rather than sequentially: if you like, a non-linear blog analogue that binds the individual microcontent items into a cohesive whole. I think that TiddlyWiki represents a novel medium for writing, and will promote it's own distinctive WritingStyle. This is the first version of TiddlyWiki and so, as discussed in TiddlyWikiDev, it's bound to be FullOfBugs, have many MissingFeatures and fail to meet all of the DesignGoals. And of course there's NoWarranty, and it might be judged a StupidName.\n<<<\n\n>level 1\n>level 1\n>>level 2\n>>level 2\n>>>level 3\n>>>level 3\n>>level 2\n>level 1\n</div>
<div id="storeTiddlyWikiAdaptations" modified="200504141525" modifier="JeremyRuston">The first and original was [[PhpTiddlyWiki|http://www.patrickcurry.com/tiddly/]] from PatrickCurry and GabrielJeffrey that adds a simple ServerSide in PHP with MySQL. Patrick's site allows anyone to create and edit tiddlers, and has become the de facto community site around TiddlyWiki.\n\nSome of the other adaptations include:\n* HenrikAastedSorensen's at http://aasted.org/wiki\n* IsaoSonobe's OgreKit at http://www-gauge.scphys.kyoto-u.ac.jp/~sonobe/OgreKit/OgreKitWiki.html \n* [[JacquesTurbé]]'s TidliPo, in French at http://avm.free.fr/IMG/html/carnet_gt_BigCo.html\n* ChristianHauck's at http://www.christianhauck.net/html/14300.html\n* TonyLownds's at http://tony.lownds.com/home/\n* PoulStaugaard and IvanMetalnikov's at http://poul.staugaard.dk/IeWiki.htm\n\n* There's also KevemBuangga's TiddlyWikiClone at http://www.kevembuangga.com/tdw/ (caution: on Safari, it seems to get locked up with error alerts)</div>
<div id="storeMainMenu" modified="200504141525" modifier="JeremyRuston">HelloThere TiddlyWiki NewFeatures UsingThisSite ReusingThisSite DownloadSoftware\n\n© [[osmosoft|http://www.osmosoft.com]] 2005</div>
<div id="storeBugFixes" modified="200504141553" modifier="JeremyRuston">This ThirdVersion of TiddlyWiki fixes a problem with line breaks within tiddlers under InternetExplorer. It also tries to avoid closing tiddlers while they are being edited. There's a bunch of smaller BugFixes as well, but they are somewhat balanced by the KnownBugs.</div>
<div id="storeKnownBugs" modified="200504141556" modifier="JeremyRuston">Depending on your browser setup, international Unicode characters don't survive SaveChanges. Very annoying, and definitely needs fixing. It appears that FireFox will always save the file in the native character set rather than UTF-8 -- do please EmailMe if you know a solution.</div></div>
    </body>
</html>